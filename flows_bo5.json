[{"id":"2d98b95a.4f0016","type":"tab","label":"Flow 1","disabled":false,"info":""},{"id":"38dbeb94.870aec","type":"tab","label":"UpdateDNS","disabled":false,"info":"This will keep the current IP of the Pi updated in DNS"},{"id":"96784fe7.2b421","type":"tab","label":"MQTT_Echo","disabled":false,"info":""},{"id":"b3e8b0d6.d2fd48","type":"tab","label":"Notes"},{"id":"f7ae3c4c.0308","type":"tab","label":"SaveToMem"},{"id":"3b15046f.07e474","type":"tab","label":"PublicIP"},{"id":"d7aa7eb2.229b","type":"tab","label":"DistributionBoard","disabled":false,"info":"This is like the Electrical DB Board where you \ncan ensure that if you turn off something, \nit WILL stay turned off."},{"id":"c9ef5ae6.3b2398","type":"tab","label":"ForceOn","disabled":false,"info":""},{"id":"e1c5a709.ef3138","type":"tab","label":"LGC_SPA","disabled":false,"info":"This contains the logical control of the SPA"},{"id":"65fee79d.91ee58","type":"tab","label":"GRP_SPA","disabled":false,"info":"This will define the grouping for the SPA controls"},{"id":"db25ff5f.95a8c","type":"tab","label":"ActualSwitches","disabled":false,"info":"This contains the Actual controls. \nThis will listen to the LOGICAL controls and if allowed will action it on the Actual control."},{"id":"673c5652.d668c8","type":"tab","label":"K145","disabled":false,"info":""},{"id":"d85f09cb.19b96","type":"tab","label":"TemperatureUI"},{"id":"68c40619.e42048","type":"tab","label":"YamahaAVR","disabled":false,"info":""},{"id":"1422562c.1a00aa","type":"tab","label":"IPtoMqtt"},{"id":"959e3a35.8b3bc","type":"tab","label":"Flow 1","disabled":false,"info":""},{"id":"ac05e4f7.9c9b18","type":"tab","label":"InitAlarm","disabled":false,"info":"Initialize the Alarm Object"},{"id":"2dba819.654bb7e","type":"tab","label":"Alarm","disabled":false},{"id":"282b2841.91abf8","type":"tab","label":"ModbusOld","disabled":true,"info":""},{"id":"dd08fb92.1a5348","type":"tab","label":"ElectricityUI"},{"id":"15a592a.c0d836d","type":"tab","label":"Water"},{"id":"58e01940.99fb9","type":"tab","label":"Flow 2","disabled":false,"info":""},{"id":"b65b888a.ee7038","type":"tab","label":"Modbus","disabled":true,"info":""},{"id":"f68fa3d3.e3f83","type":"tab","label":"MySensors","disabled":false,"info":""},{"id":"2c79f7b9.40b25","type":"tab","label":"YeeLights","disabled":false,"info":""},{"id":"46e74d40.66d774","type":"tab","label":"RS485_Switches"},{"id":"74cedccf.2b6a6c","type":"tab","label":"ESP8266"},{"id":"9430e2e4.ec8d2","type":"tab","label":"DashButtons","disabled":false,"info":""},{"id":"ccf72a10.c35188","type":"tab","label":"Scenes","disabled":false,"info":""},{"id":"dce503cb.29adb","type":"tab","label":"Xiaomi","disabled":false,"info":""},{"id":"615e8fde.26f62","type":"tab","label":"UPS","disabled":false,"info":"Monitor the NUT UPS service"},{"id":"77980bcb.4816e4","type":"tab","label":"Zigbee2MQTT","disabled":false,"info":""},{"id":"f7662c55.d7af78","type":"tab","label":"Zigbee2MQTT Admin Panel","disabled":false,"info":""},{"id":"f1d27ec0.44fba","type":"tab","label":"TelegramTest","disabled":false,"info":""},{"id":"17f2fcdf.e26acb","type":"subflow","name":"Network Map","info":"","in":[],"out":[]},{"id":"25dfd7a6.3ce178","type":"subflow","name":"Pairing Notifications","info":"","in":[],"out":[]},{"id":"9c9c1888.cd55a8","type":"subflow","name":"Devices","info":"","in":[],"out":[]},{"id":"ee4ab2d3.1c8a8","type":"subflow","name":"Status","info":"","in":[],"out":[]},{"id":"96bcddc3.ee066","type":"subflow","name":"Logging Level","info":"","in":[],"out":[]},{"id":"42b8f54d.421ebc","type":"subflow","name":"Remove Device","info":"","in":[],"out":[]},{"id":"cc5916a0.c6f7d8","type":"subflow","name":"Permit Join","info":"","in":[],"out":[]},{"id":"30a4c25a.8240d6","type":"subflow","name":"Rename Device","info":"","in":[],"out":[]},{"id":"c93e946f.f9c458","type":"mqtt-broker","z":"","broker":"localhost","port":"1883","clientid":"NodeRed","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"aef1e0bb.41f69","type":"ui_tab","z":"","name":"Lights","icon":"dashboard","order":4},{"id":"ed7f2dfb.7a92c8","type":"ui_base","theme":{"name":"theme-dark","lightTheme":{"default":"#0094CE","baseColor":"#0094CE","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#097479","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"customTheme":{"name":"Untitled Theme 1","default":"#4B7930","baseColor":"#4B7930","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"},"themeState":{"base-color":{"default":"#097479","value":"#097479","edited":false},"page-titlebar-backgroundColor":{"value":"#097479","edited":false},"page-backgroundColor":{"value":"#111111","edited":false},"page-sidebar-backgroundColor":{"value":"#000000","edited":false},"group-textColor":{"value":"#0eb8c0","edited":false},"group-borderColor":{"value":"#555555","edited":false},"group-backgroundColor":{"value":"#333333","edited":false},"widget-textColor":{"value":"#eeeeee","edited":false},"widget-backgroundColor":{"value":"#097479","edited":false},"widget-borderColor":{"value":"#333333","edited":false},"base-font":{"value":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"}}},"site":{"name":"Node-RED Dashboard","hideToolbar":"false","allowSwipe":"false","dateFormat":"DD/MM/YYYY","sizes":{"sx":48,"sy":48,"gx":6,"gy":6,"cx":6,"cy":6,"px":0,"py":0}}},{"id":"7077b4c3.6e2b5c","type":"serial-port","z":"673c5652.d668c8","serialport":"/dev/ttyK145","serialbaud":"2400","databits":"8","parity":"none","stopbits":"1","newline":"\\n","bin":"false","out":"char","addchar":false},{"id":"e6d8a0f0.6f5878","type":"mqtt-broker","z":"","broker":"localhost","port":"1883","clientid":"OH-Nodered","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"141dcbf8.69027c","type":"ui_tab","z":"","name":"HomeTemperatures","icon":"dashboard","order":2},{"id":"83a62c7f.749f78","type":"serial-port","z":"46e74d40.66d774","serialport":"/dev/ttyRS485","serialbaud":"9600","databits":"8","parity":"none","stopbits":"1","newline":"\\n","bin":"false","out":"char","addchar":true},{"id":"56fc61c8.bc429","type":"mqtt-broker","broker":"localhost","port":"1883","clientid":"","usetls":false,"verifyservercert":true,"compatmode":true,"keepalive":15,"cleansession":true,"birthQos":"0","willQos":"0"},{"id":"11456cdd.c29853","type":"mqtt-broker","z":"959e3a35.8b3bc","broker":"localhost","port":"1883","clientid":"","usetls":false,"verifyservercert":true,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthRetain":null,"birthPayload":"","willTopic":"","willQos":"0","willRetain":null,"willPayload":""},{"id":"17911408.3b4a8c","type":"mqtt-broker","z":"959e3a35.8b3bc","broker":"localhost","port":"1883","clientid":"","usetls":false,"verifyservercert":true,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"stat/sonoff/BIRTH","birthQos":"0","birthRetain":null,"birthPayload":"","willTopic":"","willQos":"0","willRetain":null,"willPayload":""},{"id":"573c68fe.418c","type":"ui_group","z":"d85f09cb.19b96","name":"Temperature","tab":"141dcbf8.69027c","disp":true,"width":"6"},{"id":"d25c6664.5d0f7","type":"ui_group","z":"68c40619.e42048","name":"AV","tab":"8950eb7c.9b5a4","disp":true,"width":"6","collapse":false},{"id":"e8d9676b.c2da8","type":"ui_tab","z":"","name":"Alarm","icon":"dashboard","order":5},{"id":"2428ec5c.a7feb4","type":"ui_group","z":"","name":"Zone Faults","tab":"e8d9676b.c2da8","order":3,"disp":true,"width":"6"},{"id":"cd06456d.06dad","type":"ui_group","z":"","name":"Alarm status","tab":"51d0b260.80ad2c","order":1,"disp":true,"width":"11"},{"id":"e01fac45.796008","type":"ui_group","z":"","name":"Remote Controls","tab":"e8d9676b.c2da8","order":1,"disp":true,"width":"6"},{"id":"9b6d8de1.d06a2","type":"ui_group","z":"","name":"Zone Bypass","tab":"e8d9676b.c2da8","order":4,"disp":true,"width":"6"},{"id":"dbeda778.10fe88","type":"ui_group","z":"","name":"Alarm Controls","tab":"e8d9676b.c2da8","order":2,"disp":true,"width":"6"},{"id":"51d0b260.80ad2c","type":"ui_tab","z":"","name":"Alarm Status","icon":"dashboard","order":6},{"id":"160a0996.5db486","type":"ui_tab","z":"46e74d40.66d774","name":"Besproeiing","icon":"dashboard","order":7},{"id":"14fdd9e3.cf19d6","type":"ui_group","z":"46e74d40.66d774","name":"Besproeiing","tab":"160a0996.5db486","disp":true,"width":"6"},{"id":"a004db13.9e779","type":"ui_group","z":"","name":"Total","tab":"147f8c3c.9bb844","order":1,"disp":true,"width":"6"},{"id":"147f8c3c.9bb844","type":"ui_tab","z":"","name":"Electricity","icon":"dashboard","order":8},{"id":"ff843fa0.47e1f8","type":"ui_group","z":"","name":"Main Geyser","tab":"147f8c3c.9bb844","order":2,"disp":true,"width":"6"},{"id":"ccb1e8a8.5b78e","type":"tls-config","z":"","name":"EmonCMS","cert":"","key":"","ca":"","verifyservercert":true},{"id":"7c8cbdf4.aadd04","type":"avr-yamaha","z":"68c40619.e42048","name":"RX-810a","address":"192.168.10.79","port":"80","debug":false},{"id":"8214cb12.410308","type":"ui_group","z":"","name":"Pool2","tab":"f4c24575.d66658","order":4,"disp":true,"width":"6"},{"id":"11d95f23.707241","type":"ui_tab","z":"","name":"Electricity Graphs","icon":"dashboard","order":9},{"id":"eb7269e5.08d1e8","type":"ui_group","z":"","name":"ElecGraphGroup","tab":"11d95f23.707241","order":1,"disp":true,"width":"6"},{"id":"8b2d0a3a.81cc58","type":"ui_group","z":"","name":"Sonoff Pows","tab":"147f8c3c.9bb844","order":3,"disp":true,"width":"6"},{"id":"f23a42a6.26fc7","type":"ui_group","z":"","name":"SDM120 Energy Meter","tab":"52841c1c.773884","order":2,"disp":true,"width":"6"},{"id":"52841c1c.773884","type":"ui_tab","z":"","name":"Modbus","icon":"memory","order":10},{"id":"e94298e5.59ac4","type":"modbus-client","z":"","name":"Local Write VServer","clienttype":"tcp","bufferCommands":true,"stateLogEnabled":false,"tcpHost":"127.0.0.1","tcpPort":"10502","serialPort":"/dev/ttyUSB","serialType":"RTU-BUFFERD","serialBaudrate":"9600","serialDatabits":"8","serialStopbits":"1","serialParity":"none","serialConnectionDelay":"100","unit_id":1,"commandDelay":1,"clientTimeout":1000,"reconnectTimeout":2000},{"id":"b265406e.3b7b68","type":"modbus-client","z":"","name":"Local Write VServer","clienttype":"tcp","bufferCommands":true,"stateLogEnabled":false,"tcpHost":"127.0.0.1","tcpPort":"10502","serialPort":"/dev/ttyUSB","serialType":"RTU-BUFFERD","serialBaudrate":"9600","serialDatabits":"8","serialStopbits":"1","serialParity":"none","serialConnectionDelay":"100","unit_id":1,"commandDelay":1,"clientTimeout":1000,"reconnectTimeout":2000},{"id":"408cb596.0ecdfc","type":"modbus-client","z":"","name":"ttyMODBUS1","clienttype":"serial","bufferCommands":true,"stateLogEnabled":false,"tcpHost":"127.0.0.1","tcpPort":"502","tcpType":"DEFAULT","serialPort":"/dev/ttyMODBUS","serialType":"RTU-BUFFERD","serialBaudrate":"9600","serialDatabits":"8","serialStopbits":"1","serialParity":"none","serialConnectionDelay":"100","unit_id":"","commandDelay":"30","clientTimeout":"2000","reconnectTimeout":"5000"},{"id":"57345486.b86a3c","type":"ui_group","z":"","name":"SDM220 Energy Meter","tab":"52841c1c.773884","order":1,"disp":true,"width":"6"},{"id":"36ab42a9.872cd6","type":"ui_group","z":"","name":"Default","tab":"44fc7bf4.12e43c","order":1,"disp":true,"width":"6"},{"id":"44fc7bf4.12e43c","type":"ui_tab","z":"","name":"testing","icon":"dashboard","order":11},{"id":"b05f77bc.c79d48","type":"mqtt-broker","z":"","broker":"192.168.92.5","port":"1883","clientid":"","usetls":false,"verifyservercert":false,"compatmode":false,"keepalive":"15","cleansession":true,"birthTopic":"","birthQos":"0","birthRetain":"false","birthPayload":"","willTopic":"","willQos":"1","willRetain":"false","willPayload":""},{"id":"a0c03515.da6558","type":"serial-port","z":"f68fa3d3.e3f83","serialport":"/dev/serial/by-id/usb-1a86_USB2.0-Serial-if00-port0","serialbaud":"115200","databits":"8","parity":"none","stopbits":"1","newline":"\\n","bin":"false","out":"char","addchar":false},{"id":"5c45879e.172aa8","type":"ui_group","z":"","name":"Yeelight Smart Bulb","tab":"77c5cef3.c2d638","order":1,"disp":true,"width":"6"},{"id":"77c5cef3.c2d638","type":"ui_tab","z":"","name":"Office","icon":"dashboard","order":12},{"id":"8950eb7c.9b5a4","type":"ui_tab","z":"","name":"TV","icon":"dashboard","order":13},{"id":"e556caad.2d2b4","type":"ui_group","z":"","name":"YL Smartlight TV","tab":"8950eb7c.9b5a4","disp":true,"width":"6"},{"id":"7349f708.a5d668","type":"ui_tab","z":"","name":"Switch Board","icon":"dashboard","order":14},{"id":"785a2ca0.c143a4","type":"ui_group","z":"","name":"Group Items","tab":"7349f708.a5d668","disp":true,"width":"6"},{"id":"cf0fd28f.ebb02","type":"ui_group","z":"","name":"Outdoor Lights","tab":"7349f708.a5d668","order":2,"disp":true,"width":"6"},{"id":"881ef573.833e98","type":"ui_group","z":"","name":"Indoor Lights","tab":"7349f708.a5d668","order":3,"disp":true,"width":"6"},{"id":"3fe74f67.052ce","type":"ui_group","z":"","name":"Security Lights","tab":"7349f708.a5d668","order":4,"disp":true,"width":"6"},{"id":"49045aeb.df53e4","type":"ui_group","z":"","name":"Pool","tab":"7349f708.a5d668","order":5,"disp":true,"width":"6"},{"id":"c4d90b7b.308278","type":"ui_group","z":"","name":"Spa","tab":"7349f708.a5d668","disp":true,"width":"6"},{"id":"f4c24575.d66658","type":"ui_tab","z":"","name":"Lapa Pool Spa","icon":"dashboard","order":15},{"id":"71ed9bad.c81874","type":"ui_group","z":"","name":"Lapa","tab":"f4c24575.d66658","order":1,"disp":true,"width":"6"},{"id":"9ace3d17.d3c63","type":"ui_group","z":"","name":"Pool","tab":"f4c24575.d66658","order":2,"disp":true,"width":"6"},{"id":"f8c6294.02cb4d8","type":"ui_group","z":"","name":"Spa","tab":"f4c24575.d66658","order":3,"disp":true,"width":"6"},{"id":"86cdb25c.bbd3a","type":"yeelight-compat-hue-config","z":"","hostname":"192.168.10.81","port":"55443","name":"YL_TVRoomBackWall"},{"id":"1d4318d6.fee087","type":"yeelight-compat-hue-config","z":"","hostname":"192.168.10.80","port":"55443","name":"YL_Study"},{"id":"1bcfb093.fcf287","type":"ui_tab","z":"","name":"Control","icon":"wb_incandescent","order":1},{"id":"3187280a.d5d678","type":"sqlitedb","z":"","db":"/home/pi/buttons.db"},{"id":"9a9f1f9.e13a5e","type":"xiaomi-configurator","z":"","name":"XiaomiGateway1","ip":"192.168.10.90","sid":"7811dce17bad","deviceList":[{"sid":"158d000186dec6","desc":"XiaomiAquaraSwitch1","model":"switch"},{"sid":"158d000186deda","desc":"XiaomiAquaraSwitch2","model":"switch"}],"key":"ju6pb91rcql5ny53"},{"id":"4357843d.5f1d34","type":"ui_group","z":"","name":"Kasligte","tab":"aef1e0bb.41f69","order":3,"disp":true,"width":"6","collapse":false},{"id":"6eaf738f.cbb964","type":"ui_group","z":"","name":"Ligte","tab":"aef1e0bb.41f69","order":1,"disp":true,"width":"6","collapse":false},{"id":"112c9a5e.08e73e","type":"mqtt-broker","broker":"192.168.1.17","port":"1883","clientid":"node-red","usetls":false,"verifyservercert":true,"compatmode":true,"keepalive":15,"cleansession":true,"birthQos":"0","willQos":"0"},{"id":"c52b78ea.b74b88","type":"ui_group","z":"","name":"UPS Load","tab":"bf71a629.c85d88","disp":true,"width":"6"},{"id":"64214ba9.d37bcc","type":"ui_group","z":"","name":"UPS Battery","tab":"bf71a629.c85d88","disp":true,"width":"6"},{"id":"1330971f.f66ce1","type":"ui_group","z":"","name":"Input Voltage","tab":"bf71a629.c85d88","disp":true,"width":"6"},{"id":"8371fcf7.880f8","type":"ui_group","z":"","name":"UPS Runtime","tab":"bf71a629.c85d88","disp":true,"width":"6"},{"id":"bf71a629.c85d88","type":"ui_tab","z":"","name":"UPS","icon":"dashboard","order":2},{"id":"5c97d771.4af83","type":"ui_group","z":"9c9c1888.cd55a8","name":"Devices","tab":"cf04e4d3.2bdd1","order":6,"disp":true,"width":"12","collapse":false},{"id":"13d7525b.841376","type":"ui_group","z":"","name":"Status","tab":"cf04e4d3.2bdd1","order":1,"disp":true,"width":"6","collapse":false},{"id":"e08ef83b.319a4","type":"ui_group","z":"96bcddc3.ee066","name":"Logging Level","tab":"cf04e4d3.2bdd1","order":3,"disp":true,"width":"6","collapse":false},{"id":"21062c5b.b1996c","type":"ui_group","z":"42b8f54d.421ebc","name":"Remove Device","tab":"cf04e4d3.2bdd1","order":4,"disp":true,"width":"6","collapse":false},{"id":"6354184f.0cac68","type":"mqtt-broker","z":"","name":"MQTT","broker":"192.168.10.8","port":"1883","clientid":"","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"domoticz/bridge/state","birthQos":"0","birthPayload":"online","willTopic":"","willQos":"0","willPayload":""},{"id":"4c9b5ea9.896df8","type":"ui_group","z":"","name":"Permit Join","tab":"cf04e4d3.2bdd1","order":2,"disp":true,"width":"6","collapse":false},{"id":"2446b16a.26b45e","type":"ui_group","z":"","name":"Rename Device","tab":"cf04e4d3.2bdd1","order":5,"disp":true,"width":"6","collapse":false},{"id":"ad236b55.6b1d","type":"mqtt-broker","z":"","name":"MQTT","broker":"192.168.10.8","port":"1883","clientid":"","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"cf04e4d3.2bdd1","type":"ui_tab","z":"","name":"Zigbee2MQTT Admin Panel","icon":"dashboard"},{"id":"5110ad9.459dfd4","type":"chatbot-telegram-node","z":"","botname":"BO5DevBot","usernames":"orgjvr","providerToken":"","polling":"500","store":"","log":"","parseMode":"","debug":true,"webHook":"","connectMode":"polling"},{"id":"6e0b1483.5b9484","type":"chatbot-telegram-node","z":"","botname":"BO5Bot","usernames":"orgjvr","providerToken":"","polling":"500","store":"","log":"","parseMode":"","debug":false,"webHook":"","connectMode":"polling"},{"id":"83131c0f.ba1218","type":"inject","z":"38dbeb94.870aec","name":"Get IP","topic":"ip","payload":"","payloadType":"str","repeat":"300","crontab":"","once":false,"x":161,"y":121,"wires":[["574551fa.0a2e8"]]},{"id":"574551fa.0a2e8","type":"exec","z":"38dbeb94.870aec","command":"wget -qO- http://bot.whatismyipaddress.com/ ; echo","append":"","useSpawn":"","name":"Call IP - whatismyipaddress.com","x":433,"y":134.5,"wires":[["dfa63048.8bfac"],[],[]]},{"id":"dfa63048.8bfac","type":"switch","z":"38dbeb94.870aec","name":"Integrity check","property":"payload","rules":[{"t":"regex","v":"\\b(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\b"},{"t":"else"}],"checkall":"true","outputs":2,"x":677,"y":122.5,"wires":[["141baf19.797309","6ecc3f81.267f2"],["91b26d17.b2841"]]},{"id":"141baf19.797309","type":"function","z":"38dbeb94.870aec","name":"Swallow unchanged IP message","func":"\nglobal.ip = global.ip || 'initial_no_update';\nvar currentip = msg.payload;\n//update';\n//global.ip = global.ip ||\nif (global.ip == 'initial_no_update') {\n    msg.payload = \"My IP is still the same \"+currentip;\n    global.ip = currentip;\n    return [null,msg];\n}\nelse if (global.ip != currentip) {\n    msg.payload = \"My new IP is \"+currentip;\n//\tmsg.payload = currentip;\n    global.ip = currentip;\n    return [msg,null];\n}\n","outputs":"2","noerr":0,"x":336,"y":264,"wires":[["9540d1a6.aa5e18","f0bb2dea.df1fe"],["46b7052c.d9088c"]]},{"id":"9540d1a6.aa5e18","type":"http request","z":"38dbeb94.870aec","name":"Update zoneedit","method":"GET","paytoqs":false,"url":"https://dynamic.zoneedit.com/auth/dynamic.html?host=hapi.picolli.com&dnsto={{context.lastip}}","tls":"","proxy":"","authType":"basic","x":441,"y":440,"wires":[["f8f446bb.f5189"]]},{"id":"f8f446bb.f5189","type":"switch","z":"38dbeb94.870aec","name":"","property":"payload","rules":[{"t":"regex","v":"2\\d\\d"},{"t":"else"}],"checkall":"false","outputs":2,"x":626,"y":444,"wires":[["4f478ea9.9c736","4a85031e.51d474"],["a61e2373.cf3268","4f478ea9.9c736"]]},{"id":"4f478ea9.9c736","type":"file","z":"38dbeb94.870aec","name":"","filename":"dyndns.log","appendNewline":true,"createDir":false,"overwriteFile":false,"x":899,"y":426,"wires":[[]]},{"id":"ded3745c.af61a","type":"comment","z":"38dbeb94.870aec","name":"Keep the DNS updated with dynamic Public IP","info":"Keep the DNS updated with dynamic Public IP\nSet the URL and username/password in the HTTP Request node.\nThis will also update the global.ip variable with the current value.\n","x":462,"y":43,"wires":[]},{"id":"4a85031e.51d474","type":"debug","z":"38dbeb94.870aec","name":"UpdateSuccess","active":false,"console":"false","complete":"payload","x":887,"y":372,"wires":[]},{"id":"a61e2373.cf3268","type":"debug","z":"38dbeb94.870aec","name":"UpdateFailed","active":false,"console":"false","complete":"payload","x":884,"y":487,"wires":[]},{"id":"f0bb2dea.df1fe","type":"debug","z":"38dbeb94.870aec","name":"IPChanged","active":false,"console":"false","complete":"payload","x":677,"y":250,"wires":[]},{"id":"6ecc3f81.267f2","type":"debug","z":"38dbeb94.870aec","name":"ValidIP","active":false,"console":"false","complete":"payload","x":963,"y":64,"wires":[]},{"id":"91b26d17.b2841","type":"debug","z":"38dbeb94.870aec","name":"InvalidIP","active":false,"console":"false","complete":"payload","x":968,"y":127,"wires":[]},{"id":"7909f35c.9035f4","type":"function","z":"2d98b95a.4f0016","name":"debug","func":"global.lastip = global.lastip || 'update2';\n\nmsg.payload = global.lastip;\nreturn msg;","outputs":1,"noerr":0,"x":439,"y":155,"wires":[["c1c49252.5da11"]]},{"id":"c1c49252.5da11","type":"debug","z":"2d98b95a.4f0016","name":"","active":false,"console":"false","complete":"false","x":721,"y":154,"wires":[]},{"id":"7520ffb5.dd39d","type":"inject","z":"2d98b95a.4f0016","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":245,"y":148,"wires":[["7909f35c.9035f4"]]},{"id":"46b7052c.d9088c","type":"debug","z":"38dbeb94.870aec","name":"IPSame","active":true,"console":"false","complete":"payload","x":637,"y":292,"wires":[]},{"id":"493431f0.54562","type":"mqtt in","z":"96784fe7.2b421","name":"AllMessages","topic":"#","qos":"2","broker":"c93e946f.f9c458","x":298,"y":235,"wires":[["1d404b84.a8b844"]]},{"id":"1d404b84.a8b844","type":"debug","z":"96784fe7.2b421","name":"","active":false,"console":"false","complete":"false","x":585,"y":239,"wires":[]},{"id":"d07be997.27061","type":"inject","z":"673c5652.d668c8","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":258.5,"y":232,"wires":[["e02c9d02.8491f"]]},{"id":"8be7a35a.aa13e","type":"debug","z":"673c5652.d668c8","name":"","active":false,"console":"false","complete":"false","x":736.5,"y":240,"wires":[]},{"id":"e02c9d02.8491f","type":"function","z":"673c5652.d668c8","name":"","func":"// Create a Date object from the payload\nvar date = new Date(msg.payload);\n// Change the payload to be a formatted Date string\nmsg.payload = date.toString();\n// Return the message so it can be sent on\nreturn msg;","outputs":1,"noerr":0,"x":445.5,"y":284,"wires":[["8be7a35a.aa13e"]]},{"id":"28793e69.bdcc7a","type":"serial in","z":"673c5652.d668c8","name":"/dev/ttyK145","serial":"7077b4c3.6e2b5c","x":221.5,"y":407,"wires":[["cbbe33f.c22c7d"]]},{"id":"c97e4e57.ba9ea","type":"debug","z":"673c5652.d668c8","name":"","active":false,"console":"false","complete":"false","x":885.5,"y":438,"wires":[]},{"id":"cbbe33f.c22c7d","type":"function","z":"673c5652.d668c8","name":"","func":"// Create a Date object from the payload\n//var temp = new String(msg.payload);\n// Change the payload to be a formatted Date string\n//var sensor_id=new String(msg.payload.split(\" \")[0]);\n//var temp = new String(msg.payload.split(\" \")[1]);\nvar sensor_id = msg.payload.split(\" \")[0];\nvar temp = msg.payload.split(\" \")[1];\nmsg.payload = sensor_id+\":\"+temp;\n// Return the message so it can be sent on\nreturn msg;","outputs":"1","noerr":0,"x":438.5,"y":454,"wires":[["c97e4e57.ba9ea","3630fa4f.4a3f96"]]},{"id":"22fa3377.273434","type":"mqtt out","z":"673c5652.d668c8","name":"ServerKasTemperatuur","topic":"/temp/ServerKas","qos":"0","retain":"false","broker":"e6d8a0f0.6f5878","x":1167.5,"y":522,"wires":[]},{"id":"3630fa4f.4a3f96","type":"switch","z":"673c5652.d668c8","name":"TemperatueLocation","property":"payload","propertyType":"msg","rules":[{"t":"cont","v":"1:","vt":"str"},{"t":"cont","v":"2:","vt":"str"},{"t":"cont","v":"3:","vt":"str"},{"t":"cont","v":"4:","vt":"str"}],"checkall":"false","outputs":4,"x":680.5,"y":532,"wires":[["cb2be28a.21092"],["e340b701.6da7b"],["dc1663fc.ea01"],["78667dc0.71e684","dc128a13.8d63d8"]]},{"id":"d1e55c8b.481388","type":"mqtt out","z":"673c5652.d668c8","name":"SpensTemperatuur","topic":"/temp/Spens","qos":"0","retain":"true","broker":"e6d8a0f0.6f5878","x":1181.5,"y":585,"wires":[]},{"id":"b42f9e18.9f2db8","type":"mqtt out","z":"673c5652.d668c8","name":"BuiteTemperatuur","topic":"/temp/Buite","qos":"","retain":"","broker":"e6d8a0f0.6f5878","x":1170.5,"y":701,"wires":[]},{"id":"29991b20.d3dbfc","type":"mqtt out","z":"673c5652.d668c8","name":"TVKamerTemperatuur","topic":"/temp/TVKamer","qos":"0","retain":"true","broker":"e6d8a0f0.6f5878","x":1172.5,"y":649,"wires":[]},{"id":"35460e5.b6262f2","type":"ui_gauge","z":"d85f09cb.19b96","name":"Outside Temperature","group":"573c68fe.418c","order":1,"width":"3","height":"3","gtype":"gage","title":"Buite","label":"","format":"{{value}}","min":"10","max":"50","x":712.5,"y":293,"wires":[]},{"id":"4944abb0.b40234","type":"mqtt in","z":"d85f09cb.19b96","name":"BuiteTemperatuur","topic":"/temp/Buite","qos":"0","broker":"e6d8a0f0.6f5878","x":172.5,"y":302,"wires":[["35460e5.b6262f2"]]},{"id":"cefc8bdd.15dde8","type":"ui_gauge","z":"d85f09cb.19b96","name":"ServerKas Temperature","group":"573c68fe.418c","order":1,"width":"3","height":"3","gtype":"gage","title":"Server Kas","label":"","format":"{{value}}","min":"20","max":"40","x":645,"y":162,"wires":[]},{"id":"2da34ea5.f833fa","type":"mqtt in","z":"d85f09cb.19b96","name":"ServerKasTemperatuur","topic":"/temp/ServerKas","qos":"0","broker":"e6d8a0f0.6f5878","x":175,"y":162,"wires":[["cefc8bdd.15dde8"]]},{"id":"50af3579.ebb81c","type":"ui_gauge","z":"d85f09cb.19b96","name":"Spens Temperature","group":"573c68fe.418c","order":1,"width":"3","height":"3","gtype":"gage","title":"Spens","label":"","format":"{{value}}","min":"0","max":"40","x":694,"y":416,"wires":[]},{"id":"6ea34cfd.12629c","type":"mqtt in","z":"d85f09cb.19b96","name":"SpensTemperatuur","topic":"/temp/Spens","qos":"0","broker":"e6d8a0f0.6f5878","x":154,"y":425,"wires":[["50af3579.ebb81c"]]},{"id":"e7c7a5ec.baf73","type":"ui_gauge","z":"d85f09cb.19b96","name":"TV Kamer Temperature","group":"573c68fe.418c","order":1,"width":"3","height":"3","gtype":"gage","title":"TV Kamer","label":"","format":"{{value}}","min":"0","max":"40","x":645,"y":593,"wires":[]},{"id":"f8de47ac.15054","type":"mqtt in","z":"d85f09cb.19b96","name":"TVKamerTemperatuur","topic":"/temp/TVKamer","qos":"0","broker":"e6d8a0f0.6f5878","x":166,"y":565,"wires":[["e7c7a5ec.baf73"]]},{"id":"4b3c16e1.3d067","type":"inject","z":"3b15046f.07e474","name":"Get IP","topic":"Public IP Address","payload":"eth0","payloadType":"str","repeat":"120","crontab":"","once":true,"onceDelay":"","x":160,"y":64.5,"wires":[["4620fea2.67fa28"]]},{"id":"32bbf5a.1bcca0a","type":"function","z":"3b15046f.07e474","name":"Compare IP","func":"var currentip = msg.payload;\n\nif (context.global.CurrentPublicIP != currentip.trim(\" \")) {\nmsg.payload = \"My IP changed from \"+context.global.CurrentPublicIP+\" to \"+currentip;\nmsg2 = {};\nmsg2.payload = currentip.trim(\" \");\n\nreturn [msg,msg2,null];\n} else {\n    msg.payload = \"My IP is same (\"+currentip+\")\"  \n    return [null,null,msg];\n}    ","outputs":"3","noerr":0,"x":687,"y":301,"wires":[["5e6136c1.0ea6e8","a8ce281.e5f0058"],["9ae5ac95.4e883","2aba74b9.58b97c","15e74e05.f8bfca","f5d84b30.cdbea8"],["d969452a.14985"]]},{"id":"4620fea2.67fa28","type":"exec","z":"3b15046f.07e474","command":"wget -qO- http://bot.whatismyipaddress.com/ ; echo","addpay":false,"append":"","useSpawn":"","timer":"","name":"Call IP - whatismyipaddress.com","x":230,"y":261,"wires":[["f338e63c.720d78"],[],[]]},{"id":"f338e63c.720d78","type":"switch","z":"3b15046f.07e474","name":"Integrity check","property":"payload","propertyType":"msg","rules":[{"t":"regex","v":"\\b(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\b","vt":"str","case":false},{"t":"else"}],"checkall":"true","outputs":2,"x":295,"y":443,"wires":[["32bbf5a.1bcca0a"],["3e4f32cb.0fc5f6"]]},{"id":"5e6136c1.0ea6e8","type":"debug","z":"3b15046f.07e474","name":"","active":true,"console":"false","complete":"payload","x":1177.5,"y":105,"wires":[]},{"id":"8aab331b.23fd38","type":"catch","z":"68c40619.e42048","name":"Errors","scope":null,"x":204.5,"y":345,"wires":[["cba80447.c4d258"]]},{"id":"cba80447.c4d258","type":"debug","z":"68c40619.e42048","name":"ErrorMsgs","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":398.5,"y":341,"wires":[]},{"id":"cb2be28a.21092","type":"function","z":"673c5652.d668c8","name":"","func":"msg.payload=msg.payload.split(\":\")[1];\nreturn msg;","outputs":1,"noerr":0,"x":938.5,"y":496,"wires":[["22fa3377.273434"]]},{"id":"e340b701.6da7b","type":"function","z":"673c5652.d668c8","name":"","func":"msg.payload=msg.payload.split(\":\")[1];\nreturn msg;","outputs":1,"noerr":0,"x":972,"y":562,"wires":[["d1e55c8b.481388"]]},{"id":"dc1663fc.ea01","type":"function","z":"673c5652.d668c8","name":"","func":"msg.payload=msg.payload.split(\":\")[1];\nreturn msg;","outputs":1,"noerr":0,"x":978,"y":615,"wires":[["29991b20.d3dbfc"]]},{"id":"78667dc0.71e684","type":"function","z":"673c5652.d668c8","name":"","func":"msg.payload=msg.payload.split(\":\")[1];\nreturn msg;","outputs":1,"noerr":0,"x":971,"y":665,"wires":[["b42f9e18.9f2db8"]]},{"id":"9ae5ac95.4e883","type":"debug","z":"3b15046f.07e474","name":"msg2","active":true,"console":"false","complete":"payload","x":1136.5,"y":333,"wires":[]},{"id":"268833f.7d0e8cc","type":"mqtt in","z":"f7ae3c4c.0308","name":"/IP/PublicDSL","topic":"/IP/PublicDSL","qos":"2","broker":"e6d8a0f0.6f5878","x":409,"y":192,"wires":[["11b75eda.64d4a9"]]},{"id":"11b75eda.64d4a9","type":"function","z":"f7ae3c4c.0308","name":"Save2Mem","func":"context.global.CurrentPublicIP = msg.payload;\nmsg.payload=\"Saving Current IP (\"+msg.payload+\") to Memory \";\nreturn msg;","outputs":1,"noerr":0,"x":659.5,"y":192,"wires":[["af45e978.194d98"]]},{"id":"af45e978.194d98","type":"debug","z":"f7ae3c4c.0308","name":"Debug","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":893.5,"y":190,"wires":[]},{"id":"11620596.6e5c2a","type":"mqtt out","z":"1422562c.1a00aa","name":"MqttPublicIP","topic":"/IP/PublicDSL","qos":"0","retain":"true","broker":"e6d8a0f0.6f5878","x":850,"y":154,"wires":[]},{"id":"a4a575de.013","type":"inject","z":"1422562c.1a00aa","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":337.5,"y":147,"wires":[["c0712cc4.cf197"]]},{"id":"c0712cc4.cf197","type":"function","z":"1422562c.1a00aa","name":"","func":"msg.payload=\"196.215.17.192a\";\nreturn msg;","outputs":1,"noerr":0,"x":595.5,"y":152,"wires":[["11620596.6e5c2a"]]},{"id":"2aba74b9.58b97c","type":"mqtt out","z":"3b15046f.07e474","name":"MqttPublicIP","topic":"/IP/PublicDSL","qos":"0","retain":"true","broker":"e6d8a0f0.6f5878","x":1161,"y":400,"wires":[]},{"id":"a8ce281.e5f0058","type":"e-mail","z":"3b15046f.07e474","server":"smtp.gmail.com","port":"465","secure":true,"name":"org@picolli.com","dname":"SendToOrg","x":1180,"y":153,"wires":[]},{"id":"769f6cb7.de1484","type":"serial out","z":"46e74d40.66d774","name":"ttyRS485","serial":"83a62c7f.749f78","x":1011.5,"y":528,"wires":[]},{"id":"e146e9af.cfc538","type":"function","z":"46e74d40.66d774","name":"","func":"/*8 Data, 1 Stop, No Parity\nBaud rate : 9600\n\nCommands:\nFIRST Output commands:\nOFF command : FF 01 00 (HEX) or 255 01 0 (DEC)\nON command : FF 01 01 (HEX) or 255 01 1 (DEC)\n...\nEIGHT Output commands:\nOFF command : FF 08 00 (HEX) or 255 08 0 (DEC)\nON command : FF 08 01 (HEX) or 255 08 1 (DEC)\n*/\n//msg.payload=xFFx18x01\";\n\n\n\nvar buf = new Buffer(3);\nbuf.writeUInt8(0xFF, 0);\nbuf.writeUInt8(0x16, 1);\nif (msg.payload==1) {\n  buf.writeUInt8(0x01, 2);\n} else {\n  buf.writeUInt8(0x00, 2);\n}\nmsg.payload=buf;\nreturn msg;","outputs":"1","noerr":0,"x":671.5,"y":456,"wires":[["769f6cb7.de1484","cef5c4c7.564d1"]]},{"id":"cef5c4c7.564d1","type":"debug","z":"46e74d40.66d774","name":"","active":false,"console":"false","complete":"payload","x":1002.5,"y":608,"wires":[]},{"id":"d94bf8e3.a22678","type":"mqtt in","z":"46e74d40.66d774","name":"MqttRS485","topic":"/RS485/Ligte/BuitLigte/state2","qos":"2","broker":"e6d8a0f0.6f5878","x":434.5,"y":406,"wires":[["e146e9af.cfc538"]]},{"id":"669db5db.b34d6c","type":"mqtt out","z":"1422562c.1a00aa","name":"MqttBuiteLigte","topic":"/RS485/BuitLigte/state","qos":"0","retain":"true","broker":"e6d8a0f0.6f5878","x":860,"y":271,"wires":[]},{"id":"defc3625.57f478","type":"inject","z":"1422562c.1a00aa","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":337.5,"y":264,"wires":[["49fdba6d.414054"]]},{"id":"49fdba6d.414054","type":"function","z":"1422562c.1a00aa","name":"","func":"msg.payload=0;\nreturn msg;","outputs":1,"noerr":0,"x":595.5,"y":269,"wires":[["669db5db.b34d6c"]]},{"id":"7f5ae6e1.c4ac18","type":"mqtt out","z":"959e3a35.8b3bc","name":"","topic":"","qos":"0","retain":"false","broker":"17911408.3b4a8c","x":569,"y":452,"wires":[]},{"id":"fab262a8.8035","type":"inject","z":"959e3a35.8b3bc","name":"Toggle switch","topic":"cmnd/sonoff/light","payload":"toggle","payloadType":"str","repeat":"","crontab":"","once":false,"x":169,"y":452,"wires":[["7f5ae6e1.c4ac18"]]},{"id":"b8e8560.09cfb28","type":"mqtt in","z":"959e3a35.8b3bc","name":"","topic":"stat/sonoff/LIGHT/#","broker":"17911408.3b4a8c","x":169,"y":192,"wires":[["964d3659.c44a7","73f6390c.8d26c8"]]},{"id":"73f6390c.8d26c8","type":"debug","z":"959e3a35.8b3bc","name":"Sonoff -> Domoticz","active":false,"console":"false","complete":"payload","x":529,"y":132,"wires":[]},{"id":"9632d4b2.38de08","type":"mqtt out","z":"959e3a35.8b3bc","name":"","topic":"","qos":"0","retain":"false","broker":"17911408.3b4a8c","x":569,"y":532,"wires":[]},{"id":"9e21666e.eec7f8","type":"inject","z":"959e3a35.8b3bc","name":"Restart Sonoff","topic":"cmnd/sonoff/restart","payload":"1","payloadType":"str","repeat":"","crontab":"","once":false,"x":169,"y":532,"wires":[["9632d4b2.38de08"]]},{"id":"ef42d068.00e1f8","type":"mqtt out","z":"959e3a35.8b3bc","name":"","topic":"domoticz/in","qos":"","retain":"","broker":"11456cdd.c29853","x":729,"y":192,"wires":[]},{"id":"964d3659.c44a7","type":"template","z":"959e3a35.8b3bc","name":"idx:336","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{\n \"command\" : \"switchlight\",\n \"idx\" : 336,\n \"switchcmd\" : \"{{payload}}\"\n}","x":499,"y":192,"wires":[["ef42d068.00e1f8"]]},{"id":"93c8abf9.fbd02","type":"mqtt in","z":"959e3a35.8b3bc","name":"Domoticz","topic":"domoticz/out/#","broker":"17911408.3b4a8c","x":100,"y":335,"wires":[["1b7769d2.c5cf8e","827263d9.67174"]]},{"id":"eb23022c.6bb34","type":"function","z":"959e3a35.8b3bc","name":"Filter message","func":"var msg2 = null;\nif (msg.payload.nvalue===1)\n{\n    msg2 = { payload: \"On\"};\n}\nelse\n{\n    msg2 = { payload: \"Off\"};\n}\nreturn [ msg, msg2 ];","outputs":"2","noerr":0,"x":679,"y":292,"wires":[[],["684d9a06.97fcbc","ab3bda97.3ec89"]]},{"id":"684d9a06.97fcbc","type":"debug","z":"959e3a35.8b3bc","name":"Domoticz -> Sonoff","active":true,"console":"false","complete":"payload","x":1009,"y":252,"wires":[]},{"id":"ab3bda97.3ec89","type":"mqtt out","z":"959e3a35.8b3bc","name":"","topic":"cmnd/sonoff/POWER","qos":"0","retain":"false","broker":"17911408.3b4a8c","x":1019,"y":312,"wires":[]},{"id":"43e58237.0fa5b4","type":"switch","z":"959e3a35.8b3bc","name":"idx=336","property":"payload.idx","propertyType":"msg","rules":[{"t":"eq","v":"336","vt":"str"},{"t":"else"}],"checkall":"false","outputs":2,"x":499,"y":292,"wires":[["eb23022c.6bb34"],[]]},{"id":"e264c015.7fb86","type":"json","z":"959e3a35.8b3bc","name":"","x":370,"y":246,"wires":[["43e58237.0fa5b4"]]},{"id":"b9790b64.467bd8","type":"comment","z":"959e3a35.8b3bc","name":"Domoticz <-> Sonoff","info":"Node-red flow for connecting Sonoff to Domoticz\n\nCredits https://github.com/arendst/Sonoff-MQTT-OTA-Arduino\n\nSonoff responds to the following MQTT commands:\n\n- the relay can be controlled by ```cmnd/sonoff/power on```, ```cmns/sonoff/power off``` or ```cmnd/sonoff/power toggle```. The LED will blink twice and sends a MQTT status message like ```stat/sonoff/POWER on```. The same function can be initiated with ```cmnd/sonoff/light on```\n- the MQTT topic can be changed with ```cmnd/sonoff/topic sonoff1``` which reboots sonoff and makes it available for MQTT commands like ```cmnd/sonoff1/power on```\n- the OTA firmware location can be made known to sonoff by ```cmnd/sonoff/otaurl http://sidnas2:80/api/sonoff/user1.bin``` where sidnas2 is your webserver hosting the firmware. Reset to default with ```cmnd/sonoff/otaurl 1```\n- upgrade OTA firmware by ```cmnd/sonoff/upgrade 1```\n- show status information by ```cmnd/sonoff/status 1```\n\nMost MQTT commands will result in a status feedback like ```stat/sonoff/POWER On```.\n## Commands supported\nThe firmware supports both a **serial** and a **MQTT** Man Machine interface. The serial interface is set to 115200 bps. The MQTT commands are constructed as ```cmnd/sonoff/<command>```. \n\nThe following commands are recognised by both topic and grouptopic:\n\nCommand | Description\n------- | -----------\npower | Show current power state as On or Off\npower on | Turn power On\npower off | Turn power Off\npower toggle | Toggle power\npower 1 | Turn power On\npower 0 | Turn power Off\npower 2 | Toggle power\nlight | Show current power state as On or Off\nlight on | Turn power On\nlight off | Turn power Off\nlight toggle | Toggle power\nlight 1 | Turn power On\nlight 0 | Turn power Off\nlight 2 | Toggle power\nstatus | Show abbreviated status information\nstatus 1 | Show more status information\nstatus 2 | Show version information\nstatus 3 | Show syslog information\nstatus 4 | Show flash information\nstatus 5 | Show network information\nseriallog 0 | Disable serial logging\nseriallog 1 | Show only error messages\nseriallog 2 | Show error and info messages\nseriallog 3 | Show error, info and debug messages\nseriallog 4 | Show all messages\nsyslog 0 | Disable syslog logging\nsyslog 1 | Show only error messages\nsyslog 2 | Show error and info messages\nsyslog 3 | Show error, info and debug messages\nsyslog 4 | Show all messages\nloghost | Show current syslog host\nloghost 1 | Reset syslog host to ```user_config.h``` value and restart\nloghost your-host | Set syslog host and restart\ngrouptopic | Show current MQTT group topic\ngrouptopic 1 | Reset MQTT group topic to ```user_config.h``` value and restart\ngrouptopic your-grouptopic | Set MQTT group topic and restart\ntimezone | Show current timezone\ntimezone -12 .. 12 | Set timezone\n\nThe following commands are recognised by topic only:\n\nCommand | Description\n------- | -----------\nrestart 1 | Restart sonoff\nreset 1 | Reset sonoff parameters to ```user_config.h``` values and restart\nreset 2 | Erase flash, reset sonoff parameters to ```user_config.h``` values and restart\nssid | Show current Wifi SSId\nssid 1 | Reset Wifi SSId to ```user_config.h``` value and restart\nssid your-ssid | Set Wifi SSId and restart\npassword | Show current Wifi password\npassword 1 | Reset Wifi password to ```user_config.h``` value and restart\npassword your-password | Set Wifi password and restart\nmqtthost | Show current MQTT host\nmqtthost 1 | Reset MQTT host to ```user_config.h``` value and restart\nmqtthost your-host | Set MQTT host and restart\ntopic | Show current MQTT topic\ntopic 1 | Reset MQTT topic to ```user_config.h``` value and restart\ntopic your-topic | Set MQTT topic and restart\nsmartconfig 1 | Start smart config\notaurl | Show current otaurl\notaurl 1 | Reset otaurl to ```user_config.h``` value\notaurl your-otaurl | Set otaurl\nupgrade 1 | Download ota firmware from your web server and restart\n\nIf the same topic has been defined to more than one sonoff an individual sonoff can still be addressed by the fall back topic MQTT_CLIENT_ID as defined in user_config.h. The fall back topic will be ```DVES_<last six characters of MAC address>```.To preventa positive feedback loop, a global state is kept.\n","x":169,"y":132,"wires":[]},{"id":"ce53d302.478638","type":"mqtt in","z":"959e3a35.8b3bc","name":"","topic":"stat/#","broker":"56fc61c8.bc429","x":129,"y":612,"wires":[["c5fb7b88.c2bce"]]},{"id":"c5fb7b88.c2bce","type":"debug","z":"959e3a35.8b3bc","name":"All status messages","active":false,"console":"false","complete":"payload","x":509,"y":612,"wires":[]},{"id":"7684926a.8c741c","type":"comment","z":"959e3a35.8b3bc","name":"For testing purposes","info":"","x":169,"y":412,"wires":[]},{"id":"f4d28e1e.eff5f8","type":"mqtt out","z":"959e3a35.8b3bc","name":"","topic":"","qos":"0","retain":"false","broker":"17911408.3b4a8c","x":569,"y":735,"wires":[]},{"id":"3414c799.006278","type":"inject","z":"959e3a35.8b3bc","name":"","topic":"cmnd/sonoff/upgrade","payload":"1","payloadType":"str","repeat":"","crontab":"","once":false,"x":199,"y":735,"wires":[["f4d28e1e.eff5f8"]]},{"id":"4e822083.12101","type":"comment","z":"959e3a35.8b3bc","name":"OTA upgrade","info":"","x":149,"y":692,"wires":[]},{"id":"ec76c09e.1ea008","type":"mqtt out","z":"2dba819.654bb7e","name":"SetZone001Bypass","topic":"/alarm/zone/1/BYPASS","qos":"","retain":"","broker":"e6d8a0f0.6f5878","x":536.5,"y":687,"wires":[]},{"id":"e030a15e.f1af","type":"mqtt in","z":"2dba819.654bb7e","name":"Zone001Status","topic":"/status/alarm/zone/1/fault","qos":"2","broker":"e6d8a0f0.6f5878","x":115.5,"y":34,"wires":[["2cc1028f.601efe"]]},{"id":"63b06059.399dc8","type":"ui_switch","z":"2dba819.654bb7e","name":"Bypass1","label":"1","group":"9b6d8de1.d06a2","order":21,"width":"1","height":"1","topic":"","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":315.5,"y":684,"wires":[["ec76c09e.1ea008"]]},{"id":"563d0376.da1144","type":"mqtt in","z":"2dba819.654bb7e","name":"Zone001BYPASS","topic":"/alarm/zone/1/BYPASS","qos":"2","broker":"e6d8a0f0.6f5878","x":113,"y":682,"wires":[["63b06059.399dc8"]]},{"id":"2cc1028f.601efe","type":"ui_template","z":"2dba819.654bb7e","group":"2428ec5c.a7feb4","name":"Zone001","order":2,"width":"1","height":"1","format":"<div layout=\"row\" layout-align=\"space-between\">\n    <p ng-style=\"{color: (msg.payload === 'Ok') ? 'green' : 'red'}\">\n        1\n    </p>\n</div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":378.5,"y":39,"wires":[[]]},{"id":"93baf38d.1b1d98","type":"exec","z":"2dba819.654bb7e","command":"/usr/local/bin/nxstat","addpay":true,"append":"-Z","useSpawn":"","timer":"","name":"nxstat","x":545.5,"y":1882.5,"wires":[["e62f2e09.119c8"],[],[]]},{"id":"bf837df7.2c5dd","type":"ui_button","z":"2dba819.654bb7e","name":"","group":"cd06456d.06dad","order":1,"width":0,"height":0,"label":"Get Current Status","color":"","icon":"","payload":"","payloadType":"str","topic":"","x":252.5,"y":1893,"wires":[["93baf38d.1b1d98"]]},{"id":"e62f2e09.119c8","type":"ui_template","z":"2dba819.654bb7e","group":"cd06456d.06dad","name":"Status","order":2,"width":"11","height":"13","format":"<div my $LOCALCSS = <<EOF;\n#box1 {\n  background: #d8d8d8;\n  margin:16px;\n  padding: 10px 10px;\n  border:1px solid;\n  border-radius:10px;\n  box-shadow: 5px 6px 5px #aaaaaa;\n  -moz-border-radius:10px;\n}\nEOF\n\n>\n    \n<table id=box1><tr><td><pre>\n{{msg.payload}}\n</pre></td></tr></table>\n</div>","storeOutMessages":true,"fwdInMessages":true,"x":896.5,"y":1859,"wires":[[]]},{"id":"29d157aa.90be9","type":"ui_switch","z":"2dba819.654bb7e","name":"Stay Switch","label":"Arm (Go to bed)","group":"dbeda778.10fe88","order":2,"width":0,"height":0,"topic":"","style":"","onvalue":"stay","onvalueType":"str","onicon":"","oncolor":"","offvalue":"disarm","offvalueType":"str","officon":"","offcolor":"","x":269.5,"y":2015,"wires":[["cacedbd2.15731"]]},{"id":"4ad9a403.ae3514","type":"exec","z":"2dba819.654bb7e","command":"echo","addpay":true,"append":"","useSpawn":"","timer":"","name":"ExecStay","x":736.5,"y":2013.5,"wires":[["66550786.b80518","93baf38d.1b1d98"],[],[]]},{"id":"d867d7de.5c33e","type":"exec","z":"2dba819.654bb7e","command":"/usr/local/bin/nxcmd","addpay":true,"append":"","useSpawn":"","timer":"","name":"ExecX10Command","x":732,"y":2238.5,"wires":[[],[],[]]},{"id":"973e22fa.38c5f","type":"ui_button","z":"2dba819.654bb7e","name":"Bakkie Garage","group":"e01fac45.796008","order":3,"width":"4","height":"2","label":"Bakkie Garage","color":"","icon":"","payload":"x10 a 4 on","payloadType":"str","topic":"","x":243.5,"y":2227,"wires":[["d867d7de.5c33e"]]},{"id":"ad85ccf3.320b5","type":"ui_button","z":"2dba819.654bb7e","name":"Kuga Garage","group":"e01fac45.796008","order":2,"width":"3","height":"2","label":"Kuga Garage","color":"","icon":"","payload":"x10 a 3 on","payloadType":"str","topic":"","x":251,"y":2281,"wires":[["d867d7de.5c33e"]]},{"id":"9bc4a47d.fcbbe","type":"ui_switch","z":"2dba819.654bb7e","name":"Arm Switch","label":"Arm (Hele huis)","group":"dbeda778.10fe88","order":3,"width":0,"height":0,"topic":"","style":"","onvalue":"armaway","onvalueType":"str","onicon":"","oncolor":"","offvalue":"disarm","offvalueType":"str","officon":"","offcolor":"","x":401,"y":2088,"wires":[["747f27a8.7d976"]]},{"id":"747f27a8.7d976","type":"exec","z":"2dba819.654bb7e","command":"echo \"1236\" | /usr/local/bin/nxcmd","addpay":true,"append":"","useSpawn":"","timer":"","name":"ExecArmAway","x":686,"y":2087.5,"wires":[["93baf38d.1b1d98"],[],[]]},{"id":"1821af2d.93e309","type":"ui_button","z":"2dba819.654bb7e","name":"StraatHek","group":"e01fac45.796008","order":1,"width":"2","height":"6","label":"Straat Hek","color":"","icon":"","payload":"x10 a 1 on","payloadType":"str","topic":"","x":270,"y":2335.5,"wires":[["d867d7de.5c33e"]]},{"id":"f0c53734.b286a","type":"ui_button","z":"2dba819.654bb7e","name":"WorkshopDoor","group":"e01fac45.796008","order":4,"width":"3","height":"2","label":"Workshop Deur","color":"","icon":"","payload":"x10 a 5 on","payloadType":"str","topic":"","x":245,"y":2169,"wires":[["d867d7de.5c33e"]]},{"id":"66550786.b80518","type":"debug","z":"2dba819.654bb7e","name":"","active":false,"console":"false","complete":"false","x":1046.5,"y":1923,"wires":[]},{"id":"c5cdfae.cd96788","type":"ui_text_input","z":"2dba819.654bb7e","name":"AlarmCode","label":"Alarm Code","group":"dbeda778.10fe88","order":1,"width":0,"height":0,"mode":"text","delay":"300","topic":"","x":241.5,"y":1950,"wires":[["e7cdc892.d0cbf8"]]},{"id":"e7cdc892.d0cbf8","type":"function","z":"2dba819.654bb7e","name":"","func":"context.global.AlarmCode=msg.payload;\nreturn msg;","outputs":1,"noerr":0,"x":422.5,"y":1956,"wires":[[]]},{"id":"cacedbd2.15731","type":"function","z":"2dba819.654bb7e","name":"","func":"msg.payload = context.global.AlarmCode+\" | /usr/local/bin/nxcmd \"+msg.payload;\n\nreturn msg;","outputs":1,"noerr":0,"x":489.5,"y":2021,"wires":[["4ad9a403.ae3514","66550786.b80518"]]},{"id":"2a4a3447.fa5704","type":"mqtt out","z":"2dba819.654bb7e","name":"SetZone002Bypass","topic":"/alarm/zone/2/BYPASS","qos":"","retain":"","broker":"e6d8a0f0.6f5878","x":534,"y":749,"wires":[]},{"id":"482fd3fb.f996fc","type":"mqtt in","z":"2dba819.654bb7e","name":"Zone002Status","topic":"/status/alarm/zone/2/fault","qos":"2","broker":"e6d8a0f0.6f5878","x":115,"y":93,"wires":[["21b4f71b.c663d8"]]},{"id":"fb5d4851.00287","type":"ui_switch","z":"2dba819.654bb7e","name":"Bypass2","label":"2","group":"9b6d8de1.d06a2","order":22,"width":"1","height":"1","topic":"","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":317,"y":751,"wires":[["2a4a3447.fa5704"]]},{"id":"b5b8edc3.d641c8","type":"mqtt in","z":"2dba819.654bb7e","name":"Zone002BYPASS","topic":"/alarm/zone/2/BYPASS","qos":"2","broker":"e6d8a0f0.6f5878","x":113.5,"y":749,"wires":[["fb5d4851.00287"]]},{"id":"21b4f71b.c663d8","type":"ui_template","z":"2dba819.654bb7e","group":"2428ec5c.a7feb4","name":"Zone002","order":3,"width":"1","height":"1","format":"<div layout=\"row\" layout-align=\"space-between\">\n    <p ng-style=\"{color: (msg.payload === 'Ok') ? 'green' : 'red'}\">\n        2\n    </p>\n</div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":378,"y":98,"wires":[[]]},{"id":"4d00fc2a.f8cd5c","type":"mqtt in","z":"2dba819.654bb7e","name":"Zone003Status","topic":"/status/alarm/zone/3/fault","qos":"2","broker":"e6d8a0f0.6f5878","x":117,"y":153,"wires":[["1b1a3402.78189c"]]},{"id":"1b1a3402.78189c","type":"ui_template","z":"2dba819.654bb7e","group":"2428ec5c.a7feb4","name":"Zone003","order":4,"width":"1","height":"1","format":"<div layout=\"row\" layout-align=\"space-between\">\n<p ng-style=\"{color: (msg.payload === 'Ok') ? 'green' : 'red'}\">\n            3\n    </p>\n</div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":380,"y":158,"wires":[[]]},{"id":"a90da15f.63e678","type":"mqtt in","z":"2dba819.654bb7e","name":"Zone004Status","topic":"/status/alarm/zone/4/fault","qos":"2","broker":"e6d8a0f0.6f5878","x":116.5,"y":212,"wires":[["8e26341a.a1a6f"]]},{"id":"8e26341a.a1a6f","type":"ui_template","z":"2dba819.654bb7e","group":"2428ec5c.a7feb4","name":"Zone004","order":5,"width":"1","height":"1","format":"<div layout=\"row\" layout-align=\"space-between\">\n    <p ng-style=\"{color: (msg.payload === 'Ok') ? 'green' : 'red'}\">\n        4\n    </p>\n</div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":379.5,"y":217,"wires":[[]]},{"id":"9548efd5.4fa55","type":"mqtt in","z":"2dba819.654bb7e","name":"Zone005Status","topic":"/status/alarm/zone/5/#","qos":"2","broker":"e6d8a0f0.6f5878","x":116,"y":267,"wires":[["f526a580.3a84f"]]},{"id":"f526a580.3a84f","type":"ui_template","z":"2dba819.654bb7e","group":"2428ec5c.a7feb4","name":"Zone005","order":6,"width":"1","height":"1","format":"\n<md-button class=\"vibrate filled touched bigfont rounded\"  ng-click=\"send({payload: 'Hello World'})\" ng-style=\"Zone5\"> \n    5\n</md-button> \n\n<script>\nvar app = angular.module(\"myApp\", []);\napp.controller(\"myCtrl\", function($scope) {\n    $scope.Zone5 = {\n        \"color\" : \"white\",\n        \"background-color\" : \"coral\"\n    }\n});\n</script>\n","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":379,"y":272,"wires":[["b1562651.08d3c"]]},{"id":"6341151c.7a6b64","type":"mqtt in","z":"2dba819.654bb7e","name":"Zone006Status","topic":"/status/alarm/zone/6/fault","qos":"2","broker":"e6d8a0f0.6f5878","x":115.5,"y":393,"wires":[["adaa972a.38d908"]]},{"id":"adaa972a.38d908","type":"ui_template","z":"2dba819.654bb7e","group":"2428ec5c.a7feb4","name":"Zone006","order":7,"width":"1","height":"1","format":"<div layout=\"row\" layout-align=\"space-between\">\n    <p ng-style=\"{color: (msg.payload === 'Ok') ? 'green' : 'red'}\">\n        6\n    </p>\n</div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":378.5,"y":331,"wires":[[]]},{"id":"99273c54.1178a8","type":"mqtt in","z":"2dba819.654bb7e","name":"Zone007Status","topic":"/status/alarm/zone/7/fault","qos":"2","broker":"e6d8a0f0.6f5878","x":121.5,"y":453,"wires":[["8205c717.b9c3f"]]},{"id":"8205c717.b9c3f","type":"ui_template","z":"2dba819.654bb7e","group":"2428ec5c.a7feb4","name":"Zone007","order":8,"width":"1","height":"1","format":"<div layout=\"row\" layout-align=\"space-between\">\n   <p ng-style=\"{color: (msg.payload === 'Ok') ? 'green' : 'red'}\">\n         7\n    </p>\n</div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":380.5,"y":391,"wires":[[]]},{"id":"b8072747.dc7628","type":"mqtt in","z":"2dba819.654bb7e","name":"Zone008Status","topic":"/status/alarm/zone/8/fault","qos":"2","broker":"e6d8a0f0.6f5878","x":117,"y":512,"wires":[["a9352b7a.b24c88"]]},{"id":"a9352b7a.b24c88","type":"ui_template","z":"2dba819.654bb7e","group":"2428ec5c.a7feb4","name":"Zone008","order":9,"width":"1","height":"1","format":"<div layout=\"row\" layout-align=\"space-between\">\n    <p ng-style=\"{color: (msg.payload === 'Ok') ? 'green' : 'red'}\">\n        8\n    </p>\n</div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":380,"y":450,"wires":[[]]},{"id":"dac640eb.9cfa6","type":"mqtt in","z":"2dba819.654bb7e","name":"Zone009Status","topic":"/status/alarm/zone/9/fault","qos":"2","broker":"e6d8a0f0.6f5878","x":120,"y":566,"wires":[["f0da4357.aab9a8"]]},{"id":"f0da4357.aab9a8","type":"ui_template","z":"2dba819.654bb7e","group":"2428ec5c.a7feb4","name":"Zone009","order":10,"width":"1","height":"1","format":"<div layout=\"row\" layout-align=\"space-between\">\n    <p ng-style=\"{color: (msg.payload === 'Ok') ? 'green' : 'red'}\">\n        9\n    </p>\n</div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":379,"y":504,"wires":[[]]},{"id":"831fb89e.237ea","type":"mqtt in","z":"2dba819.654bb7e","name":"Zone010Status","topic":"/status/alarm/zone/10/fault","qos":"2","broker":"e6d8a0f0.6f5878","x":115.5,"y":625,"wires":[["e6bc5234.2f117"]]},{"id":"e6bc5234.2f117","type":"ui_template","z":"2dba819.654bb7e","group":"2428ec5c.a7feb4","name":"Zone010","order":11,"width":"1","height":"1","format":"<div layout=\"row\" layout-align=\"space-between\">\n    <p ng-style=\"{color: (msg.payload === 'Ok') ? 'green' : 'red'}\">\n        10\n    </p>\n</div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":378.5,"y":563,"wires":[[]]},{"id":"5542c0cf.a729d","type":"mqtt in","z":"2dba819.654bb7e","name":"Zone011Status","topic":"/status/alarm/zone/11/fault","qos":"2","broker":"e6d8a0f0.6f5878","x":545,"y":39,"wires":[["3d88da80.4eabae"]]},{"id":"3d88da80.4eabae","type":"ui_template","z":"2dba819.654bb7e","group":"2428ec5c.a7feb4","name":"Zone011","order":12,"width":"1","height":"1","format":"<div layout=\"row\" layout-align=\"space-between\">\n    <p ng-style=\"{color: (msg.payload === 'Ok' ) ? 'green' : 'red'}\">\n        11\n    </p>\n</div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":808,"y":44,"wires":[[]]},{"id":"105aa7f4.620ea8","type":"mqtt in","z":"2dba819.654bb7e","name":"Zone012Status","topic":"/status/alarm/zone/12/fault","qos":"2","broker":"e6d8a0f0.6f5878","x":544.5,"y":98,"wires":[["1411d91d.e5dc3f"]]},{"id":"1411d91d.e5dc3f","type":"ui_template","z":"2dba819.654bb7e","group":"2428ec5c.a7feb4","name":"Zone012","order":13,"width":"1","height":"1","format":"<div layout=\"row\" layout-align=\"space-between\">\n    <p ng-style=\"{color: (msg.payload === 'Ok') ? 'green' : 'red'}\">\n        12\n    </p>\n</div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":807.5,"y":103,"wires":[[]]},{"id":"fffe3b2d.a6321","type":"mqtt in","z":"2dba819.654bb7e","name":"Zone013Status","topic":"/status/alarm/zone/13/fault","qos":"2","broker":"e6d8a0f0.6f5878","x":546.5,"y":158,"wires":[["5abfec1c.c0dcac"]]},{"id":"5abfec1c.c0dcac","type":"ui_template","z":"2dba819.654bb7e","group":"2428ec5c.a7feb4","name":"Zone013","order":14,"width":"1","height":"1","format":"<div layout=\"row\" layout-align=\"space-between\">\n    <p ng-style=\"{color: (msg.payload === 'Ok') ? 'green' : 'red'}\">\n        13\n    </p>\n</div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":809.5,"y":163,"wires":[[]]},{"id":"d1d2f4ae.e2ea98","type":"mqtt in","z":"2dba819.654bb7e","name":"Zone014Status","topic":"/status/alarm/zone/14/fault","qos":"2","broker":"e6d8a0f0.6f5878","x":546,"y":217,"wires":[["866df59a.96e8a","b29bbf03.4dd108"]]},{"id":"866df59a.96e8a","type":"ui_template","z":"2dba819.654bb7e","group":"2428ec5c.a7feb4","name":"Zone014","order":15,"width":"1","height":"1","format":"<div layout=\"row\" layout-align=\"space-between\">\n    <p ng-style=\"{color: (msg.payload || 0) % 2 === 0 ? 'green' : 'red'}\">\n        14\n    </p>\n</div>","storeOutMessages":true,"fwdInMessages":true,"x":809,"y":222,"wires":[[]]},{"id":"4cedd953.21f9f","type":"mqtt in","z":"2dba819.654bb7e","name":"Zone015Status","topic":"/status/alarm/zone/15/fault","qos":"2","broker":"e6d8a0f0.6f5878","x":545.5,"y":272,"wires":[["e23aee51.6054b8","daf4ed2c.6b4ab8"]]},{"id":"e23aee51.6054b8","type":"ui_template","z":"2dba819.654bb7e","group":"2428ec5c.a7feb4","name":"Zone015","order":16,"width":"1","height":"1","format":"<div layout=\"row\" layout-align=\"space-between\">\n    <p ng-style=\"{color: (msg.payload || 0) % 2 === 0 ? 'green' : 'red'}\">\n        15\n    </p>\n</div>","storeOutMessages":true,"fwdInMessages":true,"x":808.5,"y":277,"wires":[[]]},{"id":"6eaa7866.3016b8","type":"mqtt in","z":"2dba819.654bb7e","name":"Zone016Status","topic":"/status/alarm/zone/16/fault","qos":"2","broker":"e6d8a0f0.6f5878","x":545,"y":331,"wires":[["d41488e4.db1048","9ad373b2.6053a"]]},{"id":"d41488e4.db1048","type":"ui_template","z":"2dba819.654bb7e","group":"2428ec5c.a7feb4","name":"Zone016","order":17,"width":"1","height":"1","format":"<div layout=\"row\" layout-align=\"space-between\">\n    <p ng-style=\"{color: (msg.payload || 0) % 2 === 0 ? 'green' : 'red'}\">\n        16\n    </p>\n</div>","storeOutMessages":true,"fwdInMessages":true,"x":808,"y":336,"wires":[[]]},{"id":"9b738abf.4618d","type":"mqtt in","z":"2dba819.654bb7e","name":"Zone017Status","topic":"/status/alarm/zone/17/fault","qos":"2","broker":"e6d8a0f0.6f5878","x":551,"y":391,"wires":[["5d1d4659.b0ca08"]]},{"id":"5d1d4659.b0ca08","type":"ui_template","z":"2dba819.654bb7e","group":"2428ec5c.a7feb4","name":"Zone017","order":18,"width":"1","height":"1","format":"<div layout=\"row\" layout-align=\"space-between\">\n    <p ng-style=\"{color: (msg.payload || 0) % 2 === 0 ? 'green' : 'red'}\">\n        17\n    </p>\n</div>","storeOutMessages":true,"fwdInMessages":true,"x":810,"y":396,"wires":[[]]},{"id":"2235d3a9.a15ccc","type":"mqtt in","z":"2dba819.654bb7e","name":"Zone018Status","topic":"/status/alarm/zone/18/fault","qos":"2","broker":"e6d8a0f0.6f5878","x":546.5,"y":450,"wires":[["d96e0b6e.06ca5"]]},{"id":"d96e0b6e.06ca5","type":"ui_template","z":"2dba819.654bb7e","group":"2428ec5c.a7feb4","name":"Zone018","order":19,"width":"1","height":"1","format":"<div layout=\"row\" layout-align=\"space-between\">\n    <p ng-style=\"{color: (msg.payload || 0) % 2 === 0 ? 'green' : 'red'}\">\n        18\n    </p>\n</div>","storeOutMessages":true,"fwdInMessages":true,"x":809.5,"y":455,"wires":[[]]},{"id":"94629fe3.39925","type":"mqtt in","z":"2dba819.654bb7e","name":"Zone019Status","topic":"/status/alarm/zone/19/fault","qos":"2","broker":"e6d8a0f0.6f5878","x":549.5,"y":504,"wires":[["85567b17.646fc8"]]},{"id":"85567b17.646fc8","type":"ui_template","z":"2dba819.654bb7e","group":"2428ec5c.a7feb4","name":"Zone019","order":20,"width":"1","height":"1","format":"<div layout=\"row\" layout-align=\"space-between\">\n    <p ng-style=\"{color: (msg.payload || 0) % 2 === 0 ? 'green' : 'red'}\">\n        19\n    </p>\n</div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":808.5,"y":509,"wires":[[]]},{"id":"1963d0.09a86c31","type":"mqtt in","z":"2dba819.654bb7e","name":"Zone020Status","topic":"/status/alarm/zone/20/fault","qos":"2","broker":"e6d8a0f0.6f5878","x":545,"y":563,"wires":[["f1fa3798.671a78"]]},{"id":"f1fa3798.671a78","type":"ui_template","z":"2dba819.654bb7e","group":"2428ec5c.a7feb4","name":"Zone020","order":21,"width":"1","height":"1","format":"<div layout=\"row\" layout-align=\"space-between\">\n    <p ng-style=\"{color: (msg.payload === 'Ok' ) ? 'green' : 'red'}\">\n        20\n    </p>\n</div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":808,"y":568,"wires":[[]]},{"id":"16711d1e.a0f7eb","type":"mqtt in","z":"2dba819.654bb7e","name":"Zone021Status","topic":"/status/alarm/zone/21/fault","qos":"2","broker":"e6d8a0f0.6f5878","x":969,"y":36,"wires":[["49348697.2f542"]]},{"id":"49348697.2f542","type":"ui_template","z":"2dba819.654bb7e","group":"2428ec5c.a7feb4","name":"Zone021","order":22,"width":"1","height":"1","format":"<div layout=\"row\" layout-align=\"space-between\">\n    <p ng-style=\"{color: (msg.payload || 0) % 2 === 0 ? 'green' : 'red'}\">\n        21\n    </p>\n</div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":1232,"y":41,"wires":[[]]},{"id":"c20dc5b4.61acd8","type":"mqtt in","z":"2dba819.654bb7e","name":"Zone022Status","topic":"/status/alarm/zone/22/fault","qos":"2","broker":"e6d8a0f0.6f5878","x":968.5,"y":95,"wires":[["ac318481.266fa8"]]},{"id":"ac318481.266fa8","type":"ui_template","z":"2dba819.654bb7e","group":"2428ec5c.a7feb4","name":"Zone022","order":23,"width":"1","height":"1","format":"<div layout=\"row\" layout-align=\"space-between\">\n    <p ng-style=\"{color: (msg.payload || 0) % 2 === 0 ? 'green' : 'red'}\">\n        22\n    </p>\n</div>","storeOutMessages":true,"fwdInMessages":true,"x":1231.5,"y":100,"wires":[[]]},{"id":"c805a656.8271b8","type":"mqtt in","z":"2dba819.654bb7e","name":"Zone023Status","topic":"/status/alarm/zone/23/fault","qos":"2","broker":"e6d8a0f0.6f5878","x":970.5,"y":155,"wires":[["5e1a9113.2363f"]]},{"id":"5e1a9113.2363f","type":"ui_template","z":"2dba819.654bb7e","group":"2428ec5c.a7feb4","name":"Zone023","order":24,"width":"1","height":"1","format":"<div layout=\"row\" layout-align=\"space-between\">\n    <p ng-style=\"{color: (msg.payload || 0) % 2 === 0 ? 'green' : 'red'}\">\n        23\n    </p>\n</div>","storeOutMessages":true,"fwdInMessages":true,"x":1233.5,"y":160,"wires":[[]]},{"id":"af9bd944.2be85","type":"mqtt in","z":"2dba819.654bb7e","name":"Zone024Status","topic":"/status/alarm/zone/24/fault","qos":"2","broker":"e6d8a0f0.6f5878","x":970,"y":214,"wires":[["ea782359.669ad8"]]},{"id":"ea782359.669ad8","type":"ui_template","z":"2dba819.654bb7e","group":"2428ec5c.a7feb4","name":"Zone024","order":25,"width":"1","height":"1","format":"<div layout=\"row\" layout-align=\"space-between\">\n    <p ng-style=\"{color: (msg.payload || 0) % 2 === 0 ? 'green' : 'red'}\">\n        24\n    </p>\n</div>","storeOutMessages":true,"fwdInMessages":true,"x":1233,"y":219,"wires":[[]]},{"id":"d7ebc631.2b176","type":"mqtt in","z":"2dba819.654bb7e","name":"Zone025Status","topic":"/status/alarm/zone/25/fault","qos":"2","broker":"e6d8a0f0.6f5878","x":969.5,"y":269,"wires":[["9e9e69a5.f2a4b"]]},{"id":"9e9e69a5.f2a4b","type":"ui_template","z":"2dba819.654bb7e","group":"2428ec5c.a7feb4","name":"Zone025","order":26,"width":"1","height":"1","format":"<div layout=\"row\" layout-align=\"space-between\">\n    <p ng-style=\"{color: (msg.payload || 0) % 2 === 0 ? 'green' : 'red'}\">\n        25\n    </p>\n</div>","storeOutMessages":true,"fwdInMessages":true,"x":1232.5,"y":274,"wires":[[]]},{"id":"6cd45043.5ad788","type":"mqtt in","z":"2dba819.654bb7e","name":"Zone026Status","topic":"/status/alarm/zone/26/fault","qos":"2","broker":"e6d8a0f0.6f5878","x":969,"y":328,"wires":[["22f9e582.2f06b2"]]},{"id":"22f9e582.2f06b2","type":"ui_template","z":"2dba819.654bb7e","group":"2428ec5c.a7feb4","name":"Zone026","order":27,"width":"1","height":"1","format":"<div layout=\"row\" layout-align=\"space-between\">\n    <p ng-style=\"{color: (msg.payload || 0) % 2 === 0 ? 'green' : 'red'}\">\n        26\n    </p>\n</div>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":1232,"y":333,"wires":[[]]},{"id":"d7574f1a.8f9d18","type":"mqtt in","z":"2dba819.654bb7e","name":"Zone027Status","topic":"/status/alarm/zone/27/fault","qos":"2","broker":"e6d8a0f0.6f5878","x":975,"y":388,"wires":[["74352b2a.45a33c"]]},{"id":"74352b2a.45a33c","type":"ui_template","z":"2dba819.654bb7e","group":"2428ec5c.a7feb4","name":"Zone027","order":28,"width":"1","height":"1","format":"<div layout=\"row\" layout-align=\"space-between\">\n    <p ng-style=\"{color: (msg.payload || 0) % 2 === 0 ? 'green' : 'red'}\">\n        27\n    </p>\n</div>","storeOutMessages":true,"fwdInMessages":true,"x":1234,"y":393,"wires":[[]]},{"id":"28bd6568.fedbb2","type":"mqtt in","z":"2dba819.654bb7e","name":"Zone028Status","topic":"/status/alarm/zone/28/fault","qos":"2","broker":"e6d8a0f0.6f5878","x":970.5,"y":447,"wires":[["5a76593f.67e388"]]},{"id":"5a76593f.67e388","type":"ui_template","z":"2dba819.654bb7e","group":"2428ec5c.a7feb4","name":"Zone028","order":29,"width":"1","height":"1","format":"<div layout=\"row\" layout-align=\"space-between\">\n    <p ng-style=\"{color: (msg.payload || 0) % 2 === 0 ? 'green' : 'red'}\">\n        28\n    </p>\n</div>","storeOutMessages":true,"fwdInMessages":true,"x":1233.5,"y":452,"wires":[[]]},{"id":"f5564201.cd157","type":"mqtt in","z":"2dba819.654bb7e","name":"Zone029Status","topic":"/status/alarm/zone/29/fault","qos":"2","broker":"e6d8a0f0.6f5878","x":973.5,"y":501,"wires":[["fa7e3768.100cc8"]]},{"id":"fa7e3768.100cc8","type":"ui_template","z":"2dba819.654bb7e","group":"2428ec5c.a7feb4","name":"Zone029","order":30,"width":"1","height":"1","format":"<div layout=\"row\" layout-align=\"space-between\">\n    <p ng-style=\"{color: (msg.payload || 0) % 2 === 0 ? 'green' : 'red'}\">\n        29\n    </p>\n</div>","storeOutMessages":true,"fwdInMessages":true,"x":1232.5,"y":506,"wires":[[]]},{"id":"257ed9b.19f1da6","type":"mqtt in","z":"2dba819.654bb7e","name":"Zone030Status","topic":"/status/alarm/zone/30/fault","qos":"2","broker":"e6d8a0f0.6f5878","x":969,"y":560,"wires":[["553b1fb2.6c16f"]]},{"id":"553b1fb2.6c16f","type":"ui_template","z":"2dba819.654bb7e","group":"2428ec5c.a7feb4","name":"Zone030","order":31,"width":"1","height":"1","format":"<div layout=\"row\" layout-align=\"space-between\">\n    <p ng-style=\"{color: (msg.payload || 0) % 2 === 0 ? 'green' : 'red'}\">\n        30\n    </p>\n</div>","storeOutMessages":true,"fwdInMessages":true,"x":1232,"y":565,"wires":[[]]},{"id":"a1a1549f.9a4e38","type":"mqtt out","z":"2dba819.654bb7e","name":"SetZone003Bypass","topic":"/alarm/zone/3/BYPASS","qos":"","retain":"","broker":"e6d8a0f0.6f5878","x":536.5,"y":813,"wires":[]},{"id":"363dad90.1856ca","type":"ui_switch","z":"2dba819.654bb7e","name":"Bypass3","label":"3","group":"9b6d8de1.d06a2","order":21,"width":"1","height":"1","topic":"","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":315.5,"y":810,"wires":[["a1a1549f.9a4e38"]]},{"id":"e4bb6784.81bf78","type":"mqtt in","z":"2dba819.654bb7e","name":"Zone003BYPASS","topic":"/alarm/zone/3/BYPASS","qos":"2","broker":"e6d8a0f0.6f5878","x":113,"y":808,"wires":[["363dad90.1856ca"]]},{"id":"a6d9cd1e.c78a7","type":"mqtt out","z":"2dba819.654bb7e","name":"SetZone004Bypass","topic":"/alarm/zone/4/BYPASS","qos":"","retain":"","broker":"e6d8a0f0.6f5878","x":534,"y":875,"wires":[]},{"id":"84197290.24a428","type":"ui_switch","z":"2dba819.654bb7e","name":"Bypass4","label":"4","group":"9b6d8de1.d06a2","order":22,"width":"1","height":"1","topic":"","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":317,"y":877,"wires":[["a6d9cd1e.c78a7"]]},{"id":"4f3688d9.a961f","type":"mqtt in","z":"2dba819.654bb7e","name":"Zone004BYPASS","topic":"/alarm/zone/4/BYPASS","qos":"2","broker":"e6d8a0f0.6f5878","x":113.5,"y":875,"wires":[["84197290.24a428"]]},{"id":"23dcceb9.f40162","type":"mqtt out","z":"2dba819.654bb7e","name":"SetZone005Bypass","topic":"/alarm/zone/5/BYPASS","qos":"","retain":"","broker":"e6d8a0f0.6f5878","x":539.5,"y":931,"wires":[]},{"id":"a877afc9.313178","type":"ui_switch","z":"2dba819.654bb7e","name":"Bypass5","label":"5","group":"9b6d8de1.d06a2","order":21,"width":"1","height":"1","topic":"","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":318.5,"y":928,"wires":[["23dcceb9.f40162"]]},{"id":"5bc23132.0b2ab8","type":"mqtt in","z":"2dba819.654bb7e","name":"Zone005BYPASS","topic":"/alarm/zone/5/BYPASS","qos":"2","broker":"e6d8a0f0.6f5878","x":116,"y":926,"wires":[["a877afc9.313178"]]},{"id":"98fc1419.c0bb","type":"mqtt out","z":"2dba819.654bb7e","name":"SetZone006Bypass","topic":"/alarm/zone/6/BYPASS","qos":"","retain":"","broker":"e6d8a0f0.6f5878","x":537,"y":993,"wires":[]},{"id":"b51108e3.94048","type":"ui_switch","z":"2dba819.654bb7e","name":"Bypass6","label":"6","group":"9b6d8de1.d06a2","order":22,"width":"1","height":"1","topic":"","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":320,"y":995,"wires":[["98fc1419.c0bb"]]},{"id":"295cd8eb.15fb6","type":"mqtt in","z":"2dba819.654bb7e","name":"Zone006BYPASS","topic":"/alarm/zone/6/BYPASS","qos":"2","broker":"e6d8a0f0.6f5878","x":116.5,"y":993,"wires":[["b51108e3.94048"]]},{"id":"ef608591.94dfc8","type":"mqtt out","z":"2dba819.654bb7e","name":"SetZone007Bypass","topic":"/alarm/zone/7/BYPASS","qos":"","retain":"","broker":"e6d8a0f0.6f5878","x":539.5,"y":1057,"wires":[]},{"id":"4e259476.246bcc","type":"ui_switch","z":"2dba819.654bb7e","name":"Bypass7","label":"7","group":"9b6d8de1.d06a2","order":21,"width":"1","height":"1","topic":"","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":318.5,"y":1054,"wires":[["ef608591.94dfc8"]]},{"id":"320ea94a.6de7ae","type":"mqtt in","z":"2dba819.654bb7e","name":"Zone007BYPASS","topic":"/alarm/zone/7/BYPASS","qos":"2","broker":"e6d8a0f0.6f5878","x":116,"y":1052,"wires":[["4e259476.246bcc"]]},{"id":"9fcadcb4.960a6","type":"mqtt out","z":"2dba819.654bb7e","name":"SetZone008Bypass","topic":"/alarm/zone/8/BYPASS","qos":"","retain":"","broker":"e6d8a0f0.6f5878","x":537,"y":1119,"wires":[]},{"id":"7478ca1.f1e0734","type":"ui_switch","z":"2dba819.654bb7e","name":"Bypass8","label":"8","group":"9b6d8de1.d06a2","order":22,"width":"1","height":"1","topic":"","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":320,"y":1121,"wires":[["9fcadcb4.960a6"]]},{"id":"3d24956c.218492","type":"mqtt in","z":"2dba819.654bb7e","name":"Zone008BYPASS","topic":"/alarm/zone/8/BYPASS","qos":"2","broker":"e6d8a0f0.6f5878","x":116.5,"y":1119,"wires":[["7478ca1.f1e0734"]]},{"id":"651a69a7.3dc03","type":"mqtt out","z":"2dba819.654bb7e","name":"SetZone009Bypass","topic":"/alarm/zone/9/BYPASS","qos":"","retain":"","broker":"e6d8a0f0.6f5878","x":533.5,"y":1175,"wires":[]},{"id":"5cf624eb.d34c3c","type":"ui_switch","z":"2dba819.654bb7e","name":"Bypass9","label":"9","group":"9b6d8de1.d06a2","order":22,"width":"1","height":"1","topic":"","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":316.5,"y":1177,"wires":[["651a69a7.3dc03"]]},{"id":"e20d4f18.979868","type":"mqtt in","z":"2dba819.654bb7e","name":"Zone009BYPASS","topic":"/alarm/zone/9/BYPASS","qos":"2","broker":"e6d8a0f0.6f5878","x":113,"y":1175,"wires":[["5cf624eb.d34c3c"]]},{"id":"738bade.57a2dd4","type":"mqtt out","z":"2dba819.654bb7e","name":"SetZone010Bypass","topic":"/alarm/zone/10/BYPASS","qos":"","retain":"","broker":"e6d8a0f0.6f5878","x":529.5,"y":1230,"wires":[]},{"id":"99740f98.e8aff8","type":"ui_switch","z":"2dba819.654bb7e","name":"Bypass10","label":"10","group":"9b6d8de1.d06a2","order":22,"width":"1","height":"1","topic":"","style":"","onvalue":"true","onvalueType":"bool","onicon":"","oncolor":"","offvalue":"false","offvalueType":"bool","officon":"","offcolor":"","x":312.5,"y":1232,"wires":[["738bade.57a2dd4"]]},{"id":"292a39e.48fed46","type":"mqtt in","z":"2dba819.654bb7e","name":"Zone010BYPASS","topic":"/alarm/zone/10/BYPASS","qos":"2","broker":"e6d8a0f0.6f5878","x":109,"y":1230,"wires":[["99740f98.e8aff8"]]},{"id":"9e89d8ac.28793","type":"ui_switch","z":"74cedccf.2b6a6c","name":"Sonoff","label":"Sonoff Lapa","group":"4357843d.5f1d34","order":8,"width":"","height":"","passthru":false,"decouple":"true","topic":"stat/sonoff/power","onvalue":"On","onvalueType":"str","onicon":"","oncolor":"","offvalue":"Off","offvalueType":"str","officon":"","offcolor":"","x":504,"y":184,"wires":[["7960dcd8.d455b4"]]},{"id":"8ec9e556.ff6d98","type":"mqtt in","z":"74cedccf.2b6a6c","name":"ReadStateSonoff","topic":"stat/sonoff/POWER","qos":"2","broker":"e6d8a0f0.6f5878","x":302,"y":145,"wires":[["9e89d8ac.28793"]]},{"id":"7960dcd8.d455b4","type":"mqtt out","z":"74cedccf.2b6a6c","name":"SaveStateSonoff","topic":"cmnd/sonoff/power","qos":"0","retain":"true","broker":"e6d8a0f0.6f5878","x":748.5,"y":179,"wires":[]},{"id":"4fac8605.68476","type":"ui_switch","z":"46e74d40.66d774","name":"BuiteLigte","label":"Gekleurde Tuin Ligte","group":"6eaf738f.cbb964","order":1,"width":"","height":"","passthru":false,"decouple":"false","topic":"/RS485/16/Ligte/BuiteLigte/state","onvalue":"1","onvalueType":"str","onicon":"","oncolor":"","offvalue":"0","offvalueType":"str","officon":"","offcolor":"","x":526,"y":619,"wires":[["da36a920.a7d2a"]]},{"id":"2a20f33e.57bdcc","type":"mqtt in","z":"46e74d40.66d774","name":"ReadState","topic":"/RS485/16/Ligte/BuiteLigte/state","qos":"2","broker":"e6d8a0f0.6f5878","x":294,"y":580,"wires":[["4fac8605.68476"]]},{"id":"da36a920.a7d2a","type":"mqtt out","z":"46e74d40.66d774","name":"SaveState","topic":"","qos":"2","retain":"","broker":"e6d8a0f0.6f5878","x":740.5,"y":614,"wires":[]},{"id":"4c303dc4.305fa4","type":"ui_switch","z":"46e74d40.66d774","name":"GroenteBeddings","label":"Groente Beddings","group":"14fdd9e3.cf19d6","order":2,"width":"","height":"","passthru":false,"decouple":"false","topic":"/RS485/13/Besproeiing/GroenteBeddings/state","onvalue":"1","onvalueType":"str","onicon":"","oncolor":"","offvalue":"0","offvalueType":"str","officon":"","offcolor":"","x":540,"y":723,"wires":[["ea9245cc.1033f","761397c1.83d5b"]]},{"id":"c12e3afa.12636","type":"mqtt in","z":"46e74d40.66d774","name":"ReadState","topic":"/RS485/13/Besproeiing/GroenteBeddings/state","qos":"2","broker":"e6d8a0f0.6f5878","x":312,"y":730,"wires":[["4c303dc4.305fa4"]]},{"id":"106ac630.7fc672","type":"function","z":"46e74d40.66d774","name":"","func":"/*8 Data, 1 Stop, No Parity\nBaud rate : 9600\n\nCommands:\nFIRST Output commands:\nOFF command : FF 01 00 (HEX) or 255 01 0 (DEC)\nON command : FF 01 01 (HEX) or 255 01 1 (DEC)\n...\nEIGHT Output commands:\nOFF command : FF 08 00 (HEX) or 255 08 0 (DEC)\nON command : FF 08 01 (HEX) or 255 08 1 (DEC)\n*/\n//msg.payload=xFFx18x01\";\n//var msg2 = null;\nvar zone = msg.topic.split(\"/\");\nvar target = \"0x\"+zone[2];\n\nvar buf = new Buffer(3);\nbuf.writeUInt8(0xFF, 0);\n//buf.writeUInt8(0x16, 1);\nbuf.writeUInt8(target, 1);\nif ( (msg.payload==1) || (msg.payload.upercase==\"OFF\") ) {\n  buf.writeUInt8(0x01, 2);\n//  var msg2 = { topic:msg.topic , payload:0 , duration:5};\n  //setTimeout(function() {\n//        node.send([null,msg2]);\n  //}, 20000);\n//  msg2.topic=msg.topic;\n  //msg2.payload=0;\n} else {\n  buf.writeUInt8(0x00, 2);\n}\nmsg.payload=buf;\n//buf.writeUInt8(0x00, 2); //Always switch it off again\n\n    // send message after 10 second delay\n\nvar newMsg = RED.util.cloneMessage(msg);\n\n\n\nreturn newMsg;\n//return [msg,null];","outputs":"1","noerr":0,"x":574,"y":276,"wires":[["295fb7f7.e70d6","9197b769.7ce788"]]},{"id":"6916ce78.8e619","type":"mqtt in","z":"46e74d40.66d774","name":"MqttRS485","topic":"/RS485/+/+/+/state","qos":"2","broker":"e6d8a0f0.6f5878","x":160,"y":163,"wires":[["1767c108.866e5f","aec46f6.7913f9"]]},{"id":"e42b76a9.ee5c3","type":"ui_switch","z":"46e74d40.66d774","name":"LapaBeddings","label":"Beddings aan Lapa kant","group":"14fdd9e3.cf19d6","order":3,"width":"","height":"","passthru":false,"decouple":"false","topic":"/RS485/18/Besproeiing/LapaBeddings/state","onvalue":"1","onvalueType":"str","onicon":"","oncolor":"","offvalue":"0","offvalueType":"str","officon":"","offcolor":"","x":524,"y":816,"wires":[["7dbbd77e.30b8d"]]},{"id":"152fd678.28437a","type":"mqtt in","z":"46e74d40.66d774","name":"ReadState","topic":"/RS485/18/Besproeiing/LapaBeddings/state","qos":"2","broker":"e6d8a0f0.6f5878","x":306,"y":823,"wires":[["e42b76a9.ee5c3"]]},{"id":"7dbbd77e.30b8d","type":"mqtt out","z":"46e74d40.66d774","name":"SaveState","topic":"","qos":"2","retain":"","broker":"e6d8a0f0.6f5878","x":718.5,"y":811,"wires":[]},{"id":"295fb7f7.e70d6","type":"serial out","z":"46e74d40.66d774","name":"ttyRS485","serial":"83a62c7f.749f78","x":1016,"y":262,"wires":[]},{"id":"ea9245cc.1033f","type":"mqtt out","z":"46e74d40.66d774","name":"SaveState","topic":"/RS485/13/Besproeiing/GroenteBeddings/state","qos":"2","retain":"","broker":"e6d8a0f0.6f5878","x":781,"y":740,"wires":[]},{"id":"bac8775f.965ea8","type":"ui_switch","z":"46e74d40.66d774","name":"BadkamerKompos","label":"Gras : Badkamer & Kompos","group":"14fdd9e3.cf19d6","order":9,"width":"","height":"","passthru":false,"decouple":"false","topic":"/RS485/12/Besproeiing/BadkamerKompos/state","onvalue":"1","onvalueType":"str","onicon":"","oncolor":"","offvalue":"0","offvalueType":"str","officon":"","offcolor":"","x":531,"y":892,"wires":[["ff2b344f.8fe008"]]},{"id":"e831a803.aa88e","type":"mqtt in","z":"46e74d40.66d774","name":"ReadState","topic":"/RS485/12/Besproeiing/BadkamerKompos/state","qos":"2","broker":"e6d8a0f0.6f5878","x":303,"y":899,"wires":[["bac8775f.965ea8"]]},{"id":"7e9aab1a.c06bf4","type":"ui_switch","z":"46e74d40.66d774","name":"BoomhuisMiddelgras","label":"Gras: Boomhuis & Middelgras","group":"14fdd9e3.cf19d6","order":10,"width":"","height":"","passthru":false,"decouple":"false","topic":"/RS485/14/Besproeiing/BoomhuisMiddelgras/state","onvalue":"1","onvalueType":"str","onicon":"","oncolor":"","offvalue":"0","offvalueType":"str","officon":"","offcolor":"","x":535,"y":985,"wires":[["b5a17fd9.7a5748"]]},{"id":"96df8bc4.946af","type":"mqtt in","z":"46e74d40.66d774","name":"ReadState","topic":"/RS485/14/Besproeiing/BoomhuisMiddelgras/state","qos":"2","broker":"e6d8a0f0.6f5878","x":297,"y":992,"wires":[["7e9aab1a.c06bf4"]]},{"id":"b5a17fd9.7a5748","type":"mqtt out","z":"46e74d40.66d774","name":"SaveState","topic":"","qos":"2","retain":"","broker":"e6d8a0f0.6f5878","x":750.5,"y":994,"wires":[]},{"id":"ff2b344f.8fe008","type":"mqtt out","z":"46e74d40.66d774","name":"SaveState","topic":"","qos":"2","retain":"","broker":"e6d8a0f0.6f5878","x":737,"y":893,"wires":[]},{"id":"5e9cbb9f.0d079c","type":"ui_switch","z":"46e74d40.66d774","name":"WeerskanteWasgoeddraad","label":"Gras: Weerskante van Wasgoed draad","group":"14fdd9e3.cf19d6","order":8,"width":"","height":"","passthru":false,"decouple":"false","topic":"/RS485/17/Besproeiing/WeerskanteWasgoeddraad/state","onvalue":"1","onvalueType":"str","onicon":"","oncolor":"","offvalue":"0","offvalueType":"str","officon":"","offcolor":"","x":551,"y":1059,"wires":[["aae0a51a.a1fc38"]]},{"id":"38450e60.a9b95a","type":"mqtt in","z":"46e74d40.66d774","name":"ReadState","topic":"/RS485/17/Besproeiing/WeerskanteWasgoeddraad/state","qos":"2","broker":"e6d8a0f0.6f5878","x":293,"y":1066,"wires":[["5e9cbb9f.0d079c"]]},{"id":"aae0a51a.a1fc38","type":"mqtt out","z":"46e74d40.66d774","name":"SaveState","topic":"","qos":"2","retain":"","broker":"e6d8a0f0.6f5878","x":806.5,"y":1057,"wires":[]},{"id":"9197b769.7ce788","type":"debug","z":"46e74d40.66d774","name":"Immediate","active":true,"console":"false","complete":"true","x":772,"y":306,"wires":[]},{"id":"1b181db3.16b602","type":"ui_button","z":"46e74d40.66d774","name":"","group":"14fdd9e3.cf19d6","order":12,"width":0,"height":0,"label":"Alle punte","color":"","icon":"","payload":"","payloadType":"str","topic":"","x":293.5,"y":1865,"wires":[["deeee200.3408"]]},{"id":"deeee200.3408","type":"function","z":"46e74d40.66d774","name":"","func":"var TaskList = [];\n\nfunction addTask(duration, task) //duration of task in seconds. Task is the topic.\n{\n    TaskList.push({Task:task, State:'1', Duration:duration});\n    TaskList.push({Task:task, State:'0', Duration:0});\n}\n\nfunction doTaskList()\n{\n    if (TaskList.length > 0)\n    {\n        var currentTask = TaskList[0];\n        //node.warn(\"Executing Task:\"+currentTask.Task+\" - State:\"+currentTask.State+\" - Duration:\"+currentTask.Duration);\n        msg.topic=currentTask.Task;\n        msg.payload=currentTask.State;\n        node.send(msg);\n        //Remove task\n        TaskList.splice(0,1);\n        setTimeout(doTaskList, 1000*60*currentTask.Duration*context.global.ZoneTime+10);\n    } else {\n        node.warn(\"TaskList is Empty\");\n    }\n}\n\naddTask(1, '/RS485/10/Besproeiing/GrasSwembad/state');\naddTask(1, '/RS485/0C/Besproeiing/GrasTussenLapaBedding/state');\naddTask(1.5, \"/RS485/0D/Besproeiing/GrasSlaapkamers/state\");\naddTask(1, \"/RS485/0E/Besproeiing/BeddingsSwembad/state\");\naddTask(1, \"/RS485/17/Besproeiing/WeerskanteWasgoeddraad/state\");\naddTask(1, \"/RS485/12/Besproeiing/BadkamerKompos/state\");\naddTask(1, \"/RS485/14/Besproeiing/BoomhuisMiddelgras/state\");\n\naddTask(1, \"/RS485/18/Besproeiing/LapaBeddings/state\");\naddTask(1, \"/RS485/13/Besproeiing/GroenteBeddings/state\");\n\n\n\n\ndoTaskList();\n\n//return [null,msg2];","outputs":1,"noerr":0,"x":505.5,"y":1893,"wires":[["acf043ae.ebbe58","19515051.3cf4a"]]},{"id":"acf043ae.ebbe58","type":"debug","z":"46e74d40.66d774","name":"AlleDebug","active":true,"console":"false","complete":"true","x":749,"y":1875,"wires":[]},{"id":"bf385417.7cf7d","type":"ui_switch","z":"46e74d40.66d774","name":"LapaMisSproeers","label":"Lapa: Mis Sproeers","group":"71ed9bad.c81874","order":1,"width":"","height":"","passthru":false,"decouple":"false","topic":"/RS485/0F/Lapa/MisSproeers/state","onvalue":"1","onvalueType":"str","onicon":"","oncolor":"","offvalue":"0","offvalueType":"str","officon":"","offcolor":"","x":499,"y":1721,"wires":[["9a0b3db5.0c4cd"]]},{"id":"8610705b.f1bb78","type":"mqtt in","z":"46e74d40.66d774","name":"ReadState","topic":"/RS485/0F/Lapa/MisSproeers/state","qos":"2","broker":"e6d8a0f0.6f5878","x":271,"y":1728,"wires":[["bf385417.7cf7d"]]},{"id":"9a0b3db5.0c4cd","type":"mqtt out","z":"46e74d40.66d774","name":"SaveState","topic":"","qos":"2","retain":"","broker":"e6d8a0f0.6f5878","x":784.5,"y":1719,"wires":[]},{"id":"e3776c1f.88f7a8","type":"ui_switch","z":"46e74d40.66d774","name":"GrasSwembad","label":"Gras: By Swembad","group":"14fdd9e3.cf19d6","order":4,"width":"","height":"","passthru":false,"decouple":"false","topic":"/RS485/10/Besproeiing/GrasSwembad/state","onvalue":"1","onvalueType":"str","onicon":"","oncolor":"","offvalue":"0","offvalueType":"str","officon":"","offcolor":"","x":503,"y":1432,"wires":[["5db6b03b.e2ead8"]]},{"id":"32a15f85.b0ed9","type":"mqtt in","z":"46e74d40.66d774","name":"ReadState","topic":"/RS485/10/Besproeiing/GrasSwembad/state","qos":"2","broker":"e6d8a0f0.6f5878","x":285,"y":1439,"wires":[["e3776c1f.88f7a8"]]},{"id":"5db6b03b.e2ead8","type":"mqtt out","z":"46e74d40.66d774","name":"SaveState","topic":"","qos":"2","retain":"","broker":"e6d8a0f0.6f5878","x":798.5,"y":1430,"wires":[]},{"id":"253cff7f.f0ff7","type":"ui_switch","z":"46e74d40.66d774","name":"GrasTussenLapaBedding","label":"Gras: Tussen Lapa en Bedding","group":"14fdd9e3.cf19d6","order":5,"width":"","height":"","passthru":false,"decouple":"false","topic":"/RS485/0C/Besproeiing/GrasTussenLapaBedding/state","onvalue":"1","onvalueType":"str","onicon":"","oncolor":"","offvalue":"0","offvalueType":"str","officon":"","offcolor":"","x":530,"y":1509,"wires":[["8178d0ec.8639a8"]]},{"id":"e7d64608.c0c7b","type":"mqtt in","z":"46e74d40.66d774","name":"ReadState","topic":"/RS485/0C/Besproeiing/GrasTussenLapaBedding/state","qos":"2","broker":"e6d8a0f0.6f5878","x":282,"y":1516,"wires":[["253cff7f.f0ff7"]]},{"id":"8178d0ec.8639a8","type":"mqtt out","z":"46e74d40.66d774","name":"SaveState","topic":"","qos":"2","retain":"","broker":"e6d8a0f0.6f5878","x":795.5,"y":1507,"wires":[]},{"id":"930e75cf.215478","type":"ui_switch","z":"46e74d40.66d774","name":"GrasSlaapkamers","label":"Gras: By Slaapkamers","group":"14fdd9e3.cf19d6","order":6,"width":"","height":"","passthru":false,"decouple":"false","topic":"/RS485/0D/Besproeiing/GrasSlaapkamers/state","onvalue":"1","onvalueType":"str","onicon":"","oncolor":"","offvalue":"0","offvalueType":"str","officon":"","offcolor":"","x":504,"y":1577,"wires":[["2f7be261.6efbde"]]},{"id":"950cc3d4.5ed9b","type":"mqtt in","z":"46e74d40.66d774","name":"ReadState","topic":"/RS485/0D/Besproeiing/GrasSlaapkamers/state","qos":"2","broker":"e6d8a0f0.6f5878","x":276,"y":1584,"wires":[["930e75cf.215478"]]},{"id":"2f7be261.6efbde","type":"mqtt out","z":"46e74d40.66d774","name":"SaveState","topic":"","qos":"2","retain":"","broker":"e6d8a0f0.6f5878","x":789.5,"y":1575,"wires":[]},{"id":"92485d0d.db791","type":"ui_switch","z":"46e74d40.66d774","name":"GrasBeddingsSwembad","label":"Gras: Beddings by Swembad","group":"14fdd9e3.cf19d6","order":7,"width":"","height":"","passthru":false,"decouple":"false","topic":"/RS485/0E/Besproeiing/BeddingsSwembad/state","onvalue":"1","onvalueType":"str","onicon":"","oncolor":"","offvalue":"0","offvalueType":"str","officon":"","offcolor":"","x":521,"y":1654,"wires":[["369793bc.7264bc"]]},{"id":"5026556a.a5db2c","type":"mqtt in","z":"46e74d40.66d774","name":"ReadState","topic":"/RS485/0E/Besproeiing/BeddingsSwembad/state","qos":"2","broker":"e6d8a0f0.6f5878","x":273,"y":1661,"wires":[["92485d0d.db791"]]},{"id":"369793bc.7264bc","type":"mqtt out","z":"46e74d40.66d774","name":"SaveState","topic":"","qos":"2","retain":"","broker":"e6d8a0f0.6f5878","x":786.5,"y":1652,"wires":[]},{"id":"13e976bf.bf7df9","type":"debug","z":"282b2841.91abf8","name":"DebugReceived","active":false,"console":"false","complete":"payload","x":546.333251953125,"y":415.1167297363281,"wires":[]},{"id":"eb8e3b00.f4b638","type":"exec","z":"282b2841.91abf8","command":"/usr/bin/python /home/pi/Projects/modbus/eastron.py","addpay":true,"append":"","useSpawn":"","timer":"15","name":"ReadModbus","x":220.33334350585938,"y":164.60000610351562,"wires":[["7933f5e9.7f14ac","880362a7.43d63"],[],[]]},{"id":"7933f5e9.7f14ac","type":"debug","z":"282b2841.91abf8","name":"","active":false,"console":"false","complete":"false","x":401.3333435058594,"y":79.26663208007812,"wires":[]},{"id":"a6a494d.ca2f468","type":"inject","z":"282b2841.91abf8","name":"Every10Seconds","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":161.33334350585938,"y":49.016632080078125,"wires":[["eb8e3b00.f4b638"]]},{"id":"880362a7.43d63","type":"json","z":"282b2841.91abf8","name":"","x":449.3333435058594,"y":158.44998168945312,"wires":[["e41b7e44.23416"]]},{"id":"e41b7e44.23416","type":"split","z":"282b2841.91abf8","name":"SplitIntoArray","splt":"","x":663.3333740234375,"y":157.51663208007812,"wires":[["2f9d88af.719e1"]]},{"id":"2f9d88af.719e1","type":"split","z":"282b2841.91abf8","name":"SplitIntoSensors","splt":"\\n","x":878.333251953125,"y":153.51663208007812,"wires":[["67910e97.b95db","8f5df408.08e1e8"]]},{"id":"67910e97.b95db","type":"debug","z":"282b2841.91abf8","name":"","active":false,"console":"false","complete":"payload","x":1091.3333740234375,"y":73.71670532226562,"wires":[]},{"id":"8f5df408.08e1e8","type":"function","z":"282b2841.91abf8","name":"SplitValues","func":"var topic = '/in/electricity/'+msg.payload.UnitID+'/';\nvar msg_voltage = { topic:topic+'voltage' , payload:msg.payload.Voltage};\nvar msg_amps = { topic:topic+'amps' , payload:msg.payload.Amps};\nvar msg_frequency = { topic:topic+'frequency' , payload:msg.payload.Frequency};\nvar msg_power = { topic:topic+'power' , payload:msg.payload.Power};\nvar msg_energy = { topic:topic+'energy' , payload:msg.payload.Energy};\nvar msg_powerFactor = { topic:topic+'powerFactor' , payload:msg.payload.PowerFactor};\nvar msg_apparentPower = { topic:topic+'apparentPower' , payload:msg.payload.ApparentPower};\n\nnode.send(msg_voltage);\nnode.send(msg_amps);\nnode.send(msg_frequency);\nnode.send(msg_power);\nnode.send(msg_energy);\nnode.send(msg_powerFactor);\nnode.send(msg_apparentPower);\n\n\nvar msg2 = { topic:topic+'all' , payload:\"\"};\nmsg2.payload+='{\"voltage\":'+Math.round(msg.payload.Voltage)+'}';\n\nvar msg3 = { topic:\"emon/\"+msg.payload.UnitID+\"/voltage\" , payload:Math.round(msg.payload.Voltage)};\n\nreturn [null, msg2, msg3];","outputs":"1","noerr":0,"x":308.3333435058594,"y":344.4333190917969,"wires":[["13e976bf.bf7df9","7ccdbcfd.de8c34"]]},{"id":"7ccdbcfd.de8c34","type":"mqtt out","z":"282b2841.91abf8","name":"SaveState","topic":"","qos":"2","retain":"","broker":"e6d8a0f0.6f5878","x":556.88330078125,"y":323.8833312988281,"wires":[]},{"id":"f01d2fae.35403","type":"ui_gauge","z":"dd08fb92.1a5348","name":"IncommingVolts","group":"a004db13.9e779","order":1,"width":"3","height":"3","gtype":"gage","title":"Voltage","label":"V","format":"{{value | number:1}}","min":"200","max":"260","x":490.0000305175781,"y":81.88333129882812,"wires":[]},{"id":"f91cec55.e236c","type":"mqtt in","z":"dd08fb92.1a5348","name":"IncommingVolts","topic":"/in/electricity/11/voltage","qos":"0","broker":"e6d8a0f0.6f5878","x":165,"y":96.88333129882812,"wires":[["f01d2fae.35403"]]},{"id":"e43045ed.b9da","type":"ui_gauge","z":"dd08fb92.1a5348","name":"IncommingPower","group":"a004db13.9e779","order":1,"width":"3","height":"3","gtype":"gage","title":"Power","label":"W","format":"{{value | number:1}}","min":"0","max":"10000","x":487.0000305175781,"y":166.88333129882812,"wires":[]},{"id":"4548a9bd.bfb37","type":"mqtt in","z":"dd08fb92.1a5348","name":"IncommingPower","topic":"/in/electricity/11/power","qos":"0","broker":"e6d8a0f0.6f5878","x":168,"y":169.88333129882812,"wires":[["e43045ed.b9da","239f3cfb.32fec4","c21a167a.4f9a6"]]},{"id":"7707ab13.8149ac","type":"ui_gauge","z":"dd08fb92.1a5348","name":"IncommingFrequency","group":"a004db13.9e779","order":1,"width":"3","height":"3","gtype":"gage","title":"Frequency","label":"Hz","format":"{{value | number:2}}","min":"48","max":"52","x":498.0000305175781,"y":239.88333129882812,"wires":[]},{"id":"7ee00cef.bf21ac","type":"mqtt in","z":"dd08fb92.1a5348","name":"IncommingFrequency","topic":"/in/electricity/11/frequency","qos":"0","broker":"e6d8a0f0.6f5878","x":179,"y":242.88333129882812,"wires":[["7707ab13.8149ac"]]},{"id":"90d029a3.75021","type":"mqtt in","z":"dd08fb92.1a5348","name":"IncommingEnergy","topic":"/in/electricity/11/energy","qos":"0","broker":"e6d8a0f0.6f5878","x":176.99996948242188,"y":404.8833312988281,"wires":[["7d2c5843.91c6b"]]},{"id":"7d2c5843.91c6b","type":"ui_text","z":"dd08fb92.1a5348","group":"a004db13.9e779","order":0,"width":0,"height":0,"name":"IncommingEnergy","label":"Energy","format":"{{msg.payload | number:2}}kWh","layout":"row-spread","x":496.333251953125,"y":396.8000183105469,"wires":[]},{"id":"228e75ef.08dd2a","type":"ui_gauge","z":"dd08fb92.1a5348","name":"IncommingAmps","group":"a004db13.9e779","order":1,"width":"3","height":"3","gtype":"gage","title":"Amps","label":"A","format":"{{value | number:2}}","min":"0","max":"60","x":486.8833312988281,"y":312.8833312988281,"wires":[]},{"id":"bf2a9b8c.7ac71","type":"mqtt in","z":"dd08fb92.1a5348","name":"IncommingAmps","topic":"/in/electricity/11/amps","qos":"0","broker":"e6d8a0f0.6f5878","x":157.88330078125,"y":315.8833312988281,"wires":[["228e75ef.08dd2a"]]},{"id":"a50720fb.80318","type":"ui_gauge","z":"dd08fb92.1a5348","name":"GeyserPower","group":"ff843fa0.47e1f8","order":1,"width":"3","height":"3","gtype":"gage","title":"Power","label":"W","format":"{{value | number:1}}","min":"0","max":"4000","x":456.8833312988281,"y":622.8832702636719,"wires":[]},{"id":"2e703492.f65ae4","type":"mqtt in","z":"dd08fb92.1a5348","name":"GeyserPower","topic":"/in/electricity/12/power","qos":"0","broker":"e6d8a0f0.6f5878","x":127.88330078125,"y":625.8832702636719,"wires":[["a50720fb.80318","1a1e6c68.170a54"]]},{"id":"9146ac1.d53bcd","type":"ui_gauge","z":"dd08fb92.1a5348","name":"GeyserAmps","group":"ff843fa0.47e1f8","order":3,"width":"3","height":"3","gtype":"gage","title":"Amps","label":"A","format":"{{value | number:2}}","min":"0","max":"20","x":474.0000305175781,"y":676.8832702636719,"wires":[]},{"id":"7f7d41ee.17b498","type":"mqtt in","z":"dd08fb92.1a5348","name":"GeyserAmps","topic":"/in/electricity/12/amps","qos":"0","broker":"e6d8a0f0.6f5878","x":145,"y":679.8832702636719,"wires":[["9146ac1.d53bcd"]]},{"id":"15dd387f.cce99","type":"mqtt in","z":"dd08fb92.1a5348","name":"GeyserEnergy","topic":"/in/electricity/12/energy","qos":"0","broker":"e6d8a0f0.6f5878","x":133.88333129882812,"y":740.8832702636719,"wires":[["6fc430f0.0a8248"]]},{"id":"6fc430f0.0a8248","type":"ui_text","z":"dd08fb92.1a5348","group":"ff843fa0.47e1f8","order":4,"width":0,"height":0,"name":"GeyserEnergy","label":"Energy","format":"{{msg.payload | number:2}}kWh","layout":"row-spread","x":453.21661376953125,"y":732.7999572753906,"wires":[]},{"id":"1a1e6c68.170a54","type":"ui_chart","z":"dd08fb92.1a5348","name":"GeyserPowerChart","group":"eb7269e5.08d1e8","order":2,"width":0,"height":0,"label":"Power","interpolate":"step-after","nodata":"","ymin":"0","ymax":"4000","removeOlder":"1","removeOlderUnit":"86400","x":481.3333435058594,"y":580.2666015625,"wires":[[],[]]},{"id":"239f3cfb.32fec4","type":"ui_chart","z":"dd08fb92.1a5348","name":"Power Usage","group":"eb7269e5.08d1e8","order":0,"width":0,"height":0,"label":"Power","interpolate":"linear","nodata":"","ymin":"0","ymax":"10000","removeOlder":"1","removeOlderUnit":"86400","x":490.3333435058594,"y":130.26666259765625,"wires":[[],[]]},{"id":"15e74e05.f8bfca","type":"http request","z":"3b15046f.07e474","name":"","method":"POST","ret":"txt","url":"https://emoncms.org/myip/set.json?apikey=326a8a286d0ea86e9de89b0ba77c5fdb","tls":"ccb1e8a8.5b78e","x":1110.3332824707031,"y":459.1000061035156,"wires":[[]]},{"id":"72e6a38d.9172e4","type":"AVR-Yamaha-put","z":"68c40619.e42048","device":"7c8cbdf4.aadd04","name":"","topic":"Main_Zone.Power_Control.Power","payload":"","x":384.8833312988281,"y":500.8833312988281,"wires":[["57ee2e80.08a8e"]]},{"id":"437f66a1.b9fdb8","type":"inject","z":"68c40619.e42048","name":"","topic":"","payload":"On","payloadType":"str","repeat":"","crontab":"","once":false,"x":204.88333129882812,"y":480.8833312988281,"wires":[["72e6a38d.9172e4"]]},{"id":"57ee2e80.08a8e","type":"debug","z":"68c40619.e42048","name":"","active":true,"console":"false","complete":"false","x":624.8833312988281,"y":520.8833312988281,"wires":[]},{"id":"fe3d9d34.100ab","type":"inject","z":"68c40619.e42048","name":"","topic":"","payload":"Standby","payloadType":"str","repeat":"","crontab":"","once":false,"x":194.88333129882812,"y":520.8833312988281,"wires":[["72e6a38d.9172e4"]]},{"id":"67007a77.a1a00c","type":"AVR-Yamaha-get","z":"68c40619.e42048","device":"7c8cbdf4.aadd04","name":"","topic":"Main_Zone.Volume.Lvl","x":384.8833312988281,"y":580.8833312988281,"wires":[["57ee2e80.08a8e"]]},{"id":"ff503d57.7a968","type":"inject","z":"68c40619.e42048","name":"Volume Get","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":184.88333129882812,"y":580.8833312988281,"wires":[["67007a77.a1a00c"]]},{"id":"5cf67586.5dbf5c","type":"AVR-Yamaha-put","z":"68c40619.e42048","device":"7c8cbdf4.aadd04","name":"","topic":"Main_Zone.Volume.Lvl.Val","payload":"{\"Val\":-550, \"Exp\":1, \"Unit\":\"dB\"}","x":384.8833312988281,"y":620.8833312988281,"wires":[["57ee2e80.08a8e"]]},{"id":"fa602e81.22b788","type":"inject","z":"68c40619.e42048","name":"Volume Set","topic":"","payload":"Up","payloadType":"str","repeat":"","crontab":"","once":false,"x":184.88333129882812,"y":620.8833312988281,"wires":[["5cf67586.5dbf5c"]]},{"id":"dd1779f8.806a18","type":"debug","z":"68c40619.e42048","name":"","active":true,"console":"false","complete":"payload","x":686.88330078125,"y":750.63330078125,"wires":[]},{"id":"229097c2.6a48a","type":"AVR-Yamaha-in","z":"68c40619.e42048","device":"7c8cbdf4.aadd04","name":"Rx810-Listener","devdesc":true,"x":196.88330078125,"y":750.63330078125,"wires":[["508c8b19.cb1b34","ad137208.339848"]]},{"id":"510bafae.99fd18","type":"rbe","z":"68c40619.e42048","name":"","func":"rbe","gap":"","x":526.88330078125,"y":750.63330078125,"wires":[["dd1779f8.806a18"]]},{"id":"508c8b19.cb1b34","type":"function","z":"68c40619.e42048","name":"stringify","func":"\nif (typeof msg.payload != 'string')\n    msg.payload = JSON.stringify(msg.payload);\n\nreturn msg;","outputs":1,"noerr":0,"x":376.88330078125,"y":750.63330078125,"wires":[["510bafae.99fd18"]]},{"id":"c5b81ffc.980ae","type":"AVR-Yamaha-get","z":"68c40619.e42048","device":"7c8cbdf4.aadd04","name":"","topic":"System.Misc.Event.Notice","x":392.8833312988281,"y":932.63330078125,"wires":[["fefa7a8b.80a78"]]},{"id":"fefa7a8b.80a78","type":"debug","z":"68c40619.e42048","name":"","active":true,"console":"false","complete":"false","x":632.8833312988281,"y":872.63330078125,"wires":[]},{"id":"3dcb6664.248582","type":"inject","z":"68c40619.e42048","name":"Volume Get","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":192.88333129882812,"y":932.63330078125,"wires":[["c5b81ffc.980ae"]]},{"id":"7bfe8245.9397e4","type":"AVR-Yamaha-put","z":"68c40619.e42048","device":"7c8cbdf4.aadd04","name":"","topic":"System.Misc.Event.Notice","payload":"On","x":392.8833312988281,"y":972.63330078125,"wires":[["fefa7a8b.80a78"]]},{"id":"c5dca64.fa6ee58","type":"inject","z":"68c40619.e42048","name":"Volume Set","topic":"System.Misc.Event.Notice","payload":"On","payloadType":"str","repeat":"","crontab":"","once":false,"x":192.88333129882812,"y":972.63330078125,"wires":[["7bfe8245.9397e4"]]},{"id":"309b7b43.f6d67c","type":"mqtt in","z":"dd08fb92.1a5348","name":"IncommingPowerFactor","topic":"/in/electricity/11/powerFactor","qos":"0","broker":"e6d8a0f0.6f5878","x":193.88333129882812,"y":477.8833312988281,"wires":[["53b0ec68.d698c4"]]},{"id":"53b0ec68.d698c4","type":"ui_text","z":"dd08fb92.1a5348","group":"a004db13.9e779","order":0,"width":0,"height":0,"name":"IncommingPowerFactor","label":"Power Factor","format":"{{msg.payload | number:2}}","layout":"row-spread","x":513.2166137695312,"y":469.8000183105469,"wires":[]},{"id":"c21a167a.4f9a6","type":"ui_chart","z":"dd08fb92.1a5348","name":"Power Usage","group":"eb7269e5.08d1e8","order":0,"width":0,"height":0,"label":"Power (2 hours)","interpolate":"linear","nodata":"","ymin":"0","ymax":"10000","removeOlder":"2","removeOlderUnit":"3600","x":490.8833312988281,"y":204.88333129882812,"wires":[[],[]]},{"id":"4525cf78.041e28","type":"mqtt in","z":"282b2841.91abf8","name":"Send to Emoncms","topic":"home/emoncms/out/disabled/#","qos":"2","broker":"e6d8a0f0.6f5878","x":131,"y":778.63330078125,"wires":[["4f136b22.57ec74","58d4c385.554924"]]},{"id":"4f136b22.57ec74","type":"function","z":"282b2841.91abf8","name":"Build EmonCMS url","func":"// The received message is stored in 'msg'\n// It will have at least a 'payload' property:\n//   console.log(msg.payload);\n// The 'context' object is available to store state\n// between invocations of the function\n//   context = {};\n\n//expects JSON payload and destination specified in topic\n\nvar apikey = \"306e176c6f02246ddb45014f093625f8\";\n\n//destination will be last part node of topic\nvar tokens = msg.topic.split(\"/\");\nvar dest = tokens[tokens.length-2];\nvar key = tokens[tokens.length-1];\n//var dest = 11;\n\n\nif(isNaN(dest))\n{\n//not a valid destination\n//return null;\n}\n\nmsg.url =\"http://localhost/emoncms/input/post.json?node=\";\nmsg.url += dest;\n//node.warn('dest='+dest);\nmsg.url += \"&json=\";\nmsg.url += key;\nmsg.url += \":\";\nmsg.url += msg.payload;\nmsg.url += \"&apikey=\";\nmsg.url += apikey;\n\n\nreturn msg;","outputs":1,"noerr":0,"x":373.00001525878906,"y":784.63330078125,"wires":[["c2001483.88309","1cf100eb.0f60b7"]]},{"id":"c2001483.88309","type":"http request","z":"282b2841.91abf8","name":"HTTP GET to EmonCMS","method":"GET","url":"","x":640.666748046875,"y":759.63330078125,"wires":[["e60504ea.32bba8"]]},{"id":"e60504ea.32bba8","type":"debug","z":"282b2841.91abf8","name":"EmonCMS HTTP Request Result","active":false,"complete":"false","x":933.6666259765625,"y":693.9666748046875,"wires":[]},{"id":"68cc7db6.3dea1c","type":"debug","z":"282b2841.91abf8","name":"EmonCMS URL","active":false,"complete":"true","x":950,"y":852.63330078125,"wires":[]},{"id":"1cf100eb.0f60b7","type":"function","z":"282b2841.91abf8","name":"Debug EmonCMS URL","func":"// The received message is stored in 'msg'\n// It will have at least a 'payload' property:\n//   console.log(msg.payload);\n// The 'context' object is available to store state\n// between invocations of the function\n//   context = {};\n\n\nreturn msg.url;","outputs":1,"x":637,"y":837.6333618164062,"wires":[["68cc7db6.3dea1c"]]},{"id":"d0688dc2.8fde48","type":"mqtt in","z":"282b2841.91abf8","name":"ELECTRICITY IN","topic":"/in/electricity/#","qos":"2","broker":"e6d8a0f0.6f5878","x":170,"y":559.6333312988281,"wires":[["12c41fcb.79752"]]},{"id":"40237e55.6095e8","type":"mqtt out","z":"282b2841.91abf8","name":"Send to Emoncms","topic":"","qos":"","retain":"","broker":"e6d8a0f0.6f5878","x":703,"y":553.63330078125,"wires":[]},{"id":"12c41fcb.79752","type":"function","z":"282b2841.91abf8","name":"Prepare for EmonCMS","func":"// The received message is stored in 'msg'\n// It will have at least a 'payload' property:\n//   console.log(msg.payload);\n// The 'context' object is available to store state\n// between invocations of the function\n//   context = {};\n\n//destination will be last part node of topic\nvar tokens = msg.topic.split(\"/\");\nvar dest = tokens[tokens.length-1];\nvar dest2 = tokens[tokens.length-2];\n\nmsg.topic = \"home/emoncms/out/\";\nmsg.topic += dest2;\nmsg.topic += \"/\";\nmsg.topic += dest;\nif (dest==\"powerFactor\") {\n  msg.payload = Math.round(msg.payload*100);\n} else {\n  msg.payload = Math.round(msg.payload);\n}  \nreturn msg;\n","outputs":1,"noerr":0,"x":425,"y":559.63330078125,"wires":[["40237e55.6095e8","46ffb0d2.c8daa"]]},{"id":"e8b90d94.a15988","type":"comment","z":"282b2841.91abf8","name":"EmonCMS sender","info":"","x":172,"y":709.63330078125,"wires":[]},{"id":"355abd3.ab889c2","type":"comment","z":"282b2841.91abf8","name":"Send whatever was received on the In/Electricity/# MQTT topic to EmonCMS","info":"","x":338.9999694824219,"y":513.63330078125,"wires":[]},{"id":"46ffb0d2.c8daa","type":"debug","z":"282b2841.91abf8","name":"","active":true,"console":"false","complete":"false","x":688.333251953125,"y":623.1500244140625,"wires":[]},{"id":"58d4c385.554924","type":"debug","z":"282b2841.91abf8","name":"getMQTT","active":false,"console":"false","complete":"payload","x":294.3333435058594,"y":846.1499938964844,"wires":[]},{"id":"86cea238.a31c28","type":"mqtt in","z":"673c5652.d668c8","name":"TEMPERATURE IN","topic":"/temp/#","qos":"2","broker":"e6d8a0f0.6f5878","x":288.8833312988281,"y":861.86669921875,"wires":[["691083.f2d9077c"]]},{"id":"617efb90.27cbec","type":"mqtt out","z":"673c5652.d668c8","name":"Send to Emoncms","topic":"","qos":"","retain":"","broker":"e6d8a0f0.6f5878","x":821.8833312988281,"y":855.8666687011719,"wires":[]},{"id":"691083.f2d9077c","type":"function","z":"673c5652.d668c8","name":"Prepare for EmonCMS","func":"// The received message is stored in 'msg'\n// It will have at least a 'payload' property:\n//   console.log(msg.payload);\n// The 'context' object is available to store state\n// between invocations of the function\n//   context = {};\n\n//destination will be last part node of topic\nvar tokens = msg.topic.split(\"/\");\nvar dest = tokens[tokens.length-1];\nvar dest2 = \"Temperature\";\n\nmsg.topic = \"home/emoncms/out/\";\nmsg.topic += dest2;\nmsg.topic += \"/\";\nmsg.topic += dest;\nmsg.payload = Math.round(msg.payload*10);\nreturn msg;\n","outputs":1,"noerr":0,"x":543.8833312988281,"y":861.8666687011719,"wires":[["617efb90.27cbec","177a2800.7ccb2"]]},{"id":"d69a8641.c0941","type":"comment","z":"673c5652.d668c8","name":"Send whatever was received on the /temp/# MQTT topic to EmonCMS","info":"","x":437.88330078125,"y":815.8666687011719,"wires":[]},{"id":"177a2800.7ccb2","type":"debug","z":"673c5652.d668c8","name":"","active":false,"console":"false","complete":"false","x":807.2165832519531,"y":925.3833923339844,"wires":[]},{"id":"61c457ef.0d658","type":"mqtt in","z":"2dba819.654bb7e","name":"ALARM IN","topic":"/alarm/zone/+/FAULT","qos":"2","broker":"e6d8a0f0.6f5878","x":123.88333129882812,"y":1395.88330078125,"wires":[["e04f08a2.610dc8"]]},{"id":"494e2266.3d8074","type":"mqtt out","z":"2dba819.654bb7e","name":"Send to Emoncms","topic":"","qos":"","retain":"","broker":"e6d8a0f0.6f5878","x":686.8833312988281,"y":1389.8832702636719,"wires":[]},{"id":"e04f08a2.610dc8","type":"function","z":"2dba819.654bb7e","name":"Prepare for EmonCMS","func":"// The received message is stored in 'msg'\n// It will have at least a 'payload' property:\n//   console.log(msg.payload);\n// The 'context' object is available to store state\n// between invocations of the function\n//   context = {};\n\n//destination will be last part node of topic\n//  /alarm/zone/*/FAULT\nvar tokens = msg.topic.split(\"/\");\nvar dest = tokens[tokens.length-1];\nvar dest1 = tokens[tokens.length-2];\nvar dest2 = \"Alarm\";\n\nmsg.topic = \"home/emoncms/out/\";\nmsg.topic += dest2;\nmsg.topic += \"/Zone\";\nmsg.topic += dest1;\nmsg.topic += \"Fault\";\nmsg.payload = msg.payload;\nreturn msg;\n","outputs":1,"noerr":0,"x":408.8833312988281,"y":1395.8832702636719,"wires":[["494e2266.3d8074","12f9cc6c.29ea24"]]},{"id":"a4856da3.a492c8","type":"comment","z":"2dba819.654bb7e","name":"Send whatever was received on the /temp/# MQTT topic to EmonCMS","info":"","x":302.88330078125,"y":1349.8832702636719,"wires":[]},{"id":"12f9cc6c.29ea24","type":"debug","z":"2dba819.654bb7e","name":"","active":false,"console":"false","complete":"false","x":672.2165832519531,"y":1459.3999938964844,"wires":[]},{"id":"9f9bd941.834698","type":"ui_switch","z":"74cedccf.2b6a6c","name":"Kersboom","label":"Kersboom","group":"6eaf738f.cbb964","order":3,"width":"","height":"","passthru":false,"decouple":"true","topic":"/Kersboom/cmd","onvalue":"GPIO 12 1","onvalueType":"str","onicon":"","oncolor":"","offvalue":"GPIO 12 0","offvalueType":"str","officon":"","offcolor":"","x":480,"y":570.0000305175781,"wires":[["9811a983.e44388"]]},{"id":"9889ea16.436008","type":"mqtt in","z":"74cedccf.2b6a6c","name":"Kersboom","topic":"/Kersboom/cmd","qos":"2","broker":"e6d8a0f0.6f5878","x":245,"y":544,"wires":[["9f9bd941.834698"]]},{"id":"9811a983.e44388","type":"mqtt out","z":"74cedccf.2b6a6c","name":"SaveStateKersboom","topic":"/Kersboom/cmd","qos":"0","retain":"true","broker":"e6d8a0f0.6f5878","x":721.5,"y":578,"wires":[]},{"id":"16dbd2d0.7886d5","type":"bigtimer","z":"74cedccf.2b6a6c","outtopic":"/Kersboom/cmd","outpayload1":"GPIO 12 1","outpayload2":"GPIO 12 0","name":"Big Timer","lat":"-25.8619229","lon":"28.1774539","starttime":"5001","endtime":"1380","startoff":"-75","endoff":0,"offs":0,"outtext1":"GPIO 12 1","outtext2":"GPIO 12 0","timeout":1440,"sun":true,"mon":true,"tue":true,"wed":true,"thu":true,"fri":true,"sat":true,"jan":true,"feb":true,"mar":true,"apr":true,"may":true,"jun":true,"jul":true,"aug":true,"sep":true,"oct":true,"nov":true,"dec":true,"day1":0,"month1":0,"day2":0,"month2":0,"day3":0,"month3":0,"day4":0,"month4":0,"day5":0,"month5":0,"d1":0,"w1":0,"d2":0,"w2":0,"d3":0,"w3":0,"d4":0,"w4":0,"d5":0,"w5":0,"suspend":false,"random":false,"repeat":false,"atstart":true,"x":489,"y":644,"wires":[["9811a983.e44388"],[],[]]},{"id":"d2e85952.2b8a68","type":"comment","z":"b3e8b0d6.d2fd48","name":"All the IDs for ESPEasy","info":"\n22 - Kersboom\n\n32 - Kaslig32 - Gnngkas\n33 - Kaslig33 - Hoofslaapkamerkas1\n34 - Kaslig34 - Hoofslaapkamerkas2\n35 - Kaslig35 - Hoofslaapkamerkas3\n36 - Kaslig36 - Hoofslaapkamerkas4\n37 - Kaslig37 - Hoofslaapkamerkas5\n38 - Kluis - Geweer kluis asook Elektroniese kluis\n39 - ","x":225,"y":51,"wires":[]},{"id":"363fbaed.901d2e","type":"comment","z":"b3e8b0d6.d2fd48","name":"","info":"","x":176,"y":132,"wires":[]},{"id":"d4f331c.bac165","type":"ui_switch","z":"74cedccf.2b6a6c","name":"KersfeesSterSwitch","label":"KersfeesSter","group":"6eaf738f.cbb964","order":4,"width":"","height":"","passthru":false,"decouple":"true","topic":"/KersfeesSter/cmd","onvalue":"GPIO 12 1","onvalueType":"str","onicon":"","oncolor":"","offvalue":"GPIO 12 0","offvalueType":"str","officon":"","offcolor":"","x":522.8833312988281,"y":755.88330078125,"wires":[["c4124731.e64408"]]},{"id":"5fd84377.86d51c","type":"mqtt in","z":"74cedccf.2b6a6c","name":"KersfeesSter","topic":"/KersfeesSter/cmd","qos":"2","broker":"e6d8a0f0.6f5878","x":260.8833312988281,"y":716.88330078125,"wires":[["d4f331c.bac165"]]},{"id":"c4124731.e64408","type":"mqtt out","z":"74cedccf.2b6a6c","name":"SaveStateKersfeesSter","topic":"/KersfeesSter/cmd","qos":"0","retain":"true","broker":"e6d8a0f0.6f5878","x":849.38330078125,"y":747.88330078125,"wires":[]},{"id":"224da94e.75646e","type":"bigtimer","z":"74cedccf.2b6a6c","outtopic":"/Kersboom/cmd","outpayload1":"GPIO 12 1","outpayload2":"GPIO 12 0","name":"Big Timer","lat":"-25.8619229","lon":"28.1774539","starttime":"5004","endtime":"1410","startoff":"-30","endoff":0,"offs":0,"outtext1":"GPIO 12 1","outtext2":"GPIO 12 0","timeout":1440,"sun":true,"mon":true,"tue":true,"wed":true,"thu":true,"fri":true,"sat":true,"jan":true,"feb":true,"mar":true,"apr":true,"may":true,"jun":true,"jul":true,"aug":true,"sep":true,"oct":true,"nov":true,"dec":true,"day1":0,"month1":0,"day2":0,"month2":0,"day3":0,"month3":0,"day4":0,"month4":0,"day5":0,"month5":0,"d1":0,"w1":0,"d2":0,"w2":0,"d3":0,"w3":0,"d4":0,"w4":0,"d5":0,"w5":0,"suspend":false,"random":false,"repeat":false,"atstart":true,"odd":false,"even":false,"x":494.8833312988281,"y":816.88330078125,"wires":[["c4124731.e64408"],[],[]]},{"id":"8671bead.a582b","type":"mqtt in","z":"15a592a.c0d836d","name":"ALARM IN","topic":"/Water/+/Volume","qos":"2","broker":"e6d8a0f0.6f5878","x":154.88333129882812,"y":422.8833312988281,"wires":[["ef943ca3.4098e8"]]},{"id":"c8244fcc.3fc49","type":"mqtt out","z":"15a592a.c0d836d","name":"Send to Emoncms","topic":"","qos":"","retain":"","broker":"e6d8a0f0.6f5878","x":717.8833312988281,"y":416.88330078125,"wires":[]},{"id":"ef943ca3.4098e8","type":"function","z":"15a592a.c0d836d","name":"Prepare for EmonCMS","func":"// The received message is stored in 'msg'\n// It will have at least a 'payload' property:\n//   console.log(msg.payload);\n// The 'context' object is available to store state\n// between invocations of the function\n//   context = {};\n\n//destination will be last part node of topic\n//  /alarm/zone/*/FAULT\nvar tokens = msg.topic.split(\"/\");\nvar dest = tokens[tokens.length-1];\nvar dest1 = tokens[tokens.length-2];\nvar dest2 = \"Water\";\n\nmsg.topic = \"home/emoncms/out/\";\nmsg.topic += dest2;\nmsg.topic += \"/\";\nmsg.topic += dest1;\n//msg.topic += \"Fault\";\nmsg.payload = msg.payload;\nreturn msg;\n","outputs":1,"noerr":0,"x":439.8833312988281,"y":422.88330078125,"wires":[["c8244fcc.3fc49","e5795f12.b7369"]]},{"id":"49e6eb3.caf3814","type":"comment","z":"15a592a.c0d836d","name":"Send whatever was received on the /temp/# MQTT topic to EmonCMS","info":"","x":333.88330078125,"y":376.88330078125,"wires":[]},{"id":"e5795f12.b7369","type":"debug","z":"15a592a.c0d836d","name":"","active":true,"console":"false","complete":"false","x":703.2165832519531,"y":486.4000244140625,"wires":[]},{"id":"b98b70c5.c74fd","type":"mqtt in","z":"15a592a.c0d836d","name":"","topic":"/EEButton11/Flow1/Count","qos":"2","broker":"e6d8a0f0.6f5878","x":298.3333435058594,"y":227.94998168945312,"wires":[["3c056a59.268d1e"]]},{"id":"3c056a59.268d1e","type":"mqtt out","z":"15a592a.c0d836d","name":"WaterUsedByIrrigationPointBehindLapa","topic":"/Water/Irrigation1/Volume","qos":"","retain":"","broker":"e6d8a0f0.6f5878","x":812.3333435058594,"y":227.18331909179688,"wires":[]},{"id":"63b3841.58302fc","type":"ui_switch","z":"74cedccf.2b6a6c","name":"Kaslig31","label":"Gangkas Lig","group":"4357843d.5f1d34","order":2,"width":"","height":"","passthru":false,"decouple":"true","topic":"/kaslig31/cmd","onvalue":"GPIO 12 1","onvalueType":"str","onicon":"","oncolor":"","offvalue":"GPIO 12 0","offvalueType":"str","officon":"","offcolor":"","x":537.8833312988281,"y":422.8833312988281,"wires":[["5a253ac5.bb0d4c","656b1c6a.dcfb0c"]]},{"id":"80d58518.22da3","type":"mqtt in","z":"74cedccf.2b6a6c","name":"ReadStateKaslig31","topic":"/kaslig31/cmd","qos":"2","broker":"e6d8a0f0.6f5878","x":285.8833312988281,"y":406.8833312988281,"wires":[["63b3841.58302fc"]]},{"id":"5a253ac5.bb0d4c","type":"mqtt out","z":"74cedccf.2b6a6c","name":"SaveStateGangkasLig","topic":"/kaslig31/cmd","qos":"0","retain":"true","broker":"e6d8a0f0.6f5878","x":1136.38330078125,"y":348.8833312988281,"wires":[]},{"id":"5c9b1e71.ba8d2","type":"mqtt in","z":"74cedccf.2b6a6c","name":"ReadStateKaslig31Switch","topic":"/kaslig31/Kasdeur31/Switch","qos":"2","broker":"e6d8a0f0.6f5878","x":307.8833312988281,"y":350.8833312988281,"wires":[["c21d2133.d525c8"]]},{"id":"656b1c6a.dcfb0c","type":"debug","z":"74cedccf.2b6a6c","name":"","active":false,"console":"false","complete":"false","x":1100.3333740234375,"y":412.8334045410156,"wires":[]},{"id":"c21d2133.d525c8","type":"function","z":"74cedccf.2b6a6c","name":"","func":"if (msg.payload=='1') \n{\n    msg.payload = \"GPIO 12 1\";\n    context.global.Kaslig31 = new Date();\n    msg2 = msg;\n}  \nif (msg.payload=='0') \n{\n    msg.payload = \"GPIO 12 0\";\n    context.global.Kaslig31 = 0;\n    msg2 = null;\n}\nreturn [msg,msg2];","outputs":"2","noerr":0,"x":543.3333129882812,"y":356.8000183105469,"wires":[["5a253ac5.bb0d4c","656b1c6a.dcfb0c"],["a9cb300d.3c00f","2322859e.0db152"]]},{"id":"a9cb300d.3c00f","type":"delay","z":"74cedccf.2b6a6c","name":"","pauseType":"delay","timeout":"60","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":716.3333740234375,"y":290.26666259765625,"wires":[["ffd35493.5e7e"]]},{"id":"ffd35493.5e7e","type":"function","z":"74cedccf.2b6a6c","name":"","func":"var now = new Date() + 2;\n\nif ((context.global.Kaslig31 + 60) < now)\n{\n    msg.payload = \"GPIO 12 0\";\n} else {\n    msg = null;      \n}\n\nreturn msg;","outputs":1,"noerr":0,"x":864.3333740234375,"y":289.8000183105469,"wires":[["5a253ac5.bb0d4c","4f7f9a73.2e2774"]]},{"id":"4f7f9a73.2e2774","type":"debug","z":"74cedccf.2b6a6c","name":"DELAY","active":false,"console":"false","complete":"payload","x":1066.3332824707031,"y":255.33334350585938,"wires":[]},{"id":"2322859e.0db152","type":"debug","z":"74cedccf.2b6a6c","name":"DELAY-ACTIVATED","active":false,"console":"false","complete":"payload","x":736.3333435058594,"y":250.33334350585938,"wires":[]},{"id":"fa5593a.ff31a7","type":"ui_switch","z":"74cedccf.2b6a6c","name":"kaslig32","label":"Gangkas Lig 32","group":"4357843d.5f1d34","order":1,"width":"","height":"","passthru":false,"decouple":"true","topic":"cmnd/kaslig32/power","onvalue":"ON","onvalueType":"str","onicon":"","oncolor":"","offvalue":"OFF","offvalueType":"str","officon":"","offcolor":"","x":447,"y":3408.1332397460938,"wires":[["469d788a.3bc0c8"]]},{"id":"fb48bf1e.ccb86","type":"mqtt in","z":"74cedccf.2b6a6c","name":"ReadStateKaslig32","topic":"stat/kaslig32/POWER","qos":"0","datatype":"auto","broker":"56fc61c8.bc429","x":150,"y":3407.1332397460938,"wires":[["fa5593a.ff31a7"]]},{"id":"469d788a.3bc0c8","type":"mqtt out","z":"74cedccf.2b6a6c","name":"SaveStateGangkasLig32","topic":"","qos":"0","retain":"false","broker":"56fc61c8.bc429","x":748.5,"y":3412.1332397460938,"wires":[]},{"id":"db6aee16.c74e48","type":"mqtt in","z":"74cedccf.2b6a6c","name":"ReadStateKaslig32Switch","topic":"stat/kaslig32/switchstate","qos":"2","datatype":"auto","broker":"56fc61c8.bc429","x":161,"y":3347.13330078125,"wires":[["52148da0.b1b7b4"]]},{"id":"3d0dc5fa.77e2ea","type":"mqtt in","z":"74cedccf.2b6a6c","name":"ReadStateKaslig32VoordeurKlokkieSwitch","topic":"/kaslig32/VoordeurKlokkie/Switch","qos":"2","broker":"e6d8a0f0.6f5878","x":285.8833312988281,"y":1145.63330078125,"wires":[["b45b046c.4924f8"]]},{"id":"ecf2a3fd.b11d08","type":"mqtt out","z":"74cedccf.2b6a6c","name":"VoordeurKlokkie","topic":"/in/VoordeurKlokkie","qos":"","retain":"","broker":"e6d8a0f0.6f5878","x":802.3333435058594,"y":1143.8000183105469,"wires":[]},{"id":"b45b046c.4924f8","type":"function","z":"74cedccf.2b6a6c","name":"","func":"if (msg.payload=='1') \n{\n    msg2 = msg;\n    msg2.payload = \"Iemand is by die voordeur\";\n}  \nif (msg.payload=='0') \n{\n    msg2 = null;\n}\nreturn [msg,msg2];","outputs":"2","noerr":0,"x":575.88330078125,"y":1148.63330078125,"wires":[["ecf2a3fd.b11d08"],["c277c4f7.81a3a8"]]},{"id":"c277c4f7.81a3a8","type":"e-mail","z":"74cedccf.2b6a6c","server":"smtp.gmail.com","port":"465","name":"orgjvr@gmail.com","dname":"VoorsdeurKlokkie","x":833.3333435058594,"y":1215.9833068847656,"wires":[]},{"id":"5744f630.5f784","type":"ui_switch","z":"74cedccf.2b6a6c","name":"SwembadPompSwitch1","label":"Swembad Pomp","group":"8214cb12.410308","order":1,"width":"","height":"","passthru":false,"decouple":"false","topic":"","onvalue":"1","onvalueType":"str","onicon":"","oncolor":"","offvalue":"0","offvalueType":"str","officon":"","offcolor":"","x":446.8833312988281,"y":1300.1332397460938,"wires":[["6523f5b5.e319fc"]]},{"id":"2be37d8e.549e42","type":"mqtt in","z":"74cedccf.2b6a6c","name":"SwembadPomp","topic":"/swembad/pump","qos":"2","broker":"e6d8a0f0.6f5878","x":174.88330078125,"y":1333.1332397460938,"wires":[["5744f630.5f784","2a831a9f.2149b6"]]},{"id":"de748cc7.df279","type":"mqtt out","z":"74cedccf.2b6a6c","name":"DoCmdSwembad","topic":"/swembad/cmd","qos":"0","retain":"false","broker":"e6d8a0f0.6f5878","x":842.38330078125,"y":1353.1332397460938,"wires":[]},{"id":"6523f5b5.e319fc","type":"mqtt out","z":"74cedccf.2b6a6c","name":"SaveStateSwembadPomp","topic":"/swembad/pump","qos":"0","retain":"true","broker":"e6d8a0f0.6f5878","x":866.88330078125,"y":1289.1332397460938,"wires":[]},{"id":"2763ed36.abeb52","type":"ui_switch","z":"74cedccf.2b6a6c","name":"SwembadLigSwitch","label":"Swembad Lig","group":"8214cb12.410308","order":4,"width":"","height":"","passthru":false,"decouple":"false","topic":"/swembad/light","onvalue":"1","onvalueType":"str","onicon":"","oncolor":"","offvalue":"0","offvalueType":"str","officon":"","offcolor":"","x":406.88336181640625,"y":1431.21630859375,"wires":[["6c924276.402c04"]]},{"id":"da21700b.65837","type":"mqtt in","z":"74cedccf.2b6a6c","name":"SwembadLig","topic":"/swembad/light","qos":"2","broker":"e6d8a0f0.6f5878","x":137.88333129882812,"y":1450.21630859375,"wires":[["2763ed36.abeb52","f91f71e1.24846"]]},{"id":"4fdac0d6.012d58","type":"mqtt out","z":"74cedccf.2b6a6c","name":"DoCmdSwembad","topic":"/swembad/cmd","qos":"0","retain":"false","broker":"e6d8a0f0.6f5878","x":936.38330078125,"y":1477.2164916992188,"wires":[]},{"id":"6c924276.402c04","type":"mqtt out","z":"74cedccf.2b6a6c","name":"SaveStateSwembadLig","topic":"/swembad/light","qos":"0","retain":"true","broker":"e6d8a0f0.6f5878","x":954.88330078125,"y":1425.2166748046875,"wires":[]},{"id":"f91f71e1.24846","type":"function","z":"74cedccf.2b6a6c","name":"","func":"if (msg.payload=='1') \n{\n    msg.payload = \"GPIO 12 0\";\n}  \nif (msg.payload=='0') \n{\n    msg.payload = \"GPIO 12 1\";\n}\nreturn msg;","outputs":"1","noerr":0,"x":365.88336181640625,"y":1478.2998046875,"wires":[["4fdac0d6.012d58"]]},{"id":"62fab60b.950cf","type":"ui_switch","z":"74cedccf.2b6a6c","name":"SwembadAddWaterSwitch","label":"Swembad Add Water","group":"8214cb12.410308","order":5,"width":"","height":"","passthru":false,"decouple":"false","topic":"","onvalue":"1","onvalueType":"str","onicon":"","oncolor":"","offvalue":"0","offvalueType":"str","officon":"","offcolor":"","x":484.8833312988281,"y":1567.2166137695312,"wires":[["5272f9f6.9fed4"]]},{"id":"78565935.836148","type":"mqtt in","z":"74cedccf.2b6a6c","name":"SwembadAddWater","topic":"/swembad/AddWater","qos":"2","broker":"e6d8a0f0.6f5878","x":159.88330078125,"y":1604.2166748046875,"wires":[["62fab60b.950cf","a39c2536.efaa98"]]},{"id":"22a93471.8abad4","type":"mqtt out","z":"74cedccf.2b6a6c","name":"DoCmdSwembad","topic":"/swembad/cmd","qos":"0","retain":"false","broker":"e6d8a0f0.6f5878","x":939.38330078125,"y":1616.2166748046875,"wires":[]},{"id":"5272f9f6.9fed4","type":"mqtt out","z":"74cedccf.2b6a6c","name":"SaveStateSwembadAddWater","topic":"/swembad/AddWater","qos":"0","retain":"true","broker":"e6d8a0f0.6f5878","x":980.88330078125,"y":1563.2166748046875,"wires":[]},{"id":"77c5f41e.39b524","type":"ui_switch","z":"74cedccf.2b6a6c","name":"SwembadTuinligteSwitch","label":"Swembad Tuin Ligte","group":"8214cb12.410308","order":6,"width":"","height":"","passthru":false,"decouple":"true","topic":"","onvalue":"1","onvalueType":"str","onicon":"","oncolor":"","offvalue":"0","offvalueType":"str","officon":"","offcolor":"","x":433.8833312988281,"y":1701.2166748046875,"wires":[["f9f8f509.5c1838"]]},{"id":"29c194f3.86028c","type":"mqtt in","z":"74cedccf.2b6a6c","name":"SwembadTuinLigte","topic":"/swembad/TuinLigte","qos":"2","broker":"e6d8a0f0.6f5878","x":161.88330078125,"y":1696.2166748046875,"wires":[["77c5f41e.39b524","47d2ec43.23371c"]]},{"id":"9f68785f.ca2298","type":"mqtt out","z":"74cedccf.2b6a6c","name":"DoCmdSwembad","topic":"/swembad/cmd","qos":"0","retain":"false","broker":"e6d8a0f0.6f5878","x":940.38330078125,"y":1749.2166748046875,"wires":[]},{"id":"f9f8f509.5c1838","type":"mqtt out","z":"74cedccf.2b6a6c","name":"SaveStateSwembadTuinLigte","topic":"/swembad/TuinLigte","qos":"0","retain":"true","broker":"e6d8a0f0.6f5878","x":980.88330078125,"y":1697.2166748046875,"wires":[]},{"id":"2a831a9f.2149b6","type":"function","z":"74cedccf.2b6a6c","name":"","func":"if (msg.payload=='1') \n{\n    msg.payload = \"GPIO 14 0\";\n}  \nif (msg.payload=='0') \n{\n    msg.payload = \"GPIO 14 1\";\n}\nreturn msg;","outputs":"1","noerr":0,"x":390.8833312988281,"y":1356.4667358398438,"wires":[["de748cc7.df279"]]},{"id":"a39c2536.efaa98","type":"function","z":"74cedccf.2b6a6c","name":"","func":"if (msg.payload=='1') \n{\n    msg.payload = \"GPIO 13 0\";\n}  \nif (msg.payload=='0') \n{\n    msg.payload = \"GPIO 13 1\";\n}\nreturn msg;","outputs":"1","noerr":0,"x":419.8833312988281,"y":1617.38330078125,"wires":[["22a93471.8abad4"]]},{"id":"47d2ec43.23371c","type":"function","z":"74cedccf.2b6a6c","name":"","func":"if (msg.payload=='1') \n{\n    msg.payload = \"GPIO 15 0\";\n}  \nif (msg.payload=='0') \n{\n    msg.payload = \"GPIO 15 1\";\n}\nreturn msg;","outputs":"1","noerr":0,"x":394.8833312988281,"y":1751.6500244140625,"wires":[["9f68785f.ca2298"]]},{"id":"761397c1.83d5b","type":"debug","z":"46e74d40.66d774","name":"","active":true,"console":"false","complete":"false","x":765.3333435058594,"y":686.7166442871094,"wires":[]},{"id":"e42a54a.cfcfb28","type":"comment","z":"46e74d40.66d774","name":"RS485 Devices","info":"RS485 Devices:\n\n\n- 09 - Spa/Blower\n- 0A - Spa/Pump\n- 0B - Spa/Light\n- 0C - GrasTussenLapaBedding\n- 0D - GrasSlaapkamers\n- 0E - BeddingsSwembad\n- 0F - Lapa/MisSproeers\n- 10 - GrasSwembad\n- 11 - \n- 12 - BadkamerKompos\n- 13 - GroenteBeddings\n- 14 - BoomhuisMiddelgras\n- 15 - Gekleurde Buite Ligte\n- 16 - \n- 17 - WeerskanteWasgoeddraad\n- 18 - LapaBeddings\n","x":152.33334350585938,"y":43.616668701171875,"wires":[]},{"id":"7830044e.2e8dcc","type":"comment","z":"74cedccf.2b6a6c","name":"ESP8266 Devices","info":"ESP8266 Devices:\n\n0 - Reserved for new devices\n1 - \n21 - \n31 - \n32 - \n\n","x":133.88333129882812,"y":54.883331298828125,"wires":[]},{"id":"c53b0ad5.318e5","type":"ui_switch","z":"74cedccf.2b6a6c","name":"PoolGardenLights","label":"Pool GardenLights","group":"9ace3d17.d3c63","order":1,"width":"","height":"","passthru":false,"decouple":"true","topic":"cmnd/PoolGardenLights/Power","onvalue":"1","onvalueType":"str","onicon":"","oncolor":"","offvalue":"0","offvalueType":"str","officon":"","offcolor":"","x":445.8833312988281,"y":1881.38330078125,"wires":[["633f9bce.18c784"]]},{"id":"af01d566.a00708","type":"mqtt in","z":"74cedccf.2b6a6c","name":"GetPoolGardenLights","topic":"cmnd/PoolGardenLights/Power","qos":"2","broker":"e6d8a0f0.6f5878","x":176.88333129882812,"y":1870.3832702636719,"wires":[["c53b0ad5.318e5","57d761a2.41445"]]},{"id":"633f9bce.18c784","type":"mqtt out","z":"74cedccf.2b6a6c","name":"SaveStatePoolGardenLights","topic":"cmnd/PoolGardenLights/Power","qos":"0","retain":"true","broker":"e6d8a0f0.6f5878","x":761.38330078125,"y":1880.38330078125,"wires":[]},{"id":"7818ab63.570b84","type":"bigtimer","z":"74cedccf.2b6a6c","outtopic":"cmnd/PoolGardenLights/Power","outpayload1":"1","outpayload2":"0","name":"Big Timer PoolGardenLights","lat":"-25.8619229","lon":"28.1774539","starttime":"5001","endtime":"1320","startoff":"0","endoff":0,"offs":0,"outtext1":"On","outtext2":"Off","timeout":1440,"sun":true,"mon":true,"tue":true,"wed":true,"thu":true,"fri":true,"sat":true,"jan":true,"feb":true,"mar":true,"apr":true,"may":true,"jun":true,"jul":true,"aug":true,"sep":true,"oct":true,"nov":true,"dec":true,"day1":0,"month1":0,"day2":0,"month2":0,"day3":0,"month3":0,"day4":0,"month4":0,"day5":0,"month5":0,"d1":0,"w1":0,"d2":0,"w2":0,"d3":0,"w3":0,"d4":0,"w4":0,"d5":0,"w5":0,"suspend":false,"random":false,"repeat":false,"atstart":true,"odd":false,"even":false,"x":440.8833312988281,"y":1970.3832702636719,"wires":[["633f9bce.18c784"],[],[]]},{"id":"3bfec2cf.00bfc6","type":"ui_switch","z":"74cedccf.2b6a6c","name":"Pool Pump","label":"Pool Pump","group":"9ace3d17.d3c63","order":2,"width":"","height":"","passthru":false,"decouple":"true","topic":"/LGC/Pool/Pump/state","onvalue":"1","onvalueType":"str","onicon":"","oncolor":"","offvalue":"0","offvalueType":"str","officon":"","offcolor":"","x":426.0000305175781,"y":2077.38330078125,"wires":[["c3ae4fab.1c4278"]]},{"id":"9648a3cd.468a8","type":"mqtt in","z":"74cedccf.2b6a6c","name":"GetPoolPump","topic":"/LGC/Pool/Pump/state","qos":"2","broker":"e6d8a0f0.6f5878","x":147.00003051757812,"y":2066.383270263672,"wires":[["3bfec2cf.00bfc6"]]},{"id":"c3ae4fab.1c4278","type":"mqtt out","z":"74cedccf.2b6a6c","name":"SaveStatePoolPump","topic":"/LGC/Pool/Pump/state","qos":"0","retain":"true","broker":"e6d8a0f0.6f5878","x":741.5,"y":2076.38330078125,"wires":[]},{"id":"473594a0.c235cc","type":"bigtimer","z":"74cedccf.2b6a6c","outtopic":"/LGC/Pool/Pump/state","outpayload1":"1","outpayload2":"0","name":"Big Timer PoolPump","lat":"-25.8619229","lon":"28.1774539","starttime":"570","endtime":"1020","startoff":"0","endoff":0,"offs":0,"outtext1":"On","outtext2":"Off","timeout":1440,"sun":true,"mon":true,"tue":true,"wed":true,"thu":true,"fri":true,"sat":true,"jan":true,"feb":true,"mar":true,"apr":true,"may":true,"jun":true,"jul":true,"aug":true,"sep":true,"oct":true,"nov":true,"dec":true,"day1":0,"month1":0,"day2":0,"month2":0,"day3":0,"month3":0,"day4":0,"month4":0,"day5":0,"month5":0,"d1":0,"w1":0,"d2":0,"w2":0,"d3":0,"w3":0,"d4":0,"w4":0,"d5":0,"w5":0,"suspend":false,"random":false,"repeat":false,"atstart":true,"odd":false,"even":false,"x":248.00003051757812,"y":2137.38330078125,"wires":[["c3ae4fab.1c4278"],[],[]]},{"id":"29841037.7549","type":"ui_gauge","z":"74cedccf.2b6a6c","name":"Poolpump Power","group":"8214cb12.410308","order":2,"width":"3","height":"3","gtype":"gage","title":"Poolpump Power","label":"","format":"{{value}} W","min":"0","max":"1500","x":1110,"y":2520,"wires":[]},{"id":"342ad861.d6c3c8","type":"mqtt in","z":"74cedccf.2b6a6c","name":"PoolPumpTELEMETRY","topic":"tele/PoolPump/SENSOR","qos":"0","datatype":"auto","broker":"e6d8a0f0.6f5878","x":172,"y":2511,"wires":[["66622477.ef16a4","645cc9a8.1f57c8"]]},{"id":"66622477.ef16a4","type":"debug","z":"74cedccf.2b6a6c","name":"original msg","active":false,"console":"false","complete":"payload","x":494.3333740234375,"y":2486.333251953125,"wires":[]},{"id":"645cc9a8.1f57c8","type":"function","z":"74cedccf.2b6a6c","name":"","func":"var msg2 = null;\n\nif (msg.payload.indexOf('ENERGY')>0) {\n    var power = msg.payload.split('\"Power\":')[1].split(\",\")[0];\n    \n    msg2 = { payload: power};\n\n    //msg.payload = msg.payload.Time;\n    return msg2;\n} else {\n    return null;\n}","outputs":1,"noerr":0,"x":549.3334350585938,"y":2531.0498046875,"wires":[["29841037.7549","3891337e.7edf0c"]]},{"id":"3891337e.7edf0c","type":"debug","z":"74cedccf.2b6a6c","name":"msg2","active":false,"console":"false","complete":"payload","x":1072.333251953125,"y":2583.833251953125,"wires":[]},{"id":"edec58f5.d77288","type":"ui_gauge","z":"74cedccf.2b6a6c","name":"Pool Garden Lights Power","group":"8214cb12.410308","order":3,"width":"3","height":"3","gtype":"gage","title":"Garden Lights Power","label":"","format":"{{value}} W","min":"0","max":"120","x":1128,"y":2766.933349609375,"wires":[]},{"id":"f8ef58c9.ea2028","type":"mqtt in","z":"74cedccf.2b6a6c","name":"PoolGardenLightsTELEMETRY","topic":"tele/PoolGardenLights/SENSOR","qos":"0","datatype":"auto","broker":"e6d8a0f0.6f5878","x":165,"y":2722.933349609375,"wires":[["9e65dbc2.0e1de8","97b2159.12a90e8"]]},{"id":"9e65dbc2.0e1de8","type":"debug","z":"74cedccf.2b6a6c","name":"original msg","active":false,"console":"false","complete":"payload","x":451.3333435058594,"y":2828.2666015625,"wires":[]},{"id":"97b2159.12a90e8","type":"function","z":"74cedccf.2b6a6c","name":"","func":"var msg2 = null;\n\nif (msg.payload.indexOf('ENERGY')>0) {\n    var power = msg.payload.split('\"Power\":')[1].split(\",\")[0];\n    \n    msg2 = { payload: power};\n\n    //msg.payload = msg.payload.Time;\n    return msg2;\n} else {\n    return null;\n}","outputs":1,"noerr":0,"x":700.3334350585938,"y":2768.983154296875,"wires":[["edec58f5.d77288","8c8e1cae.ef97d"]]},{"id":"8c8e1cae.ef97d","type":"debug","z":"74cedccf.2b6a6c","name":"msg2","active":false,"console":"false","complete":"payload","x":1060.333251953125,"y":2830.7666015625,"wires":[]},{"id":"cf2b3ed2.f6ddf","type":"comment","z":"74cedccf.2b6a6c","name":"Send whatever was received on the/in/SonoffPows/# MQTT topic to EmonCMS","info":"","x":340,"y":3160,"wires":[]},{"id":"2b56fe4a.fd48ca","type":"json","z":"74cedccf.2b6a6c","name":"","x":701.5000305175781,"y":3041.750030517578,"wires":[["d372b69f.a0f158"]]},{"id":"d793690c.8de87","type":"debug","z":"74cedccf.2b6a6c","name":"Debu00000000000","active":false,"console":"false","complete":"payload","x":1096.0000305175781,"y":3077.000030517578,"wires":[]},{"id":"d372b69f.a0f158","type":"function","z":"74cedccf.2b6a6c","name":"SplitValues2","func":"if (msg.payload.Energy !== null) {\n    var tokens = msg.topic.split(\"/\");\n    var UnitID = tokens[1];    \n    //var UnitID = \"PoolPump\";\n    var topic = '/in/SonoffPows/'+UnitID+'/';\n    var msg_voltage = { topic:topic+'voltage' , payload:msg.payload.Energy.Voltage};\n    var msg_amps = { topic:topic+'amps' , payload:msg.payload.Energy.Current};\n    var msg_power = { topic:topic+'power' , payload:msg.payload.Energy.Power};\n    var msg_powerFactor = { topic:topic+'powerFactor' , payload:msg.payload.Energy.Factor};\n    var msg_today = { topic:topic+'energyToday' , payload:msg.payload.Energy.Today};\n    var msg_yesterday = { topic:topic+'energyYesterday' , payload:msg.payload.Energy.Yesterday};\n    \n    node.send(msg_voltage);\n    node.send(msg_amps);\n    node.send(msg_power);\n    node.send(msg_powerFactor);\n    node.send(msg_today);\n    node.send(msg_yesterday);\n    \n    \n    //var msg2 = { topic:topic+'all' , payload:\"\"};\n    //msg2.payload+='{\"voltage\":'+Math.round(msg.payload.Voltage)+'}';\n    \n    //var msg3 = { topic:\"emon/\"+UnitID+\"/voltage\" , payload:Math.round(msg.payload.Voltage)};\n//    var msg3 = { topic:msg.topic , payload:\"\"};\n//    msg3.payload = msg.payload.Energy;\n    \n    //var msg3 = { topic:\"emon/\"+UnitID+\"/voltage\" , payload:\"emon/\"+UnitID+\"/voltage\"};\n//    return msg3;\n    //return [null, msg2, msg3];\n} else {\n    return null;\n}    ","outputs":"1","noerr":0,"x":888.5000305175781,"y":3068.250030517578,"wires":[["d793690c.8de87","89055524.0397d"]]},{"id":"94695916.50801","type":"switch","z":"74cedccf.2b6a6c","name":"","property":"payload","propertyType":"msg","rules":[{"t":"cont","v":"Energy","vt":"str"}],"checkall":"true","outputs":1,"x":480.5000305175781,"y":3018.750030517578,"wires":[["2b56fe4a.fd48ca"]]},{"id":"8ef33255.8ebdc","type":"mqtt in","z":"74cedccf.2b6a6c","name":"ELECTRICITY IN","topic":"/in/SonoffPows/#","qos":"2","broker":"e6d8a0f0.6f5878","x":160.00003051757812,"y":3232.0000610351562,"wires":[["b1967b92.b3464"]]},{"id":"8da1513d.57cb58","type":"mqtt out","z":"74cedccf.2b6a6c","name":"Send to Emoncms","topic":"","qos":"","retain":"","broker":"e6d8a0f0.6f5878","x":709.0000305175781,"y":3265.000030517578,"wires":[]},{"id":"b1967b92.b3464","type":"function","z":"74cedccf.2b6a6c","name":"Prepare for EmonCMS","func":"// The received message is stored in 'msg'\n// It will have at least a 'payload' property:\n//   console.log(msg.payload);\n// The 'context' object is available to store state\n// between invocations of the function\n//   context = {};\n\n//destination will be last part node of topic\nvar tokens = msg.topic.split(\"/\");\nvar sensor = tokens[tokens.length-1];\nvar device = tokens[tokens.length-2];\n\nmsg.topic = \"home/emoncms/out/\";\nmsg.topic += device;\nmsg.topic += \"/\";\nmsg.topic += sensor;\nif (sensor==\"powerFactor\") {\n  msg.payload = Math.round(msg.payload*100);\n} else {\n    if (sensor==\"amps\" || sensor==\"energyToday\" || sensor==\"energyYesterday\") {\n        msg.payload = Math.round(msg.payload*1000);\n    } else {\n        msg.payload = Math.round(msg.payload);\n    }\n}  \nreturn msg;\n","outputs":1,"noerr":0,"x":415.0000305175781,"y":3232.000030517578,"wires":[["8da1513d.57cb58","a25e10.09c309f"]]},{"id":"a25e10.09c309f","type":"debug","z":"74cedccf.2b6a6c","name":"","active":false,"console":"false","complete":"false","x":745.3332824707031,"y":3197.516632080078,"wires":[]},{"id":"89055524.0397d","type":"mqtt out","z":"74cedccf.2b6a6c","name":"SaveState","topic":"","qos":"2","retain":"","broker":"e6d8a0f0.6f5878","x":1077.0000305175781,"y":3028.000030517578,"wires":[]},{"id":"70a6b829.84f258","type":"mqtt in","z":"74cedccf.2b6a6c","name":"AllSonoffPowTELEMETRY","topic":"tele/+/TELEMETRY","qos":"0","broker":"e6d8a0f0.6f5878","x":181.00003051757812,"y":3024.000030517578,"wires":[["94695916.50801"]]},{"id":"7566e07f.39a4e8","type":"comment","z":"74cedccf.2b6a6c","name":"Listen to all Sonoff POWs for TELEMETRY data ","info":"","x":244.00003051757812,"y":2971.000030517578,"wires":[]},{"id":"f8e06f8e.3c195","type":"mqtt in","z":"dd08fb92.1a5348","name":"PoolPumpEnergyToday","topic":"/in/SonoffPows/PoolPump/energyToday","qos":"0","broker":"e6d8a0f0.6f5878","x":151.99996948242188,"y":1025,"wires":[["459a7aef.0ca944"]]},{"id":"459a7aef.0ca944","type":"ui_text","z":"dd08fb92.1a5348","group":"8b2d0a3a.81cc58","order":14,"width":0,"height":0,"name":"PoolPumpEnergyToday","label":"PoolPump Energy Today","format":"{{msg.payload | number:2}}","layout":"row-spread","x":481.333251953125,"y":1016.9166870117188,"wires":[]},{"id":"4982c35.3c8853c","type":"mqtt in","z":"dd08fb92.1a5348","name":"PoolPumpEnergyYesterday","topic":"/in/SonoffPows/PoolPump/energyYesterday","qos":"0","broker":"e6d8a0f0.6f5878","x":175.99996948242188,"y":1087,"wires":[["49a13c27.5d710c"]]},{"id":"49a13c27.5d710c","type":"ui_text","z":"dd08fb92.1a5348","group":"8b2d0a3a.81cc58","order":15,"width":0,"height":0,"name":"PoolPumpEnergyYesterday","label":"PoolPump Energy Yesterday","format":"{{msg.payload | number:2}}","layout":"row-spread","x":495.333251953125,"y":1078.9166870117188,"wires":[]},{"id":"67b96895.0a2bc","type":"mqtt in","z":"dd08fb92.1a5348","name":"GarageFreezersEnergyToday","topic":"/in/SonoffPows/GarageFreezers/energyToday","qos":"0","broker":"e6d8a0f0.6f5878","x":160.99996948242188,"y":1234.0000610351562,"wires":[["facd1bb6.bdbf4"]]},{"id":"facd1bb6.bdbf4","type":"ui_text","z":"dd08fb92.1a5348","group":"8b2d0a3a.81cc58","order":20,"width":0,"height":0,"name":"GarageFreezersEnergyToday","label":"GarageFreezers Energy Today","format":"{{msg.payload | number:2}}","layout":"row-spread","x":490.333251953125,"y":1225.916748046875,"wires":[]},{"id":"3c0236e2.9a5132","type":"mqtt in","z":"dd08fb92.1a5348","name":"GarageFreezersEnergyYesterday","topic":"/in/SonoffPows/GarageFreezers/energyYesterday","qos":"0","broker":"e6d8a0f0.6f5878","x":184.99996948242188,"y":1296.0000610351562,"wires":[["dbc04d8c.ae1d5"]]},{"id":"dbc04d8c.ae1d5","type":"ui_text","z":"dd08fb92.1a5348","group":"8b2d0a3a.81cc58","order":21,"width":0,"height":0,"name":"GarageFreezersEnergyYesterday","label":"GarageFreezers Energy Yesterday","format":"{{msg.payload | number:2}}","layout":"row-spread","x":504.333251953125,"y":1287.916748046875,"wires":[]},{"id":"334c6cc8.08e764","type":"mqtt in","z":"dd08fb92.1a5348","name":"OumaFreezerEnergyToday","topic":"/in/SonoffPows/sonofftest/energyToday","qos":"0","broker":"e6d8a0f0.6f5878","x":167.99996948242188,"y":1424,"wires":[["f5031f3.184926"]]},{"id":"f5031f3.184926","type":"ui_text","z":"dd08fb92.1a5348","group":"8b2d0a3a.81cc58","order":23,"width":0,"height":0,"name":"OumaFreezerEnergyToday","label":"OumaFreezer Energy Today","format":"{{msg.payload | number:2}}","layout":"row-spread","x":487.333251953125,"y":1415.9166870117188,"wires":[]},{"id":"77d71440.c2c5bc","type":"mqtt in","z":"dd08fb92.1a5348","name":"OumaFreezerEnergyYesterday","topic":"/in/SonoffPows/sonofftest/energyYesterday","qos":"0","broker":"e6d8a0f0.6f5878","x":181.99996948242188,"y":1486,"wires":[["803536ba.99057"]]},{"id":"803536ba.99057","type":"ui_text","z":"dd08fb92.1a5348","group":"8b2d0a3a.81cc58","order":24,"width":0,"height":0,"name":"OumaFreezerEnergyYesterday","label":"OumaFreezer Energy Yesterday","format":"{{msg.payload | number:2}}","layout":"row-spread","x":501.333251953125,"y":1477.9166870117188,"wires":[]},{"id":"e6a67f80.b32ed","type":"mqtt in","z":"dd08fb92.1a5348","name":"PoolGardenLightsEnergyToday","topic":"/in/SonoffPows/PoolGardenLights/energyToday","qos":"0","broker":"e6d8a0f0.6f5878","x":180.99996948242188,"y":852,"wires":[["c8fee194.0d43"]]},{"id":"c8fee194.0d43","type":"ui_text","z":"dd08fb92.1a5348","group":"8b2d0a3a.81cc58","order":17,"width":0,"height":0,"name":"PoolGardenLightsEnergyToday","label":"PoolGardenLights Energy Today","format":"{{msg.payload | number:2}}","layout":"row-spread","x":500.333251953125,"y":843.9166870117188,"wires":[]},{"id":"a406f406.8aca98","type":"mqtt in","z":"dd08fb92.1a5348","name":"PoolGardenLightsEnergyYesterday","topic":"/in/SonoffPows/PoolGardenLights/energyYesterday","qos":"0","broker":"e6d8a0f0.6f5878","x":194.99996948242188,"y":914,"wires":[["9707a2d3.bf2008"]]},{"id":"9707a2d3.bf2008","type":"ui_text","z":"dd08fb92.1a5348","group":"8b2d0a3a.81cc58","order":18,"width":0,"height":0,"name":"PoolGardenLightsEnergyYesterday","label":"PoolGardenLights Energy Yesterday","format":"{{msg.payload | number:2}}","layout":"row-spread","x":514.333251953125,"y":905.9166870117188,"wires":[]},{"id":"f5d84b30.cdbea8","type":"http request","z":"3b15046f.07e474","name":"UpdateZoneedit","method":"POST","ret":"txt","paytoqs":false,"url":"http://dynamic.zoneedit.com/dyn/jsclient.php?rsp_ident=zoneedit&hostname=picolli.com&wildcard=YES","tls":"","proxy":"","authType":"basic","x":995.5,"y":543,"wires":[["fc555b54.23d5c8","836d46d3.422a"]]},{"id":"fc555b54.23d5c8","type":"debug","z":"3b15046f.07e474","name":"ZoneEditResponse","active":true,"console":"false","complete":"payload","x":1222.5,"y":540,"wires":[]},{"id":"836d46d3.422a","type":"e-mail","z":"3b15046f.07e474","server":"smtp.gmail.com","port":"465","secure":true,"name":"org@picolli.com","dname":"SendToOrg","x":1185,"y":623,"wires":[]},{"id":"e1eaa088.59aca8","type":"mqtt in","z":"dd08fb92.1a5348","name":"ServerRoomEnergyToday","topic":"/in/SonoffPows/ServerRoom/energyToday","qos":"0","broker":"e6d8a0f0.6f5878","x":162.99996948242188,"y":1596.0000610351562,"wires":[["b88af302.4ef13"]]},{"id":"b88af302.4ef13","type":"ui_text","z":"dd08fb92.1a5348","group":"8b2d0a3a.81cc58","order":2,"width":0,"height":0,"name":"ServerRoomEnergyToday","label":"ServerRoom Energy Today","format":"{{msg.payload | number:2}}","layout":"row-spread","x":482.333251953125,"y":1587.916748046875,"wires":[]},{"id":"21a5b024.75ebb8","type":"mqtt in","z":"dd08fb92.1a5348","name":"ServerRoomEnergyYesterday","topic":"/in/SonoffPows/ServerRoom/energyYesterday","qos":"0","broker":"e6d8a0f0.6f5878","x":176.99996948242188,"y":1658.0000610351562,"wires":[["e278a7d7.91a87"]]},{"id":"e278a7d7.91a87","type":"ui_text","z":"dd08fb92.1a5348","group":"8b2d0a3a.81cc58","order":3,"width":0,"height":0,"name":"ServerRoomEnergyYesterday","label":"ServerRoom Energy Yesterday","format":"{{msg.payload | number:2}}","layout":"row-spread","x":506.333251953125,"y":1649.916748046875,"wires":[]},{"id":"a52dca6d.1579b","type":"mqtt in","z":"dd08fb92.1a5348","name":"PoolGardenLightsPower","topic":"/in/SonoffPows/PoolGardenLights/power","qos":"0","broker":"e6d8a0f0.6f5878","x":161,"y":811,"wires":[["75f08fda.1132e"]]},{"id":"75f08fda.1132e","type":"ui_text","z":"dd08fb92.1a5348","group":"8b2d0a3a.81cc58","order":16,"width":0,"height":0,"name":"PoolGardenLightsPower","label":"PoolGardenLights Power","format":"{{msg.payload | number:2}}","layout":"row-spread","x":480.3332824707031,"y":802.9166870117188,"wires":[]},{"id":"8ad5b77c.7ea768","type":"mqtt in","z":"dd08fb92.1a5348","name":"PoolPumpPower","topic":"/in/SonoffPows/PoolPump/power","qos":"0","broker":"e6d8a0f0.6f5878","x":151,"y":974,"wires":[["16411b0.5d7eae5"]]},{"id":"16411b0.5d7eae5","type":"ui_text","z":"dd08fb92.1a5348","group":"8b2d0a3a.81cc58","order":13,"width":0,"height":0,"name":"PoolPumpPower","label":"PoolPump Power","format":"{{msg.payload | number:2}}","layout":"row-spread","x":480.3332824707031,"y":965.9166870117188,"wires":[]},{"id":"b66a608e.59866","type":"mqtt in","z":"dd08fb92.1a5348","name":"GarageFreezersPower","topic":"/in/SonoffPows/GarageFreezers/power","qos":"0","broker":"e6d8a0f0.6f5878","x":141,"y":1179,"wires":[["cdafd4f9.443fd"]]},{"id":"cdafd4f9.443fd","type":"ui_text","z":"dd08fb92.1a5348","group":"8b2d0a3a.81cc58","order":19,"width":0,"height":0,"name":"GarageFreezersPower","label":"GarageFreezers Power","format":"{{msg.payload | number:2}}","layout":"row-spread","x":470.3332824707031,"y":1170.9166870117188,"wires":[]},{"id":"706d334e.e9214c","type":"mqtt in","z":"dd08fb92.1a5348","name":"OumaFreezerPower","topic":"/in/SonoffPows/sonofftest/power","qos":"0","broker":"e6d8a0f0.6f5878","x":141,"y":1377,"wires":[["231db7c1.d23f68"]]},{"id":"231db7c1.d23f68","type":"ui_text","z":"dd08fb92.1a5348","group":"8b2d0a3a.81cc58","order":22,"width":0,"height":0,"name":"OumaFreezerPower","label":"OumaFreezer Power","format":"{{msg.payload | number:2}}","layout":"row-spread","x":470.3332824707031,"y":1368.9166870117188,"wires":[]},{"id":"4dd40b08.418594","type":"mqtt in","z":"dd08fb92.1a5348","name":"ServerRoomPower","topic":"/in/SonoffPows/ServerRoom/power","qos":"0","broker":"e6d8a0f0.6f5878","x":153,"y":1548,"wires":[["cbec4c1a.262138"]]},{"id":"cbec4c1a.262138","type":"ui_text","z":"dd08fb92.1a5348","group":"8b2d0a3a.81cc58","order":1,"width":0,"height":0,"name":"ServerRoomPower","label":"ServerRoom Power","format":"{{msg.payload | number:2}}","layout":"row-spread","x":472.3332824707031,"y":1539.9166870117188,"wires":[]},{"id":"8483d44.125f9a8","type":"mqtt in","z":"dd08fb92.1a5348","name":"TVEntertainmentEnergyToday","topic":"/in/SonoffPows/TVEntertainment/energyToday","qos":"0","broker":"e6d8a0f0.6f5878","x":176,"y":1776,"wires":[["53a8e552.308804"]]},{"id":"53a8e552.308804","type":"ui_text","z":"dd08fb92.1a5348","group":"8b2d0a3a.81cc58","order":5,"width":0,"height":0,"name":"TVEntertainmentEnergyToday","label":"TVEntertainment Energy Today","format":"{{msg.payload | number:2}}","layout":"row-spread","x":505.3332824707031,"y":1767.9166870117188,"wires":[]},{"id":"ab9bb0f9.603c58","type":"mqtt in","z":"dd08fb92.1a5348","name":"TVEntertainmentEnergyYesterday","topic":"/in/SonoffPows/TVEntertainment/energyYesterday","qos":"0","broker":"e6d8a0f0.6f5878","x":200,"y":1838,"wires":[["1c7e1d88.180062"]]},{"id":"1c7e1d88.180062","type":"ui_text","z":"dd08fb92.1a5348","group":"8b2d0a3a.81cc58","order":6,"width":0,"height":0,"name":"TVEntertainmentEnergyYesterday","label":"TVEntertainment Energy Yesterday","format":"{{msg.payload | number:2}}","layout":"row-spread","x":519.3332824707031,"y":1829.9166870117188,"wires":[]},{"id":"f5af5eb7.513ee8","type":"mqtt in","z":"dd08fb92.1a5348","name":"TVEntertainmentPower","topic":"/in/SonoffPows/TVEntertainment/power","qos":"0","broker":"e6d8a0f0.6f5878","x":166.00003051757812,"y":1727.9999389648438,"wires":[["2540b4db.2becfc"]]},{"id":"2540b4db.2becfc","type":"ui_text","z":"dd08fb92.1a5348","group":"8b2d0a3a.81cc58","order":4,"width":0,"height":0,"name":"TVEntertainmentPower","label":"TVEntertainment Power","format":"{{msg.payload | number:2}}","layout":"row-spread","x":495.33331298828125,"y":1719.9166259765625,"wires":[]},{"id":"8a126492.c36bb","type":"mqtt in","z":"dd08fb92.1a5348","name":"KombuisYskasEspressoEnergyToday","topic":"/in/SonoffPows/KombuisYskasEspresso/energyToday","qos":"0","broker":"e6d8a0f0.6f5878","x":198.99996948242188,"y":1944.0000610351562,"wires":[["f6fb598a.d7a738"]]},{"id":"f6fb598a.d7a738","type":"ui_text","z":"dd08fb92.1a5348","group":"8b2d0a3a.81cc58","order":8,"width":0,"height":0,"name":"KombuisYskasEspressoEnergyToday","label":"KombuisYskasEspresso Energy Today","format":"{{msg.payload | number:2}}","layout":"row-spread","x":565.333251953125,"y":1951.916748046875,"wires":[]},{"id":"36a99efa.7691ca","type":"mqtt in","z":"dd08fb92.1a5348","name":"KombuisYskasEspressoEnergyYesterday","topic":"/in/SonoffPows/KombuisYskasEspresso/energyYesterday","qos":"0","broker":"e6d8a0f0.6f5878","x":212.99996948242188,"y":2006.0000610351562,"wires":[["fd8b387f.56c9f8"]]},{"id":"fd8b387f.56c9f8","type":"ui_text","z":"dd08fb92.1a5348","group":"8b2d0a3a.81cc58","order":9,"width":0,"height":0,"name":"KombuisYskasEspressoEnergyYesterday","label":"KombuisYskasEspresso Energy Yesterday","format":"{{msg.payload | number:2}}","layout":"row-spread","x":586.333251953125,"y":2010.916748046875,"wires":[]},{"id":"503d4912.0f88e8","type":"mqtt in","z":"dd08fb92.1a5348","name":"KombuisYskasEspressoPower","topic":"/in/SonoffPows/KombuisYskasEspresso/power","qos":"0","broker":"e6d8a0f0.6f5878","x":189,"y":1896,"wires":[["93138fb3.0580e8"]]},{"id":"93138fb3.0580e8","type":"ui_text","z":"dd08fb92.1a5348","group":"8b2d0a3a.81cc58","order":7,"width":0,"height":0,"name":"KombuisYskasEspressoPower","label":"KombuisYskasEspresso Power","format":"{{msg.payload | number:2}}","layout":"row-spread","x":568.333251953125,"y":1893.916748046875,"wires":[]},{"id":"bc753e26.454ab","type":"mqtt in","z":"dd08fb92.1a5348","name":"LapaYskasteEnergyToday","topic":"/in/SonoffPows/LapaYskaste/energyToday","qos":"0","broker":"e6d8a0f0.6f5878","x":199,"y":2123,"wires":[["df84efab.d111f"]]},{"id":"df84efab.d111f","type":"ui_text","z":"dd08fb92.1a5348","group":"8b2d0a3a.81cc58","order":11,"width":0,"height":0,"name":"LapaYskasteEnergyToday","label":"LapaYskaste Energy Today","format":"{{msg.payload | number:2}}","layout":"row-spread","x":528.3332824707031,"y":2114.9166870117188,"wires":[]},{"id":"50abbd75.abe194","type":"mqtt in","z":"dd08fb92.1a5348","name":"LapaYskasteEnergyYesterday","topic":"/in/SonoffPows/LapaYskaste/energyYesterday","qos":"0","broker":"e6d8a0f0.6f5878","x":213,"y":2185,"wires":[["f85cefa4.cbdfa"]]},{"id":"f85cefa4.cbdfa","type":"ui_text","z":"dd08fb92.1a5348","group":"8b2d0a3a.81cc58","order":12,"width":0,"height":0,"name":"LapaYskasteEnergyYesterday","label":"LapaYskaste Energy Yesterday","format":"{{msg.payload | number:2}}","layout":"row-spread","x":542.3332824707031,"y":2176.9166870117188,"wires":[]},{"id":"fb6231db.68262","type":"mqtt in","z":"dd08fb92.1a5348","name":"LapaYskastePower","topic":"/in/SonoffPows/LapaYskaste/power","qos":"0","broker":"e6d8a0f0.6f5878","x":189.00003051757812,"y":2074.9999389648438,"wires":[["39156fa0.004478"]]},{"id":"39156fa0.004478","type":"ui_text","z":"dd08fb92.1a5348","group":"8b2d0a3a.81cc58","order":10,"width":0,"height":0,"name":"LapaYskastePower","label":"LapaYskaste Power","format":"{{msg.payload | number:2}}","layout":"row-spread","x":508.33331298828125,"y":2066.9166259765625,"wires":[]},{"id":"2d1c0519.71895a","type":"ui_switch","z":"74cedccf.2b6a6c","name":"Kaslig33","label":"HS Kas1 Lig","group":"4357843d.5f1d34","order":3,"width":"","height":"","passthru":false,"decouple":"true","topic":"cmnd/kaslig33/power","onvalue":"ON","onvalueType":"str","onicon":"","oncolor":"","offvalue":"OFF","offvalueType":"str","officon":"","offcolor":"","x":437,"y":3525,"wires":[["f678f272.deb05"]]},{"id":"65781659.219fd","type":"mqtt in","z":"74cedccf.2b6a6c","name":"ReadStateKaslig33","topic":"stat/kaslig33/POWER","qos":"2","datatype":"auto","broker":"56fc61c8.bc429","x":164,"y":3522,"wires":[["2d1c0519.71895a"]]},{"id":"cccd941d.99c588","type":"mqtt in","z":"74cedccf.2b6a6c","name":"ReadStateKaslig33Switch","topic":"stat/kaslig33/switchstate","qos":"2","datatype":"auto","broker":"56fc61c8.bc429","x":148,"y":3476,"wires":[["11ab9ff6.0232e8"]]},{"id":"2c5f7985.fece46","type":"ui_switch","z":"74cedccf.2b6a6c","name":"Kaslig34","label":"HS Kas2 Lig","group":"4357843d.5f1d34","order":4,"width":"","height":"","passthru":false,"decouple":"true","topic":"cmnd/kaslig34/power","onvalue":"ON","onvalueType":"str","onicon":"","oncolor":"","offvalue":"OFF","offvalueType":"str","officon":"","offcolor":"","x":450.9999694824219,"y":3674,"wires":[["656aa155.71c6e"]]},{"id":"cb76543b.2500d8","type":"mqtt in","z":"74cedccf.2b6a6c","name":"ReadStateKaslig34","topic":"stat/kaslig34/POWER","qos":"2","datatype":"auto","broker":"56fc61c8.bc429","x":156,"y":3669,"wires":[["2c5f7985.fece46"]]},{"id":"656aa155.71c6e","type":"mqtt out","z":"74cedccf.2b6a6c","name":"SaveStateKasLig34","topic":"","qos":"0","retain":"true","broker":"56fc61c8.bc429","x":906.5,"y":3665,"wires":[]},{"id":"c5e7d494.02da","type":"mqtt in","z":"74cedccf.2b6a6c","name":"ReadStateKaslig34Switch","topic":"stat/kaslig34/switchstate","qos":"2","datatype":"auto","broker":"56fc61c8.bc429","x":134,"y":3622,"wires":[["3adb1d8f.cb8ca2"]]},{"id":"798f180e.2b09a","type":"ui_switch","z":"74cedccf.2b6a6c","name":"Kaslig35","label":"HS Kas3 Lig","group":"4357843d.5f1d34","order":5,"width":"","height":"","passthru":false,"decouple":"true","topic":"cmnd/kaslig35/power","onvalue":"ON","onvalueType":"str","onicon":"","oncolor":"","offvalue":"OFF","offvalueType":"str","officon":"","offcolor":"","x":458,"y":3811,"wires":[["967871b9.87216"]]},{"id":"46185dcf.c80b94","type":"mqtt in","z":"74cedccf.2b6a6c","name":"ReadStateKaslig35","topic":"stat/kaslig35/POWER","qos":"2","datatype":"auto","broker":"56fc61c8.bc429","x":169,"y":3815,"wires":[["798f180e.2b09a"]]},{"id":"967871b9.87216","type":"mqtt out","z":"74cedccf.2b6a6c","name":"SaveStateKasLig35","topic":"","qos":"0","retain":"true","broker":"56fc61c8.bc429","x":914.5,"y":3815,"wires":[]},{"id":"5af6eacb.d6840c","type":"mqtt in","z":"74cedccf.2b6a6c","name":"ReadStateKaslig35Switch","topic":"stat/kaslig35/switchstate","qos":"2","datatype":"auto","broker":"56fc61c8.bc429","x":149,"y":3767,"wires":[["124ec91f.75ff57"]]},{"id":"be9dfabd.3d05f","type":"ui_switch","z":"74cedccf.2b6a6c","name":"Kaslig36","label":"HS Kas4 Lig","group":"4357843d.5f1d34","order":6,"width":"","height":"","passthru":false,"decouple":"true","topic":"cmnd/kaslig36/power","onvalue":"ON","onvalueType":"str","onicon":"","oncolor":"","offvalue":"OFF","offvalueType":"str","officon":"","offcolor":"","x":432,"y":4057,"wires":[["815895fe.e94098"]]},{"id":"5e734490.aeb4ec","type":"mqtt in","z":"74cedccf.2b6a6c","name":"ReadStateKaslig36","topic":"stat/kaslig36/POWER","qos":"2","datatype":"auto","broker":"56fc61c8.bc429","x":192,"y":4058,"wires":[["be9dfabd.3d05f"]]},{"id":"815895fe.e94098","type":"mqtt out","z":"74cedccf.2b6a6c","name":"SaveStateKasLig36","topic":"","qos":"0","retain":"true","broker":"56fc61c8.bc429","x":742.5,"y":4057,"wires":[]},{"id":"cb877792.ef7a5","type":"mqtt in","z":"74cedccf.2b6a6c","name":"ReadStateKaslig36Switch","topic":"stat/kaslig36/switchstate","qos":"2","datatype":"auto","broker":"56fc61c8.bc429","x":164,"y":4002,"wires":[["2675d0a1.38d008"]]},{"id":"fb7c5b3f.650f68","type":"ui_switch","z":"74cedccf.2b6a6c","name":"Kaslig37","label":"HS Kas5 Lig","group":"4357843d.5f1d34","order":7,"width":"","height":"","passthru":false,"decouple":"true","topic":"cmnd/kaslig37/power","onvalue":"ON","onvalueType":"str","onicon":"","oncolor":"","offvalue":"OFF","offvalueType":"str","officon":"","offcolor":"","x":447,"y":4215,"wires":[["e297d3e2.ab06b8"]]},{"id":"7c34b14f.6b147","type":"mqtt in","z":"74cedccf.2b6a6c","name":"ReadStateKaslig37","topic":"stat/kaslig37/POWER","qos":"2","datatype":"auto","broker":"56fc61c8.bc429","x":183,"y":4198,"wires":[["fb7c5b3f.650f68"]]},{"id":"e297d3e2.ab06b8","type":"mqtt out","z":"74cedccf.2b6a6c","name":"SaveStateKasLig37","topic":"","qos":"0","retain":"true","broker":"56fc61c8.bc429","x":747.5,"y":4213,"wires":[]},{"id":"60d00c.4141c7f4","type":"mqtt in","z":"74cedccf.2b6a6c","name":"ReadStateKaslig37Switch","topic":"stat/kaslig37/switchstate","qos":"2","datatype":"auto","broker":"56fc61c8.bc429","x":163,"y":4148,"wires":[["30ed9f9d.3e8c"]]},{"id":"7b89d53c.76e19c","type":"ui_switch","z":"74cedccf.2b6a6c","name":"TV Entertainment","label":"TVEntertainment","group":"8b2d0a3a.81cc58","order":4,"width":"","height":"","passthru":false,"decouple":"true","topic":"cmnd/TVEntertainment/Power","onvalue":"1","onvalueType":"str","onicon":"","oncolor":"","offvalue":"0","offvalueType":"str","officon":"","offcolor":"","x":444.0000305175781,"y":2904.000030517578,"wires":[["3ec56a51.9d263e"]]},{"id":"1822dccd.4e3d43","type":"mqtt in","z":"74cedccf.2b6a6c","name":"GetTVEntertainment","topic":"cmnd/TVEntertainment/Power","qos":"2","broker":"e6d8a0f0.6f5878","x":165.00003051757812,"y":2893,"wires":[["7b89d53c.76e19c"]]},{"id":"3ec56a51.9d263e","type":"mqtt out","z":"74cedccf.2b6a6c","name":"SaveStateTVEntertainment","topic":"cmnd/TVEntertainment/Power","qos":"0","retain":"true","broker":"e6d8a0f0.6f5878","x":759.5,"y":2903.000030517578,"wires":[]},{"id":"3e4f32cb.0fc5f6","type":"debug","z":"3b15046f.07e474","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":537,"y":549,"wires":[]},{"id":"d969452a.14985","type":"debug","z":"3b15046f.07e474","name":"stetp1","active":false,"console":"false","complete":"payload","x":719,"y":415,"wires":[]},{"id":"7a333dc4.f2351c","type":"ui_switch","z":"74cedccf.2b6a6c","name":"PirLight61","label":"PIR Lig 1","group":"6eaf738f.cbb964","order":5,"width":"","height":"","passthru":false,"decouple":"true","topic":"/pirlight1/cmd","onvalue":"GPIO 12 1","onvalueType":"str","onicon":"","oncolor":"","offvalue":"GPIO 12 0","offvalueType":"str","officon":"","offcolor":"","x":352,"y":4379,"wires":[["73c7379c.1fa0a","c2fd0015.224c98"]]},{"id":"e484cc3.fe7053","type":"mqtt in","z":"74cedccf.2b6a6c","name":"ReadStatePirLight61","topic":"/pirlight1/cmd","qos":"2","broker":"e6d8a0f0.6f5878","x":100,"y":4363,"wires":[["7a333dc4.f2351c"]]},{"id":"73c7379c.1fa0a","type":"mqtt out","z":"74cedccf.2b6a6c","name":"SaveStatePirlight61","topic":"/pirlight1/cmd2","qos":"0","retain":"true","broker":"e6d8a0f0.6f5878","x":940.4999694824219,"y":4305,"wires":[]},{"id":"6abe94a.654376c","type":"mqtt in","z":"74cedccf.2b6a6c","name":"ReadStatePirlight1PIR","topic":"/pirlight1/pir6101/PIR","qos":"2","broker":"e6d8a0f0.6f5878","x":102,"y":4307,"wires":[["11741a10.3a35de"]]},{"id":"c2fd0015.224c98","type":"debug","z":"74cedccf.2b6a6c","name":"","active":false,"console":"false","complete":"payload","x":904.4500427246094,"y":4368.9500732421875,"wires":[]},{"id":"11741a10.3a35de","type":"function","z":"74cedccf.2b6a6c","name":"","func":"if (msg.payload=='1') \n{\n    msg.payload = \"GPIO 12 1\";\n    context.global.PirLight1 = new Date();\n    msg2 = msg;\n}  \nif (msg.payload=='0') \n{\n    //msg.payload = \"GPIO 12 0\";\n    msg=null;\n    //context.global.PirLight1 = 0;\n    msg2 = null;\n}\nreturn [msg,msg2];","outputs":"2","noerr":0,"x":347.4499816894531,"y":4312.916687011719,"wires":[["73c7379c.1fa0a","c2fd0015.224c98"],["6b80d761.8c7e8"]]},{"id":"6b80d761.8c7e8","type":"delay","z":"74cedccf.2b6a6c","name":"","pauseType":"delay","timeout":"10","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":584,"y":4278,"wires":[["40bb77dc.7c4de"]]},{"id":"40bb77dc.7c4de","type":"function","z":"74cedccf.2b6a6c","name":"","func":"var now = new Date() + 2;\n\nif ((context.global.PirLight1 + 60) < now)\n{\n    msg.payload = \"GPIO 12 0\";\n} else {\n    msg = null;      \n}\n\nreturn msg;","outputs":1,"noerr":0,"x":732,"y":4277.533355712891,"wires":[["73c7379c.1fa0a"]]},{"id":"b956db47.edb848","type":"comment","z":"b65b888a.ee7038","name":"SDM120 Energy Meter","info":"","x":362.50000381469727,"y":463.0000009536743,"wires":[]},{"id":"1e72b48c.16d11b","type":"modbus-read","z":"b65b888a.ee7038","name":"SDM 120 Voltage","showStatusActivities":true,"showErrors":true,"unitid":"012","dataType":"InputRegister","adr":"0","quantity":"2","rate":"5","rateUnit":"s","server":"408cb596.0ecdfc","x":334.00000381469727,"y":556.0000009536743,"wires":[["ffb8f523.f8f398","3f24a5dc.44de7a"],[]]},{"id":"ffb8f523.f8f398","type":"function","z":"b65b888a.ee7038","name":"Voltage","func":"var rawData = new ArrayBuffer(4);\nvar intView = new Uint16Array(rawData);\nvar fltView = new Float32Array(rawData);\n\nintView[0] = msg.payload[1]; //low\nintView[1] = msg.payload[0]; //high\n\nmsg.payload = parseFloat(fltView[0].toFixed(1));\nmsg.topic = \"voltage\";\n\nnode.status({fill:\"blue\",shape:\"ring\",text:msg.topic + \":\" + msg.payload});    \n\nreturn msg;","outputs":1,"noerr":0,"x":563.0000038146973,"y":549.0000009536743,"wires":[["117723be.d62e2c","dd412d05.dea79"]]},{"id":"9bc653b3.688c6","type":"modbus-queue-info","z":"b65b888a.ee7038","name":"SDM120_queue","unitid":"012","lowLowLevel":"1","lowLevel":75,"highLevel":150,"highHighLevel":300,"server":"408cb596.0ecdfc","errorOnHighLevel":false,"x":705.6428565979004,"y":923.1071786880493,"wires":[["5106eeb3.4aa96"]]},{"id":"e06391e.d495df","type":"inject","z":"b65b888a.ee7038","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":334.6428642272949,"y":924.1072034835815,"wires":[["c9f17842.845a08"]]},{"id":"c9f17842.845a08","type":"change","z":"b65b888a.ee7038","name":"Reset queue","rules":[{"t":"set","p":"resetQueue","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":503.6428642272949,"y":924.1071901321411,"wires":[["9bc653b3.688c6"]]},{"id":"4d3f07be.f691d","type":"function","z":"b65b888a.ee7038","name":"Current","func":"var rawData = new ArrayBuffer(4);\nvar intView = new Uint16Array(rawData);\nvar fltView = new Float32Array(rawData);\n\nintView[0] = msg.payload[1]; //low\nintView[1] = msg.payload[0]; //high\n\nmsg.payload = parseFloat(fltView[0].toFixed(1));\nmsg.topic = \"current\";\n\nnode.status({fill:\"blue\",shape:\"ring\",text:msg.topic + \":\" + msg.payload});    \n\nreturn msg;","outputs":1,"noerr":0,"x":562.0000038146973,"y":607.0000009536743,"wires":[["bb5dae06.3b2918","dd412d05.dea79"]]},{"id":"a9628b23.43e038","type":"function","z":"b65b888a.ee7038","name":"Power","func":"var rawData = new ArrayBuffer(4);\nvar intView = new Uint16Array(rawData);\nvar fltView = new Float32Array(rawData);\n\nintView[0] = msg.payload[1]; //low\nintView[1] = msg.payload[0]; //high\n\nmsg.payload = parseFloat(fltView[0].toFixed(1));\nmsg.topic = \"power\";\n\nnode.status({fill:\"blue\",shape:\"ring\",text:msg.topic + \":\" + msg.payload});    \n\nreturn msg;","outputs":1,"noerr":0,"x":553.0000038146973,"y":660.0000009536743,"wires":[["c84ec892.e2df","dd412d05.dea79"]]},{"id":"ba94469b.17182","type":"function","z":"b65b888a.ee7038","name":"Frequency","func":"var rawData = new ArrayBuffer(4);\nvar intView = new Uint16Array(rawData);\nvar fltView = new Float32Array(rawData);\n\nintView[0] = msg.payload[1]; //low\nintView[1] = msg.payload[0]; //high\n\nmsg.payload = parseFloat(fltView[0].toFixed(1));\nmsg.topic = \"frequency\";\n\nnode.status({fill:\"blue\",shape:\"ring\",text:msg.topic + \":\" + msg.payload});    \n\nreturn msg;","outputs":1,"noerr":0,"x":573.0000038146973,"y":716.0000009536743,"wires":[["6f81647.acefa1c","dd412d05.dea79"]]},{"id":"a1fa6095.94be48","type":"function","z":"b65b888a.ee7038","name":"Energy","func":"var rawData = new ArrayBuffer(4);\nvar intView = new Uint16Array(rawData);\nvar fltView = new Float32Array(rawData);\n\nintView[0] = msg.payload[1]; //low\nintView[1] = msg.payload[0]; //high\n\nmsg.payload = parseFloat(fltView[0].toFixed(2));\nmsg.topic = \"energy\";\n\nnode.status({fill:\"blue\",shape:\"ring\",text:msg.topic + \":\" + msg.payload});    \n\nreturn msg;","outputs":1,"noerr":0,"x":563.0000038146973,"y":776.0000009536743,"wires":[["d77214.32df25f","dd412d05.dea79"]]},{"id":"e40ad403.6107f8","type":"modbus-read","z":"b65b888a.ee7038","name":"SDM 120 Current","showStatusActivities":true,"showErrors":true,"unitid":"012","dataType":"InputRegister","adr":"6","quantity":"2","rate":"5","rateUnit":"s","server":"408cb596.0ecdfc","x":343.00000381469727,"y":614.0000009536743,"wires":[["4d3f07be.f691d"],[]]},{"id":"bcaaf15f.0e04","type":"modbus-read","z":"b65b888a.ee7038","name":"SDM 120 Power","showStatusActivities":true,"showErrors":true,"unitid":"012","dataType":"InputRegister","adr":"12","quantity":"2","rate":"5","rateUnit":"s","server":"408cb596.0ecdfc","x":333.00000381469727,"y":666.0000009536743,"wires":[["a9628b23.43e038"],[]]},{"id":"dba1ce43.000f28","type":"modbus-read","z":"b65b888a.ee7038","name":"SDM 120 Frequency","showStatusActivities":true,"showErrors":true,"unitid":"012","dataType":"InputRegister","adr":"70","quantity":"2","rate":"5","rateUnit":"s","server":"408cb596.0ecdfc","x":353.00000381469727,"y":722.0000009536743,"wires":[["ba94469b.17182"],[]]},{"id":"db9fe31.e0fda2","type":"modbus-read","z":"b65b888a.ee7038","name":"SDM 120 Energy","showStatusActivities":true,"showErrors":true,"unitid":"012","dataType":"InputRegister","adr":"342","quantity":"2","rate":"5","rateUnit":"s","server":"408cb596.0ecdfc","x":331.00000381469727,"y":781.0000009536743,"wires":[["a1fa6095.94be48","78c61d7a.8a4b3c"],[]]},{"id":"117723be.d62e2c","type":"ui_text","z":"b65b888a.ee7038","group":"f23a42a6.26fc7","order":0,"width":0,"height":0,"name":"","label":"Voltage","format":"{{msg.payload}} V","layout":"row-spread","x":749.0000038146973,"y":551.0000009536743,"wires":[]},{"id":"bb5dae06.3b2918","type":"ui_text","z":"b65b888a.ee7038","group":"f23a42a6.26fc7","order":0,"width":0,"height":0,"name":"","label":"Current","format":"{{msg.payload}} A","layout":"row-spread","x":750.0000038146973,"y":606.0000009536743,"wires":[]},{"id":"c84ec892.e2df","type":"ui_text","z":"b65b888a.ee7038","group":"f23a42a6.26fc7","order":0,"width":0,"height":0,"name":"","label":"Power","format":"{{msg.payload}} W","layout":"row-spread","x":746.0000038146973,"y":661.0000009536743,"wires":[]},{"id":"6f81647.acefa1c","type":"ui_text","z":"b65b888a.ee7038","group":"f23a42a6.26fc7","order":0,"width":0,"height":0,"name":"","label":"Frequency","format":"{{msg.payload}} Hz","layout":"row-spread","x":766.0000038146973,"y":717.0000009536743,"wires":[]},{"id":"d77214.32df25f","type":"ui_text","z":"b65b888a.ee7038","group":"f23a42a6.26fc7","order":0,"width":0,"height":0,"name":"","label":"Total Energy","format":"{{msg.payload}} kWh","layout":"row-spread","x":768.0000038146973,"y":777.0000009536743,"wires":[]},{"id":"dd412d05.dea79","type":"function","z":"b65b888a.ee7038","name":"Build object","func":"watch_topic = \"energy\";\nvar output = {};\n\ncontext.set(msg.topic,msg.payload);\n\nif (context.get(\"voltage\")!==undefined) {\n    output.voltage = context.get(\"voltage\");\n}\nif (context.get(\"current\")!==undefined) {\n    output.current = context.get(\"current\");\n}\nif (context.get(\"power\")!==undefined) {\n    output.power = context.get(\"power\");\n}\nif (context.get(\"frequency\")!==undefined) {\n    output.frequency = context.get(\"frequency\");\n}\nif (context.get(\"energy\")!==undefined) {\n    output.energy = context.get(\"energy\");\n}\nmsg.payload = output;\n\nif (msg.topic===watch_topic) {\n    msg.topic = \"sdm120\";\n    return msg;\n}","outputs":1,"noerr":0,"x":947.0000038146973,"y":609.0000009536743,"wires":[["136f164f.294fa2","5864538a.3fa2dc"]]},{"id":"136f164f.294fa2","type":"debug","z":"b65b888a.ee7038","name":"SDM120Debug","active":true,"console":"false","complete":"true","x":1168.0000038146973,"y":632.0000009536743,"wires":[]},{"id":"8a1c976b.70c688","type":"function","z":"b65b888a.ee7038","name":"Diagnostic input message structure","func":"// setting a global flag that the solar system is down\n\nmsg.payload = \"High voltage warning: \" + msg.payload.voltage +\" V\";\nmsg.system = 1; // System id, use 1 for Dummy\n//msg.state = 1; // specify if the message is to change system status\nmsg.severity = 1; // 0: information, 1: warning, 2: error\nmsg.email = false; // if separate email should be sent\n//msg.emailtext = \"Clean up step of the SAIA log backup has failed\";\nreturn msg;","outputs":1,"noerr":0,"x":1654.0000038146973,"y":522.0000009536743,"wires":[["3e231963.8cc736"]]},{"id":"3e231963.8cc736","type":"link out","z":"b65b888a.ee7038","name":"","links":["13e089a7.73cb46"],"x":1861.0000038146973,"y":544.0000009536743,"wires":[]},{"id":"89094d0b.dccfc8","type":"switch","z":"b65b888a.ee7038","name":"Voltage check","property":"payload.voltage_check","propertyType":"msg","rules":[{"t":"eq","v":"high","vt":"str"},{"t":"eq","v":"low","vt":"str"}],"checkall":"true","outputs":2,"x":1362.0000038146973,"y":546.0000009536743,"wires":[["8a1c976b.70c688"],["7b9a0de0.d03b8c"]]},{"id":"7b9a0de0.d03b8c","type":"function","z":"b65b888a.ee7038","name":"Diagnostic input message structure","func":"// setting a global flag that the solar system is down\n\nmsg.payload = \"Low voltage warning: \" + msg.payload.voltage +\" V\";\nmsg.system = 1; // System id, use 1 for Dummy\n//msg.state = 1; // specify if the message is to change system status\nmsg.severity = 1; // 0: information, 1: warning, 2: error\nmsg.email = false; // if separate email should be sent\n//msg.emailtext = \"Clean up step of the SAIA log backup has failed\";\nreturn msg;","outputs":1,"noerr":0,"x":1654.0000038146973,"y":567.0000009536743,"wires":[["3e231963.8cc736"]]},{"id":"5864538a.3fa2dc","type":"function","z":"b65b888a.ee7038","name":"Voltage check","func":"var high = 250.0;\nvar low = 220.0;\n\nif (msg.payload.voltage > high) {\n    msg.payload.voltage_check = \"high\";\n}\nif (msg.payload.voltage < low) {\n    msg.payload.voltage_check = \"low\";\n}\nreturn msg;","outputs":1,"noerr":0,"x":1149.0000038146973,"y":547.0000009536743,"wires":[["89094d0b.dccfc8"]]},{"id":"edd18c97.bb2d4","type":"function","z":"b65b888a.ee7038","name":"reset on HighHigh","func":"if(\"high high level reached\" === msg.state) {\n    msg.resetQueue = true;\n    return msg;\n}\n","outputs":1,"noerr":0,"x":578.5000114440918,"y":1054.2500257492065,"wires":[["9bc653b3.688c6","2cf1a0c6.8a2f9"]]},{"id":"d9ddee8f.6e3bd","type":"catch","z":"b65b888a.ee7038","name":"Catch queue errors","scope":["9bc653b3.688c6"],"x":340.5000114440918,"y":1054.2500257492065,"wires":[["edd18c97.bb2d4"]]},{"id":"33bff59f.e8ca92","type":"comment","z":"b65b888a.ee7038","name":"Error handling","info":"","x":306.5000114440918,"y":1009.2500257492065,"wires":[]},{"id":"2cf1a0c6.8a2f9","type":"function","z":"b65b888a.ee7038","name":"Diagnostic input message structure","func":"// setting a global flag that the solar system is down\n\nmsg.payload = \"SDM120 modbus queue reached high level, resetting. (\" + msg.state + \")\";\nmsg.system = 4; // System id, use 1 for Dummy\n//msg.state = 1; // specify if the message is to change system status\nmsg.severity = 1; // 0: information, 1: warning, 2: error\nmsg.email = false; // if separate email should be sent\n//msg.emailtext = \"Clean up step of the SAIA log backup has failed\";\nreturn msg;","outputs":1,"noerr":0,"x":878.5000114440918,"y":1053.2500257492065,"wires":[["4ee7e4e7.74ed54"]]},{"id":"4ee7e4e7.74ed54","type":"link out","z":"b65b888a.ee7038","name":"","links":["13e089a7.73cb46"],"x":1064.5000114440918,"y":1053.2500257492065,"wires":[]},{"id":"c194d518.1f6618","type":"catch","z":"b65b888a.ee7038","name":"Modbus read errors","scope":["e40ad403.6107f8","db9fe31.e0fda2","dba1ce43.000f28","bcaaf15f.0e04","1e72b48c.16d11b","b956db47.edb848"],"x":340.5000114440918,"y":1097.2500257492065,"wires":[["fec08ef7.6bdca8"]]},{"id":"fec08ef7.6bdca8","type":"function","z":"b65b888a.ee7038","name":"Diagnostic input message structure","func":"// setting a global flag that the solar system is down\n\nmsg.payload = \"SDM120 modbus error: \" + msg.error.message;\nmsg.system = 4; // System id, use 1 for Dummy\n//msg.state = 1; // specify if the message is to change system status\nmsg.severity = 1; // 0: information, 1: warning, 2: error\nmsg.email = false; // if separate email should be sent\n//msg.emailtext = \"Clean up step of the SAIA log backup has failed\";\nreturn msg;","outputs":1,"noerr":0,"x":629.5000114440918,"y":1097.2500257492065,"wires":[["b994e1bb.f6fed"]]},{"id":"b994e1bb.f6fed","type":"link out","z":"b65b888a.ee7038","name":"","links":["13e089a7.73cb46"],"x":815.5000114440918,"y":1097.2500257492065,"wires":[]},{"id":"5106eeb3.4aa96","type":"debug","z":"b65b888a.ee7038","name":"ModbusError","active":true,"console":"false","complete":"true","x":906.5000114440918,"y":922.2500257492065,"wires":[]},{"id":"78c61d7a.8a4b3c","type":"function","z":"b65b888a.ee7038","name":"Health check","func":"var devicename = \"sdm120\"; // Device name used for context variable\nvar system_id = 4; // System id number for diagnostic update\nvar online_threshold = 10; // Seconds between updates under which the device is considered online\nvar offline_threshold = 30; // Seconds between updates above which the device is considered offline\n\nvar temp = context.get(devicename+\"_update\");\nvar current = new Date();\nmsg.payload = \"No data\";\nmsg.warning = false;\nif (msg.topic!==\"timecheck\") {\n    // Do not update the context if it is triggered by the check inject node\n    context.set(devicename+\"_update\",current);\n}\nif (temp===undefined) {\n    // this will be the case when node-red is booting up or redeployed\n    context.set(devicename+\"_update\",current);\n}\n\nif (temp!==undefined) {\n    current = current - temp;\n    current = Math.floor(current/1000);\n    var minute = Math.floor(current/60);\n    var hour = Math.floor(minute/60);\n    var day = Math.floor(hour/24);\n    if (current>24*60*60) {\n        msg.payload = \"Last update \" + day + \" days, \" + hour%24 + \" hours, \" + minute%60 + \" minutes, \" + current%60 + \" seconds ago\";\n    } else if (current>60*60) {\n        msg.payload = \"Last update \" + hour%24 + \" hours, \" + minute%60 + \" minutes, \" + current%60 + \" seconds ago\";\n    } else if (current>60) {\n        msg.payload = \"Last update \" + minute%60 + \" minutes, \" + current%60 + \" seconds ago\";\n    } else {\n        msg.payload = \"Last update \" + current%60 + \" seconds ago\";\n    }\n\n    if (context.get(devicename+\"_state\")!==1) {\n        if (current<online_threshold) {\n            msg.payload = \"SDM120 is now online\";\n            msg.system = system_id; // System id, use 1 for Dummy\n            msg.state = 1; // specify if the message is to change system status\n            msg.severity = 0; // 0: information, 1: warning, 2: error\n            //msg.email = true; // if separate email should be sent\n            //msg.emailtext = \"\"; this a long text which goes into the email  \n            msg.warning = true;\n            context.set(devicename+\"_state\",1);\n        }\n    } else {\n        if (current>offline_threshold) {\n            msg.payload = \"SDM120 is not transmitting\";\n            msg.system = system_id; // System id, use 1 for Dummy\n            msg.state = 99; // specify if the message is to change system status\n            msg.severity = 2; // 0: information, 1: warning, 2: error\n            //msg.email = true; // if separate email should be sent\n            //msg.emailtext = \"\"; this a long text which goes into the email            \n            msg.warning = true;\n            context.set(devicename+\"_state\",99);\n        }\n    }\n    \n    \n}\n\nnode.status({fill:\"blue\",shape:\"ring\",text:msg.payload});\n\nreturn msg;","outputs":1,"noerr":0,"x":587.0000038146973,"y":841.0000009536743,"wires":[["daa16ac.fb13398"]]},{"id":"c053bfaa.4127f8","type":"inject","z":"b65b888a.ee7038","name":"Check","topic":"timecheck","payload":"","payloadType":"date","repeat":"1","crontab":"","once":false,"x":371.00000381469727,"y":853.0000009536743,"wires":[["78c61d7a.8a4b3c"]]},{"id":"daa16ac.fb13398","type":"switch","z":"b65b888a.ee7038","name":"Update diag?","property":"warning","propertyType":"msg","rules":[{"t":"true"}],"checkall":"true","outputs":1,"x":782.0000038146973,"y":841.0000009536743,"wires":[["61fedd40.3f2b7c"]]},{"id":"61fedd40.3f2b7c","type":"link out","z":"b65b888a.ee7038","name":"","links":["13e089a7.73cb46"],"x":901.3015766143799,"y":840.5714044570923,"wires":[]},{"id":"3f24a5dc.44de7a","type":"debug","z":"b65b888a.ee7038","name":"","active":true,"console":"false","complete":"false","x":559.0000038146973,"y":497.0000009536743,"wires":[]},{"id":"3b80b403.1429ac","type":"comment","z":"b65b888a.ee7038","name":"SDM220 Energy Meter","info":"","x":301.50000381469727,"y":1215.0000009536743,"wires":[]},{"id":"85e2237f.8c84e","type":"modbus-read","z":"b65b888a.ee7038","name":"SDM 220 Voltage","showStatusActivities":true,"showErrors":true,"unitid":"011","dataType":"InputRegister","adr":"0","quantity":"2","rate":"5","rateUnit":"s","server":"408cb596.0ecdfc","x":273.00000381469727,"y":1308.0000009536743,"wires":[["4c2d0980.8ea36","985d24ca.5140c"],[]]},{"id":"4c2d0980.8ea36","type":"function","z":"b65b888a.ee7038","name":"Voltage","func":"var rawData = new ArrayBuffer(4);\nvar intView = new Uint16Array(rawData);\nvar fltView = new Float32Array(rawData);\n\nintView[0] = msg.payload[1]; //low\nintView[1] = msg.payload[0]; //high\n\nmsg.payload = parseFloat(fltView[0].toFixed(1));\nmsg.topic = \"voltage\";\n\nnode.status({fill:\"blue\",shape:\"ring\",text:msg.topic + \":\" + msg.payload});    \n\nreturn msg;","outputs":1,"noerr":0,"x":502.00000381469727,"y":1301.0000009536743,"wires":[["c47434e1.c5b71","2e67f38c.1e3fc4","a3786f37.aee2a8"]]},{"id":"884d9a2a.32dbb8","type":"modbus-queue-info","z":"b65b888a.ee7038","name":"SDM220_queue","unitid":"011","lowLowLevel":"1","lowLevel":75,"highLevel":150,"highHighLevel":300,"server":"408cb596.0ecdfc","errorOnHighLevel":false,"x":648.6428565979004,"y":1875.1071786880493,"wires":[["186e7b08.9fac3d"]]},{"id":"7da70072.c6bc08","type":"inject","z":"b65b888a.ee7038","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":277.6428642272949,"y":1876.1072034835815,"wires":[["ea31f60d.3a521"]]},{"id":"ea31f60d.3a521","type":"change","z":"b65b888a.ee7038","name":"Reset queue","rules":[{"t":"set","p":"resetQueue","pt":"msg","to":"true","tot":"bool"}],"action":"","property":"","from":"","to":"","reg":false,"x":446.6428642272949,"y":1876.107190132141,"wires":[["884d9a2a.32dbb8"]]},{"id":"64722202.a0900c","type":"function","z":"b65b888a.ee7038","name":"Current","func":"var rawData = new ArrayBuffer(4);\nvar intView = new Uint16Array(rawData);\nvar fltView = new Float32Array(rawData);\n\nintView[0] = msg.payload[1]; //low\nintView[1] = msg.payload[0]; //high\n\nmsg.payload = parseFloat(fltView[0].toFixed(1));\nmsg.topic = \"current\";\n\nnode.status({fill:\"blue\",shape:\"ring\",text:msg.topic + \":\" + msg.payload});    \n\nreturn msg;","outputs":1,"noerr":0,"x":501.00000381469727,"y":1359.0000009536743,"wires":[["f29bbe20.0e171","2e67f38c.1e3fc4","a3786f37.aee2a8"]]},{"id":"6fd718b0.733cc","type":"function","z":"b65b888a.ee7038","name":"Power","func":"var rawData = new ArrayBuffer(4);\nvar intView = new Uint16Array(rawData);\nvar fltView = new Float32Array(rawData);\n\nintView[0] = msg.payload[1]; //low\nintView[1] = msg.payload[0]; //high\n\nmsg.payload = parseFloat(fltView[0].toFixed(1));\nmsg.topic = \"power\";\n\nnode.status({fill:\"blue\",shape:\"ring\",text:msg.topic + \":\" + msg.payload});    \n\nreturn msg;","outputs":1,"noerr":0,"x":492.00000381469727,"y":1412.0000009536743,"wires":[["a1918f6c.646218","2e67f38c.1e3fc4","a3786f37.aee2a8"]]},{"id":"aa8d7d3.2a959","type":"function","z":"b65b888a.ee7038","name":"Frequency","func":"var rawData = new ArrayBuffer(4);\nvar intView = new Uint16Array(rawData);\nvar fltView = new Float32Array(rawData);\n\nintView[0] = msg.payload[1]; //low\nintView[1] = msg.payload[0]; //high\n\nmsg.payload = parseFloat(fltView[0].toFixed(1));\nmsg.topic = \"frequency\";\n\nnode.status({fill:\"blue\",shape:\"ring\",text:msg.topic + \":\" + msg.payload});    \n\nreturn msg;","outputs":1,"noerr":0,"x":512.0000038146973,"y":1468.0000009536743,"wires":[["deb3c809.90cf98","2e67f38c.1e3fc4","a3786f37.aee2a8"]]},{"id":"4276f3a0.153c54","type":"function","z":"b65b888a.ee7038","name":"Energy","func":"var rawData = new ArrayBuffer(4);\nvar intView = new Uint16Array(rawData);\nvar fltView = new Float32Array(rawData);\n\nintView[0] = msg.payload[1]; //low\nintView[1] = msg.payload[0]; //high\n\nmsg.payload = parseFloat(fltView[0].toFixed(2));\nmsg.topic = \"energy\";\n\nnode.status({fill:\"blue\",shape:\"ring\",text:msg.topic + \":\" + msg.payload});    \n\nreturn msg;","outputs":1,"noerr":0,"x":506.00000381469727,"y":1728.0000009536743,"wires":[["5e5851b.6b93b3","2e67f38c.1e3fc4","a3786f37.aee2a8"]]},{"id":"4037c0ba.c494","type":"modbus-read","z":"b65b888a.ee7038","name":"SDM 220 Current","showStatusActivities":true,"showErrors":true,"unitid":"011","dataType":"InputRegister","adr":"6","quantity":"2","rate":"5","rateUnit":"s","server":"408cb596.0ecdfc","x":282.00000381469727,"y":1366.0000009536743,"wires":[["64722202.a0900c"],[]]},{"id":"2c8ce8f6.395f08","type":"modbus-read","z":"b65b888a.ee7038","name":"SDM 220 Power","showStatusActivities":true,"showErrors":true,"unitid":"011","dataType":"InputRegister","adr":"12","quantity":"2","rate":"5","rateUnit":"s","server":"408cb596.0ecdfc","x":272.00000381469727,"y":1418.0000009536743,"wires":[["6fd718b0.733cc"],[]]},{"id":"4b5226aa.2ffee8","type":"modbus-read","z":"b65b888a.ee7038","name":"SDM 220 Frequency","showStatusActivities":true,"showErrors":true,"unitid":"011","dataType":"InputRegister","adr":"70","quantity":"2","rate":"5","rateUnit":"s","server":"408cb596.0ecdfc","x":292.00000381469727,"y":1474.0000009536743,"wires":[["aa8d7d3.2a959"],[]]},{"id":"9d25d178.9056f8","type":"modbus-read","z":"b65b888a.ee7038","name":"SDM 220 Energy","showStatusActivities":true,"showErrors":true,"unitid":"011","dataType":"InputRegister","adr":"342","quantity":"2","rate":"5","rateUnit":"s","server":"408cb596.0ecdfc","x":274.00000381469727,"y":1733.0000009536743,"wires":[["4276f3a0.153c54","2814d0d3.759978"],[]]},{"id":"c47434e1.c5b71","type":"ui_text","z":"b65b888a.ee7038","group":"57345486.b86a3c","order":0,"width":0,"height":0,"name":"","label":"Voltage","format":"{{msg.payload}} V","layout":"row-spread","x":688.0000038146973,"y":1308.0000009536743,"wires":[]},{"id":"f29bbe20.0e171","type":"ui_text","z":"b65b888a.ee7038","group":"57345486.b86a3c","order":0,"width":0,"height":0,"name":"","label":"Current","format":"{{msg.payload}} A","layout":"row-spread","x":689.0000038146973,"y":1358.0000009536743,"wires":[]},{"id":"a1918f6c.646218","type":"ui_text","z":"b65b888a.ee7038","group":"57345486.b86a3c","order":0,"width":0,"height":0,"name":"","label":"Power","format":"{{msg.payload}} W","layout":"row-spread","x":685.0000038146973,"y":1413.0000009536743,"wires":[]},{"id":"deb3c809.90cf98","type":"ui_text","z":"b65b888a.ee7038","group":"57345486.b86a3c","order":0,"width":0,"height":0,"name":"","label":"Frequency","format":"{{msg.payload}} Hz","layout":"row-spread","x":705.0000038146973,"y":1469.0000009536743,"wires":[]},{"id":"5e5851b.6b93b3","type":"ui_text","z":"b65b888a.ee7038","group":"57345486.b86a3c","order":0,"width":0,"height":0,"name":"","label":"Total Energy","format":"{{msg.payload}} kWh","layout":"row-spread","x":711.0000038146973,"y":1729.0000009536743,"wires":[]},{"id":"2e67f38c.1e3fc4","type":"function","z":"b65b888a.ee7038","name":"Build object","func":"watch_topic = \"energy\";\nvar output = {};\n\ncontext.set(msg.topic,msg.payload);\n\nif (context.get(\"voltage\")!==undefined) {\n    output.voltage = context.get(\"voltage\");\n}\nif (context.get(\"current\")!==undefined) {\n    output.current = context.get(\"current\");\n}\nif (context.get(\"power\")!==undefined) {\n    output.power = context.get(\"power\");\n}\nif (context.get(\"frequency\")!==undefined) {\n    output.frequency = context.get(\"frequency\");\n}\nif (context.get(\"energy\")!==undefined) {\n    output.energy = context.get(\"energy\");\n}\nmsg.payload = output;\n\nif (msg.topic===watch_topic) {\n    msg.topic = \"sdm220\";\n    return msg;\n}","outputs":1,"noerr":0,"x":886.0000038146973,"y":1361.0000009536743,"wires":[["b77d2850.59792","27d3e2eb.dfebb6"]]},{"id":"b77d2850.59792","type":"debug","z":"b65b888a.ee7038","name":"SDM220Debug","active":true,"console":"false","complete":"true","x":1107.0000038146973,"y":1384.0000009536743,"wires":[]},{"id":"5308f6b8.6fe6f8","type":"function","z":"b65b888a.ee7038","name":"Diagnostic input message structure","func":"// setting a global flag that the solar system is down\n\nmsg.payload = \"High voltage warning: \" + msg.payload.voltage +\" V\";\nmsg.system = 1; // System id, use 1 for Dummy\n//msg.state = 1; // specify if the message is to change system status\nmsg.severity = 1; // 0: information, 1: warning, 2: error\nmsg.email = false; // if separate email should be sent\n//msg.emailtext = \"Clean up step of the SAIA log backup has failed\";\nreturn msg;","outputs":1,"noerr":0,"x":1593.0000038146973,"y":1274.0000009536743,"wires":[["952c37a8.91f8f8"]]},{"id":"952c37a8.91f8f8","type":"link out","z":"b65b888a.ee7038","name":"","links":["13e089a7.73cb46"],"x":1800.0000038146973,"y":1296.0000009536743,"wires":[]},{"id":"eb1c6888.dde6b","type":"switch","z":"b65b888a.ee7038","name":"Voltage check","property":"payload.voltage_check","propertyType":"msg","rules":[{"t":"eq","v":"high","vt":"str"},{"t":"eq","v":"low","vt":"str"}],"checkall":"true","outputs":2,"x":1301.0000038146973,"y":1298.0000009536743,"wires":[["5308f6b8.6fe6f8"],["cbd49580.a5fee"]]},{"id":"cbd49580.a5fee","type":"function","z":"b65b888a.ee7038","name":"Diagnostic input message structure","func":"// setting a global flag that the solar system is down\n\nmsg.payload = \"Low voltage warning: \" + msg.payload.voltage +\" V\";\nmsg.system = 1; // System id, use 1 for Dummy\n//msg.state = 1; // specify if the message is to change system status\nmsg.severity = 1; // 0: information, 1: warning, 2: error\nmsg.email = false; // if separate email should be sent\n//msg.emailtext = \"Clean up step of the SAIA log backup has failed\";\nreturn msg;","outputs":1,"noerr":0,"x":1593.0000038146973,"y":1319.0000009536743,"wires":[["952c37a8.91f8f8"]]},{"id":"27d3e2eb.dfebb6","type":"function","z":"b65b888a.ee7038","name":"Voltage check","func":"var high = 250.0;\nvar low = 220.0;\n\nif (msg.payload.voltage > high) {\n    msg.payload.voltage_check = \"high\";\n}\nif (msg.payload.voltage < low) {\n    msg.payload.voltage_check = \"low\";\n}\nreturn msg;","outputs":1,"noerr":0,"x":1088.0000038146973,"y":1299.0000009536743,"wires":[["eb1c6888.dde6b"]]},{"id":"9b4e128c.103618","type":"function","z":"b65b888a.ee7038","name":"reset on HighHigh","func":"if(\"high high level reached\" === msg.state) {\n    msg.resetQueue = true;\n    return msg;\n}\n","outputs":1,"noerr":0,"x":521.5000114440918,"y":2006.2500257492065,"wires":[["884d9a2a.32dbb8","84dc1468.bead18"]]},{"id":"6d440ca.ac72174","type":"catch","z":"b65b888a.ee7038","name":"Catch queue errors","scope":["884d9a2a.32dbb8"],"x":283.5000114440918,"y":2006.2500257492065,"wires":[["9b4e128c.103618"]]},{"id":"3366a068.5b52d8","type":"comment","z":"b65b888a.ee7038","name":"Error handling","info":"","x":249.5000114440918,"y":1961.2500257492065,"wires":[]},{"id":"84dc1468.bead18","type":"function","z":"b65b888a.ee7038","name":"Diagnostic input message structure","func":"// setting a global flag that the solar system is down\n\nmsg.payload = \"SDM120 modbus queue reached high level, resetting. (\" + msg.state + \")\";\nmsg.system = 4; // System id, use 1 for Dummy\n//msg.state = 1; // specify if the message is to change system status\nmsg.severity = 1; // 0: information, 1: warning, 2: error\nmsg.email = false; // if separate email should be sent\n//msg.emailtext = \"Clean up step of the SAIA log backup has failed\";\nreturn msg;","outputs":1,"noerr":0,"x":821.5000114440918,"y":2005.2500257492065,"wires":[["247f886d.6958c"]]},{"id":"247f886d.6958c","type":"link out","z":"b65b888a.ee7038","name":"","links":["13e089a7.73cb46"],"x":1007.5000114440918,"y":2005.2500257492065,"wires":[]},{"id":"75982658.58743","type":"catch","z":"b65b888a.ee7038","name":"Modbus read errors","scope":["4037c0ba.c494","9d25d178.9056f8","4b5226aa.2ffee8","2c8ce8f6.395f08","85e2237f.8c84e","3b80b403.1429ac"],"x":283.5000114440918,"y":2049.2500257492065,"wires":[["7948c670.436048"]]},{"id":"7948c670.436048","type":"function","z":"b65b888a.ee7038","name":"Diagnostic input message structure","func":"// setting a global flag that the solar system is down\n\nmsg.payload = \"SDM120 modbus error: \" + msg.error.message;\nmsg.system = 4; // System id, use 1 for Dummy\n//msg.state = 1; // specify if the message is to change system status\nmsg.severity = 1; // 0: information, 1: warning, 2: error\nmsg.email = false; // if separate email should be sent\n//msg.emailtext = \"Clean up step of the SAIA log backup has failed\";\nreturn msg;","outputs":1,"noerr":0,"x":572.5000114440918,"y":2049.2500257492065,"wires":[["d9a72c0d.7ada7"]]},{"id":"d9a72c0d.7ada7","type":"link out","z":"b65b888a.ee7038","name":"","links":["13e089a7.73cb46"],"x":758.5000114440918,"y":2049.2500257492065,"wires":[]},{"id":"186e7b08.9fac3d","type":"debug","z":"b65b888a.ee7038","name":"ModbusError","active":true,"console":"false","complete":"true","x":849.5000114440918,"y":1874.2500257492065,"wires":[]},{"id":"2814d0d3.759978","type":"function","z":"b65b888a.ee7038","name":"Health check","func":"var devicename = \"sdm220\"; // Device name used for context variable\nvar system_id = 3; // System id number for diagnostic update\nvar online_threshold = 10; // Seconds between updates under which the device is considered online\nvar offline_threshold = 30; // Seconds between updates above which the device is considered offline\n\nvar temp = context.get(devicename+\"_update\");\nvar current = new Date();\nmsg.payload = \"No data\";\nmsg.warning = false;\nif (msg.topic!==\"timecheck\") {\n    // Do not update the context if it is triggered by the check inject node\n    context.set(devicename+\"_update\",current);\n}\nif (temp===undefined) {\n    // this will be the case when node-red is booting up or redeployed\n    context.set(devicename+\"_update\",current);\n}\n\nif (temp!==undefined) {\n    current = current - temp;\n    current = Math.floor(current/1000);\n    var minute = Math.floor(current/60);\n    var hour = Math.floor(minute/60);\n    var day = Math.floor(hour/24);\n    if (current>24*60*60) {\n        msg.payload = \"Last update \" + day + \" days, \" + hour%24 + \" hours, \" + minute%60 + \" minutes, \" + current%60 + \" seconds ago\";\n    } else if (current>60*60) {\n        msg.payload = \"Last update \" + hour%24 + \" hours, \" + minute%60 + \" minutes, \" + current%60 + \" seconds ago\";\n    } else if (current>60) {\n        msg.payload = \"Last update \" + minute%60 + \" minutes, \" + current%60 + \" seconds ago\";\n    } else {\n        msg.payload = \"Last update \" + current%60 + \" seconds ago\";\n    }\n\n    if (context.get(devicename+\"_state\")!==1) {\n        if (current<online_threshold) {\n            msg.payload = \"SDM220 is now online\";\n            msg.system = system_id; // System id, use 1 for Dummy\n            msg.state = 1; // specify if the message is to change system status\n            msg.severity = 0; // 0: information, 1: warning, 2: error\n            //msg.email = true; // if separate email should be sent\n            //msg.emailtext = \"\"; this a long text which goes into the email  \n            msg.warning = true;\n            context.set(devicename+\"_state\",1);\n        }\n    } else {\n        if (current>offline_threshold) {\n            msg.payload = \"SDM220 is not transmitting\";\n            msg.system = system_id; // System id, use 1 for Dummy\n            msg.state = 99; // specify if the message is to change system status\n            msg.severity = 2; // 0: information, 1: warning, 2: error\n            //msg.email = true; // if separate email should be sent\n            //msg.emailtext = \"\"; this a long text which goes into the email            \n            msg.warning = true;\n            context.set(devicename+\"_state\",99);\n        }\n    }\n    \n    \n}\n\nnode.status({fill:\"blue\",shape:\"ring\",text:msg.payload});\n\nreturn msg;","outputs":1,"noerr":0,"x":530.0000038146973,"y":1793.0000009536743,"wires":[["b953cbd9.acd9a"]]},{"id":"9be88dc6.5eacf","type":"inject","z":"b65b888a.ee7038","name":"Check","topic":"timecheck","payload":"","payloadType":"date","repeat":"1","crontab":"","once":false,"x":314.00000381469727,"y":1805.0000009536743,"wires":[["2814d0d3.759978"]]},{"id":"b953cbd9.acd9a","type":"switch","z":"b65b888a.ee7038","name":"Update diag?","property":"warning","propertyType":"msg","rules":[{"t":"true"}],"checkall":"true","outputs":1,"x":725.0000038146973,"y":1793.0000009536743,"wires":[["43375f3d.51361"]]},{"id":"43375f3d.51361","type":"link out","z":"b65b888a.ee7038","name":"","links":["13e089a7.73cb46"],"x":844.3015766143799,"y":1792.5714044570923,"wires":[]},{"id":"985d24ca.5140c","type":"debug","z":"b65b888a.ee7038","name":"","active":true,"console":"false","complete":"false","x":498.00000381469727,"y":1249.0000009536743,"wires":[]},{"id":"d456a667.71d738","type":"function","z":"b65b888a.ee7038","name":"PowerFactor","func":"var rawData = new ArrayBuffer(4);\nvar intView = new Uint16Array(rawData);\nvar fltView = new Float32Array(rawData);\n\nintView[0] = msg.payload[1]; //low\nintView[1] = msg.payload[0]; //high\n\nmsg.payload = parseFloat(fltView[0].toFixed(1));\nmsg.topic = \"powerfactor\";\n\nnode.status({fill:\"blue\",shape:\"ring\",text:msg.topic + \":\" + msg.payload});    \n\nreturn msg;","outputs":1,"noerr":0,"x":515.5000038146973,"y":1543.0000009536743,"wires":[["28225fa4.9b49d8","2e67f38c.1e3fc4","a3786f37.aee2a8"]]},{"id":"d0cef747.e5ea08","type":"modbus-read","z":"b65b888a.ee7038","name":"SDM 220 PowerFactor","showStatusActivities":true,"showErrors":true,"unitid":"011","dataType":"InputRegister","adr":"30","quantity":"2","rate":"5","rateUnit":"s","server":"408cb596.0ecdfc","x":295.50000381469727,"y":1549.0000009536743,"wires":[["d456a667.71d738"],[]]},{"id":"28225fa4.9b49d8","type":"ui_text","z":"b65b888a.ee7038","group":"57345486.b86a3c","order":0,"width":0,"height":0,"name":"","label":"PowerFactor","format":"{{msg.payload}}","layout":"row-spread","x":708.5000038146973,"y":1544.0000009536743,"wires":[]},{"id":"bf8369de.9bdbd8","type":"function","z":"b65b888a.ee7038","name":"ApparentPower","func":"var rawData = new ArrayBuffer(4);\nvar intView = new Uint16Array(rawData);\nvar fltView = new Float32Array(rawData);\n\nintView[0] = msg.payload[1]; //low\nintView[1] = msg.payload[0]; //high\n\nmsg.payload = parseFloat(fltView[0].toFixed(1));\nmsg.topic = \"ApparentPower\";\n\nnode.status({fill:\"blue\",shape:\"ring\",text:msg.topic + \":\" + msg.payload});    \n\nreturn msg;","outputs":1,"noerr":0,"x":523.5000038146973,"y":1605.0000009536743,"wires":[["11b1d78b.184288","2e67f38c.1e3fc4","a3786f37.aee2a8"]]},{"id":"c4e390e8.a75c28","type":"modbus-read","z":"b65b888a.ee7038","name":"SDM 220 ApparentPower","showStatusActivities":true,"showErrors":true,"unitid":"011","dataType":"InputRegister","adr":"18","quantity":"2","rate":"5","rateUnit":"s","server":"408cb596.0ecdfc","x":303.50000381469727,"y":1611.0000009536743,"wires":[["bf8369de.9bdbd8"],[]]},{"id":"11b1d78b.184288","type":"ui_text","z":"b65b888a.ee7038","group":"57345486.b86a3c","order":0,"width":0,"height":0,"name":"","label":"ApparentPower","format":"{{msg.payload}} VA","layout":"row-spread","x":716.5000038146973,"y":1606.0000009536743,"wires":[]},{"id":"ade0970.00190e8","type":"debug","z":"b65b888a.ee7038","name":"DebugReceived","active":false,"console":"false","complete":"payload","x":1225.5000038146973,"y":1579.0000009536743,"wires":[]},{"id":"a3786f37.aee2a8","type":"function","z":"b65b888a.ee7038","name":"SplitValues","func":"//var topic = '/in/electricity/'+msg.payload.UnitID+'/';\nvar topic = '/in/electricity/11/'+msg.topic;\n/*var msg_voltage = { topic:topic+'voltage' , payload:msg.payload.Voltage};\nvar msg_amps = { topic:topic+'amps' , payload:msg.payload.Amps};\nvar msg_frequency = { topic:topic+'frequency' , payload:msg.payload.Frequency};\nvar msg_power = { topic:topic+'power' , payload:msg.payload.Power};\nvar msg_energy = { topic:topic+'energy' , payload:msg.payload.Energy};\nvar msg_powerFactor = { topic:topic+'powerFactor' , payload:msg.payload.PowerFactor};\nvar msg_apparentPower = { topic:topic+'apparentPower' , payload:msg.payload.ApparentPower};\n*/\n\nreturn {topic:topic, payload:msg.payload}\n/*\nnode.send(msg_voltage);\nnode.send(msg_amps);\nnode.send(msg_frequency);\nnode.send(msg_power);\nnode.send(msg_energy);\nnode.send(msg_powerFactor);\nnode.send(msg_apparentPower);\n\n\nvar msg2 = { topic:topic+'all' , payload:\"\"};\nmsg2.payload+='{\"voltage\":'+Math.round(msg.payload.Voltage)+'}';\n\nvar msg3 = { topic:\"emon/\"+msg.payload.UnitID+\"/voltage\" , payload:Math.round(msg.payload.Voltage)};\n\nreturn [null, msg2, msg3];\n*/","outputs":"1","noerr":0,"x":987.5000953674316,"y":1508.316590309143,"wires":[["ade0970.00190e8","526c5a14.90a20c"]]},{"id":"526c5a14.90a20c","type":"mqtt out","z":"b65b888a.ee7038","name":"SaveState1","topic":"","qos":"2","retain":"","broker":"e6d8a0f0.6f5878","x":1236.0500526428223,"y":1487.7666025161743,"wires":[]},{"id":"404b9289.d01074","type":"ui_template","z":"58e01940.99fb9","group":"36ab42a9.872cd6","name":"blue","order":4,"width":"2","height":"2","format":"\n<md-button class=\"vibrate filled touched bigfont rounded\" style=\"background-color:#2980b9\"   ng-click=\"send({payload: 'Hello World'})\"> \n    Blue<br/>button\n</md-button> \n\n","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":351,"y":216,"wires":[[]]},{"id":"fee6224a.216a48","type":"ui_template","z":"58e01940.99fb9","group":"36ab42a9.872cd6","name":"red","order":2,"width":"2","height":"2","format":"\n<md-button class=\"vibrate filled touched bigfont rounded\" style=\"background-color:#c0392b\" ng-click=\"send({payload: 'Hello World'})\"> \n    Red<br/>button\n</md-button> \n\n","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":351,"y":136,"wires":[[]]},{"id":"7b5cbae6.90ea2c","type":"ui_template","z":"58e01940.99fb9","group":"36ab42a9.872cd6","name":"green","order":3,"width":"2","height":"2","format":"\n<md-button class=\"filled touched bigfont rounded vibrate\" style=\"background-color:#27ae60\" ng-click=\"send({payload: 'Hello World'})\"> \n    Green<br/>button\n</md-button> \n\n","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":351,"y":176,"wires":[[]]},{"id":"5f49c5a6.ff3de4","type":"ui_template","z":"58e01940.99fb9","group":"36ab42a9.872cd6","name":"","order":5,"width":"2","height":"1","format":"\n<md-button class=\"vibrate filled touched smallfont rounded\" style=\"background-color:#16a085\"   ng-click=\"send({payload: 'Hello World'})\"> \n    Blue<br/>button\n</md-button> \n\n","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":361,"y":296,"wires":[[]]},{"id":"aef82f0b.00288","type":"ui_template","z":"58e01940.99fb9","group":"36ab42a9.872cd6","name":"","order":6,"width":"2","height":"1","format":"\n<md-button class=\"vibrate filled touched smallfont rounded\" style=\"background-color:#e67e22\" ng-click=\"send({payload: 'Hello World'})\"> \n    Red<br/>button\n</md-button> \n\n","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":361,"y":256,"wires":[[]]},{"id":"198168e0.f8222f","type":"ui_template","z":"58e01940.99fb9","group":"36ab42a9.872cd6","name":"on","order":7,"width":"1","height":"1","format":"\n<md-button class=\"vibrate filled touched smallfont rounded\" style=\"background-color:#34495e\" ng-click=\"send({payload: 'Hello World'})\"> \n    On\n</md-button> \n\n","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":351,"y":336,"wires":[[]]},{"id":"eec7e7fc.f88f3","type":"ui_template","z":"58e01940.99fb9","group":"36ab42a9.872cd6","name":"off","order":8,"width":"1","height":"1","format":"\n<md-button class=\"vibrate filled touched smallfont rounded\" style=\"background-color:#8e44ad\" ng-click=\"send({payload: 'Hello World'})\"> \n    Off\n</md-button> \n\n","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":351,"y":376,"wires":[[]]},{"id":"46b70c1f.77220c","type":"ui_template","z":"58e01940.99fb9","group":"36ab42a9.872cd6","name":"stuff","order":0,"width":"0","height":"0","format":"<style>\n  .filled { \n      height: 100% !important;\n\n      padding: 0 !important;\n      margin: 0 !important;\n  }\n  .nr-dashboard-template {\n      padding: 0;\n      margin: 0;\n  }\n  \n  .rounded {\n  border-radius: 12px 12px 12px 12px;\n}\n \n   .bigfont {\n  font-size: 18px;\n}\n\n   .smallfont {\n  font-size: 12px;\n}\n  \n</style>\n\n<script>\n$('.vibrate').on('click', function() {\n  navigator.vibrate(100);\n});\n\nfunction restore_bg(x) {\n            $(this).css(\"background-color\", x);\n    };\n\n$('.touched').on('mousedown', function() {\n    \n    var x= $(this).css(\"background-color\");\n    $(this).css(\"background-color\", \"yellow\");\n    \n    setTimeout(restore_bg.bind(this,x),100);\n    navigator.vibrate(80);\n    });\n    \n</script>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":231,"y":136,"wires":[[]]},{"id":"e0d53298.3508","type":"ui_template","z":"2dba819.654bb7e","group":"2428ec5c.a7feb4","name":"stuff","order":1,"width":"0","height":"0","format":"<style>\n  .filled { \n      height: 100% !important;\n\n      padding: 0 !important;\n      margin: 0 !important;\n  }\n  .nr-dashboard-template {\n      padding: 0;\n      margin: 0;\n  }\n  \n  .rounded {\n  border-radius: 12px 12px 12px 12px;\n}\n \n   .bigfont {\n  font-size: 18px;\n}\n\n   .smallfont {\n  font-size: 12px;\n}\n  \n</style>\n\n<script>\n$('.vibrate').on('click', function() {\n  navigator.vibrate(100);\n});\n\nfunction restore_bg(x) {\n            $(this).css(\"background-color\", x);\n    };\n\n$('.touched').on('mousedown', function() {\n    \n    var x= $(this).css(\"background-color\");\n    $(this).css(\"background-color\", \"yellow\");\n    \n    setTimeout(restore_bg.bind(this,x),100);\n    navigator.vibrate(80);\n    });\n    \n</script>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"global","x":823,"y":658,"wires":[[]]},{"id":"b3a2a40f.06f588","type":"function","z":"2dba819.654bb7e","name":"","func":"/*\n#\n# Event type specific variables:\n#\n# Zone:\n# ALARM_EVENT_ZONE_NAME          Zone Name\n# ALARM_EVENT_ZONE_FAULT         Zone Fault status: 1=Fault, 0=OK  \n# ALARM_EVENT_ZONE_TROUBLE       Zone Trouble status: 1=Trouble, 0=No Trouble \n# ALARM_EVENT_ZONE_TAMPER        Zone Tamper status: 1=Tamper, 0=No Tamper \n# ALARM_EVENT_ZONE_BYPASS        Zone Bypass status: 1=Bypassed, 0=Not Bypassed\n'Bypass enabled'\n'Bypass disabled'\n*/\n\n//destination will be last part node of topic\n//  /alarm/zone/*/FAULT\nvar tokens = msg.topic.split(\"/\");\nvar zone = tokens[tokens.length-1];\n\nvar static_topic='';\n\nif (msg.payload == 'Ok') {\n    var new_topic=static_topic+zone+'/fault';\n    flow.set('Zone'+zone+'.fault',msg.payload);\n} else if (msg.payload == 'Fault') {\n    var new_topic=static_topic+zone+'/fault';\n    flow.set('Zone'+zone+'.fault',msg.payload);\n} else if (msg.payload == 'Bypass enabled') {\n    var new_topic=static_topic+zone+'/bypass';\n    flow.set('Zone'+zone+'.bypass',msg.payload);\n} else if (msg.payload == 'Bypass disabled') {\n    var new_topic=static_topic+zone+'/bypass';\n    flow.set('Zone'+zone+'.bypass',msg.payload);\n}\n\nvar new_msg = { topic:'/status/alarm/zone/'+new_topic , payload:msg.payload};\n\nreturn new_msg;\n","outputs":1,"noerr":0,"x":1030,"y":720,"wires":[["e76ace91.afd2c","b9952d45.eb36c","69c11d60.1edb94"]]},{"id":"4ece531e.c298fc","type":"mqtt in","z":"2dba819.654bb7e","name":"ZoneStatusChange","topic":"in/nxgipd/zone/#","qos":"2","broker":"e6d8a0f0.6f5878","x":813,"y":732,"wires":[["b3a2a40f.06f588"]]},{"id":"e76ace91.afd2c","type":"debug","z":"2dba819.654bb7e","name":"","active":false,"console":"false","complete":"false","x":1294,"y":732,"wires":[]},{"id":"b9952d45.eb36c","type":"mqtt out","z":"2dba819.654bb7e","name":"SetZoneStatus","topic":"","qos":"","retain":"false","broker":"e6d8a0f0.6f5878","x":1213,"y":663,"wires":[]},{"id":"69c11d60.1edb94","type":"function","z":"2dba819.654bb7e","name":"testfunc","func":"msg.payload = (flow.get('Zone5.fault') === 'Ok') ? 'green' : 'red';\nreturn msg;","outputs":1,"noerr":0,"x":983,"y":808,"wires":[["5211eef4.c7fa08"]]},{"id":"5211eef4.c7fa08","type":"debug","z":"2dba819.654bb7e","name":"debug-testfunc","active":false,"console":"false","complete":"payload","x":1216,"y":809,"wires":[]},{"id":"b1562651.08d3c","type":"debug","z":"2dba819.654bb7e","name":"hello","active":false,"console":"false","complete":"payload","x":601,"y":631,"wires":[]},{"id":"58a0c517.4478cc","type":"mqtt in","z":"2dba819.654bb7e","name":"Zone020Status","topic":"/status/alarm/zone/20/#","qos":"2","broker":"e6d8a0f0.6f5878","x":274,"y":1649,"wires":[["874d3118.d4604","5e7cb5c1.e4f50c"]]},{"id":"874d3118.d4604","type":"ui_template","z":"2dba819.654bb7e","group":"9b6d8de1.d06a2","name":"Zone020b","order":21,"width":"4","height":"1","format":"\n<md-button class=\"vibrate filled touched bigfont rounded\"  ng-click=\"send({payload: 'Hello World'})\" ng-style=\"{this.Zone20}\"> \n    { Zone20.color }\n</md-button> \n\n<script>\n  var Zone20 = {\n        \"color\" : \"white\",\n        \"background-color\" : \"coral\"\n    }\n</script>\n","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":537,"y":1654,"wires":[[]]},{"id":"cb9e4db0.7ca87","type":"debug","z":"2dba819.654bb7e","name":"TRIGGERED","active":true,"console":"false","complete":"payload","x":692,"y":1728,"wires":[]},{"id":"5e7cb5c1.e4f50c","type":"function","z":"2dba819.654bb7e","name":"triggered","func":"msg.payload=\"{color:(\"+flow.get('Zone20.fault')+\" === 'Ok') ? 'black': 'red'}\";\n/*'background-color' : (flow.get('Zone20.bypass') === 'Bypass enabled') ? '#9bf0ff' : '#d6ff84' , */\n\nreturn msg;","outputs":1,"noerr":0,"x":441,"y":1759,"wires":[["cb9e4db0.7ca87"]]},{"id":"9a608ce7.1968b","type":"inject","z":"ac05e4f7.9c9b18","name":"","topic":"testtopic","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":125,"y":119,"wires":[["566eaf9a.fd9a"]]},{"id":"bdac6f2d.0ca49","type":"debug","z":"ac05e4f7.9c9b18","name":"","active":true,"console":"false","complete":"false","x":583,"y":131,"wires":[]},{"id":"ccf3d3b3.71fba","type":"function","z":"ac05e4f7.9c9b18","name":"func2","func":"/*var band = [\n  {firstName : 'John', lastName: 'Lennon'}, \n  {firstName : 'Paul', lastName: 'McCartney'}\n];\n\nfor(var member of band){\n  var tmp_msg = { topic:msg.topic ,  payload:member.firstName + ' ' + member.lastName}; \n//    node.send(tmp_msg);\n}\n*/\n\n//var Zone = {  };\nvar tmp = msg.payload.Alarm;\n//node.send({topic:'tmp',payload:tmp});\n//node.warn(\"debug1\");\nfor (var Zone in tmp ) {\n//node.warn(\"debug2\");\n    //var tmp_msg = { topic:msg.topic , payload:{id:Zone.id,name:Zone.name}};\n    var tmp_msg = { topic:msg.topic , payload:Zone};\n//    node.send(tmp_msg);\n//node.warn(\"debug2b\");\n    var tmp_msg = { topic:msg.topic , payload:tmp[Zone].name};\n//    node.send(tmp_msg);\n    tmp[Zone].name=tmp[Zone].name+\"modified\";\n    var tmp_msg = { topic:msg.topic , payload:tmp[Zone].name};\n//    node.send(tmp_msg);\n}\n//node.warn(\"debug3\");\n\nreturn msg;\n","outputs":1,"noerr":0,"x":448,"y":233,"wires":[["bdac6f2d.0ca49"]]},{"id":"566eaf9a.fd9a","type":"function","z":"ac05e4f7.9c9b18","name":"func1","func":"var max_zones=3;\nfunction Zone(id, name, isTriggered, isBypassed, isTampered, isTroubled) {\n    this.id = id;\n    this.name = name;\n    this.isTriggered = isTriggered;\n    this.isBypassed = isBypassed;\n    this.isTampered = isTampered;\n    this.isTroubled = isTroubled;\n}\n\n//Alarm = Zone[max_zones];\nAlarm={z1:{id: 1, name: \"Zone1\", isTriggered: false, isBypassed: false, isTampered: false, isTroubled: false }};\n\nAlarm1={Alarm};\nAlarm+={z2:{id: 2, name: \"Zone2\", isTriggered: false, isBypassed: false, isTampered: false, isTroubled: false }};\n//msg.payload={Alarm:{z1:{id: 1, name: \"Zone1\", isTriggered: false, isBypassed: false, isTampered: false, isTroubled: false }}};\n//msg.payload=msg.payload+{Alarm:{z2:{id: 2, name: \"Zone2\", isTriggered: false, isBypassed: false, isTampered: false, isTroubled: false }}};\n\nmsg.payload = {Alarm1};\n\n/*msg.payload = {\n    Alarm : {\n        z1:{id: 1, name: \"Zone1\", isTriggered: false, isBypassed: false, isTampered: false, isTroubled: false },\n        z2:{id: 2, name: \"Zone2\", isTriggered: false, isBypassed: false, isTampered: false, isTroubled: false }\n    }\n};\n*/\n\n/*msg.payload = {\n    Alarm : {\n        Zone1 : {id: 1, name: \"Zone1\", isTriggered: false, isBypassed: false, isTampered: false, isTroubled: false },\n        Zone2 : {id: 2, name: \"Zone2\", isTriggered: false, isBypassed: false, isTampered: false, isTroubled: false }\n    }\n};*/\nglobal.set('Alarm',msg.payload.Alarm);\nreturn msg;","outputs":1,"noerr":0,"x":327,"y":112,"wires":[["ccf3d3b3.71fba","bdac6f2d.0ca49"]]},{"id":"2af613b4.c71464","type":"ui_switch","z":"74cedccf.2b6a6c","name":"Pool Light","label":"Pool Light","group":"9ace3d17.d3c63","order":3,"width":"","height":"","passthru":false,"decouple":"true","topic":"cmnd/PoolLight/Power","onvalue":"1","onvalueType":"str","onicon":"","oncolor":"","offvalue":"0","offvalueType":"str","officon":"","offcolor":"","x":420,"y":2280,"wires":[["2d63266c.2ab0aa"]]},{"id":"90f58051.6df39","type":"mqtt in","z":"74cedccf.2b6a6c","name":"GetPoolLight","topic":"cmnd/PoolLight/Power","qos":"2","broker":"e6d8a0f0.6f5878","x":121,"y":2314,"wires":[["2af613b4.c71464"]]},{"id":"2d63266c.2ab0aa","type":"mqtt out","z":"74cedccf.2b6a6c","name":"SaveStatePoolLight","topic":"cmnd/PoolLight/Power","qos":"0","retain":"true","broker":"e6d8a0f0.6f5878","x":745.4999694824219,"y":2279,"wires":[]},{"id":"f473ea5a.41db9","type":"bigtimer","z":"74cedccf.2b6a6c","outtopic":"cmnd/PoolLight/Power","outpayload1":"1","outpayload2":"0","name":"Big Timer PoolLight","lat":"-25.8619229","lon":"28.1774539","starttime":"5005","endtime":"1380","startoff":"-30","endoff":0,"offs":0,"outtext1":"On","outtext2":"Off","timeout":1440,"sun":true,"mon":false,"tue":false,"wed":false,"thu":false,"fri":true,"sat":true,"jan":true,"feb":true,"mar":true,"apr":true,"may":true,"jun":true,"jul":true,"aug":true,"sep":true,"oct":true,"nov":true,"dec":true,"day1":0,"month1":0,"day2":0,"month2":0,"day3":0,"month3":0,"day4":0,"month4":0,"day5":0,"month5":0,"d1":0,"w1":0,"d2":0,"w2":0,"d3":0,"w3":0,"d4":0,"w4":0,"d5":0,"w5":0,"suspend":false,"random":false,"repeat":false,"atstart":true,"odd":false,"even":false,"x":415,"y":2368.999969482422,"wires":[["2d63266c.2ab0aa"],[],[]]},{"id":"9b45ae21.be3ad","type":"ui_button","z":"46e74d40.66d774","name":"AllGrass","group":"14fdd9e3.cf19d6","order":13,"width":0,"height":0,"passthru":false,"label":"Al die gras","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":291,"y":2018,"wires":[["e0de3a0.d8f73c8"]]},{"id":"e0de3a0.d8f73c8","type":"function","z":"46e74d40.66d774","name":"","func":"var TaskList = [];\n\nfunction addTask(duration, task) //duration of task in seconds. Task is the topic.\n{\n    TaskList.push({Task:task, State:'1', Duration:duration});\n    TaskList.push({Task:task, State:'0', Duration:0});\n}\n\nfunction doTaskList()\n{\n    if (TaskList.length > 0)\n    {\n        var swBesproeiingMains = global.get(\"db.BesproeiingMains\")||2;\n        var currentTask = TaskList[0];\n        //node.warn(\"Executing Task:\"+currentTask.Task+\" - State:\"+currentTask.State+\" - Duration:\"+currentTask.Duration);\n        msg.topic=currentTask.Task;\n        msg.payload=currentTask.State;\n        if (swBesproeiingMains==1) {\n            node.send(msg);\n        } else {\n            node.warn(\"BesproeiingMains is off. Not executing current task\");\n        }\n        //Remove task\n        TaskList.splice(0,1);\n        setTimeout(doTaskList, 1000*60*currentTask.Duration*context.global.ZoneTime+10);\n    } else {\n        node.warn(\"TaskList is Empty\");\n    }\n}\n\naddTask(1.1, \"/RS485/0D/Besproeiing/GrasSlaapkamers/state\");\naddTask(1, \"/RS485/0E/Besproeiing/BeddingsSwembad/state\");\naddTask(1, '/RS485/0C/Besproeiing/GrasTussenLapaBedding/state');\naddTask(1, '/RS485/10/Besproeiing/GrasSwembad/state');\naddTask(1, \"/RS485/17/Besproeiing/WeerskanteWasgoeddraad/state\");\naddTask(1, \"/RS485/12/Besproeiing/BadkamerKompos/state\");\naddTask(1, \"/RS485/14/Besproeiing/BoomhuisMiddelgras/state\");\n\n//addTask(1, \"/RS485/18/Besproeiing/LapaBeddings/state\");\n//addTask(1, \"/RS485/13/Besproeiing/GroenteBeddings/state\");\n\n\n\n\ndoTaskList();\n\n//return [null,msg2];","outputs":"1","noerr":0,"x":512,"y":2016,"wires":[["f7027cfd.920b5","19515051.3cf4a"]]},{"id":"f7027cfd.920b5","type":"debug","z":"46e74d40.66d774","name":"AlleGrasDebug","active":true,"console":"true","complete":"true","x":947.5,"y":1998,"wires":[]},{"id":"17b4fdc5.9eeec2","type":"ui_numeric","z":"46e74d40.66d774","name":"","label":"ZoneTime","group":"14fdd9e3.cf19d6","order":11,"width":0,"height":0,"passthru":false,"topic":"","format":"{{value}}","min":"0","max":"30","step":"1","x":291,"y":1953,"wires":[["cfb1dbf6.bba8b8"]]},{"id":"cfb1dbf6.bba8b8","type":"function","z":"46e74d40.66d774","name":"","func":"context.global.ZoneTime = msg.payload;\n\nreturn msg;","outputs":1,"noerr":0,"x":516,"y":1956,"wires":[["f7027cfd.920b5"]]},{"id":"19515051.3cf4a","type":"mqtt out","z":"46e74d40.66d774","name":"PubMsg","topic":"","qos":"2","retain":"false","broker":"e6d8a0f0.6f5878","x":950,"y":2133,"wires":[]},{"id":"1767c108.866e5f","type":"diode","z":"46e74d40.66d774","name":"WriteRS485Diode","x":405.5,"y":239,"wires":[["106ac630.7fc672"]]},{"id":"aec46f6.7913f9","type":"debug","z":"46e74d40.66d774","name":"MustDoDebug","active":false,"console":"true","complete":"true","x":425,"y":134,"wires":[]},{"id":"57d761a2.41445","type":"debug","z":"74cedccf.2b6a6c","name":"","active":false,"console":"false","complete":"false","x":695,"y":2015,"wires":[]},{"id":"df4173e9.1d5ab","type":"switch","z":"f68fa3d3.e3f83","name":"switch message type","property":"messageType","rules":[{"t":"eq","v":"0"},{"t":"eq","v":"1"},{"t":"eq","v":"2"},{"t":"eq","v":"3"},{"t":"eq","v":"4"}],"checkall":"true","outputs":5,"x":1280,"y":260,"wires":[["c6c0b4f1.4ff518"],["777317ec.d30f58"],["40cbab24.a1c994"],["88c8e3df.3b334"],["54c735d3.40e6ac"]]},{"id":"c6c0b4f1.4ff518","type":"function","z":"f68fa3d3.e3f83","name":"presentation","func":"msg.subTypeString = context.global.MYS.SString(msg.subType);\n\nmsg.topic = context.global.MYS.TOPIC_PREFIX + '/' + msg.controller + \"/\" + msg.nodeId + \"/\" + msg.childSensorId + \"/\" + msg.subTypeString;\n\nreturn msg;","outputs":1,"noerr":0,"x":1509.75,"y":122.74997138977051,"wires":[["1395034a.5c681d","32f6d037.38fc8"]]},{"id":"40cbab24.a1c994","type":"function","z":"f68fa3d3.e3f83","name":"req","func":"msg.topic = \"req\";\nreturn msg;","outputs":1,"noerr":0,"x":1505.3333740234375,"y":260.2499885559082,"wires":[["de615a4f.131a48","1395034a.5c681d"]]},{"id":"88c8e3df.3b334","type":"function","z":"f68fa3d3.e3f83","name":"internal","func":"msg.subTypeString = context.global.MYS.IString(msg.subType);\n\nmsg.topic = context.global.MYS.TOPIC_PREFIX + '/' + msg.controller + \"/\" + msg.nodeId + \"/\" + msg.childSensorId + \"/\" + msg.subTypeString;\n\nreturn msg;","outputs":1,"noerr":0,"x":1509.3333740234375,"y":310.4999885559082,"wires":[["1395034a.5c681d","c40159c8.ef0118","64204deb.736fc4"]]},{"id":"54c735d3.40e6ac","type":"function","z":"f68fa3d3.e3f83","name":"stream","func":"msg.topic = \"stream\";\nreturn msg;","outputs":1,"x":1517.3333740234375,"y":405.4999885559082,"wires":[[]]},{"id":"c40159c8.ef0118","type":"debug","z":"f68fa3d3.e3f83","name":"debug","active":true,"console":"false","complete":"true","x":1846.583351135254,"y":311.49998664855957,"wires":[]},{"id":"777317ec.d30f58","type":"function","z":"f68fa3d3.e3f83","name":"set","func":"msg.subTypeString = context.global.MYS.VString(msg.subType);\n\nmsg.topic = context.global.MYS.TOPIC_PREFIX + '/' + msg.controller + \"/\" + msg.nodeId + \"/\" + msg.childSensorId + \"/\" + msg.subTypeString;\n\n\nreturn msg;","outputs":1,"noerr":0,"x":1513,"y":184.99998664855957,"wires":[["1395034a.5c681d","bd2c3c80.f97f4"]]},{"id":"b9f4da06.4ef668","type":"debug","z":"f68fa3d3.e3f83","name":"","active":true,"console":"false","complete":"true","x":1239.7499771118164,"y":119.16667175292969,"wires":[]},{"id":"a9fc244f.d0d188","type":"function","z":"f68fa3d3.e3f83","name":"Split GW Message","func":"\n    var tokens = msg.payload.split(\";\")\n    \n    msg.rawData = tokens;\n    if(tokens.length >= 6)\n    {\n        msg.nodeId = parseInt(tokens[0]);\n        msg.childSensorId = parseInt(tokens[1]);\n        msg.messageType = parseInt(tokens[2]);\n        msg.ack = parseInt(tokens[3]);\n        msg.subType = parseInt(tokens[4]);\n        msg.payload = tokens[5];\n        for (j=6; j<tokens.length; j++) \n            msg.payload = msg.payload + ';' + tokens[j];\n    }\n\nreturn msg;","outputs":1,"noerr":0,"x":975.4999771118164,"y":213.16662788391113,"wires":[["df4173e9.1d5ab","b9f4da06.4ef668","14c5634b.a0d6dd"]]},{"id":"1395034a.5c681d","type":"mqtt out","z":"f68fa3d3.e3f83","name":"Publish to MQTT","topic":"","qos":"","retain":"","broker":"56fc61c8.bc429","x":1813.7499771118164,"y":69.6666431427002,"wires":[]},{"id":"64204deb.736fc4","type":"function","z":"f68fa3d3.e3f83","name":"hanlde internal messages","func":"//msg.subTypeString = \"\";\n//msg.topic = \"internal respones\";\n\nif (msg.subTypeString == 'I_TIME')\n{\n    var payload = parseInt(new Date().getTime()/1000);\n\tvar command = context.global.MYS.T_INTERNAL; \n\tvar acknowledge = 0; // no ack\n\tvar type = context.global.MYS.I_TIME; // I_TIME\n\tmsg.payload = context.global.MYS.encode(msg.nodeId, msg.childSensorId, command, acknowledge, type, payload);\n    return msg;\n    \n}\nelse if  (msg.subTypeString == 'I_ID_REQUEST')\n{\n    msg.topic = \"I_ID_RESPONSE\";\n    msg.subTypeString = \"I_ID_RESPONSE\";\n    // 255;255;3;0;4;8 for ID 8\n    var command = context.global.MYS.T_INTERNAL;\n\tvar acknowledge = 0; // no ack\n\tvar type = context.global.MYS.I_ID_RESPONSE; // I_ID_RESPONSE\n\n\tif (context.global.mysnextid[msg.controller] === undefined) {\n\t    payload = context.global.MYS.MIN_NODEID;\n\t}    \n\telse\n\t{\n\t    payload = context.global.mysnextid[msg.controller];\n\t}\n\t\n    msg.payload = context.global.MYS.encode(msg.nodeId, msg.childSensorId, command, acknowledge, type, payload);\n    return msg; \n} \nelse if  (msg.subTypeString == 'I_CONFIG')\n{\n    var payload = 'M';\n\tvar command = context.global.MYS.T_INTERNAL; \n\tvar acknowledge = 0; // no ack\n\tvar type = context.global.MYS.I_CONFIG; // I_TIME\n\tmsg.payload = context.global.MYS.encode(msg.nodeId, msg.childSensorId, command, acknowledge, type, payload);\n    return msg;\n}\nelse if  (msg.subTypeString == 'I_INCLUSION_MODE')\n{\n    // not yet implemented\n}\n\nreturn;\n\n\n","outputs":1,"noerr":0,"x":1715.75,"y":620.916675567627,"wires":[["c40159c8.ef0118","dabf85a6.13ffe8"]]},{"id":"f9e016fc.7d6af8","type":"inject","z":"f68fa3d3.e3f83","name":"Startup","topic":"","payload":"","payloadType":"str","repeat":"","crontab":"","once":true,"x":160.0833511352539,"y":126.9166431427002,"wires":[["1e3c4453.299a8c","bb55c04e.bca9"]]},{"id":"c26e58b1.6c2048","type":"function","z":"f68fa3d3.e3f83","name":"ToString","func":"// sometimes we are receiving a several messages in one packet\n// we should spit them and emit one by one\nvar outputMsg = [];\n\nmsg.payload = msg.payload || '';\n\nmsg.payload = msg.payload.toString();\nvar parts = msg.payload.split(\"\\n\");\nfor (var id in parts) {\n    var payload = parts[id].replace(/[\\n\\r]/g, '');\n    if (payload.length > 0) {\n        outputMsg.push({ \n            payload: payload, \n            controller: msg.controller\n        });\n    }\n}\n\nreturn [outputMsg];","outputs":1,"noerr":0,"x":789.0000381469727,"y":213.41667366027832,"wires":[["a9fc244f.d0d188"]]},{"id":"1e3c4453.299a8c","type":"function","z":"f68fa3d3.e3f83","name":"MYS Initialize","func":"function MySHelper() { \n\nMySHelper.prototype.TOPIC_PREFIX = \"MYS-NODERED\";\n\nMySHelper.prototype.MIN_NODEID = 10;\n\n\n// don't touch below :)\n    \nMySHelper.prototype.T_PRESENTATION                = 0;\nMySHelper.prototype.T_SET                         = 1;\nMySHelper.prototype.T_REQ                         = 2;\nMySHelper.prototype.T_INTERNAL                    = 3;\nMySHelper.prototype.T_STREAM                      = 4;\n\nMySHelper.prototype.I_BATTERY_LEVEL               = 0;\nMySHelper.prototype.I_TIME                        = 1;\nMySHelper.prototype.I_VERSION                     = 2;\nMySHelper.prototype.I_ID_REQUEST                  = 3;\nMySHelper.prototype.I_ID_RESPONSE                 = 4;\nMySHelper.prototype.I_INCLUSION_MODE              = 5;\nMySHelper.prototype.I_CONFIG                      = 6;\nMySHelper.prototype.I_PING                        = 7;\nMySHelper.prototype.I_PING_ACK                    = 8;\nMySHelper.prototype.I_LOG_MESSAGE                 = 9;\nMySHelper.prototype.I_CHILDREN                    = 10;\nMySHelper.prototype.I_SKETCH_NAME                 = 11;\nMySHelper.prototype.I_SKETCH_VERSION              = 12;\nMySHelper.prototype.I_REBOOT                      = 13;\nMySHelper.prototype.I_GATEWAY_READY               = 14;\nMySHelper.prototype.I_REQUEST_SIGNING             = 15;\nMySHelper.prototype.I_GET_NONCE                   = 16;\nMySHelper.prototype.I_GET_NONCE_RESPONSE          = 17;\nMySHelper.prototype.I_HEARTBEAT                   = 18;\nMySHelper.prototype.I_PRESENTATION                = 19;\n \nvar itype = {\nI_BATTERY_LEVEL:                    MySHelper.prototype.I_BATTERY_LEVEL,\nI_TIME:                             MySHelper.prototype.I_TIME,\nI_VERSION:                          MySHelper.prototype.I_VERSION,\nI_ID_REQUEST:                       MySHelper.prototype.I_ID_REQUEST,\nI_ID_RESPONSE:                      MySHelper.prototype.I_ID_RESPONSE,\nI_INCLUSION_MODE:                   MySHelper.prototype.I_INCLUSION_MODE,\nI_CONFIG:                           MySHelper.prototype.I_CONFIG,\nI_PING:                             MySHelper.prototype.I_PING,\nI_PING_ACK:                         MySHelper.prototype.I_PING_ACK,\nI_LOG_MESSAGE:                      MySHelper.prototype.I_LOG_MESSAGE,\nI_CHILDREN:                         MySHelper.prototype.I_CHILDREN,\nI_SKETCH_NAME:                      MySHelper.prototype.I_SKETCH_NAME,\nI_SKETCH_VERSION:                   MySHelper.prototype.I_SKETCH_VERSION,\nI_REBOOT:                           MySHelper.prototype.I_REBOOT,\nI_GATEWAY_READY:                    MySHelper.prototype.I_GATEWAY_READY,\nI_REQUEST_SIGNING:                  MySHelper.prototype.I_REQUEST_SIGNING,\nI_GET_NONCE:                        MySHelper.prototype.I_GET_NONCE,\nI_GET_NONCE_RESPONSE:               MySHelper.prototype.I_GET_NONCE_RESPONSE,\nI_HEARTBEAT:                        MySHelper.prototype.I_HEARTBEAT,\nI_PRESENTATION:                     MySHelper.prototype.I_PRESENTATION\n};\n\nMySHelper.prototype.IString = function(I_SUBTYPE) {\n    for (var prop in itype ) \n    if( itype[ prop ] === parseInt(I_SUBTYPE) )\n        return prop;\n};\n\nMySHelper.prototype.V_TEMP                = 0;\nMySHelper.prototype.V_HUM                 = 1;\nMySHelper.prototype.V_LIGHT               = 2;\nMySHelper.prototype.V_STATUS              = 2;\nMySHelper.prototype.V_DIMMER              = 3;\nMySHelper.prototype.V_PRESSURE            = 4;\nMySHelper.prototype.V_FORECAST            = 5;\nMySHelper.prototype.V_RAIN                = 6;\nMySHelper.prototype.V_RAINRATE            = 7;\nMySHelper.prototype.V_WIND                = 8;\nMySHelper.prototype.V_GUST                = 9;\nMySHelper.prototype.V_DIRECTION           = 10;\nMySHelper.prototype.V_UV                  = 11;\nMySHelper.prototype.V_WEIGHT              = 12;\nMySHelper.prototype.V_DISTANCE            = 13;\nMySHelper.prototype.V_IMPEDANCE           = 14;\nMySHelper.prototype.V_ARMED               = 15;\nMySHelper.prototype.V_TRIPPED             = 16;\nMySHelper.prototype.V_WATT                = 17;\nMySHelper.prototype.V_KWH                 = 18;\nMySHelper.prototype.V_SCENE_ON            = 19;\nMySHelper.prototype.V_SCENE_OFF           = 20;\nMySHelper.prototype.V_HEATER              = 21;\nMySHelper.prototype.V_HEATER_SW           = 22;\nMySHelper.prototype.V_LIGHT_LEVEL         = 23;\nMySHelper.prototype.V_VAR1                = 24;\nMySHelper.prototype.V_VAR2                = 25;\nMySHelper.prototype.V_VAR3                = 26;\nMySHelper.prototype.V_VAR4                = 27;\nMySHelper.prototype.V_VAR5                = 28;\nMySHelper.prototype.V_UP                  = 29;\nMySHelper.prototype.V_DOWN                = 30;\nMySHelper.prototype.V_STOP                = 31;\nMySHelper.prototype.V_IR_SEND             = 32;\nMySHelper.prototype.V_IR_RECEIVE          = 33;\nMySHelper.prototype.V_FLOW                = 34;\nMySHelper.prototype.V_VOLUME              = 35;\nMySHelper.prototype.V_LOCK_STATUS         = 36;\nMySHelper.prototype.V_LEVEL               = 37; \nMySHelper.prototype.V_VOLTAGE             = 38; \nMySHelper.prototype.V_CURRENT             = 39; \nMySHelper.prototype.V_RGB                 = 40; \nMySHelper.prototype.V_RGBW                = 41;\nMySHelper.prototype.V_ID                  = 42;\nMySHelper.prototype.V_UNIT_PREFIX         = 43;\nMySHelper.prototype.V_HVAC_SETPOINT_COOL  = 44;\nMySHelper.prototype.V_HVAC_SETPOINT_HEAT  = 45;\nMySHelper.prototype.V_HVAC_FLOW_MODE      = 46;\nMySHelper.prototype.V_TEXT                = 47;\nMySHelper.prototype.V_CUSTOM\t\t\t  = 48;\t//!< Custom messages used for controller/inter node specific commands, preferably using S_CUSTOM device type.\nMySHelper.prototype.V_POSITION\t\t  \t  = 49;\t//!< GPS position and altitude. Payload: latitude;longitude;altitude(m). E.g. \"55.722526;13.017972;18\"\nMySHelper.prototype.V_IR_RECORD\t\t\t  = 50;\t//!< Record IR codes S_IR for playback\nMySHelper.prototype.V_PH\t\t\t\t  = 51;\t//!< S_WATER_QUALITY, water PH\nMySHelper.prototype.V_ORP\t\t\t\t  = 52;\t//!< S_WATER_QUALITY, water ORP : redox potential in mV\nMySHelper.prototype.V_EC\t\t\t\t  = 53;\t//!< S_WATER_QUALITY, water electric conductivity ľS/cm (microSiemens/cm)\nMySHelper.prototype.V_VAR\t\t\t\t  = 54;\t//!< S_POWER, Reactive power: volt-ampere reactive (var)\nMySHelper.prototype.V_VA\t\t\t\t  = 55;\t//!< S_POWER, Apparent power: volt-ampere (VA)\nMySHelper.prototype.V_POWER_FACTOR\t\t  = 56;\t//!< S_POWER, Ratio of real power to apparent power: floating point value in the range [-1,..,1]\n\n\nvar vtype = {\nV_TEMP:              MySHelper.prototype.V_TEMP,\nV_HUM:               MySHelper.prototype.V_HUM,\nV_STATUS:            MySHelper.prototype.V_STATUS,\nV_LIGHT:             MySHelper.prototype.V_LIGHT,\nV_DIMMER:            MySHelper.prototype.V_DIMMER,\nV_PRESSURE:          MySHelper.prototype.V_PRESSURE,\nV_FORECAST:          MySHelper.prototype.V_FORECAST,\nV_RAIN:              MySHelper.prototype.V_RAIN,\nV_RAINRATE:          MySHelper.prototype.V_RAINRATE,\nV_WIND:              MySHelper.prototype.V_WIND,\nV_GUST:              MySHelper.prototype.V_GUST,\nV_DIRECTION:         MySHelper.prototype.V_DIRECTION,\nV_UV:                MySHelper.prototype.V_UV,\nV_WEIGHT:            MySHelper.prototype.V_WEIGHT,\nV_DISTANCE:          MySHelper.prototype.V_DISTANCE,\nV_IMPEDANCE:         MySHelper.prototype.V_IMPEDANCE,\nV_ARMED:             MySHelper.prototype.V_ARMED,\nV_TRIPPED:           MySHelper.prototype.V_TRIPPED,\nV_WATT:              MySHelper.prototype.V_WATT,\nV_KWH:               MySHelper.prototype.V_KWH,\nV_SCENE_ON:          MySHelper.prototype.V_SCENE_ON,\nV_SCENE_OFF:         MySHelper.prototype.V_SCENE_OFF,\nV_HEATER:            MySHelper.prototype.V_HEATER,\nV_HEATER_SW:         MySHelper.prototype.V_HEATER_SW,\nV_LIGHT_LEVEL:       MySHelper.prototype.V_LIGHT_LEVEL,\nV_VAR1:              MySHelper.prototype.V_VAR1,\nV_VAR2:              MySHelper.prototype.V_VAR2,\nV_VAR3:              MySHelper.prototype.V_VAR3,\nV_VAR4:              MySHelper.prototype.V_VAR4,\nV_VAR5:              MySHelper.prototype.V_VAR5,\nV_UP:                MySHelper.prototype.V_UP,\nV_DOWN:              MySHelper.prototype.V_DOWN,\nV_STOP:              MySHelper.prototype.V_STOP,\nV_IR_SEND:           MySHelper.prototype.V_IR_SEND,\nV_IR_RECEIVE:        MySHelper.prototype.V_IR_RECEIVE,\nV_FLOW:              MySHelper.prototype.V_FLOW,\nV_VOLUME:            MySHelper.prototype.V_VOLUME,\nV_LOCK_STATUS:       MySHelper.prototype.V_LOCK_STATUS,\nV_LEVEL:             MySHelper.prototype.V_LEVEL,\nV_VOLTAGE:           MySHelper.prototype.V_VOLTAGE, \nV_CURRENT:           MySHelper.prototype.V_CURRENT,\nV_RGB:               MySHelper.prototype.V_RGB,\nV_RGBW:              MySHelper.prototype.V_RGBW,\nV_ID:                MySHelper.prototype.V_ID,\nV_UNIT_PREFIX:       MySHelper.prototype.V_UNIT_PREFIX,\nV_HVAC_SETPOINT_COOL:MySHelper.prototype.V_HVAC_SETPOINT_COOL,\nV_HVAC_SETPOINT_HEAT:MySHelper.prototype.V_HVAC_SETPOINT_HEAT,\nV_HVAC_FLOW_MODE:    MySHelper.prototype.V_HVAC_FLOW_MODE,\nV_TEXT:              MySHelper.prototype.V_TEXT,\nV_CUSTOM:            MySHelper.prototype.V_CUSTOM,\t//!< Custom messages used for controller/inter node specific commands, preferably using S_CUSTOM device type.\nV_POSITION:\t\t\t MySHelper.prototype.V_POSITION,\t//!< GPS position and altitude. Payload: latitude;longitude;altitude(m). E.g. \"55.722526;13.017972;18\"\nV_IR_RECORD:\t\t MySHelper.prototype.V_IR_RECORD,\t//!< Record IR codes S_IR for playback\nV_PH:\t\t\t\t MySHelper.prototype.V_PH,\t//!< S_WATER_QUALITY, water PH\nV_ORP:\t\t\t\t MySHelper.prototype.V_ORP,\t//!< S_WATER_QUALITY, water ORP : redox potential in mV\nV_EC:\t\t\t\t MySHelper.prototype.V_EC,\t//!< S_WATER_QUALITY, water electric conductivity ľS/cm (microSiemens/cm)\nV_VAR:\t\t\t\t MySHelper.prototype.V_VAR,\t//!< S_POWER, Reactive power: volt-ampere reactive (var)\nV_VA:\t\t\t\t MySHelper.prototype.V_VA,\t//!< S_POWER, Apparent power: volt-ampere (VA)\nV_POWER_FACTOR:\t\t MySHelper.prototype.V_POWER_FACTOR\t//!< S_POWER, Ratio of real power to apparent power: floating point value in the range [-1,..,1]\n};\n\n\n\nMySHelper.prototype.VString = function(V_SUBTYPE) {\n    for (var prop in vtype ) \n    if( vtype[ prop ] === parseInt(V_SUBTYPE) )\n        return prop;\n};\n    \nMySHelper.prototype.VNum = function(V_SUBTYPE) {\n    sRet = vtype [V_SUBTYPE];\n    if (sRet === undefined)\n        sRet = V_SUBTYPE;\n    return sRet;\n}\n\nMySHelper.prototype.S_DOOR = 0; // Door sensor; V_TRIPPED; V_ARMED\nMySHelper.prototype.S_MOTION = 1;  // Motion sensor; V_TRIPPED; V_ARMED \nMySHelper.prototype.S_SMOKE = 2;  // Smoke sensor; V_TRIPPED; V_ARMED\nMySHelper.prototype.S_LIGHT = 3; // Binary light or relay; V_STATUS (or V_LIGHT); V_WATT\nMySHelper.prototype.S_BINARY = 3; // Binary light or relay; V_STATUS (or V_LIGHT); V_WATT (same as MySHelper.prototype.S_LIGHT)\nMySHelper.prototype.S_DIMMER = 4; // Dimmable light or fan device; V_STATUS (on/off); V_DIMMER (dimmer level 0-100); V_WATT\nMySHelper.prototype.S_COVER = 5; // Blinds or window cover; V_UP; V_DOWN; V_STOP; V_DIMMER (open/close to a percentage)\nMySHelper.prototype.S_TEMP = 6; // Temperature sensor; V_TEMP\nMySHelper.prototype.S_HUM = 7; // Humidity sensor; V_HUM\nMySHelper.prototype.S_BARO = 8; // Barometer sensor; V_PRESSURE; V_FORECAST\nMySHelper.prototype.S_WIND = 9; // Wind sensor; V_WIND; V_GUST\nMySHelper.prototype.S_RAIN = 10; // Rain sensor; V_RAIN; V_RAINRATE\nMySHelper.prototype.S_UV = 11; // Uv sensor; V_UV\nMySHelper.prototype.S_WEIGHT = 12; // Personal scale sensor; V_WEIGHT; V_IMPEDANCE\nMySHelper.prototype.S_POWER = 13; // Power meter; V_WATT; V_KWH\nMySHelper.prototype.S_HEATER = 14; // Header device; V_HVAC_SETPOINT_HEAT; V_HVAC_FLOW_STATE; V_TEMP\nMySHelper.prototype.S_DISTANCE = 15; // Distance sensor; V_DISTANCE\nMySHelper.prototype.S_LIGHT_LEVEL = 16; // Light level sensor; V_LIGHT_LEVEL (uncalibrated in percentage);  V_LEVEL (light level in lux)\nMySHelper.prototype.S_ARDUINO_NODE = 17 ; // Used (internally) for presenting a non-repeating Arduino node\nMySHelper.prototype.S_ARDUINO_REPEATER_NODE = 18; // Used (internally) for presenting a repeating Arduino node \nMySHelper.prototype.S_LOCK = 19; // Lock device; V_LOCK_STATUS\nMySHelper.prototype.S_IR = 20; // Ir device; V_IR_SEND; V_IR_RECEIVE\nMySHelper.prototype.S_WATER = 21; // Water meter; V_FLOW; V_VOLUME\nMySHelper.prototype.S_AIR_QUALITY = 22; // Air quality sensor; V_LEVEL\nMySHelper.prototype.S_CUSTOM = 23; // Custom sensor \nMySHelper.prototype.S_DUST = 24; // Dust sensor; V_LEVEL\nMySHelper.prototype.S_SCENE_CONTROLLER = 25; // Scene controller device; V_SCENE_ON; V_SCENE_OFF. \nMySHelper.prototype.S_RGB_LIGHT = 26; // RGB light. Send color component data using V_RGB. Also supports V_WATT \nMySHelper.prototype.S_RGBW_LIGHT = 27; // RGB light with an additional White component. Send data using V_RGBW. Also supports V_WATT\nMySHelper.prototype.S_COLOR_SENSOR = 28;  // Color sensor; send color information using V_RGB\nMySHelper.prototype.S_HVAC = 29; // Thermostat/HVAC device. V_HVAC_SETPOINT_HEAT; V_HVAC_SETPOINT_COLD; V_HVAC_FLOW_STATE; V_HVAC_FLOW_MODE; V_TEMP\nMySHelper.prototype.S_MULTIMETER = 30; // Multimeter device; V_VOLTAGE; V_CURRENT; V_IMPEDANCE \nMySHelper.prototype.S_SPRINKLER  = 31;  // Sprinkler; V_STATUS (turn on/off); V_TRIPPED (if fire detecting device)\nMySHelper.prototype.S_WATER_LEAK = 32; // Water leak sensor; V_TRIPPED; V_ARMED\nMySHelper.prototype.S_SOUND = 33; // Sound sensor; V_TRIPPED; V_ARMED; V_LEVEL (sound level in dB)\nMySHelper.prototype.S_VIBRATION = 34; // Vibration sensor; V_TRIPPED; V_ARMED; V_LEVEL (vibration in Hz)\nMySHelper.prototype.S_MOISTURE = 35; // Moisture sensor; V_TRIPPED; V_ARMED; V_LEVEL (water content or moisture in percentage?) \nMySHelper.prototype.S_INFO = 36; // LCD text device / Simple information device on controller; V_TEXT\nMySHelper.prototype.S_GAS = 37; // Gas meter; V_FLOW; V_VOLUME\nMySHelper.prototype.S_GPS = 38; // GPS Sensor; V_POSITION\nMySHelper.prototype.S_WATER_QUALITY\t= 39;\t//!< V_TEMP, V_PH, V_ORP, V_EC, V_STATUS \n\nvar stype = {\nS_DOOR:                 MySHelper.prototype.S_DOOR, // Door sensor; V_TRIPPED; V_ARMED\nS_MOTION:               MySHelper.prototype.S_MOTION,  // Motion sensor; V_TRIPPED; V_ARMED \nS_SMOKE:                MySHelper.prototype.S_SMOKE,  // Smoke sensor; V_TRIPPED; V_ARMED\nS_LIGHT:                MySHelper.prototype.S_LIGHT, // Binary light or relay; V_STATUS (or V_LIGHT); V_WATT\nS_BINARY:               MySHelper.prototype.S_BINARY, // Binary light or relay; V_STATUS (or V_LIGHT); V_WATT (same as MySHelper.prototype.S_LIGHT)\nS_DIMMER:               MySHelper.prototype.S_DIMMER, // Dimmable light or fan device; V_STATUS (on/off); V_DIMMER (dimmer level 0-100); V_WATT\nS_COVER:                MySHelper.prototype.S_COVER, // Blinds or window cover; V_UP; V_DOWN; V_STOP; V_DIMMER (open/close to a percentage)\nS_TEMP:                 MySHelper.prototype.S_TEMP, // Temperature sensor; V_TEMP\nS_HUM:                  MySHelper.prototype.S_HUM, // Humidity sensor; V_HUM\nS_BARO:                 MySHelper.prototype.S_BARO, // Barometer sensor; V_PRESSURE; V_FORECAST\nS_WIND:                 MySHelper.prototype.S_WIND, // Wind sensor; V_WIND; V_GUST\nS_RAIN:                 MySHelper.prototype.S_RAIN, // Rain sensor; V_RAIN; V_RAINRATE\nS_UV:                   MySHelper.prototype.S_UV, // Uv sensor; V_UV\nS_WEIGHT:               MySHelper.prototype.S_WEIGHT, // Personal scale sensor; V_WEIGHT; V_IMPEDANCE\nS_POWER:                MySHelper.prototype.S_POWER, // Power meter; V_WATT; V_KWH\nS_HEATER:               MySHelper.prototype.S_HEATER, // Header device; V_HVAC_SETPOINT_HEAT; V_HVAC_FLOW_STATE; V_TEMP\nS_DISTANCE:             MySHelper.prototype.S_DISTANCE, // Distance sensor; V_DISTANCE\nS_LIGHT_LEVEL:          MySHelper.prototype.S_LIGHT_LEVEL, // Light level sensor; V_LIGHT_LEVEL (uncalibrated in percentage);  V_LEVEL (light level in lux)\nS_ARDUINO_NODE:         MySHelper.prototype.S_ARDUINO_NODE, // Used (internally) for presenting a non-repeating Arduino node\nS_ARDUINO_REPEATER_NODE:MySHelper.prototype.S_ARDUINO_REPEATER_NODE, // Used (internally) for presenting a repeating Arduino node \nS_LOCK:                 MySHelper.prototype.S_LOCK, // Lock device; V_LOCK_STATUS\nS_IR:                   MySHelper.prototype.S_IR, // Ir device; V_IR_SEND; V_IR_RECEIVE\nS_WATER:                MySHelper.prototype.S_WATER, // Water meter; V_FLOW; V_VOLUME\nS_AIR_QUALITY:          MySHelper.prototype.S_AIR_QUALITY, // Air quality sensor; V_LEVEL\nS_CUSTOM:               MySHelper.prototype.S_CUSTOM, // Custom sensor \nS_DUST:                 MySHelper.prototype.S_DUST, // Dust sensor; V_LEVEL\nS_SCENE_CONTROLLER:     MySHelper.prototype.S_SCENE_CONTROLLER, // Scene controller device; V_SCENE_ON; V_SCENE_OFF. \nS_RGB_LIGHT:            MySHelper.prototype.S_RGB_LIGHT, // RGB light. Send color component data using V_RGB. Also supports V_WATT \nS_RGBW_LIGHT:           MySHelper.prototype.S_RGBW_LIGHT, // RGB light with an additional White component. Send data using V_RGBW. Also supports V_WATT\nS_COLOR_SENSOR:         MySHelper.prototype.S_COLOR_SENSOR,  // Color sensor; send color information using V_RGB\nS_HVAC:                 MySHelper.prototype.S_HVAC, // Thermostat/HVAC device. V_HVAC_SETPOINT_HEAT; V_HVAC_SETPOINT_COLD; V_HVAC_FLOW_STATE; V_HVAC_FLOW_MODE; V_TEMP\nS_MULTIMETER:           MySHelper.prototype.S_MULTIMETER, // Multimeter device; V_VOLTAGE; V_CURRENT; V_IMPEDANCE \nS_SPRINKLER:            MySHelper.prototype.S_SPRINKLER,  // Sprinkler; V_STATUS (turn on/off); V_TRIPPED (if fire detecting device)\nS_WATER_LEAK:           MySHelper.prototype.S_WATER_LEAK, // Water leak sensor; V_TRIPPED; V_ARMED\nS_SOUND:                MySHelper.prototype.S_SOUND, // Sound sensor; V_TRIPPED; V_ARMED; V_LEVEL (sound level in dB)\nS_VIBRATION:            MySHelper.prototype.S_VIBRATION, // Vibration sensor; V_TRIPPED; V_ARMED; V_LEVEL (vibration in Hz)\nS_MOISTURE:             MySHelper.prototype.S_MOISTURE, // Moisture sensor; V_TRIPPED; V_ARMED; V_LEVEL (water content or moisture in percentage?) \nS_INFO:                 MySHelper.prototype.S_INFO, // LCD text device / Simple information device on controller; V_TEXT\nS_GAS:                  MySHelper.prototype.S_GAS, // Gas meter; V_FLOW; V_VOLUME\nS_GPS:                  MySHelper.prototype.S_GPS, // GPS Sensor; V_POSITION\nS_WATER_QUALITY:        MySHelper.prototype.S_WATER_QUALITY // GPS Sensor; V_POSITION\n};\n\nMySHelper.prototype.SString = function(S_SUBTYPE) {\n    for (var prop in stype ) \n    if( stype[ prop ] === parseInt(S_SUBTYPE) )\n        return prop;\n};    \n    \n MySHelper.prototype.encode = function(destination, sensor, command, acknowledge, type, payload) {\n\tvar msg = destination.toString(10) + \";\" + sensor.toString(10) + \";\" + command.toString(10) + \";\" + acknowledge.toString(10) + \";\" + type.toString(10) + \";\";\n\tif (command == 4) {\n\t\tfor (var i = 0; i < payload.length; i++) {\n\t\t\tif (payload[i] < 16)\n\t\t\t\tmsg += \"0\";\n\t\t\tmsg += payload[i].toString(16);\n\t\t}\n\t} else {\n\t\tmsg += payload;\n\t}\n\tmsg += '\\n';\n\treturn msg.toString();\n}\n}\n\n\nvar MySHelperObj = new MySHelper();\n\ncontext.global.MYS = MySHelperObj;\n\nreturn msg;","outputs":1,"noerr":0,"x":416.0833511352539,"y":119.49998664855957,"wires":[[]]},{"id":"2550c9f0.220e66","type":"function","z":"f68fa3d3.e3f83","name":"Set Controller 1","func":"msg.controller = 1\n\nreturn msg;","outputs":1,"noerr":0,"x":614.8333511352539,"y":213.99998664855957,"wires":[["c26e58b1.6c2048"]]},{"id":"dabf85a6.13ffe8","type":"switch","z":"f68fa3d3.e3f83","name":"route to controller n","property":"controller","rules":[{"t":"eq","v":"1"},{"t":"eq","v":"2"},{"t":"eq","v":"3"},{"t":"eq","v":"4"}],"checkall":"false","outputs":4,"x":1810,"y":800,"wires":[["39030285.e62b7e","1a43aa04.8360a6"],[],[],[]]},{"id":"bb55c04e.bca9","type":"file in","z":"f68fa3d3.e3f83","name":"read store for next ids","filename":"/home/pi/mysids.dump","format":"utf8","sendError":true,"x":436.8333511352539,"y":165.49998664855957,"wires":[["1274ac95.d5c443"]]},{"id":"1274ac95.d5c443","type":"function","z":"f68fa3d3.e3f83","name":"store to context.global.mysnextid","func":"if (msg.payload === undefined) {\n          var mysnextid = {};\n\n        obj = mysnextid;  \n}\nelse \n{\ntry{\n        obj = JSON.parse(msg.payload);\n    }\n    catch(e){\n        \n        var mysnextid = {};\n\n        obj = mysnextid;\n        \n    }\n}    \n\ncontext.global.mysnextid = obj;\n\nmsg.payload = context.global.mysnextid;\n\nreturn msg;","outputs":1,"noerr":0,"x":678.8333511352539,"y":130.49998664855957,"wires":[[]]},{"id":"468827e0.2263d8","type":"file","z":"f68fa3d3.e3f83","name":"dump mysids","filename":"mysids.dump","appendNewline":true,"createDir":false,"overwriteFile":"true","x":1493.833351135254,"y":459.4999828338623,"wires":[[]]},{"id":"14c5634b.a0d6dd","type":"function","z":"f68fa3d3.e3f83","name":"handle nextids","func":"// increase nextid, if nodeid >= nextid \n// node.log(\"Handling next ids\");\n// node.log(\"nodeId: \" + msg.nodeId);\n\nbChanged = false;\n\nif (msg.nodeId === 0) return;\n\nif (msg.nodeId < 255)\n{\n    // node.log(\"Test if next node-id must be set\");\n    if (context.global.mysnextid[msg.controller] === undefined) {\n        node.log(\"node-id not initialized yet\");\n        context.global.mysnextid[msg.controller] = msg.nodeId+1;\n        if (context.global.mysnextid[msg.controller] < context.global.MYS.MIN_NODEID)\n            context.global.mysnextid[msg.controller] = context.global.MYS.MIN_NODEID;\n        bChanged = true;\n    }\n    \n    // node.log(\"Nexid stored \" + parseInt(context.global.mysnextid[msg.controller]));\n    \n    if (msg.nodeId >= parseInt(context.global.mysnextid[msg.controller])) {\n        node.log(\"node-id >= next -> increase\");\n        // convert to int\n        context.global.mysnextid[msg.controller] = parseInt(context.global.mysnextid[msg.controller]);\n        context.global.mysnextid[msg.controller] = msg.nodeId+1; \n        if (context.global.mysnextid[msg.controller] < context.global.MYS.MIN_NODEID)\n            context.global.mysnextid[msg.controller] = context.global.MYS.MIN_NODEID;\n        bChanged = true;\n    }\n\n    if (bChanged) {\n        node.log(\"next id must be stored\");\n        msg.payload = JSON.stringify(context.global.mysnextid);   \n        return msg;\n    }\n}\n\n\n","outputs":1,"noerr":0,"x":1282.833351135254,"y":452.4999828338623,"wires":[["468827e0.2263d8","e0da19aa.9a8a18"]]},{"id":"e0da19aa.9a8a18","type":"debug","z":"f68fa3d3.e3f83","name":"","active":true,"console":"false","complete":"false","x":1474.833351135254,"y":621.4999828338623,"wires":[]},{"id":"23d97c53.249724","type":"serial in","z":"f68fa3d3.e3f83","name":"MySensors Gateway Mega2560","serial":"a0c03515.da6558","x":170,"y":320,"wires":[["2550c9f0.220e66","685838dc.7dfcd8"]]},{"id":"39030285.e62b7e","type":"serial out","z":"f68fa3d3.e3f83","name":"MySensors Gateway Mega2560 Write","serial":"a0c03515.da6558","x":2250,"y":740,"wires":[]},{"id":"32f6d037.38fc8","type":"debug","z":"f68fa3d3.e3f83","name":"debug","active":true,"console":"false","complete":"true","x":1843.833351135254,"y":122.49998664855957,"wires":[]},{"id":"bd2c3c80.f97f4","type":"debug","z":"f68fa3d3.e3f83","name":"debug","active":true,"console":"false","complete":"true","x":1843.833351135254,"y":189.49998664855957,"wires":[]},{"id":"de615a4f.131a48","type":"debug","z":"f68fa3d3.e3f83","name":"debug","active":true,"console":"false","complete":"true","x":1853.833351135254,"y":262.49998664855957,"wires":[]},{"id":"134dd88d.0105a7","type":"mqtt in","z":"f68fa3d3.e3f83","name":"From Outside","topic":"MYS-NODERED/+/+/+/+/SET","qos":"2","broker":"56fc61c8.bc429","x":134.3333511352539,"y":72.49998664855957,"wires":[["31577633.d7690a"]]},{"id":"a8cd84db.06aff8","type":"debug","z":"f68fa3d3.e3f83","name":"Dump from MQTT","active":false,"console":"false","complete":"true","x":694.3333511352539,"y":71.49998664855957,"wires":[]},{"id":"31577633.d7690a","type":"function","z":"f68fa3d3.e3f83","name":"Parse","func":"// msg.topic = context.global.MYS.TOPIC_PREFIX + '/' + msg.controller + \"/\" + msg.nodeId + \"/\" + msg.childSensorId + \"/\" + msg.subTypeString;\n\n\n    var tokens = msg.topic.split(\"/\");\n    \n    msg.rawData = tokens;\n    if(tokens.length >= 5)\n    {\n        msg.controller = parseInt(tokens[1]);\n        msg.nodeId = parseInt(tokens[2]);\n        msg.childSensorId = parseInt(tokens[3]);\n        msg.subTypeString = tokens[4];\n        msg.subType = context.global.MYS.VNum(msg.subTypeString);\n        msg.command = 1; // SET\n        msg.acknowledge = 0; // no ack as default\n    }\n\nreturn msg;","outputs":1,"noerr":0,"x":313.3333511352539,"y":72.49998664855957,"wires":[["a8cd84db.06aff8","41f0bb73.663704"]]},{"id":"41f0bb73.663704","type":"function","z":"f68fa3d3.e3f83","name":"Send to Gateway","func":"msg.payload = context.global.MYS.encode(msg.nodeId, msg.childSensorId, msg.command, msg.acknowledge, msg.subType, msg.payload);\n\n//msg.payload = msg.nodeId + ' ' + msg.childSensorId + ' ' + msg.command;\n//msg.childSensorId, msg.command, msg.acknowledge, msg.subType, msg.payload);\n\n    \nreturn msg;","outputs":1,"noerr":0,"x":950,"y":620,"wires":[["1a43aa04.8360a6","dabf85a6.13ffe8"]]},{"id":"1a43aa04.8360a6","type":"debug","z":"f68fa3d3.e3f83","name":"Serial","active":true,"console":"false","complete":"true","x":1970,"y":720,"wires":[]},{"id":"b486a9b8.163538","type":"inject","z":"f68fa3d3.e3f83","name":"","topic":"Test","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":240,"y":460,"wires":[["bfae724f.6098c"]]},{"id":"bfae724f.6098c","type":"function","z":"f68fa3d3.e3f83","name":"Set Relay On","func":"msg.controller = 1;\nmsg.nodeId = 14;\nmsg.childSensorId = 2;\nmsg.subTypeString = 'V_LIGHT';\nmsg.subType = context.global.MYS.VNum(msg.subTypeString);\nmsg.command = 1; // SET\nmsg.acknowledge = 0; // no ack as default\nmsg.payload = 1;\nreturn msg;","outputs":1,"noerr":0,"x":373,"y":459,"wires":[["41f0bb73.663704"]]},{"id":"151fddeb.1693c2","type":"function","z":"f68fa3d3.e3f83","name":"Set Relay Off","func":"msg.controller = 1;\nmsg.nodeId = 14;\nmsg.childSensorId = 2;\nmsg.subTypeString = 'V_LIGHT';\nmsg.subType = context.global.MYS.VNum(msg.subTypeString);\nmsg.command = 1; // SET\nmsg.acknowledge = 0; // no ack as default\nmsg.payload = 0;\nreturn msg;","outputs":1,"noerr":0,"x":366.5,"y":498,"wires":[["41f0bb73.663704"]]},{"id":"9f519b67.c35368","type":"inject","z":"f68fa3d3.e3f83","name":"","topic":"Test","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":222.5,"y":496,"wires":[["151fddeb.1693c2"]]},{"id":"890861ff.e89ce","type":"inject","z":"f68fa3d3.e3f83","name":"","topic":"Test","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":225.5,"y":547,"wires":[["f20b4209.127dd"]]},{"id":"f20b4209.127dd","type":"function","z":"f68fa3d3.e3f83","name":"Set Relay 2 On","func":"msg.controller = 1;\nmsg.nodeId = 14;\nmsg.childSensorId = 3;\nmsg.subTypeString = 'V_LIGHT';\nmsg.subType = context.global.MYS.VNum(msg.subTypeString);\nmsg.command = 1; // SET\nmsg.acknowledge = 0; // no ack as default\nmsg.payload = 1;\nreturn msg;","outputs":1,"noerr":0,"x":368.5,"y":546,"wires":[["41f0bb73.663704"]]},{"id":"a308c965.068628","type":"function","z":"f68fa3d3.e3f83","name":"Set Relay 2 Off","func":"msg.controller = 1;\nmsg.nodeId = 14;\nmsg.childSensorId = 2;\nmsg.subTypeString = 'V_LIGHT';\nmsg.subType = context.global.MYS.VNum(msg.subTypeString);\nmsg.command = 1; // SET\nmsg.acknowledge = 0; // no ack as default\nmsg.payload = 0;\nreturn msg;","outputs":1,"noerr":0,"x":374,"y":585,"wires":[["41f0bb73.663704"]]},{"id":"7eac0d56.e00ac4","type":"inject","z":"f68fa3d3.e3f83","name":"","topic":"Test","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":208,"y":583,"wires":[["a308c965.068628"]]},{"id":"685838dc.7dfcd8","type":"debug","z":"f68fa3d3.e3f83","name":"","active":true,"console":"false","complete":"true","x":954.8333511352539,"y":172.49998664855957,"wires":[]},{"id":"6c86fc5f.597d54","type":"mqtt in","z":"f68fa3d3.e3f83","name":"From Outside","topic":"MYS-NODERED/+/+/+/+/+","qos":"2","broker":"56fc61c8.bc429","x":130,"y":20,"wires":[["a105531f.3fb99"]]},{"id":"ecc26f27.1a142","type":"debug","z":"f68fa3d3.e3f83","name":"listenMQTT","active":true,"console":"false","complete":"payload","x":1210,"y":20,"wires":[]},{"id":"3ee0ee35.681dc2","type":"mqtt in","z":"f68fa3d3.e3f83","name":"From Outside","topic":"gw1-out/#","qos":"2","broker":"56fc61c8.bc429","x":970,"y":20,"wires":[["ecc26f27.1a142"]]},{"id":"3b8a4bbb.d39904","type":"mqtt in","z":"f68fa3d3.e3f83","name":"From Outside","topic":"MYS-NODERED/#","qos":"2","broker":"56fc61c8.bc429","x":970,"y":60,"wires":[["ecc26f27.1a142"]]},{"id":"a105531f.3fb99","type":"debug","z":"f68fa3d3.e3f83","name":"DEBUG from MQTT","active":true,"console":"false","complete":"true","x":720,"y":20,"wires":[]},{"id":"53e14b19.14dcc4","type":"ui_colour_picker","z":"2c79f7b9.40b25","name":"Color Picker","label":"COLOR PICKER","group":"5c45879e.172aa8","format":"hex","outformat":"string","showSwatch":true,"showPicker":true,"showValue":true,"showAlpha":true,"showLightness":true,"order":1,"width":0,"height":0,"passthru":true,"topic":"","x":265,"y":547.0000152587891,"wires":[["849a3526.70e348"]]},{"id":"849a3526.70e348","type":"function","z":"2c79f7b9.40b25","name":"Format Color","func":"msg.payload = {\"hex\":msg.payload};\nreturn msg;\n","outputs":1,"noerr":0,"x":460,"y":539.0000152587891,"wires":[["c03eddcf.d901c"]]},{"id":"3ea75e3f.12c3ca","type":"ui_slider","z":"2c79f7b9.40b25","name":"Set Temperature","label":"SET TEMPERATURE","group":"5c45879e.172aa8","order":3,"width":0,"height":0,"passthru":true,"topic":"","min":"1700","max":"6500","step":"10","x":285,"y":638.0000152587891,"wires":[["b2416f14.0bb4e"]]},{"id":"415ae979.f89c98","type":"ui_slider","z":"2c79f7b9.40b25","name":"Set Brightness","label":"SET BRIGHTNESS","group":"5c45879e.172aa8","order":2,"width":0,"height":0,"passthru":true,"topic":"","min":"0","max":"255","step":1,"x":276,"y":595.0000152587891,"wires":[["c6581648.427b78"]]},{"id":"b3d24882.b1b828","type":"ui_switch","z":"d7aa7eb2.229b","name":"ALL_LIGHTS","label":"All Lights","group":"785a2ca0.c143a4","order":2,"width":"","height":"","passthru":false,"decouple":"false","topic":"/db/lights/all","onvalue":"1","onvalueType":"str","onicon":"","oncolor":"","offvalue":"0","offvalueType":"str","officon":"","offcolor":"","x":557,"y":267,"wires":[["e363b2af.f5f8f"]]},{"id":"fd785335.65579","type":"mqtt in","z":"d7aa7eb2.229b","name":"ReadState","topic":"/db/lights/all","qos":"2","broker":"e6d8a0f0.6f5878","x":264,"y":266,"wires":[["b3d24882.b1b828"]]},{"id":"e363b2af.f5f8f","type":"mqtt out","z":"d7aa7eb2.229b","name":"SaveState","topic":"","qos":"2","retain":"","broker":"e6d8a0f0.6f5878","x":967.5,"y":265,"wires":[]},{"id":"a71b05c4.1b4e58","type":"comment","z":"d7aa7eb2.229b","name":"Groupings","info":"","x":110,"y":144,"wires":[]},{"id":"dc0867b4.f7fde8","type":"ui_switch","z":"d7aa7eb2.229b","name":"OUTDOOR_LIGHTS","label":"Outdoor Lights","group":"785a2ca0.c143a4","order":3,"width":"","height":"","passthru":false,"decouple":"false","topic":"/db/lights/outdoor","onvalue":"1","onvalueType":"str","onicon":"","oncolor":"","offvalue":"0","offvalueType":"str","officon":"","offcolor":"","x":492,"y":402,"wires":[["55833376.e808ec"]]},{"id":"f9e51f91.da5b5","type":"mqtt in","z":"d7aa7eb2.229b","name":"ReadState","topic":"/db/lights/outdoor","qos":"2","broker":"e6d8a0f0.6f5878","x":220,"y":363,"wires":[["dc0867b4.f7fde8"]]},{"id":"55833376.e808ec","type":"mqtt out","z":"d7aa7eb2.229b","name":"SaveState","topic":"","qos":"2","retain":"","broker":"e6d8a0f0.6f5878","x":725.5,"y":388,"wires":[]},{"id":"a09e5625.178ca8","type":"ui_switch","z":"d7aa7eb2.229b","name":"INDOOR_LIGHTS","label":"Indoor Lights","group":"785a2ca0.c143a4","order":4,"width":"","height":"","passthru":false,"decouple":"false","topic":"/db/lights/indoor","onvalue":"1","onvalueType":"str","onicon":"","oncolor":"","offvalue":"0","offvalueType":"str","officon":"","offcolor":"","x":480,"y":467,"wires":[["2e42ebbb.c86624"]]},{"id":"e753405f.3a5ad","type":"mqtt in","z":"d7aa7eb2.229b","name":"ReadState","topic":"/db/lights/indoor","qos":"2","broker":"e6d8a0f0.6f5878","x":218,"y":428,"wires":[["a09e5625.178ca8"]]},{"id":"2e42ebbb.c86624","type":"mqtt out","z":"d7aa7eb2.229b","name":"SaveState","topic":"","qos":"2","retain":"","broker":"e6d8a0f0.6f5878","x":719.5,"y":458,"wires":[]},{"id":"b2a2dadc.41e578","type":"ui_switch","z":"d7aa7eb2.229b","name":"SECURITY_LIGHTS","label":"Security Lights","group":"785a2ca0.c143a4","order":5,"width":"","height":"","passthru":false,"decouple":"false","topic":"/db/lights/security","onvalue":"1","onvalueType":"str","onicon":"","oncolor":"","offvalue":"0","offvalueType":"str","officon":"","offcolor":"","x":490,"y":532,"wires":[["6f9e02d7.9fd88c"]]},{"id":"b0882471.952648","type":"mqtt in","z":"d7aa7eb2.229b","name":"ReadState","topic":"/db/lights/security","qos":"2","broker":"e6d8a0f0.6f5878","x":218,"y":493,"wires":[["b2a2dadc.41e578"]]},{"id":"6f9e02d7.9fd88c","type":"mqtt out","z":"d7aa7eb2.229b","name":"SaveState","topic":"","qos":"2","retain":"","broker":"e6d8a0f0.6f5878","x":731.5,"y":516,"wires":[]},{"id":"5aaac007.705fe","type":"comment","z":"d7aa7eb2.229b","name":"Pool","info":"","x":70,"y":860,"wires":[]},{"id":"362b2e7.a85f8d2","type":"ui_switch","z":"d7aa7eb2.229b","name":"MAIN","label":"Main","group":"785a2ca0.c143a4","order":1,"width":"","height":"","passthru":false,"decouple":"false","topic":"/db/main","onvalue":"1","onvalueType":"str","onicon":"","oncolor":"","offvalue":"0","offvalueType":"str","officon":"","offcolor":"","x":429,"y":209,"wires":[["983ef257.392a5"]]},{"id":"4a4e464a.46ed58","type":"mqtt in","z":"d7aa7eb2.229b","name":"ReadState","topic":"/db/main","qos":"2","broker":"e6d8a0f0.6f5878","x":166,"y":209,"wires":[["362b2e7.a85f8d2"]]},{"id":"983ef257.392a5","type":"mqtt out","z":"d7aa7eb2.229b","name":"SaveState","topic":"","qos":"2","retain":"true","broker":"e6d8a0f0.6f5878","x":729.5,"y":207,"wires":[]},{"id":"da304b46.be11e8","type":"ui_switch","z":"d7aa7eb2.229b","name":"POOL","label":"Pool DB","group":"785a2ca0.c143a4","order":6,"width":"","height":"","passthru":false,"decouple":"false","topic":"/db/pool/all","onvalue":"1","onvalueType":"str","onicon":"","oncolor":"","offvalue":"0","offvalueType":"str","officon":"","offcolor":"","x":490,"y":580,"wires":[["fa1222f0.8af3d"]]},{"id":"1a13b0a2.d8556f","type":"mqtt in","z":"d7aa7eb2.229b","name":"ReadState","topic":"/db/pool/all","qos":"2","broker":"e6d8a0f0.6f5878","x":232,"y":578,"wires":[["da304b46.be11e8"]]},{"id":"fa1222f0.8af3d","type":"mqtt out","z":"d7aa7eb2.229b","name":"SaveState","topic":"","qos":"2","retain":"true","broker":"e6d8a0f0.6f5878","x":823.5,"y":579,"wires":[]},{"id":"e1422fe.5be30d","type":"ui_switch","z":"d7aa7eb2.229b","name":"POOLPUMP","label":"Pool Pump","group":"49045aeb.df53e4","order":9,"width":"","height":"","passthru":false,"decouple":"false","topic":"/db/pool/pump","onvalue":"1","onvalueType":"str","onicon":"","oncolor":"","offvalue":"0","offvalueType":"str","officon":"","offcolor":"","x":504,"y":898,"wires":[["69914301.4dba4c"]]},{"id":"f8044626.72d3f8","type":"mqtt in","z":"d7aa7eb2.229b","name":"ReadState","topic":"/db/pool/pump","qos":"2","broker":"e6d8a0f0.6f5878","x":244,"y":900,"wires":[["e1422fe.5be30d"]]},{"id":"69914301.4dba4c","type":"mqtt out","z":"d7aa7eb2.229b","name":"SaveState","topic":"","qos":"2","retain":"true","broker":"e6d8a0f0.6f5878","x":830.5,"y":898,"wires":[]},{"id":"bee89cc.737d06","type":"ui_switch","z":"d7aa7eb2.229b","name":"POOLLIGHT","label":"Pool Light","group":"49045aeb.df53e4","order":7,"width":"","height":"","passthru":false,"decouple":"false","topic":"/db/pool/light","onvalue":"1","onvalueType":"str","onicon":"","oncolor":"","offvalue":"0","offvalueType":"str","officon":"","offcolor":"","x":512,"y":960,"wires":[["15e1d1f5.0e826e"]]},{"id":"1c63cbb5.b29444","type":"mqtt in","z":"d7aa7eb2.229b","name":"ReadState","topic":"/db/pool/light","qos":"2","broker":"e6d8a0f0.6f5878","x":247,"y":962,"wires":[["bee89cc.737d06"]]},{"id":"15e1d1f5.0e826e","type":"mqtt out","z":"d7aa7eb2.229b","name":"SaveState","topic":"","qos":"2","retain":"","broker":"e6d8a0f0.6f5878","x":842.5,"y":961,"wires":[]},{"id":"d5152f38.64cc2","type":"ui_switch","z":"d7aa7eb2.229b","name":"POOL GARDEN LIGHTS","label":"Pool Garden Lights","group":"49045aeb.df53e4","order":8,"width":"","height":"","passthru":false,"decouple":"false","topic":"/db/pool/gardenlight","onvalue":"1","onvalueType":"str","onicon":"","oncolor":"","offvalue":"0","offvalueType":"str","officon":"","offcolor":"","x":525,"y":1023,"wires":[["bcf370ce.2166c"]]},{"id":"26edf2fa.6fc09e","type":"mqtt in","z":"d7aa7eb2.229b","name":"ReadState","topic":"/db/pool/gardenlight","qos":"2","broker":"e6d8a0f0.6f5878","x":244,"y":1023,"wires":[["d5152f38.64cc2"]]},{"id":"bcf370ce.2166c","type":"mqtt out","z":"d7aa7eb2.229b","name":"SaveState","topic":"","qos":"2","retain":"","broker":"e6d8a0f0.6f5878","x":835.5,"y":1024,"wires":[]},{"id":"4b8ef11b.a59e6","type":"inject","z":"b65b888a.ee7038","name":"ON","topic":"","payload":"true","payloadType":"bool","repeat":"","crontab":"","once":false,"x":275,"y":130,"wires":[["9cf45bd1.c11dc8"]]},{"id":"59122699.45cb78","type":"inject","z":"b65b888a.ee7038","name":"OFF","topic":"","payload":"false","payloadType":"bool","repeat":"","crontab":"","once":false,"x":275,"y":170,"wires":[["9cf45bd1.c11dc8"]]},{"id":"66551cb5.343ed4","type":"switch","z":"b65b888a.ee7038","name":"Is this flow enabled?","property":"start-stop","propertyType":"flow","rules":[{"t":"true"}],"checkall":"true","outputs":1,"x":505,"y":250,"wires":[["6603a9e7.081888"]]},{"id":"c13458db.dfabf8","type":"inject","z":"b65b888a.ee7038","name":"","topic":"","payload":"","payloadType":"date","repeat":"1","crontab":"","once":true,"x":295,"y":250,"wires":[["66551cb5.343ed4","8ceb6d0.8a12a9"]]},{"id":"6603a9e7.081888","type":"function","z":"b65b888a.ee7038","name":"Generate Random Data","func":"msg.payload = Math.round(Math.random()*100);\nreturn msg;","outputs":1,"noerr":0,"x":755,"y":250,"wires":[["16a1e924.138c27"]]},{"id":"16a1e924.138c27","type":"debug","z":"b65b888a.ee7038","name":"","active":true,"console":"false","complete":"false","x":975,"y":250,"wires":[]},{"id":"83316a9d.f28478","type":"debug","z":"b65b888a.ee7038","name":"","active":true,"console":"false","complete":"false","x":695,"y":150,"wires":[]},{"id":"8ceb6d0.8a12a9","type":"function","z":"b65b888a.ee7038","name":"","func":"var enabled = flow.get('start-stop')||false;\nmsg.payload = enabled;\nreturn msg;","outputs":1,"noerr":0,"x":455,"y":330,"wires":[["907c2417.dbd128"]]},{"id":"907c2417.dbd128","type":"debug","z":"b65b888a.ee7038","name":"","active":false,"console":"false","complete":"false","x":615,"y":330,"wires":[]},{"id":"9cf45bd1.c11dc8","type":"change","z":"b65b888a.ee7038","name":"Enable / Disable this flow","rules":[{"t":"set","p":"start-stop","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":475,"y":150,"wires":[["83316a9d.f28478"]]},{"id":"7556d38c.24db4c","type":"mqtt out","z":"673c5652.d668c8","name":"DomBuiteTemperatuur","topic":"domoticz/in","qos":"","retain":"","broker":"e6d8a0f0.6f5878","x":1289,"y":777,"wires":[]},{"id":"dc128a13.8d63d8","type":"function","z":"673c5652.d668c8","name":"","func":"msg.payload='{ \"idx\" : 13, \"nvalue\" : 0, \"svalue\" : \"'+msg.payload.split(\":\")[1]+'\" }';\nreturn msg;","outputs":1,"noerr":0,"x":1010,"y":768,"wires":[["7556d38c.24db4c"]]},{"id":"752e78cc.893a68","type":"mqtt in","z":"74cedccf.2b6a6c","name":"ReadStateElectronicSafeSwitch","topic":"/kaslig36/ElectronicSafe/switch","qos":"2","broker":"e6d8a0f0.6f5878","x":222,"y":4515,"wires":[["c882a8a0.a84948"]]},{"id":"58d1c7e8.827b48","type":"mqtt in","z":"74cedccf.2b6a6c","name":"ReadStateRifleSafeSwitch","topic":"/kaslig36/RifleSafe/switch","qos":"2","broker":"e6d8a0f0.6f5878","x":198,"y":4572,"wires":[["d3601889.5d9d78"]]},{"id":"8a6208fe.19c768","type":"mqtt out","z":"74cedccf.2b6a6c","name":"SendToDomoticz","topic":"domoticz/in","qos":"0","retain":"true","broker":"e6d8a0f0.6f5878","x":740,"y":4533,"wires":[]},{"id":"c882a8a0.a84948","type":"function","z":"74cedccf.2b6a6c","name":"","func":"msg.payload='{ \"idx\" : 14, \"nvalue\" : '+msg.payload+' }';\nreturn msg;","outputs":1,"noerr":0,"x":488,"y":4525,"wires":[["8a6208fe.19c768"]]},{"id":"d3601889.5d9d78","type":"function","z":"74cedccf.2b6a6c","name":"","func":"msg.payload='{ \"idx\" : 15, \"nvalue\" : '+msg.payload+' }';\n//msg.payload='{ \"idx\" : 15, \"nvalue\" : 0, \"svalue\" : \"'+msg.payload.split(\":\")[1]+'\" }';\nreturn msg;","outputs":1,"noerr":0,"x":486,"y":4582,"wires":[["8a6208fe.19c768"]]},{"id":"928f5fe.d6ec9a","type":"bigtimer","z":"2c79f7b9.40b25","outtopic":"","outpayload1":"{\"on\":true,\"bri\":255,\"hue\":0,\"sat\":255,\"duration\":30000,\"ct\": 5200}","outpayload2":"{\"on\":false,\"duration\":30000}","name":"Big Timer","lat":"-25.8619229","lon":"28.1774539","starttime":"5001","endtime":"1380","startoff":"-15","endoff":"0","offs":0,"outtext1":"true","outtext2":"false","timeout":1440,"sun":true,"mon":true,"tue":true,"wed":true,"thu":true,"fri":true,"sat":true,"jan":true,"feb":true,"mar":true,"apr":true,"may":true,"jun":true,"jul":true,"aug":true,"sep":true,"oct":true,"nov":true,"dec":true,"day1":0,"month1":0,"day2":0,"month2":0,"day3":0,"month3":0,"day4":0,"month4":0,"day5":0,"month5":0,"d1":0,"w1":0,"d2":0,"w2":0,"d3":0,"w3":0,"d4":0,"w4":0,"d5":0,"w5":0,"suspend":false,"random":false,"repeat":false,"atstart":true,"odd":false,"even":false,"x":296,"y":56,"wires":[["9b666796.201a48","977c3037.0d541"],[],[]]},{"id":"fc463cf7.4dcc3","type":"ui_switch","z":"2c79f7b9.40b25","name":"","label":"TV YL Switch","group":"e556caad.2d2b4","order":0,"width":0,"height":0,"passthru":false,"decouple":"true","topic":"","style":"","onvalue":"1","onvalueType":"num","onicon":"","oncolor":"","offvalue":"0","offvalueType":"num","officon":"","offcolor":"","x":651.0000305175781,"y":200.99999618530273,"wires":[["ffe65cae.30c1d8"]]},{"id":"38f85db2.748922","type":"comment","z":"d7aa7eb2.229b","name":"Spa","info":"","x":90,"y":1100,"wires":[]},{"id":"135bb16d.a739ef","type":"ui_switch","z":"d7aa7eb2.229b","name":"SPA","label":"Spa DB","group":"785a2ca0.c143a4","order":6,"width":"","height":"","passthru":false,"decouple":"false","topic":"/db/spa/all","onvalue":"1","onvalueType":"str","onicon":"","oncolor":"","offvalue":"0","offvalueType":"str","officon":"","offcolor":"","x":470,"y":640,"wires":[["75a68727.deb398"]]},{"id":"dde6380c.5e85b8","type":"mqtt in","z":"d7aa7eb2.229b","name":"ReadState","topic":"/db/spa/all","qos":"2","broker":"e6d8a0f0.6f5878","x":212,"y":638,"wires":[["135bb16d.a739ef"]]},{"id":"75a68727.deb398","type":"mqtt out","z":"d7aa7eb2.229b","name":"SaveState","topic":"","qos":"2","retain":"true","broker":"e6d8a0f0.6f5878","x":803.5,"y":639,"wires":[]},{"id":"22b400dd.f9ad7","type":"ui_switch","z":"d7aa7eb2.229b","name":"SPAPUMP","label":"Spa Pump","group":"c4d90b7b.308278","order":9,"width":"","height":"","passthru":false,"decouple":"false","topic":"/db/spa/pump","onvalue":"1","onvalueType":"str","onicon":"","oncolor":"","offvalue":"0","offvalueType":"str","officon":"","offcolor":"","x":530,"y":1120,"wires":[["ed1ab8bd.ccc3c8"]]},{"id":"2eee68fc.bfc0e8","type":"mqtt in","z":"d7aa7eb2.229b","name":"ReadState","topic":"/db/spa/pump","qos":"2","broker":"e6d8a0f0.6f5878","x":270,"y":1122,"wires":[["22b400dd.f9ad7"]]},{"id":"ed1ab8bd.ccc3c8","type":"mqtt out","z":"d7aa7eb2.229b","name":"SaveState","topic":"","qos":"2","retain":"","broker":"e6d8a0f0.6f5878","x":856.5,"y":1120,"wires":[]},{"id":"ac75e39e.fd733","type":"ui_switch","z":"d7aa7eb2.229b","name":"SPABLOWER","label":"Spa Blower","group":"c4d90b7b.308278","order":7,"width":"","height":"","passthru":false,"decouple":"false","topic":"/db/spa/blower","onvalue":"1","onvalueType":"str","onicon":"","oncolor":"","offvalue":"0","offvalueType":"str","officon":"","offcolor":"","x":548,"y":1182,"wires":[["7490ebe0.1d23c4","56c81550.fbe19c"]]},{"id":"2ed437a0.06bda8","type":"mqtt in","z":"d7aa7eb2.229b","name":"ReadState","topic":"/db/spa/blower","qos":"2","broker":"e6d8a0f0.6f5878","x":273,"y":1184,"wires":[["ac75e39e.fd733"]]},{"id":"7490ebe0.1d23c4","type":"mqtt out","z":"d7aa7eb2.229b","name":"SaveState","topic":"","qos":"2","retain":"","broker":"e6d8a0f0.6f5878","x":868.5,"y":1183,"wires":[]},{"id":"20f96679.d1e7ca","type":"ui_switch","z":"d7aa7eb2.229b","name":"SPALIGHTS","label":"Spa Lights","group":"c4d90b7b.308278","order":8,"width":"","height":"","passthru":false,"decouple":"false","topic":"/db/spa/light","onvalue":"1","onvalueType":"str","onicon":"","oncolor":"","offvalue":"0","offvalueType":"str","officon":"","offcolor":"","x":511,"y":1245,"wires":[["c944c1b0.385be"]]},{"id":"42ccc55b.27e53c","type":"mqtt in","z":"d7aa7eb2.229b","name":"ReadState","topic":"/db/spa/light","qos":"2","broker":"e6d8a0f0.6f5878","x":270,"y":1245,"wires":[["20f96679.d1e7ca"]]},{"id":"c944c1b0.385be","type":"mqtt out","z":"d7aa7eb2.229b","name":"SaveState","topic":"","qos":"2","retain":"","broker":"e6d8a0f0.6f5878","x":861.5,"y":1246,"wires":[]},{"id":"4aba3e5b.49e66","type":"mqtt in","z":"db25ff5f.95a8c","name":"ReadState","topic":"/PHY/Spa/Pump/state","qos":"2","broker":"e6d8a0f0.6f5878","x":258,"y":619.9999847412109,"wires":[["21dd749d.60441c"]]},{"id":"70f248b3.ec8bc8","type":"mqtt out","z":"db25ff5f.95a8c","name":"SaveState","topic":"/RS485/0A/Spa/Pump/state","qos":"2","retain":"","broker":"e6d8a0f0.6f5878","x":913.5,"y":771,"wires":[]},{"id":"2d7d4ce3.ab02c4","type":"mqtt in","z":"db25ff5f.95a8c","name":"ReadState","topic":"/PHY/Spa/Light/state","qos":"2","broker":"e6d8a0f0.6f5878","x":241.00001525878906,"y":509.00002098083496,"wires":[["d5f64068.4f8d7"]]},{"id":"b59ec657.58e878","type":"mqtt out","z":"db25ff5f.95a8c","name":"SaveState","topic":"/RS485/0B/Spa/Light/state","qos":"2","retain":"","broker":"e6d8a0f0.6f5878","x":916.5,"y":677,"wires":[]},{"id":"20b8cc5f.0c3a14","type":"mqtt in","z":"db25ff5f.95a8c","name":"ReadPHYState","topic":"/PHY/Spa/Blower/state","qos":"2","broker":"e6d8a0f0.6f5878","x":240,"y":360,"wires":[["f1d35abc.a930c8"]]},{"id":"3bdf4c45.8b0064","type":"mqtt out","z":"db25ff5f.95a8c","name":"SaveStateRS485","topic":"/RS485/09/Spa/Blower/state","qos":"2","retain":"","broker":"e6d8a0f0.6f5878","x":848,"y":373,"wires":[]},{"id":"5ef626e0.1efcd8","type":"ui_switch","z":"e1c5a709.ef3138","name":"SpaPump","label":"Pomp","group":"f8c6294.02cb4d8","order":1,"width":"","height":"","passthru":false,"decouple":"false","topic":"/LGC/Spa/Pump/state","onvalue":"1","onvalueType":"str","onicon":"","oncolor":"","offvalue":"0","offvalueType":"str","officon":"","offcolor":"","x":480,"y":120,"wires":[["7d2fb4d3.3c58bc"]]},{"id":"72ca9e07.1b837","type":"mqtt in","z":"e1c5a709.ef3138","name":"ReadState","topic":"/LGC/Spa/Pump/state","qos":"2","broker":"e6d8a0f0.6f5878","x":282,"y":127,"wires":[["5ef626e0.1efcd8"]]},{"id":"7d2fb4d3.3c58bc","type":"mqtt out","z":"e1c5a709.ef3138","name":"SaveState","topic":"","qos":"2","retain":"","broker":"e6d8a0f0.6f5878","x":795.5,"y":118,"wires":[]},{"id":"c9c1ea86.0624a8","type":"ui_switch","z":"e1c5a709.ef3138","name":"SpaLight","label":"Lig","group":"f8c6294.02cb4d8","order":3,"width":"","height":"","passthru":false,"decouple":"false","topic":"/LGC/Spa/Light/state","onvalue":"1","onvalueType":"str","onicon":"","oncolor":"","offvalue":"0","offvalueType":"str","officon":"","offcolor":"","x":463,"y":326,"wires":[["7bedca3a.a39784"]]},{"id":"266e5db1.42ddd2","type":"mqtt in","z":"e1c5a709.ef3138","name":"ReadState","topic":"/LGC/Spa/Light/state","qos":"2","broker":"e6d8a0f0.6f5878","x":265,"y":333,"wires":[["c9c1ea86.0624a8"]]},{"id":"7bedca3a.a39784","type":"mqtt out","z":"e1c5a709.ef3138","name":"SaveState","topic":"","qos":"2","retain":"","broker":"e6d8a0f0.6f5878","x":778.5,"y":324,"wires":[]},{"id":"bf3d20c8.a2a45","type":"ui_switch","z":"e1c5a709.ef3138","name":"SpaBlower","label":"Blower","group":"f8c6294.02cb4d8","order":2,"width":"","height":"","passthru":false,"decouple":"false","topic":"/LGC/Spa/Blower/state","onvalue":"1","onvalueType":"str","onicon":"","oncolor":"","offvalue":"0","offvalueType":"str","officon":"","offcolor":"","x":482,"y":238,"wires":[["32d170b1.808cf","30a4aeee.e55e82"]]},{"id":"8b385c64.70224","type":"mqtt in","z":"e1c5a709.ef3138","name":"ReadState","topic":"/LGC/Spa/Blower/state","qos":"2","broker":"e6d8a0f0.6f5878","x":274,"y":245,"wires":[["bf3d20c8.a2a45"]]},{"id":"32d170b1.808cf","type":"mqtt out","z":"e1c5a709.ef3138","name":"SaveState","topic":"","qos":"2","retain":"","broker":"e6d8a0f0.6f5878","x":787.5,"y":236,"wires":[]},{"id":"d8ebd26a.695f4","type":"bigtimer","z":"e1c5a709.ef3138","outtopic":"/LGC/Spa/Pump/state","outpayload1":"1","outpayload2":"0","name":"Big Timer SpaPump","lat":"-25.8619229","lon":"28.1774539","starttime":"720","endtime":"840","startoff":"0","endoff":0,"offs":0,"outtext1":"On","outtext2":"Off","timeout":1440,"sun":true,"mon":true,"tue":true,"wed":true,"thu":true,"fri":true,"sat":true,"jan":true,"feb":true,"mar":true,"apr":true,"may":true,"jun":true,"jul":true,"aug":true,"sep":true,"oct":true,"nov":true,"dec":true,"day1":0,"month1":0,"day2":0,"month2":0,"day3":0,"month3":0,"day4":0,"month4":0,"day5":0,"month5":0,"d1":0,"w1":0,"d2":0,"w2":0,"d3":0,"w3":0,"d4":0,"w4":0,"d5":0,"w5":0,"suspend":false,"random":false,"repeat":false,"atstart":true,"odd":false,"even":false,"x":486.0000228881836,"y":55.999996185302734,"wires":[["7d2fb4d3.3c58bc"],[],[]]},{"id":"f1d35abc.a930c8","type":"function","z":"db25ff5f.95a8c","name":"SPA_BLOWER","func":"var newMsg = { payload: msg.payload,topic:msg.topic };\n\nreturn msg;","outputs":1,"noerr":0,"x":538,"y":373,"wires":[["3bdf4c45.8b0064","269fe9f8.a1a5c6"]]},{"id":"d5f64068.4f8d7","type":"function","z":"db25ff5f.95a8c","name":"SPA_LIGHT","func":"\nreturn msg;","outputs":1,"noerr":0,"x":523.0000152587891,"y":485.0000247955322,"wires":[["b59ec657.58e878","269fe9f8.a1a5c6"]]},{"id":"21dd749d.60441c","type":"function","z":"db25ff5f.95a8c","name":"SPA_PUMP","func":"\nreturn msg;","outputs":1,"noerr":0,"x":502,"y":626.9999837875366,"wires":[["70f248b3.ec8bc8","269fe9f8.a1a5c6"]]},{"id":"7d1c21e6.b7403","type":"comment","z":"db25ff5f.95a8c","name":"SPA","info":"This FLOW controls the SPA\nIt controls it via RS485 currently connected as ttyRS485.\nIt control the following functions:\n- PUMP\n- BLOWER\n- LIGHT\n\nIt will check the DB board to see if it can switch ON otherwise it will send on OFF command.\n","x":160,"y":70,"wires":[]},{"id":"2d04be5a.fb0b52","type":"function","z":"65fee79d.91ee58","name":"Merge the two","func":"context.data = context.data || {};\n\nswitch (msg.topic) {\n    case \"temp\":\n        context.data.temp = msg.payload;\n        msg = null;\n        break;\n    case \"humidity\":\n        context.data.humidity = msg.payload;\n        msg = null;\n        break;\n        \n    default:\n        msg = null;\n    \tbreak;\n\n}\n\nif(context.data.temp != null && context.data.humidity != null ) {\n\tmsg2 = {};\n    msg2.payload = \"Temp is:\"+context.data.temp+\" Humidity is:\"+context.data.humidity;\n    \n    context.data=null;\n\treturn msg2;\n} ","outputs":1,"noerr":0,"x":620,"y":280,"wires":[["cc86cc01.68e79"]]},{"id":"cc86cc01.68e79","type":"debug","z":"65fee79d.91ee58","name":"","active":true,"console":"false","complete":"true","x":832,"y":280,"wires":[]},{"id":"dae65071.f803c","type":"function","z":"65fee79d.91ee58","name":"temp","func":"msg.topic=\"temp\";\nmsg.payload=\"25\";\nreturn msg;","outputs":1,"noerr":0,"x":464,"y":224,"wires":[["2d04be5a.fb0b52"]]},{"id":"dd020254.89624","type":"function","z":"65fee79d.91ee58","name":"humidity","func":"msg.topic=\"humidity\";\nmsg.payload=\"78\";\nreturn msg;","outputs":1,"noerr":0,"x":466,"y":365,"wires":[["2d04be5a.fb0b52"]]},{"id":"485b3750.f9e8b8","type":"inject","z":"65fee79d.91ee58","name":"Start","topic":"","payload":"","payloadType":"str","repeat":"","crontab":"","once":false,"x":335,"y":366,"wires":[["dd020254.89624"]]},{"id":"a1a39263.2a098","type":"inject","z":"65fee79d.91ee58","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":333.5,"y":224,"wires":[["dae65071.f803c"]]},{"id":"47606c99.a6d7a4","type":"mqtt in","z":"65fee79d.91ee58","name":"ReadLGCState","topic":"/LGC/Spa/Blower/state","qos":"2","broker":"e6d8a0f0.6f5878","x":245.99999237060547,"y":575.9999713897705,"wires":[["9e5196f3.935d58"]]},{"id":"1a76a059.d8e58","type":"mqtt out","z":"65fee79d.91ee58","name":"SavePHYState","topic":"/PHY/Spa/Blower/state","qos":"2","retain":"","broker":"e6d8a0f0.6f5878","x":860,"y":520,"wires":[]},{"id":"2ea2a2a9.e0062e","type":"mqtt in","z":"65fee79d.91ee58","name":"ReadPHYState","topic":"/PHY/Spa/Blower/state","qos":"2","broker":"e6d8a0f0.6f5878","x":335.0000228881836,"y":661.9999561309814,"wires":[["cff10976.eee1d8"]]},{"id":"349965bd.88c73a","type":"mqtt in","z":"65fee79d.91ee58","name":"ReadDBSpaState","topic":"/db/spa/all","qos":"2","broker":"e6d8a0f0.6f5878","x":250,"y":508.9999752044678,"wires":[["9e5196f3.935d58","69e9c76.a9f9538"]]},{"id":"5681a62b.d7ed98","type":"mqtt in","z":"65fee79d.91ee58","name":"ReadDBBlowerState","topic":"/db/spa/blower","qos":"2","broker":"e6d8a0f0.6f5878","x":250,"y":440,"wires":[["9e5196f3.935d58","69e9c76.a9f9538"]]},{"id":"9e5196f3.935d58","type":"function","z":"65fee79d.91ee58","name":"SPA_BLOWER","func":"// set switch topic\n// find which input it was\n\n\n//object\n\n//RollupParent\n//Parents\n//  Parent topic\n//  Parent output\n//  SwitchState\n//switchState\n//output\n\nvar switchObject = { \n                      topic:\"/PHY/Spa/Blower/state\", \n                      switchState:\"\", \n                      output:\"\",\n                      wattage:\"\",\n                      RollupParent:\"\",\n                      Parents:[]\n                   };\n\nvar newMsg = { payload: msg.payload,topic:msg.topic };\n\nreturn msg;","outputs":1,"noerr":0,"x":560,"y":520,"wires":[["1a76a059.d8e58","7ec0c25c.5b664c"]]},{"id":"9b666796.201a48","type":"yeelight-compat-hue-out","z":"2c79f7b9.40b25","name":"TVRoomBackWall","server":"86cdb25c.bbd3a","x":998.9998931884766,"y":49,"wires":[]},{"id":"c03eddcf.d901c","type":"yeelight-compat-hue-out","z":"2c79f7b9.40b25","name":"YL_Study","server":"1d4318d6.fee087","x":899,"y":757.0000152587891,"wires":[]},{"id":"2d730a32.c56ede","type":"yeelight-compat-hue-state","z":"2c79f7b9.40b25","name":"YL_TV","server":"86cdb25c.bbd3a","x":296.00000762939453,"y":190.99999618530273,"wires":[["7ca11e3e.76ce58"]]},{"id":"7ca11e3e.76ce58","type":"function","z":"2c79f7b9.40b25","name":"","func":"flow.set('YL_TVBackWall',msg.payload);\nif (msg.payload.state.on === true) {\n    msg.payload = 1;\n} else {\n    msg.payload = 0;\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":508.0000228881836,"y":150.99998092651367,"wires":[["fc463cf7.4dcc3"]]},{"id":"ffe65cae.30c1d8","type":"function","z":"2c79f7b9.40b25","name":"","func":"if (msg.payload==1 ) {\n    msg.payload = {\"on\":true,\"bri\":255,\"hue\":0,\"sat\":255,\"duration\":3000,\"ct\": 5200};\n} else {\n    msg.payload = {\"on\":false,\"duration\":1000};\n}\nreturn msg;","outputs":1,"noerr":0,"x":764,"y":123.99996948242188,"wires":[["9b666796.201a48","977c3037.0d541"]]},{"id":"beddb448.816838","type":"ui_switch","z":"2c79f7b9.40b25","name":"","label":"Study YL Switch","group":"5c45879e.172aa8","order":0,"width":0,"height":0,"passthru":false,"decouple":"true","topic":"","style":"","onvalue":"1","onvalueType":"num","onicon":"","oncolor":"","offvalue":"0","offvalueType":"num","officon":"","offcolor":"","x":570,"y":879.0000152587891,"wires":[["97e75d72.c8e838"]]},{"id":"d9bd07c.2ca5df8","type":"yeelight-compat-hue-state","z":"2c79f7b9.40b25","name":"YL_Study_Events","server":"1d4318d6.fee087","x":268,"y":865.0000152587891,"wires":[["e4d97fd6.aa5a7"]]},{"id":"e4d97fd6.aa5a7","type":"function","z":"2c79f7b9.40b25","name":"","func":"flow.set('YL_study',msg.payload);\n\nif (msg.payload.state.on === true) {\n    msg.payload = 1;\n} else {\n    msg.payload = 0;\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":420,"y":819.0000152587891,"wires":[["beddb448.816838"]]},{"id":"97e75d72.c8e838","type":"function","z":"2c79f7b9.40b25","name":"","func":"if (msg.payload==1 ) {\n    msg.payload = {\"on\":true,\"bri\":255,\"hue\":0,\"sat\":255,\"duration\":3000,\"ct\": 5200};\n} else {\n    msg.payload = {\"on\":false,\"duration\":1000};\n}\nreturn msg;","outputs":1,"noerr":0,"x":660,"y":819.0000152587891,"wires":[["c03eddcf.d901c","3dcaf120.123846","3beb8185.58e60e"]]},{"id":"b2416f14.0bb4e","type":"function","z":"2c79f7b9.40b25","name":"","func":"msg.payload = {\"ct\":msg.payload};\nreturn msg;","outputs":1,"noerr":0,"x":440,"y":659.0000152587891,"wires":[["c03eddcf.d901c"]]},{"id":"c6581648.427b78","type":"function","z":"2c79f7b9.40b25","name":"","func":"msg.payload = {\"bri\":msg.payload};\nreturn msg;","outputs":1,"noerr":0,"x":460,"y":619.0000152587891,"wires":[["c03eddcf.d901c"]]},{"id":"c924121.a6848f","type":"inject","z":"2c79f7b9.40b25","name":"Test_YL_Status","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"*/10 0-23 * * *","once":true,"onceDelay":"1","x":145.87216186523438,"y":785.3409139380967,"wires":[["d9bd07c.2ca5df8"]]},{"id":"c45c18d1.b64cd","type":"inject","z":"2c79f7b9.40b25","name":"Test_YL_Status","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"*/10 0-23 * * *","once":true,"onceDelay":0.1,"x":151,"y":117.00000381469727,"wires":[["2d730a32.c56ede"]]},{"id":"ad137208.339848","type":"debug","z":"68c40619.e42048","name":"temp_msg","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":457,"y":697,"wires":[]},{"id":"88e2eee.1496c1","type":"mqtt in","z":"9430e2e4.ec8d2","name":"Get Button Status","topic":"/button/#","qos":"2","broker":"e6d8a0f0.6f5878","x":209,"y":225.99998474121094,"wires":[["7ff265e8.df2f4c"]]},{"id":"1381bd55.2e6d93","type":"debug","z":"9430e2e4.ec8d2","name":"DashButtonDebug","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":748.9999771118164,"y":221.99999618530273,"wires":[]},{"id":"7ff265e8.df2f4c","type":"function","z":"9430e2e4.ec8d2","name":"","func":"var button_list = msg.topic.split(\"/\");\nvar button_no = button_list[2];\nvar msg1 = RED.util.cloneMessage(msg);\nvar msg2 = RED.util.cloneMessage(msg);\n\nif (button_list[3] == 'message') {\n    msg1.payload=button_no + ':' + msg.payload;\n    msg2.payload='Message from button[' +button_no + '] is [' + msg.payload+']';\n} else if(button_list[3] == 'vcc') {\n    msg1.payload=button_no + ':' + msg.payload;\n    msg2.payload='Battery level of button['+ button_no + '] is ' + msg.payload + 'V';\n} else {\n    msg1.payload=button_no + ' other ' + msg.payload;\n    msg2.payload=button_no + ' other ' + msg.payload;\n}    \n/*\nif (msg.topic  payload=='1') \n{\n    msg.payload = \"GPIO 12 1\";\n    context.global.Kaslig31 = new Date();\n    msg2 = msg;\n}  \nif (msg.payload=='0') \n{\n    msg.payload = \"GPIO 12 0\";\n    context.global.Kaslig31 = 0;\n    msg2 = null;\n}\n*/\nreturn [msg1,msg2];\n\n","outputs":2,"noerr":0,"x":481.99999618530273,"y":263.99999237060547,"wires":[["1381bd55.2e6d93"],["1381bd55.2e6d93"]],"outputLabels":["Short","Long",""]},{"id":"a178f0f4.23f4f","type":"mqtt in","z":"2c79f7b9.40b25","name":"Get Button Status","topic":"/button/0001/message","qos":"2","broker":"e6d8a0f0.6f5878","x":111,"y":1031.999979019165,"wires":[["246353d1.c2c10c"]]},{"id":"d20c3d95.179b98","type":"debug","z":"2c79f7b9.40b25","name":"StudyTogglePHY","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":764,"y":999.0000152587891,"wires":[]},{"id":"246353d1.c2c10c","type":"function","z":"2c79f7b9.40b25","name":"F-toggle","func":"if (msg.payload == \"ON\") {\n\n  var local_YL_study = flow.get('YL_study')||0;\n\n  if (local_YL_study.state.on === false ) {\n      msg.payload = {\"on\":true,\"bri\":255,\"hue\":0,\"sat\":255,\"duration\":3000,\"ct\": 5200};\n  } else {\n      msg.payload = {\"on\":false,\"duration\":1000};\n  }\n  return msg;\n} else\n  return null;","outputs":1,"noerr":0,"x":444.00001525878906,"y":1032,"wires":[["d20c3d95.179b98","c03eddcf.d901c","3beb8185.58e60e"]]},{"id":"3dcaf120.123846","type":"debug","z":"2c79f7b9.40b25","name":"StudyToggleGUI","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":873,"y":854.0000152587891,"wires":[]},{"id":"3beb8185.58e60e","type":"delay","z":"2c79f7b9.40b25","name":"Delay3s","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":423.69883728027344,"y":975.1278305053711,"wires":[["d9bd07c.2ca5df8"]]},{"id":"977c3037.0d541","type":"delay","z":"2c79f7b9.40b25","name":"Delay3s","pauseType":"delay","timeout":"3","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":597.6931915283203,"y":75.119309425354,"wires":[["2d730a32.c56ede"]]},{"id":"335de0b7.0f16e","type":"mqtt in","z":"9430e2e4.ec8d2","name":"Listen2AllBatteryButtons","topic":"/BatteryButton/#","qos":"2","broker":"c93e946f.f9c458","x":211.6931610107422,"y":95.09659481048584,"wires":[["b3fa7f53.d44aa"]]},{"id":"a0ab3d89.18732","type":"debug","z":"9430e2e4.ec8d2","name":"BatteryButtonDebug","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":757.0142364501953,"y":48.00568389892578,"wires":[]},{"id":"b3fa7f53.d44aa","type":"function","z":"9430e2e4.ec8d2","name":"","func":"var button_list = msg.topic.split(\"/\");\nvar button_no = button_list[2];\nvar msg1 = RED.util.cloneMessage(msg);\nvar msg2 = RED.util.cloneMessage(msg);\nvar msg3 = RED.util.cloneMessage(msg);\n\n    msg1.payload=button_no + ':' + msg.payload;\n    msg2.payload='Battery level of button['+ button_no + '] is ' + msg.payload + 'V';\n    msg3.topic=\"INSERT INTO button_presses(button_id, battery, currentdate, currenttime) values ('\"+button_no+\"', \"+msg.payload+\", date('now'), time('now'))\";\nreturn [msg1,msg2,msg3];\n\n","outputs":3,"noerr":0,"x":457.0142402648926,"y":100.00567245483398,"wires":[["a0ab3d89.18732"],["a0ab3d89.18732"],["32594d1d.768ca2"]],"outputLabels":["Short","Long",""]},{"id":"4e7fa0f2.78a92","type":"mqtt in","z":"2c79f7b9.40b25","name":"Listen2BB_FEECCBx","topic":"/BatteryButton/FEECCBx","qos":"2","broker":"c93e946f.f9c458","x":133.0142059326172,"y":1187.0966339111328,"wires":[["47e041d5.a677c"]]},{"id":"47e041d5.a677c","type":"function","z":"2c79f7b9.40b25","name":"F-toggle","func":"var currentVoltage=msg.payload;\nvar msg2 = RED.util.cloneMessage(msg);\n\nvar local_YL = flow.get('YL_study')||0;\n\n  if (local_YL.state.on === false ) {\n      msg.payload = {\"on\":true,\"bri\":255,\"hue\":0,\"sat\":255,\"duration\":3000,\"ct\": 5200};\n  } else {\n      msg.payload = {\"on\":false,\"duration\":1000};\n  }\n  return [msg,msg2];\n","outputs":2,"noerr":0,"x":432.0142288208008,"y":1168.0966110229492,"wires":[["3beb8185.58e60e","c03eddcf.d901c","d20c3d95.179b98"],["6712e9f2.52d018"]]},{"id":"6712e9f2.52d018","type":"debug","z":"2c79f7b9.40b25","name":"Voltage","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":709.7017288208008,"y":1165.2443161010742,"wires":[]},{"id":"3960c06f.9b23a","type":"function","z":"2c79f7b9.40b25","name":"F-toggle","func":"var currentVoltage=msg.payload;\nvar msg2 = RED.util.cloneMessage(msg);\n\nvar local_YL = flow.get('YL_TVBackWall')||0;\n\n  if (local_YL.state.on === false ) {\n      msg.payload = {\"on\":true,\"bri\":255,\"hue\":0,\"sat\":255,\"duration\":3000,\"ct\": 5200};\n  } else {\n      msg.payload = {\"on\":false,\"duration\":1000};\n  }\n  return [msg,msg2];\n","outputs":2,"noerr":0,"x":487.01424407958984,"y":308.0056095123291,"wires":[["977c3037.0d541","9b666796.201a48","1a0d4318.7c712d"],[]]},{"id":"7b5b3b58.833974","type":"mqtt in","z":"2c79f7b9.40b25","name":"Listen2BB_9E2D84","topic":"/BatteryButton/9E2D84","qos":"2","broker":"c93e946f.f9c458","x":159.0142059326172,"y":341.36932373046875,"wires":[["3960c06f.9b23a"]]},{"id":"32594d1d.768ca2","type":"sqlite","z":"9430e2e4.ec8d2","mydb":"3187280a.d5d678","sqlquery":"msg.topic","sql":"","name":"buttonsDB","x":732.6932144165039,"y":110.15336418151855,"wires":[["b2813d26.03948"]]},{"id":"68d6a9e1.46a798","type":"inject","z":"9430e2e4.ec8d2","name":"CreateTable","topic":"CREATE TABLE button_presses(id INTEGER PRIMARY KEY AUTOINCREMENT, button_id TEXT, battery NUMERIC, currentdate DATE, currenttime TIME)","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":202.69315338134766,"y":404.14768409729004,"wires":[["8238ff35.70816"]]},{"id":"e040f67b.f07fd8","type":"inject","z":"9430e2e4.ec8d2","name":"GetCounts","topic":"select button_id, count(1), min(battery) from button_presses group by button_id","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":213.0142059326172,"y":463.00567626953125,"wires":[["8238ff35.70816"]]},{"id":"b2813d26.03948","type":"debug","z":"9430e2e4.ec8d2","name":"InsertDebug","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":956.7017211914062,"y":116.86931419372559,"wires":[]},{"id":"d493d513.804138","type":"inject","z":"9430e2e4.ec8d2","name":"DropTable","topic":"DROP TABLE button_presses","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":207.0142059326172,"y":349.00567626953125,"wires":[["8238ff35.70816"]]},{"id":"8238ff35.70816","type":"sqlite","z":"9430e2e4.ec8d2","mydb":"3187280a.d5d678","sqlquery":"msg.topic","sql":"CREATE TABLE button_presses(id INTEGER PRIMARY KEY AUTOINCREMENT, button_id TEXT, battery NUMERIC, currentdate DATE, currenttime TIME)","name":"ButtonsDB","x":490.01705169677734,"y":403.4573669433594,"wires":[["47ae3af8.ef9904"]]},{"id":"47ae3af8.ef9904","type":"debug","z":"9430e2e4.ec8d2","name":"SqlDebug","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":747.0170478820801,"y":409.7386169433594,"wires":[]},{"id":"b60f3f4.66355c","type":"inject","z":"9430e2e4.ec8d2","name":"Get9E2D84","topic":"select id, currentdate, currenttime from button_presses where button_id = '9E2D84'","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":227.0142059326172,"y":522.0056762695312,"wires":[["8238ff35.70816"]]},{"id":"a2a4f95b.429158","type":"ui_switch","z":"74cedccf.2b6a6c","name":"Shane Lig","label":"Shane Lig","group":"6eaf738f.cbb964","order":2,"width":"","height":"","passthru":false,"decouple":"true","topic":"cmnd/ShaneLig/Power","onvalue":"ON","onvalueType":"str","onicon":"","oncolor":"","offvalue":"OFF","offvalueType":"str","officon":"","offcolor":"","x":390.01422119140625,"y":4690.55126953125,"wires":[["8e0363d6.683ae"]]},{"id":"3f8290f3.e22ee","type":"mqtt in","z":"74cedccf.2b6a6c","name":"GetShaneLig","topic":"stat/ShaneLig/POWER","qos":"2","broker":"e6d8a0f0.6f5878","x":121.01422119140625,"y":4679.551239013672,"wires":[["a2a4f95b.429158"]]},{"id":"a6769ff6.8f2be","type":"mqtt out","z":"74cedccf.2b6a6c","name":"SaveStateShaneLig","topic":"","qos":"1","retain":"","broker":"e6d8a0f0.6f5878","x":840.51416015625,"y":4687.55126953125,"wires":[]},{"id":"8657dcf8.9a9b2","type":"function","z":"74cedccf.2b6a6c","name":"F-toggle","func":"var currentVoltage=msg.payload;\nvar msg2 = RED.util.cloneMessage(msg);\nmsg2.topic=\"cmnd/ShaneLig/Power\"\nmsg2.payload=\"toggle\"\nmsg2.retain=false\nreturn msg2;\n","outputs":1,"noerr":0,"x":450.00006103515625,"y":4799.368748664856,"wires":[["a6769ff6.8f2be"]]},{"id":"31801df2.587142","type":"mqtt in","z":"74cedccf.2b6a6c","name":"Listen2BB_FEECCB","topic":"/BatteryButton/FEECCB","qos":"2","broker":"c93e946f.f9c458","x":148.00001525878906,"y":4825.732835769653,"wires":[["8657dcf8.9a9b2"]]},{"id":"1a0d4318.7c712d","type":"debug","z":"2c79f7b9.40b25","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":962.6959838867188,"y":192.1448516845703,"wires":[]},{"id":"258a5359.4131fc","type":"mqtt in","z":"2c79f7b9.40b25","name":"Listen2AqBB_186dec6","topic":"in/Aqara/switch/158d000186dec6/action","qos":"2","broker":"c93e946f.f9c458","x":131.0142059326172,"y":1256.733024597168,"wires":[["59b673d9.603bcc","32ef38d1.9739c8"]]},{"id":"59b673d9.603bcc","type":"switch","z":"2c79f7b9.40b25","name":"OnClick","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"click","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":346.70167541503906,"y":1253.2356567382812,"wires":[["47e041d5.a677c"]]},{"id":"32ef38d1.9739c8","type":"debug","z":"2c79f7b9.40b25","name":"mqttDebug","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":411.01422119140625,"y":1336.733024597168,"wires":[]},{"id":"c2ef6d63.f7df9","type":"mqtt in","z":"74cedccf.2b6a6c","name":"Listen2AqBB_186deda","topic":"in/Aqara/switch/158d000186deda/action","qos":"2","broker":"c93e946f.f9c458","x":124.01420593261719,"y":4900,"wires":[["84e3f256.7f098","3d79c305.234adc"]]},{"id":"84e3f256.7f098","type":"switch","z":"74cedccf.2b6a6c","name":"OnClick","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"click","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":339.70167541503906,"y":4896.502632141113,"wires":[["8657dcf8.9a9b2"]]},{"id":"3d79c305.234adc","type":"debug","z":"74cedccf.2b6a6c","name":"mqttDebug","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":434.0142288208008,"y":4954.999868392944,"wires":[]},{"id":"1b88cf9c.f73f5","type":"inject","z":"ccf72a10.c35188","name":"ExecuteGo2Bed","topic":"","payload":"1","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":159.69599151611328,"y":81.15907955169678,"wires":[["8b9b8f6a.e552a","23c42b3f.e88a24"]]},{"id":"8b9b8f6a.e552a","type":"debug","z":"ccf72a10.c35188","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":471.69605255126953,"y":59.150564193725586,"wires":[]},{"id":"5ddc32ef.5adf5c","type":"xiaomi-gateway in","z":"dce503cb.29adb","name":"XiaomiGateway1","gateway":"9a9f1f9.e13a5e","ip":"192.168.10.90","x":177.70169067382812,"y":533.1335077285767,"wires":[["a62ed44c.1e9368","57fe23b8.a8ce84"]]},{"id":"a62ed44c.1e9368","type":"function","z":"dce503cb.29adb","name":"","func":"//Outputs:\n// 1 - Original Message\n// 2 - Formatted for MQTT\n// 3 - A debug message\n\nvar msgMQTT = RED.util.cloneMessage(msg);\nvar msgDebug = RED.util.cloneMessage(msg);\n\nmsgMQTT.topic = \"in/Aqara\";\nif ( msg.payload.model === \"switch\" || msg.payload.model === \"sensor_switch.aq2\" ) {\n    msgMQTT.topic += \"/switch/\"+msg.payload.sid; \n    if ( msg.payload.cmd === \"report\" ) {\n        msgMQTT.topic += \"/action\"; \n        if ( msg.payload.data.status === \"click\" ) {\n            msgDebug.payload=\"click\";\n            msgMQTT.payload=\"click\";\n        } else if ( msg.payload.data.status === \"double_click\" ) {\n            msgDebug.payload=\"double_click\";\n            msgMQTT.payload=\"double_click\";\n        } else if ( msg.payload.data.status === \"long_click_press\" ) {\n            msgDebug.payload=\"long_click_press\";\n            msgMQTT.payload=\"long_click_press\";\n        } else if ( msg.payload.data.status === \"long_click_release\" ) {\n            msgDebug.payload=\"long_click_release\";\n            msgMQTT.payload=\"long_click_release\";\n        } else {\n            //msg = null;\n        }\n    } else if ( msg.payload.cmd === \"heartbeat\" ) {\n        msgMQTT.topic += \"/battery\"; \n        var msgBatteryVoltReport = RED.util.cloneMessage(msg);\n        msgBatteryVoltReport.topic = msgMQTT.topic + \"/milliVolt\"; \n        msgBatteryVoltReport.payload=msg.payload.data.voltage;\n        node.send(null,msgBatteryVoltReport,null);\n        msgMQTT.topic += \"/level\"; \n        msgMQTT.payload=msg.payload.data.batteryLevel;\n        msgDebug.payload = \"Voltage:\"+msg.payload.data.voltage+\" and Level:\"+msg.payload.data.batteryLevel;\n    } else {\n        //msg = null;\n    }\n\n} else if ( msg.payload.model === \"gateway\" && msg.payload.cmd===\"heartbeat\") {\n  // Discard the heartbeat from the gateway for now.\n  msgDebug = null;\n  msgMQTT = null;\n} else {\n    //msg = null;\n  msgDebug = null;\n  msgMQTT = null;\n}\nreturn [msg,msgMQTT,msgDebug];","outputs":3,"noerr":0,"x":419.0142288208008,"y":545.1874961853027,"wires":[["98e3b4b0.3f0c88"],["cb2eaa8a.3f9cf8","c5c21bb4.d22c68"],["3cbb8b6f.f065e4"]]},{"id":"3cbb8b6f.f065e4","type":"debug","z":"dce503cb.29adb","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":677.3295707702637,"y":671.8580665588379,"wires":[]},{"id":"cb2eaa8a.3f9cf8","type":"debug","z":"dce503cb.29adb","name":"mqtt","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":761.0142288208008,"y":550.0057640075684,"wires":[]},{"id":"98e3b4b0.3f0c88","type":"debug","z":"dce503cb.29adb","name":"complete","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":620.014217376709,"y":508.0057125091553,"wires":[]},{"id":"c5c21bb4.d22c68","type":"mqtt out","z":"dce503cb.29adb","name":"SendToMQTT","topic":"","qos":"","retain":"","broker":"e6d8a0f0.6f5878","x":760.6988677978516,"y":592.5682621002197,"wires":[]},{"id":"1d12ee29.cb6d52","type":"mqtt in","z":"dce503cb.29adb","name":"Listen2AllAquara","topic":"in/Aqara/switch/+/battery/level","qos":"2","broker":"e6d8a0f0.6f5878","x":147.0142059326172,"y":817.914794921875,"wires":[["ff220044.56bf8"]]},{"id":"9b5d8dac.f0af4","type":"debug","z":"dce503cb.29adb","name":"BatteryButtonDebug","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":722.3352813720703,"y":770.8238840103149,"wires":[]},{"id":"ff220044.56bf8","type":"function","z":"dce503cb.29adb","name":"","func":"var button_list = msg.topic.split(\"/\");\nvar button_no = button_list[3];\nvar msg1 = RED.util.cloneMessage(msg);\nvar msg2 = RED.util.cloneMessage(msg);\nvar msg3 = RED.util.cloneMessage(msg);\n\n    msg1.payload=button_no + ':' + msg.payload;\n    msg2.payload='Battery level of button['+ button_no + '] is ' + msg.payload + '%';\n    msg3.topic=\"INSERT INTO button_presses(button_id, battery, currentdate, currenttime) values ('Aqara\"+button_no+\"', \"+msg.payload+\", date('now'), time('now'))\";\nreturn [msg1,msg2,msg3];\n\n","outputs":3,"noerr":0,"x":418.3353157043457,"y":822.8238697052002,"wires":[["9b5d8dac.f0af4"],["9b5d8dac.f0af4"],["4987104b.6fb67"]],"outputLabels":["Short","Long",""]},{"id":"4987104b.6fb67","type":"sqlite","z":"dce503cb.29adb","mydb":"3187280a.d5d678","sqlquery":"msg.topic","sql":"","name":"buttonsDB","x":698.0142593383789,"y":832.9715642929077,"wires":[["db84a924.c7a118"]]},{"id":"db84a924.c7a118","type":"debug","z":"dce503cb.29adb","name":"InsertDebug","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":922.0227661132812,"y":839.6875143051147,"wires":[]},{"id":"2b31a32f.81894c","type":"inject","z":"dce503cb.29adb","name":"Inject10","topic":"in/Aqara/switch/158d000186dec6/battery/level\"","payload":"10","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":119.69886779785156,"y":719.0596361160278,"wires":[["ff220044.56bf8"]]},{"id":"8ff0357d.870c58","type":"inject","z":"dce503cb.29adb","name":"","topic":"7811dce17bad","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":161.7017059326172,"y":300.87499141693115,"wires":[["12e3b7d2.211498"]]},{"id":"68d4e202.8b8f1c","type":"xiaomi-gateway out","z":"dce503cb.29adb","name":"XiaomiGateway1","gateway":"9a9f1f9.e13a5e","ip":"192.168.10.90","x":901.7017440795898,"y":402.56817054748535,"wires":[]},{"id":"99b05282.6109","type":"xiaomi-actions gateway_light","z":"dce503cb.29adb","name":"","brightness":100,"hexRgbColor":"#e710d9","color":{"red":231,"green":16,"blue":217},"x":380.69602966308594,"y":271.1931686401367,"wires":[["68d4e202.8b8f1c","32b89df.d4c1962"]]},{"id":"12e3b7d2.211498","type":"xiaomi-actions gateway_sound","z":"dce503cb.29adb","name":"","mid":"10","volume":"67","x":311.6959991455078,"y":357.17896270751953,"wires":[["491c6e31.1e6ac"]]},{"id":"2cc0d562.6091aa","type":"inject","z":"dce503cb.29adb","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":170.0142059326172,"y":234.7329559326172,"wires":[["99b05282.6109"]]},{"id":"707f910c.d2788","type":"xiaomi-actions gateway_stop_sound","z":"dce503cb.29adb","name":"","x":300.70167541503906,"y":412.34940338134766,"wires":[["68d4e202.8b8f1c","32b89df.d4c1962"]]},{"id":"a32c993a.876098","type":"inject","z":"dce503cb.29adb","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":137.0142059326172,"y":368.7329406738281,"wires":[["707f910c.d2788"]]},{"id":"32b89df.d4c1962","type":"debug","z":"dce503cb.29adb","name":"debug","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":936.0142402648926,"y":249.3693084716797,"wires":[]},{"id":"491c6e31.1e6ac","type":"function","z":"dce503cb.29adb","name":"","func":"//msg.payload.sid=\"7811dce17bad\";\nreturn msg;","outputs":1,"noerr":0,"x":476.6988830566406,"y":331.06818771362305,"wires":[["68d4e202.8b8f1c","32b89df.d4c1962"]]},{"id":"189cd75d.85ba59","type":"function","z":"dce503cb.29adb","name":"","func":"//msg.payload={sid:\"7811dce17bad\", color:15143129, brightness:100};\n//message = \"{\\\"cmd\\\":\\\"write\\\",\\\"model\\\":\\\"gateway\\\",\\\"sid\\\":\\\"\" + m_GatewaySID + \"\\\",\\\"short_id\\\":0,\\\"data\\\":\\\"{\\\\\\\"mid\\\\\\\":\" + m_GatewayMusicId.c_str() + \",\\\\\\\"vol\\\\\\\":\" + m_GatewayVolume.c_str() + \",\\\\\\\"key\\\\\\\":\\\\\\\"@gatewaykey\\\\\\\"}\\\" }\"\n//message = \"{\\\"cmd\\\":\\\"write\\\",\\\"model\\\":\\\"gateway\\\",\\\"sid\\\":\\\"\" + m_GatewaySID + \"\\\",\\\"short_id\\\":0,\\\"data\\\":\\\"{\\\\\\\"rgb\\\\\\\":4294967295,\\\\\\\"key\\\\\\\":\\\\\\\"@gatewaykey\\\\\\\"}\\\" }\";\nmsg.payload={cmd:\"write\", model:\"gateway\", sid:\"7811dce17bad\", short_id:0, data:{rgb:15143129, brightness:100, key:\"ju6pb91rcql5ny53\"} };\n\nreturn msg;","outputs":1,"noerr":0,"x":487.69029235839844,"y":173.8835220336914,"wires":[["32b89df.d4c1962","68d4e202.8b8f1c"]]},{"id":"cb3a95ee.9da448","type":"inject","z":"dce503cb.29adb","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":275.01422119140625,"y":147.36932754516602,"wires":[["189cd75d.85ba59"]]},{"id":"123cb585.a24dea","type":"comment","z":"ccf72a10.c35188","name":"Go to bed","info":"","x":111.7016830444336,"y":43.36362075805664,"wires":[]},{"id":"23c42b3f.e88a24","type":"mqtt out","z":"ccf72a10.c35188","name":"Send2/LGC/Scenes/Go2Bed","topic":"/LGC/Scenes/Go2Bed","qos":"","retain":"","broker":"e6d8a0f0.6f5878","x":911.6960601806641,"y":106.11078262329102,"wires":[]},{"id":"1b7de8f5.a60237","type":"mqtt in","z":"ccf72a10.c35188","name":"/LGC/Scenes/Go2Bed","topic":"/LGC/Scenes/Go2Bed","qos":"2","broker":"e6d8a0f0.6f5878","x":147.69033813476562,"y":226.0965576171875,"wires":[["34f1eaee.f4fee6"]]},{"id":"34f1eaee.f4fee6","type":"function","z":"ccf72a10.c35188","name":"","func":"msg.payload=\"OFF\";\nreturn msg;","outputs":1,"noerr":0,"x":354.69606018066406,"y":288.15049839019775,"wires":[["6aa8f86.19ffa08","9db78529.eacd38"]]},{"id":"6aa8f86.19ffa08","type":"mqtt out","z":"ccf72a10.c35188","name":"SwitchOffTVLight","topic":"/LGC/Lights/Indoor/TVBackWall","qos":"","retain":"","broker":"e6d8a0f0.6f5878","x":583.6960525512695,"y":271.1249599456787,"wires":[]},{"id":"9db78529.eacd38","type":"mqtt out","z":"ccf72a10.c35188","name":"SwitchOffStudyLight","topic":"/LGC/Lights/Indoor/Study","qos":"","retain":"","broker":"e6d8a0f0.6f5878","x":596.0141983032227,"y":329.00566482543945,"wires":[]},{"id":"78fc1567.98809c","type":"mqtt in","z":"2c79f7b9.40b25","name":"/LGC/Lights/Indoor/TVBackWall","topic":"/LGC/Lights/Indoor/TVBackWall","qos":"2","broker":"e6d8a0f0.6f5878","x":189.69886779785156,"y":275.3749599456787,"wires":[["eae1a47b.d293d8"]]},{"id":"eae1a47b.d293d8","type":"function","z":"2c79f7b9.40b25","name":"","func":"  if (msg.payload === 1 || msg.payload.toUpperCase() === \"ON\" || msg.payload.toUpperCase() === \"TRUE\") {\n      msg.payload = {\"on\":true,\"bri\":255,\"hue\":0,\"sat\":255,\"duration\":3000,\"ct\": 5200};\n  } else {\n      msg.payload = {\"on\":false,\"duration\":1000};\n  }\n  \nreturn msg;","outputs":1,"noerr":0,"x":431.69602966308594,"y":262.60511016845703,"wires":[["977c3037.0d541","9b666796.201a48","1a0d4318.7c712d"]]},{"id":"c50ea07.9e3476","type":"mqtt in","z":"2c79f7b9.40b25","name":"/LGC/Lights/Indoor/Study","topic":"/LGC/Lights/Indoor/Study","qos":"2","broker":"e6d8a0f0.6f5878","x":156.0142059326172,"y":1117.9148378372192,"wires":[["75d8c56f.572e0c"]]},{"id":"75d8c56f.572e0c","type":"function","z":"2c79f7b9.40b25","name":"","func":"  if (msg.payload === 1 || msg.payload.toUpperCase() === \"ON\" || msg.payload.toUpperCase() === \"TRUE\") {\n      msg.payload = {\"on\":true,\"bri\":255,\"hue\":0,\"sat\":255,\"duration\":3000,\"ct\": 5200};\n  } else {\n      msg.payload = {\"on\":false,\"duration\":1000};\n  }\n  \nreturn msg;","outputs":1,"noerr":0,"x":437.0114288330078,"y":1095.1449508666992,"wires":[["3beb8185.58e60e","c03eddcf.d901c","d20c3d95.179b98"]]},{"id":"7a7d4d7d.d04904","type":"mqtt in","z":"ccf72a10.c35188","name":"in/Aqara/switch/158d0001e88649/action","topic":"in/Aqara/switch/158d0001e88649/action","qos":"2","broker":"e6d8a0f0.6f5878","x":190.69886779785156,"y":157.9119110107422,"wires":[["7152e7bd.ddad18"]]},{"id":"7152e7bd.ddad18","type":"function","z":"ccf72a10.c35188","name":"","func":"if (msg.payload === \"double_click\") {\n    msg.payload=1;\n} else {\n    msg = null;\n}\nreturn msg;","outputs":1,"noerr":0,"x":514.6960639953613,"y":136.98009300231934,"wires":[["23c42b3f.e88a24"]]},{"id":"fcd95ecd.2c3ff","type":"ui_switch","z":"74cedccf.2b6a6c","name":"Ruben Lig","label":"Ruben Lig","group":"6eaf738f.cbb964","order":2,"width":"","height":"","passthru":false,"decouple":"true","topic":"cmnd/RubenLig/Power","onvalue":"ON","onvalueType":"str","onicon":"","oncolor":"","offvalue":"OFF","offvalueType":"str","officon":"","offcolor":"","x":1171.0141410827637,"y":4744.551191329956,"wires":[["7952a005.7e536"]]},{"id":"2928c06c.0fe43","type":"mqtt in","z":"74cedccf.2b6a6c","name":"GetRubenLig","topic":"stat/RubenLig/POWER","qos":"2","broker":"e6d8a0f0.6f5878","x":914.0141525268555,"y":4765.73309803009,"wires":[["fcd95ecd.2c3ff"]]},{"id":"4bea7f42.22e0a","type":"mqtt out","z":"74cedccf.2b6a6c","name":"SaveStateRubenLig","topic":"","qos":"1","retain":"","broker":"e6d8a0f0.6f5878","x":1587.51416015625,"y":4744.55126953125,"wires":[]},{"id":"1824c7db.cff148","type":"function","z":"74cedccf.2b6a6c","name":"F-toggle","func":"var currentVoltage=msg.payload;\nvar msg2 = RED.util.cloneMessage(msg);\nmsg2.topic=\"cmnd/RubenLig/Power\"\nmsg2.payload=\"toggle\"\nmsg2.retain=false\nreturn msg2;\n","outputs":1,"noerr":0,"x":1240,"y":4809.36865234375,"wires":[["4bea7f42.22e0a"]]},{"id":"c1fb49be.8f66d8","type":"mqtt in","z":"74cedccf.2b6a6c","name":"Listen2AqBB_1a2d612","topic":"in/Aqara/switch/158d0001a2d612/action","qos":"2","datatype":"auto","broker":"c93e946f.f9c458","x":827.0141372680664,"y":4867.181776046753,"wires":[["be936690.18b4a8","20f387ae.35f478"]]},{"id":"be936690.18b4a8","type":"switch","z":"74cedccf.2b6a6c","name":"OnClick","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"click","vt":"str"},{"t":"eq","v":"double_click","vt":"str"},{"t":"eq","v":"long_click_press","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":1049.7015380859375,"y":4830.5029296875,"wires":[["1824c7db.cff148"],["55b7c576.f5ac0c"],["4c1adf12.e3d7f8"]]},{"id":"20f387ae.35f478","type":"debug","z":"74cedccf.2b6a6c","name":"mqttDebug","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":1193.014144897461,"y":4980,"wires":[]},{"id":"b0ea84ff.697b08","type":"ui_switch","z":"74cedccf.2b6a6c","name":"Tanya Lig","label":"Tanya Lig","group":"6eaf738f.cbb964","order":2,"width":"","height":"","passthru":false,"decouple":"true","topic":"cmnd/TanyaLig/Power","onvalue":"ON","onvalueType":"str","onicon":"","oncolor":"","offvalue":"OFF","offvalueType":"str","officon":"","offcolor":"","x":1414.1051025390625,"y":4393.2783203125,"wires":[["477222d5.0297ac"]]},{"id":"5ab4a027.f001e","type":"mqtt in","z":"74cedccf.2b6a6c","name":"GetTanyaLig","topic":"stat/TanyaLig/POWER","qos":"2","broker":"e6d8a0f0.6f5878","x":1167.1051139831543,"y":4414.460227012634,"wires":[["b0ea84ff.697b08"]]},{"id":"d937c5a1.97df38","type":"mqtt out","z":"74cedccf.2b6a6c","name":"SaveStateTanyaLig","topic":"","qos":"1","retain":"","broker":"e6d8a0f0.6f5878","x":1767.6051025390625,"y":4415.2783203125,"wires":[]},{"id":"6037d5b9.31276c","type":"function","z":"74cedccf.2b6a6c","name":"F-toggle","func":"var currentVoltage=msg.payload;\nvar msg2 = RED.util.cloneMessage(msg);\nmsg2.topic=\"cmnd/TanyaLig/Power\"\nmsg2.payload=\"toggle\"\nmsg2.retain=false\nreturn msg2;\n","outputs":1,"noerr":0,"x":1462.0909385681152,"y":4473.096009254456,"wires":[["d937c5a1.97df38"]]},{"id":"c0b1a392.2c78e","type":"mqtt in","z":"74cedccf.2b6a6c","name":"Listen2AqBB_186deda","topic":"in/Aqara/switch/158d000186de5f/action","qos":"2","broker":"c93e946f.f9c458","x":1080.1050987243652,"y":4515.908905029297,"wires":[["eaca75ed.b85338","ff3ca8a9.ebe168"]]},{"id":"eaca75ed.b85338","type":"switch","z":"74cedccf.2b6a6c","name":"OnClick","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"click","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":1315.7924919128418,"y":4513.230018615723,"wires":[["6037d5b9.31276c"]]},{"id":"ff3ca8a9.ebe168","type":"debug","z":"74cedccf.2b6a6c","name":"mqttDebug","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":1446.1051063537598,"y":4628.727128982544,"wires":[]},{"id":"b85c0502.20d6b8","type":"inject","z":"ccf72a10.c35188","name":"ExecuteAllLightsOff","topic":"","payload":"1","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":168.0142059326172,"y":515.0056791305542,"wires":[["c89164d2.ed7ac8","461fe0a2.75134"]]},{"id":"c89164d2.ed7ac8","type":"debug","z":"ccf72a10.c35188","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":465.01426696777344,"y":488.9971675872803,"wires":[]},{"id":"a2f5669c.463eb8","type":"comment","z":"ccf72a10.c35188","name":"Switch off all Lights in morning","info":"","x":161.0198974609375,"y":457.2101764678955,"wires":[]},{"id":"461fe0a2.75134","type":"mqtt out","z":"ccf72a10.c35188","name":"Send2/LGC/Scenes/AllLightsOff","topic":"/LGC/Scenes/AllLightsOff","qos":"","retain":"","broker":"e6d8a0f0.6f5878","x":922.014274597168,"y":527.9573793411255,"wires":[]},{"id":"5b04c17e.95869","type":"mqtt in","z":"ccf72a10.c35188","name":"/LGC/Scenes/AllLightsOff","topic":"/LGC/Scenes/AllLightsOff","qos":"2","broker":"e6d8a0f0.6f5878","x":144.00855255126953,"y":711.9431481361389,"wires":[["2a323055.967e"]]},{"id":"2a323055.967e","type":"function","z":"ccf72a10.c35188","name":"SendOFF","func":"msg.payload=\"OFF\";\nreturn msg;","outputs":1,"noerr":0,"x":382.0143051147461,"y":717.9971199035645,"wires":[["469fc355.4e44bc","dd927988.6bb2f8","c79527dd.e6c3a8","8fbcddd6.4a998","f006cfa5.3f38c","2af1d590.3de8ba","45144866.9e2018","18555790.d8e8b8"]]},{"id":"469fc355.4e44bc","type":"mqtt out","z":"ccf72a10.c35188","name":"TVLight","topic":"/LGC/Lights/Indoor/TVBackWall","qos":"","retain":"","broker":"e6d8a0f0.6f5878","x":713.014274597168,"y":613.9715766906738,"wires":[]},{"id":"dd927988.6bb2f8","type":"mqtt out","z":"ccf72a10.c35188","name":"StudyLight","topic":"/LGC/Lights/Indoor/Study","qos":"","retain":"","broker":"e6d8a0f0.6f5878","x":713.3323936462402,"y":658.8522663116455,"wires":[]},{"id":"6682504f.8cf3b","type":"inject","z":"ccf72a10.c35188","name":"SendAt9","topic":"","payload":"1","payloadType":"str","repeat":"","crontab":"00 09 * * *","once":false,"onceDelay":0.1,"x":268.6988868713379,"y":555.9658784866333,"wires":[["461fe0a2.75134"]]},{"id":"c79527dd.e6c3a8","type":"mqtt out","z":"ccf72a10.c35188","name":"RubenStudyLight","topic":"cmnd/sonoffpowtest/Power","qos":"","retain":"","broker":"e6d8a0f0.6f5878","x":732.0142211914062,"y":703.7329711914062,"wires":[]},{"id":"8fbcddd6.4a998","type":"mqtt out","z":"ccf72a10.c35188","name":"ShaneStudyLight","topic":"cmnd/ShaneLig/Power","qos":"","retain":"","broker":"e6d8a0f0.6f5878","x":732.0142211914062,"y":745.7329711914062,"wires":[]},{"id":"f006cfa5.3f38c","type":"mqtt out","z":"ccf72a10.c35188","name":"TanyaStudyLight","topic":"cmnd/TanyaLig/Power","qos":"","retain":"","broker":"e6d8a0f0.6f5878","x":732.0142211914062,"y":795.7329711914062,"wires":[]},{"id":"2af1d590.3de8ba","type":"mqtt out","z":"ccf72a10.c35188","name":"PoolLight","topic":"cmnd/PoolLight/Power","qos":"0","retain":"true","broker":"e6d8a0f0.6f5878","x":702.0142211914062,"y":845.2783813476562,"wires":[]},{"id":"45144866.9e2018","type":"mqtt out","z":"ccf72a10.c35188","name":"PoolGardenLights","topic":"cmnd/PoolGardenLights/Power","qos":"0","retain":"true","broker":"e6d8a0f0.6f5878","x":735.0142211914062,"y":892.2783813476562,"wires":[]},{"id":"18555790.d8e8b8","type":"mqtt out","z":"ccf72a10.c35188","name":"GekleurdeTuinLigte","topic":"/RS485/16/Ligte/BuiteLigte/state","qos":"0","retain":"true","broker":"e6d8a0f0.6f5878","x":737.0142211914062,"y":944.2783813476562,"wires":[]},{"id":"826f1d85.d15ab","type":"inject","z":"ccf72a10.c35188","name":"SendAt8","topic":"","payload":"1","payloadType":"str","repeat":"","crontab":"00 08 * * *","once":false,"onceDelay":0.1,"x":270.01422119140625,"y":594.2783813476562,"wires":[["461fe0a2.75134"]]},{"id":"9227e616.4bcfa8","type":"bigtimer","z":"46e74d40.66d774","outtopic":"","outpayload1":"true","outpayload2":"false","name":"Big Timer","lat":"-25.86188","lon":"28.17662","starttime":"1200","endtime":"1215","startoff":0,"endoff":"0","offs":0,"outtext1":"true","outtext2":"false","timeout":1440,"sun":true,"mon":true,"tue":true,"wed":true,"thu":true,"fri":true,"sat":true,"jan":true,"feb":true,"mar":true,"apr":true,"may":true,"jun":true,"jul":true,"aug":true,"sep":true,"oct":true,"nov":true,"dec":true,"day1":0,"month1":0,"day2":0,"month2":0,"day3":0,"month3":0,"day4":0,"month4":0,"day5":0,"month5":0,"d1":0,"w1":0,"d2":0,"w2":0,"d3":0,"w3":0,"d4":0,"w4":0,"d5":0,"w5":0,"suspend":false,"random":false,"repeat":false,"atstart":true,"odd":true,"even":false,"x":253.6903419494629,"y":2117.889274597168,"wires":[["bb4a3b49.760ce8"],[],[]]},{"id":"bb4a3b49.760ce8","type":"switch","z":"46e74d40.66d774","name":"OnlyOn","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"true","vt":"str"},{"t":"neq","v":"true","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":437.7017593383789,"y":2163.241503715515,"wires":[["b21b8355.653cd"],[]]},{"id":"3479aee7.a93032","type":"inject","z":"46e74d40.66d774","name":"on","topic":"","payload":"1","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":102.99999618530273,"y":2050.6108350753784,"wires":[["9227e616.4bcfa8"]]},{"id":"877ea51c.eedc78","type":"inject","z":"46e74d40.66d774","name":"off","topic":"","payload":"0","payloadType":"num","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":98.69884490966797,"y":2098.610908508301,"wires":[["9227e616.4bcfa8"]]},{"id":"3cda6a13.e5ea76","type":"inject","z":"46e74d40.66d774","name":"Auto","topic":"","payload":"auto","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":84.69033813476562,"y":2143.6080646514893,"wires":[["9227e616.4bcfa8"]]},{"id":"b21b8355.653cd","type":"function","z":"46e74d40.66d774","name":"","func":"var ZT;\nvar msg2 = RED.util.cloneMessage(msg);\n\nZT=global.get('ZoneTime')||0;\n\nif (ZT > 20 || ZT < 2)\n{\n   global.set('ZoneTime',20);\n}\nmsg2.payload = {\"ZT=\":ZT};\n\nreturn msg,msg2;","outputs":2,"noerr":0,"x":479.6931915283203,"y":2090.062395095825,"wires":[["e0de3a0.d8f73c8","1bd1df6.f574c21"],["1bd1df6.f574c21"]]},{"id":"1bd1df6.f574c21","type":"debug","z":"46e74d40.66d774","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":679.6931610107422,"y":2123.3295364379883,"wires":[]},{"id":"ccdf177a.4719e8","type":"inject","z":"74cedccf.2b6a6c","name":"SwitchOffAt23","topic":"/LGC/Pool/Pump/state","payload":"0","payloadType":"str","repeat":"","crontab":"30 23 * * 1","once":false,"onceDelay":0.1,"x":537.696044921875,"y":2212.79541015625,"wires":[["c3ae4fab.1c4278"]]},{"id":"269fe9f8.a1a5c6","type":"debug","z":"db25ff5f.95a8c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":810.7016448974609,"y":324.6931686401367,"wires":[]},{"id":"7ec0c25c.5b664c","type":"debug","z":"65fee79d.91ee58","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":847.6902923583984,"y":454.32386016845703,"wires":[]},{"id":"30a4aeee.e55e82","type":"debug","z":"e1c5a709.ef3138","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":770.7016448974609,"y":187.3352279663086,"wires":[]},{"id":"56c81550.fbe19c","type":"debug","z":"d7aa7eb2.229b","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":759.6931610107422,"y":1334.9630508422852,"wires":[]},{"id":"69e9c76.a9f9538","type":"debug","z":"65fee79d.91ee58","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":555.7017059326172,"y":429.32386016845703,"wires":[]},{"id":"cff10976.eee1d8","type":"debug","z":"65fee79d.91ee58","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":550.7017059326172,"y":624.323860168457,"wires":[]},{"id":"c0bec02e.1b5f4","type":"mqtt in","z":"65fee79d.91ee58","name":"ReadLGCState","topic":"/LGC/Spa/Pump/state","qos":"2","broker":"e6d8a0f0.6f5878","x":194.0142059326172,"y":889.2783813476562,"wires":[["bc8c385f.2ace98"]]},{"id":"f806389d.a89498","type":"mqtt out","z":"65fee79d.91ee58","name":"SavePHYState","topic":"/PHY/Spa/Pump/state","qos":"2","retain":"","broker":"e6d8a0f0.6f5878","x":808.0142135620117,"y":833.2784099578857,"wires":[]},{"id":"3b0c5e10.b50812","type":"mqtt in","z":"65fee79d.91ee58","name":"ReadDBSpaState","topic":"/db/spa/all","qos":"2","broker":"e6d8a0f0.6f5878","x":198.01421356201172,"y":822.2783851623535,"wires":[["bc8c385f.2ace98","43544f13.03a8c"]]},{"id":"ca20db04.9d0018","type":"mqtt in","z":"65fee79d.91ee58","name":"ReadDBSpaPumpState","topic":"/db/spa/pump","qos":"2","broker":"e6d8a0f0.6f5878","x":208.01421356201172,"y":753.2784099578857,"wires":[["bc8c385f.2ace98","43544f13.03a8c"]]},{"id":"bc8c385f.2ace98","type":"function","z":"65fee79d.91ee58","name":"SPA_PUMP","func":"// set switch topic\n// find which input it was\n\n\n//object\n\n//RollupParent\n//Parents\n//  Parent topic\n//  Parent output\n//  SwitchState\n//switchState\n//output\n\nvar switchObject = { \n                      topic:\"/PHY/Spa/Pump/state\", \n                      switchState:\"\", \n                      output:\"\",\n                      wattage:\"\",\n                      RollupParent:\"\",\n                      Parents:[]\n                   };\n\nvar newMsg = { payload: msg.payload,topic:msg.topic };\n\nreturn msg;","outputs":1,"noerr":0,"x":498.0142135620117,"y":833.2784099578857,"wires":[["f806389d.a89498","574df414.0cc7dc"]]},{"id":"574df414.0cc7dc","type":"debug","z":"65fee79d.91ee58","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":795.7045059204102,"y":767.6022701263428,"wires":[]},{"id":"43544f13.03a8c","type":"debug","z":"65fee79d.91ee58","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":503.7159194946289,"y":742.6022701263428,"wires":[]},{"id":"43977f9d.945b5","type":"bigtimer","z":"74cedccf.2b6a6c","outtopic":"/LGC/Pool/Pump/state","outpayload1":"0","outpayload2":"0","name":"PoolPump of at 11","lat":"-25.8619229","lon":"28.1774539","starttime":"1425","endtime":"1425","startoff":"0","endoff":0,"offs":0,"outtext1":"Off","outtext2":"Off","timeout":1440,"sun":true,"mon":true,"tue":true,"wed":true,"thu":true,"fri":true,"sat":true,"jan":true,"feb":true,"mar":true,"apr":true,"may":true,"jun":true,"jul":true,"aug":true,"sep":true,"oct":true,"nov":true,"dec":true,"day1":0,"month1":0,"day2":0,"month2":0,"day3":0,"month3":0,"day4":0,"month4":0,"day5":0,"month5":0,"d1":0,"w1":0,"d2":0,"w2":0,"d3":0,"w3":0,"d4":0,"w4":0,"d5":0,"w5":0,"suspend":true,"random":false,"repeat":false,"atstart":false,"odd":true,"even":true,"x":122.99999618530273,"y":2217.2783203125,"wires":[["c3ae4fab.1c4278"],[],[]]},{"id":"5bd72b74.836614","type":"inject","z":"46e74d40.66d774","name":"Manual","topic":"","payload":"manual","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":85.01420593261719,"y":2199.005615234375,"wires":[["9227e616.4bcfa8"]]},{"id":"57489d8d.e51554","type":"inject","z":"46e74d40.66d774","name":"Override OFF","topic":"","payload":"off_override","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":106.01420593261719,"y":2251.005615234375,"wires":[["9227e616.4bcfa8"]]},{"id":"46d11e7d.3cf8","type":"ui_switch","z":"d7aa7eb2.229b","name":"BesproeiingMains","label":"Besproeiing Mains","group":"785a2ca0.c143a4","order":3,"width":"","height":"","passthru":false,"decouple":"false","topic":"/db/Besproeiing/Mains","onvalue":"1","onvalueType":"str","onicon":"","oncolor":"","offvalue":"0","offvalueType":"str","officon":"","offcolor":"","x":512,"y":1438,"wires":[["ec83a623.29ee9"]]},{"id":"f176a8d2.e882b","type":"mqtt in","z":"d7aa7eb2.229b","name":"ReadState","topic":"/db/Besproeiing/Mains","qos":"2","broker":"e6d8a0f0.6f5878","x":284,"y":1445,"wires":[["46d11e7d.3cf8"]]},{"id":"ec83a623.29ee9","type":"mqtt out","z":"d7aa7eb2.229b","name":"SaveState","topic":"","qos":"2","retain":"true","broker":"e6d8a0f0.6f5878","x":797.5,"y":1436,"wires":[]},{"id":"e7c7d5c6.c3b0c","type":"comment","z":"d7aa7eb2.229b","name":"Besproeiing","info":"","x":136,"y":1404,"wires":[]},{"id":"db6a3728.9a35d","type":"ui_switch","z":"46e74d40.66d774","name":"BesproeiingMains","label":"Besproeiing Mains","group":"14fdd9e3.cf19d6","order":1,"width":"","height":"","passthru":false,"decouple":"false","topic":"/db/Besproeiing/Mains","onvalue":"1","onvalueType":"str","onicon":"","oncolor":"","offvalue":"0","offvalueType":"str","officon":"","offcolor":"","x":520,"y":2300,"wires":[["739f760e.6f11a"]]},{"id":"bdf0942.18f7ce8","type":"mqtt in","z":"46e74d40.66d774","name":"ReadState","topic":"/db/Besproeiing/Mains","qos":"2","broker":"e6d8a0f0.6f5878","x":292,"y":2307,"wires":[["db6a3728.9a35d"]]},{"id":"739f760e.6f11a","type":"mqtt out","z":"46e74d40.66d774","name":"SaveState","topic":"","qos":"2","retain":"","broker":"e6d8a0f0.6f5878","x":805.5,"y":2298,"wires":[]},{"id":"b982688b.36eef8","type":"mqtt in","z":"f7ae3c4c.0308","name":"/db/Besproeiing/Mains","topic":"/db/Besproeiing/Mains","qos":"2","broker":"e6d8a0f0.6f5878","x":373,"y":282,"wires":[["fac83942.ba19a"]]},{"id":"fac83942.ba19a","type":"function","z":"f7ae3c4c.0308","name":"Save2Mem","func":"global.set(\"db.BesproeiingMains\", msg.payload);\nmsg.payload=\"Saving BesproeiingMains (\"+msg.payload+\") to Memory \";\nreturn msg;","outputs":1,"noerr":0,"x":595.5,"y":284,"wires":[["8e136537.0e75e"]]},{"id":"8e136537.0e75e","type":"debug","z":"f7ae3c4c.0308","name":"Debug","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":918.5,"y":279,"wires":[]},{"id":"7349007b.2b6cc8","type":"function","z":"db25ff5f.95a8c","name":"PoolPump","func":"//Now we read all variables\nvar swDbPoolAll = global.get(\"db.PoolAll\")||2;\nvar swDbPoolPump = global.get(\"db.PoolPump\")||2;\nvar swForceOnPoolPump = global.get(\"ForceOn.PoolPump\")||2;\nvar swLgcPoolPumpState = global.get(\"Logical.PoolPumpState\")||2;\n\n//Default to off\nmsg.payload=0;\n\nif (swDbPoolAll==1 && swDbPoolPump==1) {\n    if (swLgcPoolPumpState==1) {\n        //Switch it on\n        msg.payload=1;\n    } else {\n        if (swForceOnPoolPump==1) {\n            msg.payload=1;\n        }        \n    } \n} else {\n    node.warn(\"Not switching on because DB or Group is off\");\n}\n\nreturn msg;","outputs":"1","noerr":0,"x":678,"y":970,"wires":[["48d86f1e.6d1e28","61b4b2e0.857f4c"]]},{"id":"9b1918cf.b9b8a8","type":"mqtt in","z":"db25ff5f.95a8c","name":"/LGC/Pool/Pump/state","topic":"/LGC/Pool/Pump/state","qos":"2","broker":"e6d8a0f0.6f5878","x":194,"y":910,"wires":[["fd5f7232.2ee9b8"]]},{"id":"48d86f1e.6d1e28","type":"mqtt out","z":"db25ff5f.95a8c","name":"SaveState","topic":"cmnd/PoolPump/Power","qos":"2","retain":"","broker":"e6d8a0f0.6f5878","x":926,"y":962,"wires":[]},{"id":"27736897.9efaf8","type":"mqtt in","z":"db25ff5f.95a8c","name":"/db/pool/pump","topic":"/db/pool/pump","qos":"2","broker":"e6d8a0f0.6f5878","x":212,"y":1011,"wires":[["fd5f7232.2ee9b8"]]},{"id":"b954a7ec.b4018","type":"mqtt in","z":"db25ff5f.95a8c","name":"/db/pool/all","topic":"/db/pool/all","qos":"2","broker":"e6d8a0f0.6f5878","x":233,"y":958,"wires":[["fd5f7232.2ee9b8"]]},{"id":"8b3650f0.14c0e","type":"mqtt in","z":"db25ff5f.95a8c","name":" /ForceOn/Pool/Pump","topic":" /ForceOn/Pool/Pump","qos":"2","broker":"e6d8a0f0.6f5878","x":196,"y":1061,"wires":[["fd5f7232.2ee9b8"]]},{"id":"89bf7677.8eefd","type":"comment","z":"db25ff5f.95a8c","name":"PoolPump","info":"","x":161,"y":861,"wires":[]},{"id":"61b4b2e0.857f4c","type":"debug","z":"db25ff5f.95a8c","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":899.5,"y":1029,"wires":[]},{"id":"1cb7ec.ebb7d014","type":"comment","z":"c9ef5ae6.3b2398","name":"Pool","info":"","x":100,"y":88,"wires":[]},{"id":"eb29b0e0.a76fb","type":"ui_switch","z":"c9ef5ae6.3b2398","name":"POOLPUMP","label":"Pool Pump ForceOn","group":"49045aeb.df53e4","order":9,"width":"","height":"","passthru":false,"decouple":"false","topic":" /ForceOn/Pool/Pump","onvalue":"1","onvalueType":"str","onicon":"","oncolor":"","offvalue":"0","offvalueType":"str","officon":"","offcolor":"","x":534,"y":126,"wires":[["82070faa.0e63c8"]]},{"id":"de8578f2.c3b3c","type":"mqtt in","z":"c9ef5ae6.3b2398","name":"ReadState","topic":" /ForceOn/Pool/Pump","qos":"2","broker":"e6d8a0f0.6f5878","x":274,"y":128,"wires":[["eb29b0e0.a76fb"]]},{"id":"82070faa.0e63c8","type":"mqtt out","z":"c9ef5ae6.3b2398","name":"SaveState","topic":"","qos":"2","retain":"","broker":"e6d8a0f0.6f5878","x":860.5,"y":126,"wires":[]},{"id":"6363477e.6bbad8","type":"mqtt in","z":"f7ae3c4c.0308","name":"/LGC/Pool/Pump/state","topic":"/LGC/Pool/Pump/state","qos":"2","broker":"e6d8a0f0.6f5878","x":349,"y":399,"wires":[["1e1d1035.edaee8"]]},{"id":"7a553a8d.b12dbc","type":"mqtt in","z":"f7ae3c4c.0308","name":"/db/pool/pump","topic":"/db/pool/pump","qos":"2","broker":"e6d8a0f0.6f5878","x":367,"y":500,"wires":[["2a91242d.092e4c"]]},{"id":"dd5f345e.ae1248","type":"mqtt in","z":"f7ae3c4c.0308","name":"/db/pool/all","topic":"/db/pool/all","qos":"2","broker":"e6d8a0f0.6f5878","x":388,"y":447,"wires":[["2abeb1bf.e0050e"]]},{"id":"aa829508.8bab7","type":"mqtt in","z":"f7ae3c4c.0308","name":" /ForceOn/Pool/Pump","topic":" /ForceOn/Pool/Pump","qos":"2","broker":"e6d8a0f0.6f5878","x":351,"y":550,"wires":[["e1393b3c.ef702"]]},{"id":"1e1d1035.edaee8","type":"function","z":"f7ae3c4c.0308","name":"Save2Mem","func":"global.set(\"Logical.PoolPumpState\", msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":567,"y":399,"wires":[[]]},{"id":"2abeb1bf.e0050e","type":"function","z":"f7ae3c4c.0308","name":"Save2Mem","func":"global.set(\"db.PoolAll\", msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":569,"y":446,"wires":[[]]},{"id":"2a91242d.092e4c","type":"function","z":"f7ae3c4c.0308","name":"Save2Mem","func":"global.set(\"db.PoolPump\", msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":574,"y":490,"wires":[[]]},{"id":"e1393b3c.ef702","type":"function","z":"f7ae3c4c.0308","name":"Save2Mem","func":"global.set(\"ForceOn.PoolPump\", msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":577,"y":535,"wires":[[]]},{"id":"fd5f7232.2ee9b8","type":"delay","z":"db25ff5f.95a8c","name":"","pauseType":"delay","timeout":"50","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":475.5,"y":970,"wires":[["7349007b.2b6cc8"]]},{"id":"f75f7d58.8fecf8","type":"nut-ups","z":"615e8fde.26f62","name":"CyberPowerUPS","ups":"cp1","x":388.5,"y":181,"wires":[["e54a9950.2c2e4","340f452e.8daefa"]]},{"id":"e54a9950.2c2e4","type":"debug","z":"615e8fde.26f62","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":688.5,"y":126,"wires":[]},{"id":"ca3563fc.e2ec7","type":"inject","z":"615e8fde.26f62","name":"","topic":"","payload":"","payloadType":"date","repeat":"60","crontab":"","once":false,"onceDelay":0.1,"x":186.5,"y":110,"wires":[["f75f7d58.8fecf8"]]},{"id":"be7fb172.75a118","type":"mqtt in","z":"615e8fde.26f62","name":"","topic":"upsmon","qos":"2","broker":"56fc61c8.bc429","x":192,"y":276,"wires":[["12224cf2.71f86b"]]},{"id":"eb0d3381.9bd9f8","type":"debug","z":"615e8fde.26f62","name":"","active":false,"console":"false","complete":"payload","x":708,"y":273,"wires":[]},{"id":"74acaf82.493fe8","type":"ui_gauge","z":"615e8fde.26f62","name":"UPS Load","group":"c52b78ea.b74b88","order":0,"width":0,"height":0,"gtype":"donut","title":"Load","label":"%","format":"{{value}}","min":0,"max":"100","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":708,"y":358,"wires":[]},{"id":"c8b34b3e.83e8a8","type":"function","z":"615e8fde.26f62","name":"UPS_Load","func":"//msg.payload = Number(msg.payload.ups_load);\n//msg.payload = Number(msg.payload.battery.capacity);\nmsg.payload = Number(msg.payload.ups.load.value);\nreturn msg;","outputs":1,"noerr":0,"x":450,"y":360,"wires":[["74acaf82.493fe8","69f2709d.b21238"]]},{"id":"12224cf2.71f86b","type":"json","z":"615e8fde.26f62","name":"To Json","x":207,"y":363,"wires":[["c8b34b3e.83e8a8","d02a1d0f.0774c8","396b9540.d3f672","da3a7d6b.e7159","e853226a.950e3"]]},{"id":"69f2709d.b21238","type":"ui_chart","z":"615e8fde.26f62","name":"Ups Load/Time","group":"c52b78ea.b74b88","order":0,"width":0,"height":0,"label":"Load/Time","chartType":"line","legend":"false","xformat":"HH:mm","interpolate":"linear","nodata":"","dot":false,"ymin":"0","ymax":"100","removeOlder":1,"removeOlderPoints":"120","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":true,"x":717,"y":411,"wires":[[],[]]},{"id":"d02a1d0f.0774c8","type":"function","z":"615e8fde.26f62","name":"Battery Status","func":"var Vbats = msg.payload.battery.voltage.value;\n\n//var Vbat = Vbats.replace(\"_\",\".\");\n\nmsg.payload = Number(Vbats);\n\nreturn msg;","outputs":1,"noerr":0,"x":478,"y":521,"wires":[["af4b129f.10713"]]},{"id":"396b9540.d3f672","type":"function","z":"615e8fde.26f62","name":"V IN","func":"var Vins = msg.payload.input.voltage.value;\n\n//var Vin = Vins.replace(\"_\",\".\");\n\nmsg.payload = Number(Vins);\nreturn msg;","outputs":1,"noerr":0,"x":447,"y":755,"wires":[["d7e5cd4a.117d28","7b199cbb.024744","eb0d3381.9bd9f8"]]},{"id":"af4b129f.10713","type":"ui_gauge","z":"615e8fde.26f62","name":"","group":"64214ba9.d37bcc","order":0,"width":0,"height":0,"gtype":"gage","title":"Curr. Bat. Voltage","label":"V. Bat","format":"{{value}}","min":"23","max":"28","colors":["#b50000","#e6e600","#00b500"],"seg1":"","seg2":"","x":694,"y":517,"wires":[]},{"id":"d7e5cd4a.117d28","type":"ui_gauge","z":"615e8fde.26f62","name":"Input AC Voltage","group":"1330971f.f66ce1","order":0,"width":0,"height":0,"gtype":"gage","title":"VIN AC","label":"V AC","format":"{{value}}","min":"190","max":"240","colors":["#00b500","#e6e600","#ca3838"],"x":738,"y":754,"wires":[]},{"id":"da3a7d6b.e7159","type":"function","z":"615e8fde.26f62","name":"Bat Runtime","func":"msg.payload = Number(msg.payload.battery.runtime.value);\nreturn msg;","outputs":1,"noerr":0,"x":493,"y":590,"wires":[["9683ced.bcfbd3","abf12fad.6d7a78"]]},{"id":"9683ced.bcfbd3","type":"ui_gauge","z":"615e8fde.26f62","name":"UPS Level","group":"8371fcf7.880f8","order":0,"width":0,"height":0,"gtype":"wave","title":"UPS Runtime","label":"","format":"{{value}}","min":0,"max":"55000","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":720,"y":576,"wires":[]},{"id":"e853226a.950e3","type":"function","z":"615e8fde.26f62","name":"Bat Charge","func":"var Vcharges = msg.payload.battery.charge.value;\n\n//var Vcharge = Vcharges.replace(\"_\",\".\");\n\nmsg.payload = Number(Vcharges);\n\n\nreturn msg;","outputs":1,"noerr":0,"x":482.5,"y":680,"wires":[["5a4aad56.c88044"]]},{"id":"5a4aad56.c88044","type":"ui_gauge","z":"615e8fde.26f62","name":"Battery Charge","group":"64214ba9.d37bcc","order":0,"width":0,"height":0,"gtype":"gage","title":"Battery Charge","label":"%","format":"{{value}}","min":0,"max":"100","colors":["#ff0000","#e6e600","#00ff01"],"x":739,"y":679,"wires":[]},{"id":"abf12fad.6d7a78","type":"ui_chart","z":"615e8fde.26f62","name":"","group":"8371fcf7.880f8","order":0,"width":0,"height":0,"label":"Runtime (sec)","chartType":"line","legend":"false","xformat":"HH:mm","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"1000","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":true,"x":703,"y":626,"wires":[[],[]]},{"id":"7b199cbb.024744","type":"ui_chart","z":"615e8fde.26f62","name":"Vin/Time","group":"1330971f.f66ce1","order":0,"width":0,"height":0,"label":"VAC In/Time","chartType":"line","legend":"false","xformat":"HH:mm","interpolate":"linear","nodata":"","dot":false,"ymin":"190","ymax":"240","removeOlder":"24","removeOlderPoints":"1200","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":true,"x":713,"y":826,"wires":[[],[]]},{"id":"340f452e.8daefa","type":"mqtt out","z":"615e8fde.26f62","name":"","topic":"upsmon","qos":"","retain":"","broker":"56fc61c8.bc429","x":648.5,"y":197,"wires":[]},{"id":"15f2a7d4.0bcd3","type":"mqtt in","z":"17f2fcdf.e26acb","name":"zigbee2mqtt/out","topic":"zigbee2mqtt/bridge/networkmap/graphviz","qos":"2","broker":"6354184f.0cac68","x":120,"y":140,"wires":[["c1e307d7.465a68"]]},{"id":"f03e3ed2.b8d0f8","type":"http in","z":"17f2fcdf.e26acb","name":"","url":"/adminpanelapi/networkmap/graphviz","method":"get","upload":false,"swaggerDoc":"","x":200,"y":200,"wires":[["99a53785.ac38f8"]]},{"id":"d25cd79b.e05e1","type":"http response","z":"17f2fcdf.e26acb","name":"","x":610,"y":200,"wires":[]},{"id":"99a53785.ac38f8","type":"function","z":"17f2fcdf.e26acb","name":"get from flow","func":"var networkmap = flow.get('networkmap');\n\nmsg.payload = networkmap;\nreturn msg;","outputs":1,"noerr":0,"x":470,"y":200,"wires":[["d25cd79b.e05e1"]]},{"id":"1cad6e76.f5484a","type":"inject","z":"17f2fcdf.e26acb","name":"","topic":"","payload":"graphviz","payloadType":"str","repeat":"30","crontab":"","once":true,"onceDelay":0.1,"x":120,"y":80,"wires":[["eeb7ca41.62286"]]},{"id":"c1e307d7.465a68","type":"function","z":"17f2fcdf.e26acb","name":"store in flow","func":"flow.set('networkmap',msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":290,"y":140,"wires":[[]]},{"id":"eeb7ca41.62286","type":"mqtt out","z":"17f2fcdf.e26acb","name":"zigbee2mqtt/in","topic":"zigbee2mqtt/bridge/networkmap","qos":"","retain":"","broker":"ad236b55.6b1d","x":280,"y":80,"wires":[]},{"id":"613dab3b.011fec","type":"http in","z":"17f2fcdf.e26acb","name":"","url":"/adminpanelapi/networkmap/viz/:engine","method":"get","upload":false,"swaggerDoc":"","x":210,"y":260,"wires":[["77f81578.054ccc"]]},{"id":"8c976aed.f5269","type":"http response","z":"17f2fcdf.e26acb","name":"","statusCode":"","headers":{},"x":810,"y":260,"wires":[]},{"id":"8a58cde1.936e8","type":"function","z":"17f2fcdf.e26acb","name":"generate viz html","func":"var html = `<!DOCTYPE html>\n<html lang=\"en\">\n  <head>\n    <meta charset=\"UTF-8\">\n    <title>NetworkMap</title>\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/viz.js/2.1.2/viz.js\"></script>\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/viz.js/2.1.2/full.render.js\"></script>\n    <script src='https://cdn.jsdelivr.net/npm/svg-pan-zoom@3.5.0/dist/svg-pan-zoom.min.js'></script>\n    <style>\n    svg {\n      width: 100% !important;\n      height: 100% !important;\n      min-width: 100% !important;\n      min-height: 80% !important;\n    }\n    </style>\n  </head>\n  <body>\n    <div id=\"output\"></div>\n    \n    <script>\n        var graphData = '${(flow.get('networkmap')).replace(/(\\r\\n|\\n|\\r)/gm,\"\")}';\n        var vizOptions = { format: 'svg', engine: '${msg.engine}'}\n        var graph = document.querySelector(\"#output\");\n        var svg = graph.querySelector(\"svg\");\n        if (svg) {\n          graph.removeChild(svg);\n        }        \n\n        var viz = new Viz();\n\n        viz.renderSVGElement(graphData, vizOptions)\n          .then(function(svg) {\n            svg.id = \"svg_output\";\n            graph.appendChild(svg);              \n            \n            panZoom = svgPanZoom(svg, {\n              zoomEnabled: true,\n              controlIconsEnabled: true,\n              contain: true,\n              center: true,\n              minZoom: 0.1\n            });\n\n            svg.addEventListener('paneresize', function(e) {\n              panZoom.resize();\n            }, false);\n            window.addEventListener('resize', function(e) {\n              panZoom.resize();\n            });\n          })\n          .catch(error => {\n            // Create a new Viz instance (@see Caveats page for more info)\n            viz = new Viz();\n  \n            // Possibly display the error\n            console.error(error);\n          });\n    </script>\n  </body>\n</html>\n`\n\nmsg.payload = html;\nreturn msg;","outputs":1,"noerr":0,"x":650,"y":260,"wires":[["8c976aed.f5269"]]},{"id":"77f81578.054ccc","type":"function","z":"17f2fcdf.e26acb","name":"set engine","func":"var availableEngines = ['circo', 'dot', 'fdp', 'neato', 'osage', 'twopi']\nif(availableEngines.includes(msg.req.params.engine)) { msg.engine = msg.req.params.engine }\nelse { msg.engine = 'dot' }\nreturn msg;","outputs":1,"noerr":0,"x":470,"y":260,"wires":[["8a58cde1.936e8"]]},{"id":"fc522d32.2e4d78","type":"mqtt in","z":"25dfd7a6.3ce178","name":"zigbee2mqtt/logging","topic":"zigbee2mqtt/bridge/log","qos":"2","broker":"6354184f.0cac68","x":290,"y":140,"wires":[["cdbc704c.d8a41"]]},{"id":"cdbc704c.d8a41","type":"json","z":"25dfd7a6.3ce178","name":"","property":"payload","action":"","pretty":false,"x":450,"y":140,"wires":[["700e52bc.f11984","e596895f.b6bb7","fdcfe337.ea0ab8"]]},{"id":"9646d30e.e67c6","type":"ui_toast","z":"25dfd7a6.3ce178","position":"top right","displayTime":"30","highlight":"","outputs":0,"ok":"OK","cancel":"","topic":"System Notification","name":"","x":950,"y":80,"wires":[]},{"id":"700e52bc.f11984","type":"function","z":"25dfd7a6.3ce178","name":"Notification","func":"if(msg.payload.type == \"pairing\" && msg.payload.message == \"connecting with device\") {\n\nmsg.payload = (\"A device is attempting to pair...\");\n\nreturn msg;\n}\n","outputs":1,"noerr":0,"x":750,"y":80,"wires":[["9646d30e.e67c6"]]},{"id":"50765ab5.3f3f0c","type":"comment","z":"25dfd7a6.3ce178","name":"Notification","info":"","x":110,"y":140,"wires":[]},{"id":"bea26bc4.c22778","type":"comment","z":"25dfd7a6.3ce178","name":"Pairing","info":"","x":590,"y":80,"wires":[]},{"id":"917df261.223f9","type":"ui_toast","z":"25dfd7a6.3ce178","position":"top right","displayTime":"10","highlight":"","outputs":0,"ok":"OK","cancel":"","topic":"System Notification","name":"","x":950,"y":200,"wires":[]},{"id":"e596895f.b6bb7","type":"function","z":"25dfd7a6.3ce178","name":"Notification","func":"if(msg.payload.type == \"device_connected\") {\n\nmsg.payload = (\"Device paired successfully: \" + msg.payload.message);\n\nreturn msg;\n}\n","outputs":1,"noerr":0,"x":750,"y":200,"wires":[["917df261.223f9"]]},{"id":"844b4506.fa64e","type":"comment","z":"25dfd7a6.3ce178","name":"Paired","info":"","x":590,"y":200,"wires":[]},{"id":"eb4a947.a9b44e8","type":"ui_toast","z":"25dfd7a6.3ce178","position":"top right","displayTime":"30","highlight":"","outputs":0,"ok":"OK","cancel":"","topic":"System Notification","name":"","x":1030,"y":140,"wires":[]},{"id":"fdcfe337.ea0ab8","type":"function","z":"25dfd7a6.3ce178","name":"Notification","func":"if(msg.payload.type == \"pairing\" && msg.payload.message == \"device incoming\") {\n\nmsg.payload = (\"A device is incoming or repairing...\");\n\nreturn msg;\n}\n","outputs":1,"noerr":0,"x":830,"y":140,"wires":[["eb4a947.a9b44e8"]]},{"id":"46576f5b.304d58","type":"comment","z":"25dfd7a6.3ce178","name":"Incoming or Repairing","info":"","x":640,"y":140,"wires":[]},{"id":"e72405d3.3b962","type":"mqtt in","z":"9c9c1888.cd55a8","name":"zigbee2mqtt/out devices","topic":"zigbee2mqtt/bridge/log","qos":"2","broker":"6354184f.0cac68","x":350,"y":140,"wires":[["9093099e.24f67"]]},{"id":"cedac222.c6bdd8","type":"ui_template","z":"9c9c1888.cd55a8","group":"5c97d771.4af83","name":"","order":0,"width":"12","height":"12","format":"<table>\n<tr>\n    <td><B><U>Name:</U></B></td>\n    <td><B><U>ieeeAddr:</U></B></td>\n    <td><B><U>Model:</U></B></td>\n    <td><B><U>Type:</U></B></td>\n</tr>\n  <tr ng-repeat=\"obj in msg.payload.message\">\n    <td>{{ obj.friendly_name }}</td>\n    <td>{{ obj.ieeeAddr }}</td>\n    <td>{{ obj.model }}</td>\n    <td>{{ obj.type }}</td>\n  </tr>\n\n</table>\n\n","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":685,"y":104,"wires":[[]]},{"id":"42402743.8b406","type":"mqtt out","z":"9c9c1888.cd55a8","name":"zigbee2mqtt/in devices","topic":"zigbee2mqtt/bridge/config/devices","qos":"","retain":"","broker":"6354184f.0cac68","x":580,"y":60,"wires":[]},{"id":"6531da6e.e9740c","type":"inject","z":"9c9c1888.cd55a8","name":"Request Device List","topic":"","payload":"","payloadType":"date","repeat":"4","crontab":"","once":true,"onceDelay":0.1,"x":360,"y":60,"wires":[["42402743.8b406"]]},{"id":"c557d943.a32f88","type":"comment","z":"9c9c1888.cd55a8","name":"Request Device List","info":"","x":130,"y":60,"wires":[]},{"id":"b51b34ef.1c7db8","type":"comment","z":"9c9c1888.cd55a8","name":"Receive Device List","info":"","x":130,"y":140,"wires":[]},{"id":"9093099e.24f67","type":"json","z":"9c9c1888.cd55a8","name":"","property":"payload","action":"","pretty":false,"x":530,"y":140,"wires":[["cedac222.c6bdd8","46edd67b.df354","cc5675f1.48c4e8"]]},{"id":"857f1c4c.9878d8","type":"http in","z":"9c9c1888.cd55a8","name":"","url":"/adminpanelapi/devicelist","method":"get","upload":false,"swaggerDoc":"","x":530,"y":220,"wires":[["a6cbb4a6.28ef88"]]},{"id":"46edd67b.df354","type":"function","z":"9c9c1888.cd55a8","name":"Store Data","func":"flow.set('devicelist',msg.payload);","outputs":1,"noerr":0,"x":296,"y":247,"wires":[[]]},{"id":"2beee173.102cfe","type":"http response","z":"9c9c1888.cd55a8","name":"","x":870,"y":220,"wires":[]},{"id":"a6cbb4a6.28ef88","type":"function","z":"9c9c1888.cd55a8","name":"Get Data","func":"var devicelist = flow.get('devicelist');\nmsg.payload = devicelist;\nreturn msg;","outputs":1,"noerr":0,"x":740,"y":220,"wires":[["2beee173.102cfe"]]},{"id":"c314c32b.f3ae98","type":"comment","z":"9c9c1888.cd55a8","name":"HTTP JSON API","info":"","x":120,"y":220,"wires":[]},{"id":"cc5675f1.48c4e8","type":"function","z":"9c9c1888.cd55a8","name":"Store Globally","func":"global.set('zigbee2mqttdevicelist',msg.payload.message);\nreturn msg;","outputs":1,"noerr":0,"x":901,"y":140,"wires":[[]]},{"id":"f76ef9a9.63c8b8","type":"mqtt in","z":"ee4ab2d3.1c8a8","name":"zigbee2mqtt/bridge state","topic":"zigbee2mqtt/bridge/state","qos":"2","broker":"6354184f.0cac68","x":270,"y":80,"wires":[["201507df.1fe8c8"]]},{"id":"201507df.1fe8c8","type":"function","z":"ee4ab2d3.1c8a8","name":"Format Data","func":"flow.set('bridgestate',msg.payload);\nvar bridgestate = flow.get('bridgestate');\nmsg.payload = bridgestate;\nreturn msg;","outputs":1,"noerr":0,"x":470,"y":80,"wires":[["7f6e3ce4.53883c"]]},{"id":"93868ce3.2ba448","type":"ui_template","z":"ee4ab2d3.1c8a8","group":"13d7525b.841376","name":"","order":0,"width":"6","height":"2","format":"<style>\n    {{msg.style}}\n</style>\n\n<table>\n  <tr>\n    <td>Bridge</td>\n    <td>{{msg.payload.bridgestate}}</td>\n  </tr>\n  <tr>\n    <td>Devices</td>\n    <td>{{msg.payload.numberofdevices}}</td>\n  </tr>\n</table>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":660,"y":140,"wires":[[]]},{"id":"8446d93e.d4b69","type":"function","z":"ee4ab2d3.1c8a8","name":"Format Data","func":"var bridgestate = flow.get('bridgestate');\nvar devicelist = global.get('zigbee2mqttdevicelist');\nmsg.payload = {}\nmsg.payload.bridgestate = bridgestate;\nmsg.payload.numberofdevices = devicelist.length;\n\nreturn msg;","outputs":1,"noerr":0,"x":510,"y":140,"wires":[["93868ce3.2ba448"]]},{"id":"64eb3c83.37740c","type":"inject","z":"ee4ab2d3.1c8a8","name":"","topic":"","payload":"","payloadType":"date","repeat":"3","crontab":"","once":true,"onceDelay":0.1,"x":350,"y":140,"wires":[["8446d93e.d4b69"]]},{"id":"7f6e3ce4.53883c","type":"debug","z":"ee4ab2d3.1c8a8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":610,"y":80,"wires":[]},{"id":"da340cbb.f223a8","type":"comment","z":"ee4ab2d3.1c8a8","name":"Get state","info":"","x":80,"y":80,"wires":[]},{"id":"cc466006.7cd5f","type":"comment","z":"ee4ab2d3.1c8a8","name":"Update Web UI on Interval","info":"","x":130,"y":140,"wires":[]},{"id":"2d4101a0.931a56","type":"http in","z":"ee4ab2d3.1c8a8","name":"","url":"/adminpanelapi/state","method":"get","upload":false,"swaggerDoc":"","x":270,"y":220,"wires":[["230ae1f4.efd516"]]},{"id":"5f902b7e.ef7fd4","type":"http response","z":"ee4ab2d3.1c8a8","name":"","x":590,"y":220,"wires":[]},{"id":"230ae1f4.efd516","type":"function","z":"ee4ab2d3.1c8a8","name":"Get Data","func":"var bridgestate = flow.get('bridgestate');\nmsg.payload = bridgestate;\nreturn msg;","outputs":1,"noerr":0,"x":460,"y":220,"wires":[["5f902b7e.ef7fd4"]]},{"id":"845a44db.0af428","type":"comment","z":"ee4ab2d3.1c8a8","name":"HTTP API","info":"","x":80,"y":220,"wires":[]},{"id":"58878761.e32d8","type":"ui_dropdown","z":"96bcddc3.ee066","name":"","label":"","place":"Select option","group":"e08ef83b.319a4","order":1,"width":0,"height":0,"passthru":true,"options":[{"label":"Info","value":"info","type":"str"},{"label":"Debug","value":"debug","type":"str"},{"label":"Warn","value":"warn","type":"str"},{"label":"Error","value":"error","type":"str"}],"payload":"","topic":"","x":120,"y":60,"wires":[["56ffba59.ec0d1c"]]},{"id":"56ffba59.ec0d1c","type":"mqtt out","z":"96bcddc3.ee066","name":"zigbee2mqtt/in Logging Level","topic":"zigbee2mqtt/bridge/config/log_level","qos":"","retain":"","broker":"ad236b55.6b1d","x":380,"y":60,"wires":[]},{"id":"cf9f3c37.104718","type":"ui_text_input","z":"42b8f54d.421ebc","name":"","label":"Device Name","group":"21062c5b.b1996c","order":3,"width":0,"height":0,"passthru":true,"mode":"text","delay":"5","topic":"","x":300,"y":60,"wires":[["e0d85554.3b858"]]},{"id":"abae8314.e495f","type":"mqtt out","z":"42b8f54d.421ebc","name":"zigbee2mqtt/in Remove","topic":"zigbee2mqtt/bridge/config/remove","qos":"","retain":"","broker":"ad236b55.6b1d","x":1190,"y":60,"wires":[]},{"id":"f7e2b727.ff66d8","type":"function","z":"42b8f54d.421ebc","name":"Format Data","func":"flow.set('remove',msg.payload.remove);","outputs":1,"noerr":0,"x":650,"y":60,"wires":[[]]},{"id":"e0d85554.3b858","type":"change","z":"42b8f54d.421ebc","name":"change msg old","rules":[{"t":"move","p":"payload","pt":"msg","to":"payload.remove","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":480,"y":60,"wires":[["f7e2b727.ff66d8"]]},{"id":"93a1ab46.6bb01","type":"function","z":"42b8f54d.421ebc","name":"Format Data","func":"var remove = flow.get('remove');\nif (typeof remove !== 'undefined' && remove !== null && remove !== \"\"){\nmsg.payload = remove;\n\nreturn msg;\n}","outputs":1,"noerr":0,"x":970,"y":60,"wires":[["abae8314.e495f"]]},{"id":"eaeec96b.c2bcb8","type":"ui_button","z":"42b8f54d.421ebc","name":"","group":"21062c5b.b1996c","order":5,"width":0,"height":0,"passthru":false,"label":"Remove","color":"","bgcolor":"","icon":"","payload":"","payloadType":"date","topic":"","x":820,"y":60,"wires":[["93a1ab46.6bb01","6698496b.f4c06"]]},{"id":"f507a0eb.a4118","type":"comment","z":"42b8f54d.421ebc","name":"Remove Device","info":"","x":120,"y":60,"wires":[]},{"id":"862ac36f.ff794","type":"mqtt in","z":"42b8f54d.421ebc","name":"zigbee2mqtt/logging","topic":"zigbee2mqtt/bridge/log","qos":"2","broker":"6354184f.0cac68","x":290,"y":120,"wires":[["2a98568d.7219d2"]]},{"id":"2a98568d.7219d2","type":"json","z":"42b8f54d.421ebc","name":"","property":"payload","action":"","pretty":false,"x":450,"y":120,"wires":[["552859f7.c32b5"]]},{"id":"3a08d6fd.283372","type":"ui_toast","z":"42b8f54d.421ebc","position":"top right","displayTime":"5","highlight":"","outputs":0,"ok":"OK","cancel":"","topic":"System Notification","name":"","x":790,"y":120,"wires":[]},{"id":"552859f7.c32b5","type":"function","z":"42b8f54d.421ebc","name":"Notification","func":"if(msg.payload.type == 'device_removed') {\nvar remove = flow.get('remove');\nif (typeof remove !== 'undefined' && remove !== null && remove !== \"\"){\nmsg.payload = (\"Deviced removed: \" + msg.payload.message);\n\n// Reset field\n//remove = \"\";\n//flow.set('remove',msg.payload.message);\n\nreturn msg;\n}\n}\n\n","outputs":1,"noerr":0,"x":590,"y":120,"wires":[["3a08d6fd.283372"]]},{"id":"9cf35d5b.db3ec","type":"comment","z":"42b8f54d.421ebc","name":"Notification","info":"","x":110,"y":120,"wires":[]},{"id":"5036db27.dadfd4","type":"ui_toast","z":"42b8f54d.421ebc","position":"top right","displayTime":"5","highlight":"","outputs":0,"ok":"OK","cancel":"","topic":"System Notification","name":"","x":1210,"y":120,"wires":[]},{"id":"6698496b.f4c06","type":"function","z":"42b8f54d.421ebc","name":"Notification","func":"var remove = flow.get('remove');\nif (typeof remove === 'undefined' || remove === null || remove === \"\"){\nmsg.payload = \"Enter a device to remove\";\n\nreturn msg;\n}","outputs":1,"noerr":0,"x":1010,"y":120,"wires":[["5036db27.dadfd4"]]},{"id":"c9476544.a189","type":"ui_dropdown","z":"cc5916a0.c6f7d8","name":"","label":"","place":"Select option","group":"4c9b5ea9.896df8","order":1,"width":0,"height":0,"passthru":true,"options":[{"label":"Allow","value":"true","type":"str"},{"label":"Deny","value":"false","type":"str"}],"payload":"","topic":"","x":90,"y":40,"wires":[["3b6d75d9.62a0ba","91473305.b72f1"]]},{"id":"3b6d75d9.62a0ba","type":"mqtt out","z":"cc5916a0.c6f7d8","name":"zigbee2mqtt/in Join","topic":"zigbee2mqtt/bridge/config/permit_join","qos":"","retain":"","broker":"ad236b55.6b1d","x":270,"y":40,"wires":[]},{"id":"9756b1e1.cf45d8","type":"ui_toast","z":"cc5916a0.c6f7d8","position":"top right","displayTime":"5","highlight":"","outputs":0,"ok":"OK","cancel":"","topic":"System Notification","name":"","x":450,"y":100,"wires":[]},{"id":"91473305.b72f1","type":"function","z":"cc5916a0.c6f7d8","name":"Notification","func":"if (typeof msg.payload !== 'undefined' && msg.payload !== null && msg.payload !== \"\"){\nif (msg.payload == \"false\"){\n    msg.payload = \"Permit join: Deny\";\n}\nif (msg.payload == \"true\"){\n    msg.payload = \"Permit join: Allow\";\n}\nreturn msg;\n}\n","outputs":1,"noerr":0,"x":250,"y":100,"wires":[["9756b1e1.cf45d8"]]},{"id":"2a95568d.7cc7a2","type":"ui_text_input","z":"30a4c25a.8240d6","name":"","label":"Old Name","group":"2446b16a.26b45e","order":3,"width":0,"height":0,"passthru":true,"mode":"text","delay":"5","topic":"","x":120,"y":140,"wires":[["88ff5ba9.47df5"]]},{"id":"1714b0c9.04a9df","type":"ui_text_input","z":"30a4c25a.8240d6","name":"","label":"New Name","group":"2446b16a.26b45e","order":4,"width":0,"height":0,"passthru":true,"mode":"text","delay":"5","topic":"","x":130,"y":200,"wires":[["447185da.64342c"]]},{"id":"d6590bb1.4af308","type":"mqtt out","z":"30a4c25a.8240d6","name":"zigbee2mqtt/in Rename","topic":"zigbee2mqtt/bridge/config/rename","qos":"","retain":"","broker":"ad236b55.6b1d","x":1010,"y":140,"wires":[]},{"id":"466ccdfe.e0118c","type":"function","z":"30a4c25a.8240d6","name":"Format Data","func":"flow.set('oldname',msg.payload.old);","outputs":1,"noerr":0,"x":470,"y":140,"wires":[[]]},{"id":"88ff5ba9.47df5","type":"change","z":"30a4c25a.8240d6","name":"change msg old","rules":[{"t":"move","p":"payload","pt":"msg","to":"payload.old","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":300,"y":140,"wires":[["466ccdfe.e0118c"]]},{"id":"447185da.64342c","type":"change","z":"30a4c25a.8240d6","name":"change msg new","rules":[{"t":"move","p":"payload","pt":"msg","to":"payload.new","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":310,"y":200,"wires":[["2de4fdfa.1fb98a"]]},{"id":"60983e78.e26298","type":"function","z":"30a4c25a.8240d6","name":"Format Data","func":"var oldname = flow.get('oldname');\nvar newname = flow.get('newname');\n\nif (typeof oldname !== 'undefined' && oldname !== null && oldname !== \"\" && typeof newname !== 'undefined' && newname !== null && newname !== \"\"){\nmsg.payload = {\"old\": oldname, \"new\": newname}\n\n// Reset fields\noldname = \"\";\nnewname = \"\";\nflow.set('oldname',msg.payload.old);\nflow.set('newname',msg.payload.new);\n\nreturn msg;\n}","outputs":1,"noerr":0,"x":790,"y":140,"wires":[["d6590bb1.4af308"]]},{"id":"2de4fdfa.1fb98a","type":"function","z":"30a4c25a.8240d6","name":"Format Data","func":"flow.set('newname',msg.payload.new);","outputs":1,"noerr":0,"x":490,"y":200,"wires":[[]]},{"id":"12529f4e.110461","type":"ui_button","z":"30a4c25a.8240d6","name":"","group":"2446b16a.26b45e","order":5,"width":0,"height":0,"passthru":false,"label":"Rename","color":"","bgcolor":"","icon":"","payload":"","payloadType":"date","topic":"","x":640,"y":140,"wires":[["60983e78.e26298","a18934a8.d51ac"]]},{"id":"de0fd9c4.6268b","type":"ui_toast","z":"30a4c25a.8240d6","position":"top right","displayTime":"5","highlight":"","outputs":0,"ok":"OK","cancel":"","topic":"System Notification","name":"","x":850,"y":200,"wires":[]},{"id":"a18934a8.d51ac","type":"function","z":"30a4c25a.8240d6","name":"Notification","func":"var oldname = flow.get('oldname');\nvar newname = flow.get('newname');\n\nif (typeof oldname !== 'undefined' && oldname !== null && oldname !== \"\" && typeof newname !== 'undefined' && newname !== null && newname !== \"\"){\nmsg.payload = (\"Rename Device: \" + oldname + \" to \" + newname);\nreturn msg;\n} else {\nmsg.payload = \"Enter device to rename\";\nreturn msg;\n}\n","outputs":1,"noerr":0,"x":670,"y":200,"wires":[["de0fd9c4.6268b"]]},{"id":"2774c571.84a592","type":"subflow:30a4c25a.8240d6","z":"f7662c55.d7af78","name":"","x":120,"y":120,"wires":[]},{"id":"3070fecf.d10222","type":"subflow:cc5916a0.c6f7d8","z":"f7662c55.d7af78","name":"","x":100,"y":80,"wires":[]},{"id":"d1c47ebb.c3b5e8","type":"subflow:42b8f54d.421ebc","z":"f7662c55.d7af78","name":"","x":120,"y":160,"wires":[]},{"id":"189b2e69.dab26a","type":"comment","z":"f7662c55.d7af78","name":"Function","info":"","x":100,"y":40,"wires":[]},{"id":"9a2805c4.2e7588","type":"subflow:96bcddc3.ee066","z":"f7662c55.d7af78","name":"","x":110,"y":200,"wires":[]},{"id":"95a82f3d.5db36","type":"subflow:ee4ab2d3.1c8a8","z":"f7662c55.d7af78","name":"","x":90,"y":240,"wires":[]},{"id":"d64ea8b1.2618e","type":"subflow:9c9c1888.cd55a8","z":"f7662c55.d7af78","name":"","x":90,"y":280,"wires":[]},{"id":"5ef44b61.da6234","type":"comment","z":"f7662c55.d7af78","name":"Other","info":"","x":350,"y":40,"wires":[]},{"id":"2e1d2b6e.0997a4","type":"subflow:25dfd7a6.3ce178","z":"f7662c55.d7af78","name":"","x":390,"y":80,"wires":[]},{"id":"3fedd5a8.1dac82","type":"subflow:17f2fcdf.e26acb","z":"f7662c55.d7af78","name":"","x":370,"y":140,"wires":[]},{"id":"8e0363d6.683ae","type":"function","z":"74cedccf.2b6a6c","name":"","func":"msg.retain=true;\nreturn msg;","outputs":1,"noerr":0,"x":566.5,"y":4687,"wires":[["a6769ff6.8f2be"]]},{"id":"7952a005.7e536","type":"function","z":"74cedccf.2b6a6c","name":"","func":"msg.retain=true;\nreturn msg;","outputs":1,"noerr":0,"x":1365,"y":4730,"wires":[["4bea7f42.22e0a"]]},{"id":"477222d5.0297ac","type":"function","z":"74cedccf.2b6a6c","name":"","func":"msg.retain=true;\nreturn msg;","outputs":1,"noerr":0,"x":1563,"y":4382,"wires":[["d937c5a1.97df38"]]},{"id":"1b7769d2.c5cf8e","type":"debug","z":"959e3a35.8b3bc","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":359.5,"y":354,"wires":[]},{"id":"827263d9.67174","type":"switch","z":"959e3a35.8b3bc","name":"","property":"payload","propertyType":"msg","rules":[{"t":"neq","v":"PING","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":232.5,"y":272,"wires":[["e264c015.7fb86"]]},{"id":"345c4e21.89a4ea","type":"mqtt in","z":"74cedccf.2b6a6c","name":"PoolPumpTELEMETRY","topic":"stat/PoolPump/STATUS8","qos":"0","datatype":"auto","broker":"e6d8a0f0.6f5878","x":176.10000610351562,"y":2572.800048828125,"wires":[["645cc9a8.1f57c8","66622477.ef16a4"]]},{"id":"55b7c576.f5ac0c","type":"function","z":"74cedccf.2b6a6c","name":"F-Dim","func":"var currentVoltage=msg.payload;\nvar msg2 = RED.util.cloneMessage(msg);\nmsg2.topic=\"cmnd/RubenLig/Dimmer\"\nmsg2.payload=\"-\"\nmsg2.retain=false\nreturn msg2;\n","outputs":1,"noerr":0,"x":1235.3499755859375,"y":4856.25,"wires":[["4bea7f42.22e0a","e6d324f0.e5755"]]},{"id":"e6d324f0.e5755","type":"debug","z":"74cedccf.2b6a6c","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1574.3000183105469,"y":4831.000030517578,"wires":[]},{"id":"4c1adf12.e3d7f8","type":"function","z":"74cedccf.2b6a6c","name":"F-Dim-reset","func":"var currentVoltage=msg.payload;\nvar msg2 = RED.util.cloneMessage(msg);\nmsg2.topic=\"cmnd/RubenLig/Dimmer\"\nmsg2.payload=\"100\"\nmsg2.retain=false\nreturn msg2;\n","outputs":1,"noerr":0,"x":1255.3499755859375,"y":4905.25,"wires":[["e6d324f0.e5755","4bea7f42.22e0a"]]},{"id":"866d5236.f4c308","type":"inject","z":"f1d27ec0.44fba","name":"","topic":"chat","payload":"test","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":227.10000610351562,"y":310.1000061035156,"wires":[["30f30d13.b2bbea"]]},{"id":"6646465e.232f08","type":"chatbot-telegram-send","z":"f1d27ec0.44fba","bot":"5110ad9.459dfd4","botProduction":"6e0b1483.5b9484","track":false,"passThrough":true,"outputs":1,"x":830.0999450683594,"y":401.25001525878906,"wires":[[]]},{"id":"fe00b7dc.b9bc48","type":"chatbot-telegram-receive","z":"f1d27ec0.44fba","bot":"5110ad9.459dfd4","botProduction":"6e0b1483.5b9484","x":220.30001831054688,"y":145.25,"wires":[["5be5280e.a3e358","3b999ebd.d4f5ea"]]},{"id":"5be5280e.a3e358","type":"debug","z":"f1d27ec0.44fba","name":"inc","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":712.300048828125,"y":86.39998626708984,"wires":[]},{"id":"30f30d13.b2bbea","type":"function","z":"f1d27ec0.44fba","name":"","func":"msg.payload = 'I am a message';\nreturn msg;","outputs":1,"noerr":0,"x":358.3000183105469,"y":265.8999938964844,"wires":[["154b8d1c.899d4b","a5aed3d7.2a4cc"]]},{"id":"154b8d1c.899d4b","type":"debug","z":"f1d27ec0.44fba","name":"func","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":533.3000183105469,"y":398,"wires":[]},{"id":"66cb3bb9.006014","type":"debug","z":"f1d27ec0.44fba","name":"chat","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":728.3000183105469,"y":192,"wires":[]},{"id":"a5aed3d7.2a4cc","type":"chatbot-conversation","z":"f1d27ec0.44fba","name":"","botTelegram":"5110ad9.459dfd4","botTelegramProduction":"6e0b1483.5b9484","botSlack":"","botSlackProduction":"","botFacebook":"","botFacebookProduction":"","botViber":"","botViberProduction":"","botUniversal":"","botUniversalProduction":"","botTwilio":"","botTwilioProduction":"","botDiscord":"","botDiscordProduction":"","chatId":"143456971","transport":"telegram","messageId":"","contextMessageId":false,"store":"","x":537.2999877929688,"y":497.75,"wires":[["a75732fa.305328","12c00eca.f549b1"]]},{"id":"a75732fa.305328","type":"debug","z":"f1d27ec0.44fba","name":"conv","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":726.0999755859375,"y":541.7000122070312,"wires":[]},{"id":"3b999ebd.d4f5ea","type":"chatbot-message","z":"f1d27ec0.44fba","name":"","message":[{"message":"Hallo groot baas"}],"answer":true,"silent":false,"x":490.3000183105469,"y":180.95001220703125,"wires":[["66cb3bb9.006014"]]},{"id":"12c00eca.f549b1","type":"chatbot-message","z":"f1d27ec0.44fba","name":"","message":[""],"answer":false,"silent":false,"x":681.300048828125,"y":447.3999938964844,"wires":[["6646465e.232f08"]]},{"id":"57fe23b8.a8ce84","type":"function","z":"dce503cb.29adb","name":"FilterMotionSensor","func":"//Outputs:\n// 1 - Original Message\n// 2 - Formatted for MQTT\n// 3 - A debug message\n\n\n//msgMQTT.topic = \"in/Aqara\";\nif ( msg.payload.model === \"sensor_motion.aq2\" ) {\n            //msg = null;\n    } else {\n        msg = null;\n    }\n\n\nreturn msg;","outputs":1,"noerr":0,"x":681.1000366210938,"y":723.2999877929688,"wires":[["7eec9752.8a732","b99b8aec.52675"]]},{"id":"7eec9752.8a732","type":"debug","z":"dce503cb.29adb","name":"OnlyMotion","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":1263.0999145507812,"y":832.2999877929688,"wires":[]},{"id":"b99b8aec.52675","type":"function","z":"dce503cb.29adb","name":"","func":"if ( msg.payload.data.status === \"motion\" ) {\n    msg.payload = 'Motion Detected!';\n} else {\n    msg = null;\n}\nreturn msg;","outputs":1,"noerr":0,"x":971.300048828125,"y":672.5999755859375,"wires":[["d5b3e1f5.e13c48"]]},{"id":"b6babfb1.97f778","type":"chatbot-telegram-send","z":"f1d27ec0.44fba","bot":"5110ad9.459dfd4","botProduction":"6e0b1483.5b9484","track":false,"passThrough":true,"outputs":1,"x":709.14990234375,"y":805.7000122070312,"wires":[[]]},{"id":"aebc0c0b.7a5708","type":"chatbot-conversation","z":"f1d27ec0.44fba","name":"","botTelegram":"5110ad9.459dfd4","botTelegramProduction":"6e0b1483.5b9484","botSlack":"","botSlackProduction":"","botFacebook":"","botFacebookProduction":"","botViber":"","botViberProduction":"","botUniversal":"","botUniversalProduction":"","botTwilio":"","botTwilioProduction":"","botDiscord":"","botDiscordProduction":"","chatId":"-1001473165024","transport":"telegram","messageId":"","contextMessageId":false,"store":"","x":416.3499450683594,"y":902.1999969482422,"wires":[["bfdd8cec.05ed68","8e9f69b.1182f18"]]},{"id":"bfdd8cec.05ed68","type":"debug","z":"f1d27ec0.44fba","name":"conv","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":605.1499328613281,"y":946.1500091552734,"wires":[]},{"id":"8e9f69b.1182f18","type":"chatbot-message","z":"f1d27ec0.44fba","name":"","message":[""],"answer":false,"silent":false,"x":560.3500061035156,"y":851.8499908447266,"wires":[["b6babfb1.97f778"]]},{"id":"c0032d02.5d609","type":"function","z":"f1d27ec0.44fba","name":"","func":"msg.payload = 'group hallo!';\n\nreturn msg;","outputs":1,"noerr":0,"x":271,"y":946,"wires":[["aebc0c0b.7a5708"]]},{"id":"995ea0f2.d630d","type":"inject","z":"f1d27ec0.44fba","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":128.30001831054688,"y":865.3999938964844,"wires":[["c0032d02.5d609"]]},{"id":"2cf6ab62.54f09c","type":"mqtt in","z":"f1d27ec0.44fba","name":"SendAllStatus","topic":"out/Telegram/status/#","qos":"2","datatype":"auto","broker":"56fc61c8.bc429","x":141.3000030517578,"y":768.6000061035156,"wires":[["194a07a6.a56fa8"]]},{"id":"194a07a6.a56fa8","type":"function","z":"f1d27ec0.44fba","name":"","func":"//msg.payload = 'group hallo!';\n\nreturn msg;","outputs":1,"noerr":0,"x":273.1000061035156,"y":827.5,"wires":[["aebc0c0b.7a5708"]]},{"id":"d5b3e1f5.e13c48","type":"mqtt out","z":"dce503cb.29adb","name":"","topic":"out/Telegram/status/pir1","qos":"","retain":"","broker":"56fc61c8.bc429","x":1200.3000183105469,"y":543.7000122070312,"wires":[]},{"id":"d2b9c2b.b6cd6c","type":"mqtt out","z":"74cedccf.2b6a6c","name":"","topic":"out/Telegram/status/kaste","qos":"","retain":"","broker":"56fc61c8.bc429","x":752.0999755859375,"y":3343.699951171875,"wires":[]},{"id":"52148da0.b1b7b4","type":"change","z":"74cedccf.2b6a6c","name":"","rules":[{"t":"change","p":"payload","pt":"msg","from":"1","fromt":"str","to":"Gangkas oop","tot":"str"},{"t":"change","p":"payload","pt":"msg","from":"0","fromt":"str","to":"Gangkas toe","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":453.300048828125,"y":3346.5999755859375,"wires":[["d2b9c2b.b6cd6c"]]},{"id":"11ab9ff6.0232e8","type":"change","z":"74cedccf.2b6a6c","name":"","rules":[{"t":"change","p":"payload","pt":"msg","from":"1","fromt":"str","to":"Martie kas1 oop","tot":"str"},{"t":"change","p":"payload","pt":"msg","from":"0","fromt":"str","to":"Martie kas1 toe","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":429.1000061035156,"y":3477.300048828125,"wires":[["74c665c4.e344fc"]]},{"id":"74c665c4.e344fc","type":"mqtt out","z":"74cedccf.2b6a6c","name":"","topic":"out/Telegram/status/kaste","qos":"","retain":"","broker":"56fc61c8.bc429","x":911.89990234375,"y":3469.39990234375,"wires":[]},{"id":"3adb1d8f.cb8ca2","type":"change","z":"74cedccf.2b6a6c","name":"","rules":[{"t":"change","p":"payload","pt":"msg","from":"1","fromt":"str","to":"Martie kas2 oop","tot":"str"},{"t":"change","p":"payload","pt":"msg","from":"0","fromt":"str","to":"Martie kas2 toe","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":453.1000061035156,"y":3626.5,"wires":[["6fc56b29.510edc"]]},{"id":"6fc56b29.510edc","type":"mqtt out","z":"74cedccf.2b6a6c","name":"","topic":"out/Telegram/status/kaste","qos":"","retain":"","broker":"56fc61c8.bc429","x":904.89990234375,"y":3614.599853515625,"wires":[]},{"id":"124ec91f.75ff57","type":"change","z":"74cedccf.2b6a6c","name":"","rules":[{"t":"change","p":"payload","pt":"msg","from":"1","fromt":"str","to":"Martie kas3 oop","tot":"str"},{"t":"change","p":"payload","pt":"msg","from":"0","fromt":"str","to":"Martie kas3 toe","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":466.1000061035156,"y":3770.5,"wires":[["55e9a2a0.0f5cfc"]]},{"id":"55e9a2a0.0f5cfc","type":"mqtt out","z":"74cedccf.2b6a6c","name":"","topic":"out/Telegram/status/kaste","qos":"","retain":"","broker":"56fc61c8.bc429","x":924.8999633789062,"y":3769.599853515625,"wires":[]},{"id":"e3303c2c.0c6268","type":"mqtt out","z":"74cedccf.2b6a6c","name":"","topic":"out/Telegram/status/kaste","qos":"","retain":"","broker":"56fc61c8.bc429","x":755.7999267578125,"y":4008.5,"wires":[]},{"id":"2675d0a1.38d008","type":"change","z":"74cedccf.2b6a6c","name":"","rules":[{"t":"change","p":"payload","pt":"msg","from":"1","fromt":"str","to":"Org Rak kas oop","tot":"str"},{"t":"change","p":"payload","pt":"msg","from":"0","fromt":"str","to":"Org Rak kas toe","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":471,"y":4008.400146484375,"wires":[["e3303c2c.0c6268"]]},{"id":"d27c6cc.05caf9","type":"mqtt out","z":"74cedccf.2b6a6c","name":"","topic":"out/Telegram/status/kaste","qos":"","retain":"","broker":"56fc61c8.bc429","x":763.0999755859375,"y":4162.699951171875,"wires":[]},{"id":"30ed9f9d.3e8c","type":"change","z":"74cedccf.2b6a6c","name":"","rules":[{"t":"change","p":"payload","pt":"msg","from":"1","fromt":"str","to":"Org hangkas oop","tot":"str"},{"t":"change","p":"payload","pt":"msg","from":"0","fromt":"str","to":"Org hangkas toe","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":464.300048828125,"y":4161.60009765625,"wires":[["d27c6cc.05caf9"]]},{"id":"b29bbf03.4dd108","type":"change","z":"2dba819.654bb7e","name":"Kuga garagedeur","rules":[{"t":"change","p":"payload","pt":"msg","from":"Fault","fromt":"str","to":"Kuga garage oop","tot":"str"},{"t":"change","p":"payload","pt":"msg","from":"Ok","fromt":"str","to":"Kuga garage toe","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1497.5999755859375,"y":134.10000610351562,"wires":[["78fdee69.ef5218"]]},{"id":"78fdee69.ef5218","type":"mqtt out","z":"2dba819.654bb7e","name":"","topic":"out/Telegram/status/garage","qos":"","retain":"","broker":"56fc61c8.bc429","x":1760.3999328613281,"y":146.199951171875,"wires":[]},{"id":"daf4ed2c.6b4ab8","type":"change","z":"2dba819.654bb7e","name":"Mazda garagedeur","rules":[{"t":"change","p":"payload","pt":"msg","from":"Fault","fromt":"str","to":"Mazda garage oop","tot":"str"},{"t":"change","p":"payload","pt":"msg","from":"Ok","fromt":"str","to":"Mzada garage toe","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1499.949951171875,"y":198.10000610351562,"wires":[["78fdee69.ef5218"]]},{"id":"9ad373b2.6053a","type":"change","z":"2dba819.654bb7e","name":"Workshop garagedeur","rules":[{"t":"change","p":"payload","pt":"msg","from":"Fault","fromt":"str","to":"Workshop garage oop","tot":"str"},{"t":"change","p":"payload","pt":"msg","from":"Ok","fromt":"str","to":"Workshop garage toe","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1519.949951171875,"y":253.10000610351562,"wires":[["78fdee69.ef5218"]]},{"id":"f678f272.deb05","type":"mqtt out","z":"74cedccf.2b6a6c","name":"SaveStateKasLig33","topic":"","qos":"0","retain":"true","broker":"56fc61c8.bc429","x":875.5,"y":3519,"wires":[]},{"id":"3bc665ed.c7c1fa","type":"mqtt in","z":"74cedccf.2b6a6c","name":"ReadStateRifleSafe36Switch","topic":"stat/riflesafe/switchstate","qos":"2","datatype":"auto","broker":"56fc61c8.bc429","x":184,"y":3952.800048828125,"wires":[["7a0aac5f.b45264"]]},{"id":"cd8b1947.499638","type":"mqtt out","z":"74cedccf.2b6a6c","name":"","topic":"out/Telegram/status/kaste","qos":"","retain":"","broker":"56fc61c8.bc429","x":765.7999267578125,"y":3959.300048828125,"wires":[]},{"id":"7a0aac5f.b45264","type":"change","z":"74cedccf.2b6a6c","name":"","rules":[{"t":"change","p":"payload","pt":"msg","from":"1","fromt":"str","to":"Geweerkluis oop","tot":"str"},{"t":"change","p":"payload","pt":"msg","from":"0","fromt":"str","to":"Geweerkluis toe","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":481,"y":3959.2001953125,"wires":[["cd8b1947.499638"]]},{"id":"793b0a2.48685f4","type":"mqtt in","z":"74cedccf.2b6a6c","name":"ReadStateElectronicsafe36Switch","topic":"stat/electronicsafe/switchstate","qos":"2","datatype":"auto","broker":"56fc61c8.bc429","x":205,"y":3905.800048828125,"wires":[["e3d8964e.302c78"]]},{"id":"c0120dd1.1b938","type":"mqtt out","z":"74cedccf.2b6a6c","name":"","topic":"out/Telegram/status/kaste","qos":"","retain":"","broker":"56fc61c8.bc429","x":766.7999267578125,"y":3912.300048828125,"wires":[]},{"id":"e3d8964e.302c78","type":"change","z":"74cedccf.2b6a6c","name":"","rules":[{"t":"change","p":"payload","pt":"msg","from":"1","fromt":"str","to":"Electronic kluis oop","tot":"str"},{"t":"change","p":"payload","pt":"msg","from":"0","fromt":"str","to":"Electronic kluis toe","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":482,"y":3912.2001953125,"wires":[["c0120dd1.1b938"]]},{"id":"b86b8fc5.d7c9b","type":"ui_switch","z":"74cedccf.2b6a6c","name":"ServerFan","label":"Server Fan","group":"4357843d.5f1d34","order":1,"width":"","height":"","passthru":false,"decouple":"true","topic":"cmnd/serverfan/power","onvalue":"ON","onvalueType":"str","onicon":"","oncolor":"","offvalue":"OFF","offvalueType":"str","officon":"","offcolor":"","x":1387,"y":3353,"wires":[["d2c759fa.462c08"]]},{"id":"ade28c65.1d29","type":"mqtt in","z":"74cedccf.2b6a6c","name":"ReadStateServerFan","topic":"stat/serverfan/POWER","qos":"0","datatype":"auto","broker":"56fc61c8.bc429","x":1090,"y":3352,"wires":[["b86b8fc5.d7c9b","7f8d8088.a83998","c9bafe3d.c15e1"]]},{"id":"d2c759fa.462c08","type":"mqtt out","z":"74cedccf.2b6a6c","name":"SaveStateServerFan","topic":"cmnd/serverfan/power","qos":"0","retain":"false","broker":"56fc61c8.bc429","x":2109.5,"y":3361,"wires":[]},{"id":"4895c674.380e18","type":"mqtt out","z":"74cedccf.2b6a6c","name":"","topic":"out/Telegram/status/fans","qos":"","retain":"","broker":"56fc61c8.bc429","x":1850.0999755859375,"y":3449.566650390625,"wires":[]},{"id":"7f8d8088.a83998","type":"change","z":"74cedccf.2b6a6c","name":"","rules":[{"t":"change","p":"payload","pt":"msg","from":"ON","fromt":"str","to":"Server Fan ON","tot":"str"},{"t":"change","p":"payload","pt":"msg","from":"OFF","fromt":"str","to":"Server Fan OFF","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1477.300048828125,"y":3438.466796875,"wires":[["4895c674.380e18"]]},{"id":"279e289a.04ba08","type":"mqtt in","z":"74cedccf.2b6a6c","name":"ServerKasTemperatuur","topic":"/temp/ServerKas","qos":"0","datatype":"auto","broker":"e6d8a0f0.6f5878","x":1121,"y":3257,"wires":[["2648156c.d73dba"]]},{"id":"2648156c.d73dba","type":"switch","z":"74cedccf.2b6a6c","name":"","property":"payload","propertyType":"msg","rules":[{"t":"gte","v":"29","vt":"num"},{"t":"lt","v":"27","vt":"num"}],"checkall":"true","repair":false,"outputs":2,"x":1345.5,"y":3243,"wires":[["3d686241.1b1ea6"],["eff71491.f311b8"]]},{"id":"3d686241.1b1ea6","type":"change","z":"74cedccf.2b6a6c","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"ON","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1543.5,"y":3215,"wires":[["c9bafe3d.c15e1","bb31321d.79855"]]},{"id":"eff71491.f311b8","type":"change","z":"74cedccf.2b6a6c","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"OFF","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1542,"y":3253,"wires":[["c9bafe3d.c15e1","bb31321d.79855"]]},{"id":"c9bafe3d.c15e1","type":"join","z":"74cedccf.2b6a6c","name":"","mode":"custom","build":"object","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":true,"timeout":"","count":"1","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":1771.5,"y":3293,"wires":[["d4e384ec.b1ee28"]]},{"id":"d4e384ec.b1ee28","type":"function","z":"74cedccf.2b6a6c","name":"","func":"if ( msg.payload[\"/temp/ServerKas\"] == \"ON\" ) {\n    currentState = msg.payload[\"stat/serverfan/POWER\"]||\"OFF\";\n    if ( currentState == \"OFF\" ) {\n        msg.payload = \"ON\";\n        return msg;\n    }\n}\n\nif ( msg.payload[\"/temp/ServerKas\"] == \"OFF\" ) {\n    currentState = msg.payload[\"stat/serverfan/POWER\"]||\"ON\";\n    if ( currentState == \"ON\" ) {\n        msg.payload = \"OFF\";\n        return msg;\n    }\n}\n","outputs":1,"noerr":0,"x":1916.5,"y":3287,"wires":[["89b16560.63c578","d2c759fa.462c08"]]},{"id":"89b16560.63c578","type":"debug","z":"74cedccf.2b6a6c","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":2083.5,"y":3278,"wires":[]},{"id":"bb31321d.79855","type":"debug","z":"74cedccf.2b6a6c","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1918.5,"y":3194,"wires":[]}]